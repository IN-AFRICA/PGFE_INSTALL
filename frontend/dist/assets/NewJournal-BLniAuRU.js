import{d as ue,A as j,s as S,a as ne,p as B,q as oe,v as de,x as p,w as a,b as T,f as l,i as t,z as g,y as d,c as i,h as _,a4 as F,t as m,B as C,C as A,D as w,E as L,J as f,G as y,F as N,k as Q,g as re,o as n}from"./index-CJ_PivE-.js";import{_ as W}from"./Input.vue_vue_type_script_setup_true_lang-B9adgRZV.js";import{_ as ie}from"./Textarea.vue_vue_type_script_setup_true_lang-Bg8QXdyw.js";import{_ as me}from"./ComptaLayout.vue_vue_type_script_setup_true_lang-Bu3Oqdii.js";import{_ as pe}from"./FormSection.vue_vue_type_script_setup_true_lang-C-XSdIg3.js";import{I as v}from"./InputWrapper-tSRHzcjN.js";import{S as x}from"./SpanRequired-COKghTUX.js";import{_ as V}from"./SelectGroup.vue_vue_type_script_setup_true_lang-CwIOzTi6.js";import{u as ce}from"./usePostApi-Crg8MURP.js";import{u as H}from"./useGetApi-EdzHoZm6.js";import{o as fe,aM as q,a4 as _e,s as h,av as E,u as ye,aQ as k,t as be}from"./vee-validate-zod-Bra4yLtR.js";import{e as ge}from"./eventBus-CGRXT3Tn.js";import{t as ve}from"./utils-74-Kdsy2.js";import"./index-BpkKmY4O.js";import"./DashPageHeader.vue_vue_type_script_setup_true_lang-DucYyTAx.js";import"./DashLayout.vue_vue_type_script_setup_true_lang-Ch2egXHm.js";import"./RightDashHeader.vue_vue_type_script_setup_true_lang-Bn3G870_.js";import"./BoxPanelWrapper.vue_vue_type_script_setup_true_lang-CmJ-Iy6y.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const xe={key:0,class:"text-sm text-red-500"},ke={key:0,class:"text-sm text-red-500"},he={key:0,class:"text-sm text-red-500"},Se={key:0,class:"text-sm text-red-500"},Ce={key:0,class:"text-sm text-red-500"},Ae={key:0,class:"text-sm text-red-500"},we={key:0,class:"text-sm text-red-500"},Le={key:0,class:"text-sm text-red-500"},Ne={class:"flex items-center justify-end gap-2"},Ve={key:0},qe={key:1},Ye=ue({__name:"NewJournal",setup(Ee){const K=fe({date:h().min(1,"La date est requise"),description:h().min(1,"La description est requise").max(255,"255 caractères maximum"),montant:_e.number({invalid_type_error:"Le montant doit être un nombre"}).min(0,"Le montant doit être positif"),input_account_id:q([h().refine(s=>s!=="","Le compte d'entrée est requis").transform(s=>Number(s)),E()]).refine(s=>Number(s)>0,"Le compte d'entrée est requis"),output_account_id:q([h().refine(s=>s!=="","Le compte de sortie est requis").transform(s=>Number(s)),E()]).refine(s=>Number(s)>0,"Le compte de sortie est requis"),account_plan_id:q([h().refine(s=>s!=="","Le plan comptable est requis").transform(s=>Number(s)),E()]).refine(s=>Number(s)>0,"Le plan comptable est requis"),sub_account_plan_id:q([h().refine(s=>s!=="","Le sous-compte est requis").transform(s=>Number(s)),E()]).refine(s=>Number(s)>0,"Le sous-compte est requis"),account_id:q([h().refine(s=>s!=="","Le compte est requis").transform(s=>Number(s)),E()]).refine(s=>Number(s)>0,"Le compte est requis")}),{handleSubmit:X,resetForm:Y,setFieldValue:Z,values:J}=ye({validationSchema:be(K),initialValues:{date:new Date().toISOString().split("T")[0],description:"",montant:0,input_account_id:"",output_account_id:"",account_plan_id:"",sub_account_plan_id:"",account_id:""}}),{response:U,error:D,loading:P,postData:M}=ce(),O=ne(),R=X(async s=>{try{const e={...s,date:ve(s.date)};if(await M(j.CREATE_JOURNAL,e),D.value){S({message:typeof D.value=="string"?D.value:"Erreur lors de la création du journal.",type:"error"});return}U.value?U.value.success?(S({message:U.value.message||"Journal créé avec succès",type:"success"}),Y(),ge.emit("journalUpdated"),O.push("/comptabilite/saisie-operations")):S({message:U.value.message||"Erreur lors de la création du Journal.",type:"error"}):S({message:"Aucune réponse du serveur.",type:"error"})}catch(e){console.error("Erreur lors de la création du journal:",e),S({message:"Une erreur inattendue s'est produite.",type:"error"})}}),{data:ee,loading:$,fetchData:te}=H(j.GET_COMPTE),{data:ae,loading:le,fetchData:se}=H(j.GET_SUB_COMPTE);function G(s){let e=[];return Array.isArray(s)?e=s:s!=null&&s.data&&Array.isArray(s.data)?e=s.data:s!=null&&s.items&&Array.isArray(s.items)?e=s.items:s!=null&&s.accounts&&Array.isArray(s.accounts)?e=s.accounts:s&&typeof s=="object"&&(e=Object.values(s).filter(o=>o&&typeof o=="object"&&(o.id||o.value))),e}const b=B(()=>G(ee.value).map(e=>({id:String(e.id??e.value??""),name:e.name??e.label??e.libelle??e.title??e.account??`Compte #${e.id??e.value}`,code:e.code??e.number??e.code_compte}))),I=B(()=>G(ae.value).map(e=>({id:String(e.id??e.value??""),name:e.name??e.label??e.libelle??e.title??e.account??`Sous-compte #${e.id??e.value}`,code:e.code??e.number??e.code_compte,account_plan_id:e.account_plan_id??e.parent_id??e.plan_id??e.compte_id}))),z=B(()=>{const s=J.account_plan_id;return s?I.value.filter(e=>String(e.account_plan_id??"")===String(s)):I.value});return oe(()=>J.account_plan_id,()=>{Z("sub_account_plan_id","")}),de(async()=>{await Promise.all([te(),se()])}),(s,e)=>(n(),p(me,{activeBread:"Nouveau Journal","active-tag-name":"journal",group:"operations","show-header":!1},{default:a(()=>[T("form",{onSubmit:e[1]||(e[1]=re((...o)=>t(R)&&t(R)(...o),["prevent"])),class:"mt-10 space-y-8"},[l(pe,{class:"grid sm:grid-cols-2 lg:grid-cols-3 gap-y-6 gap-x-10",title:"Écriture de journal"},{default:a(()=>[l(v,null,{default:a(()=>[l(t(g),{class:"text-sm"},{default:a(()=>[e[2]||(e[2]=d(" Date ",-1)),l(x)]),_:1}),l(t(k),{name:"date"},{default:a(({field:o,errorMessage:r,meta:c})=>[l(t(W),F(o,{type:"date",class:"bg-gray-100 transition-all h-10 rounded-md"}),null,16),c.touched&&r?(n(),i("span",xe,m(r),1)):_("",!0)]),_:1})]),_:1}),l(v,{class:"lg:col-span-2"},{default:a(()=>[l(t(g),{class:"text-sm"},{default:a(()=>[e[3]||(e[3]=d(" Description ",-1)),l(x)]),_:1}),l(t(k),{name:"description"},{default:a(({field:o,errorMessage:r,meta:c})=>[l(t(ie),F(o,{class:"bg-gray-100 transition-all rounded-md min-h-[100px]",placeholder:"Ex: Paiement fournisseur - Facture n°12345"}),null,16),c.touched&&r?(n(),i("span",ke,m(r),1)):_("",!0)]),_:1})]),_:1}),l(v,null,{default:a(()=>[l(t(g),{class:"text-sm"},{default:a(()=>[e[4]||(e[4]=d(" Montant (FC) ",-1)),l(x)]),_:1}),l(t(k),{name:"montant"},{default:a(({field:o,errorMessage:r,meta:c})=>[l(t(W),F(o,{type:"number",step:"0.01",min:"0",class:"bg-gray-100 transition-all h-10 rounded-md",placeholder:"0.00"}),null,16),c.touched&&r?(n(),i("span",he,m(r),1)):_("",!0)]),_:1})]),_:1}),l(v,null,{default:a(()=>[l(t(g),{class:"text-sm"},{default:a(()=>[e[5]||(e[5]=d(" Compte d'entrée ",-1)),l(x)]),_:1}),l(t(k),{name:"input_account_id"},{default:a(({field:o,errorMessage:r,meta:c})=>[l(t(C),{"model-value":o.value,"onUpdate:modelValue":u=>o.onChange(u)},{default:a(()=>[l(t(A),{class:"!h-10 bg-white w-full"},{default:a(()=>[l(t(w),{placeholder:"Sélectionner le compte d'entrée"})]),_:1}),l(t(L),null,{default:a(()=>[l(t(V),null,{default:a(()=>[t($)?(n(),p(t(f),{key:0,value:"loading",disabled:""},{default:a(()=>[...e[6]||(e[6]=[d(" Chargement des comptes... ",-1)])]),_:1})):(n(),i(y,{key:1},[b.value.length?_("",!0):(n(),p(t(f),{key:0,value:"empty",disabled:""},{default:a(()=>[...e[7]||(e[7]=[d(" Aucun compte disponible ",-1)])]),_:1})),(n(!0),i(y,null,N(b.value,u=>(n(),p(t(f),{key:u.id,value:u.id},{default:a(()=>[d(m(u.code?u.code+" - ":"")+m(u.name),1)]),_:2},1032,["value"]))),128))],64))]),_:1})]),_:1})]),_:1},8,["model-value","onUpdate:modelValue"]),c.touched&&r?(n(),i("span",Se,m(r),1)):_("",!0)]),_:1})]),_:1}),l(v,null,{default:a(()=>[l(t(g),{class:"text-sm"},{default:a(()=>[e[8]||(e[8]=d(" Compte de sortie ",-1)),l(x)]),_:1}),l(t(k),{name:"output_account_id"},{default:a(({field:o,errorMessage:r,meta:c})=>[l(t(C),{"model-value":o.value,"onUpdate:modelValue":u=>o.onChange(u)},{default:a(()=>[l(t(A),{class:"!h-10 bg-white w-full"},{default:a(()=>[l(t(w),{placeholder:"Sélectionner le compte de sortie"})]),_:1}),l(t(L),null,{default:a(()=>[l(t(V),null,{default:a(()=>[t($)?(n(),p(t(f),{key:0,value:"loading",disabled:""},{default:a(()=>[...e[9]||(e[9]=[d(" Chargement des comptes... ",-1)])]),_:1})):(n(),i(y,{key:1},[b.value.length?_("",!0):(n(),p(t(f),{key:0,value:"empty",disabled:""},{default:a(()=>[...e[10]||(e[10]=[d(" Aucun compte disponible ",-1)])]),_:1})),(n(!0),i(y,null,N(b.value,u=>(n(),p(t(f),{key:u.id,value:u.id},{default:a(()=>[d(m(u.code?u.code+" - ":"")+m(u.name),1)]),_:2},1032,["value"]))),128))],64))]),_:1})]),_:1})]),_:1},8,["model-value","onUpdate:modelValue"]),c.touched&&r?(n(),i("span",Ce,m(r),1)):_("",!0)]),_:1})]),_:1}),l(v,null,{default:a(()=>[l(t(g),{class:"text-sm"},{default:a(()=>[e[11]||(e[11]=d(" Plan comptable ",-1)),l(x)]),_:1}),l(t(k),{name:"account_plan_id"},{default:a(({field:o,errorMessage:r,meta:c})=>[l(t(C),{"model-value":o.value,"onUpdate:modelValue":u=>o.onChange(u)},{default:a(()=>[l(t(A),{class:"!h-10 bg-white w-full"},{default:a(()=>[l(t(w),{placeholder:"Sélectionner le plan comptable"})]),_:1}),l(t(L),null,{default:a(()=>[l(t(V),null,{default:a(()=>[t($)?(n(),p(t(f),{key:0,value:"loading",disabled:""},{default:a(()=>[...e[12]||(e[12]=[d(" Chargement des plans... ",-1)])]),_:1})):(n(),i(y,{key:1},[b.value.length?_("",!0):(n(),p(t(f),{key:0,value:"empty",disabled:""},{default:a(()=>[...e[13]||(e[13]=[d(" Aucun plan disponible ",-1)])]),_:1})),(n(!0),i(y,null,N(b.value,u=>(n(),p(t(f),{key:u.id,value:u.id},{default:a(()=>[d(m(u.code?u.code+" - ":"")+m(u.name),1)]),_:2},1032,["value"]))),128))],64))]),_:1})]),_:1})]),_:1},8,["model-value","onUpdate:modelValue"]),c.touched&&r?(n(),i("span",Ae,m(r),1)):_("",!0)]),_:1})]),_:1}),l(v,null,{default:a(()=>[l(t(g),{class:"text-sm"},{default:a(()=>[e[14]||(e[14]=d(" Sous-compte ",-1)),l(x)]),_:1}),l(t(k),{name:"sub_account_plan_id"},{default:a(({field:o,errorMessage:r,meta:c})=>[l(t(C),{"model-value":o.value,"onUpdate:modelValue":u=>o.onChange(u)},{default:a(()=>[l(t(A),{class:"!h-10 bg-white w-full"},{default:a(()=>[l(t(w),{placeholder:"Sélectionner le sous-compte"})]),_:1}),l(t(L),null,{default:a(()=>[l(t(V),null,{default:a(()=>[t(le)?(n(),p(t(f),{key:0,value:"loading",disabled:""},{default:a(()=>[...e[15]||(e[15]=[d(" Chargement des sous-comptes... ",-1)])]),_:1})):(n(),i(y,{key:1},[z.value.length?_("",!0):(n(),p(t(f),{key:0,value:"empty",disabled:""},{default:a(()=>[...e[16]||(e[16]=[d(" Aucun sous-compte disponible ",-1)])]),_:1})),(n(!0),i(y,null,N(z.value,u=>(n(),p(t(f),{key:u.id,value:u.id},{default:a(()=>[d(m(u.code?u.code+" - ":"")+m(u.name),1)]),_:2},1032,["value"]))),128))],64))]),_:1})]),_:1})]),_:1},8,["model-value","onUpdate:modelValue"]),c.touched&&r?(n(),i("span",we,m(r),1)):_("",!0)]),_:1})]),_:1}),l(v,null,{default:a(()=>[l(t(g),{class:"text-sm"},{default:a(()=>[e[17]||(e[17]=d(" Compte ",-1)),l(x)]),_:1}),l(t(k),{name:"account_id"},{default:a(({field:o,errorMessage:r,meta:c})=>[l(t(C),{"model-value":o.value,"onUpdate:modelValue":u=>o.onChange(u)},{default:a(()=>[l(t(A),{class:"!h-10 bg-white w-full"},{default:a(()=>[l(t(w),{placeholder:"Sélectionner le compte"})]),_:1}),l(t(L),null,{default:a(()=>[l(t(V),null,{default:a(()=>[t($)?(n(),p(t(f),{key:0,value:"loading",disabled:""},{default:a(()=>[...e[18]||(e[18]=[d(" Chargement des comptes... ",-1)])]),_:1})):(n(),i(y,{key:1},[b.value.length?_("",!0):(n(),p(t(f),{key:0,value:"empty",disabled:""},{default:a(()=>[...e[19]||(e[19]=[d(" Aucun compte disponible ",-1)])]),_:1})),(n(!0),i(y,null,N(b.value,u=>(n(),p(t(f),{key:u.id,value:u.id},{default:a(()=>[d(m(u.code?u.code+" - ":"")+m(u.name),1)]),_:2},1032,["value"]))),128))],64))]),_:1})]),_:1})]),_:1},8,["model-value","onUpdate:modelValue"]),c.touched&&r?(n(),i("span",Le,m(r),1)):_("",!0)]),_:1})]),_:1})]),_:1}),T("div",Ne,[l(t(Q),{variant:"outline",type:"button",disabled:t(P),onClick:e[0]||(e[0]=o=>t(O).push("/comptabilite/saisie-operations"))},{default:a(()=>[...e[20]||(e[20]=[T("span",{class:"flex iconify hugeicons--cancel-01 mr-1.5"},null,-1),d(" Annuler ",-1)])]),_:1},8,["disabled"]),l(t(Q),{type:"submit",disabled:t(P)},{default:a(()=>[e[21]||(e[21]=T("span",{class:"flex iconify hugeicons--add-01"},null,-1)),t(P)?(n(),i("span",qe,"Enregistrement...")):(n(),i("span",Ve,"Enregistrer l'écriture"))]),_:1},8,["disabled"])])],32)]),_:1}))}});export{Ye as default};
