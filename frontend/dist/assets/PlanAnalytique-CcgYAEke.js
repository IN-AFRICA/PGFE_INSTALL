import{d as j,r as y,x,i as e,K as I,w as s,f as a,k as b,b as o,L as h,M as O,N as R,y as i,g as F,z as U,P as G,t as N,s as m,A as E,o as c,p as z,v as M,a2 as Y,c as K,F as H,G as J}from"./index-CJ_PivE-.js";import{_ as w}from"./Input.vue_vue_type_script_setup_true_lang-B9adgRZV.js";import{_ as Q,a as W,b as P,c as L,d as X,e as p}from"./TableHeader.vue_vue_type_script_setup_true_lang-cS4zBTGx.js";import{_ as T}from"./Checkbox.vue_vue_type_script_setup_true_lang-DTckireD.js";import{_ as Z}from"./BoxPanelWrapper.vue_vue_type_script_setup_true_lang-CmJ-Iy6y.js";import{_ as ee}from"./TabPagination.vue_vue_type_script_setup_true_lang-Dsg8W898.js";import{_ as ae}from"./ComptaLayout.vue_vue_type_script_setup_true_lang-Bu3Oqdii.js";import{_ as se}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-Bm461x8Q.js";import{S as te}from"./SpanRequired-COKghTUX.js";import{u as le}from"./usePostApi-Crg8MURP.js";import{e as V}from"./eventBus-CGRXT3Tn.js";import{a as ne}from"./AlertMessage.vue_vue_type_script_setup_true_lang-DthA28zY.js";import{u as oe}from"./useGetApi-EdzHoZm6.js";import{u as re}from"./useDeleteApi-D2AjqV8w.js";import"./index-BpkKmY4O.js";import"./RovingFocusGroup-BxePylpC.js";import"./DashPageHeader.vue_vue_type_script_setup_true_lang-DucYyTAx.js";import"./DashLayout.vue_vue_type_script_setup_true_lang-Ch2egXHm.js";import"./RightDashHeader.vue_vue_type_script_setup_true_lang-Bn3G870_.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ie={class:"flex flex-col space-y-1.5"},ue={class:"flex flex-col space-y-1.5"},de=j({__name:"NewPlanAnalytique",setup(B){const _=y(!1),u=y(""),f=y(""),{response:v,error:q,loading:g,postData:A}=le();function C(){u.value="",f.value=""}async function $(){if(!u.value.trim()||!f.value.trim()){m({message:"Le code et le nom sont requis.",type:"error"});return}if(u.value.length>255||f.value.length>255){m({message:"Le code et le nom doivent contenir au plus 255 caractères.",type:"error"});return}try{if(await A(E.CREATE_ANALYTICS_PLAN,{code:u.value.trim(),name:f.value.trim()}),q.value){m({message:String(q.value),type:"error"});return}v.value?(m({message:v.value.message||"Plan analytique créé avec succès",type:"success"}),V.emit("analyticsPlanUpdated"),C(),_.value=!1):m({message:"Aucune réponse du serveur.",type:"error"})}catch{m({message:"Erreur lors de la création du plan analytique.",type:"error"})}}return(k,n)=>(c(),x(e(I),{open:_.value,"onUpdate:open":n[3]||(n[3]=d=>_.value=d)},{default:s(()=>[a(e(se),{"as-child":""},{default:s(()=>[a(e(b),{size:"md",class:"rounded-md"},{default:s(()=>[...n[4]||(n[4]=[o("span",{class:"iconify hugeicons--plus-sign"},null,-1),o("span",{class:"hidden sm:flex"}," Nouveau plan analytique ",-1)])]),_:1})]),_:1}),a(e(h),{class:"sm:max-w-[440px]"},{default:s(()=>[a(e(O),null,{default:s(()=>[a(e(R),null,{default:s(()=>[...n[5]||(n[5]=[i("Nouveau plan analytique",-1)])]),_:1})]),_:1}),o("form",{class:"grid grid-cols-1 gap-4 py-4",onSubmit:F($,["prevent"])},[o("div",ie,[a(e(U),{for:"numero",class:"text-sm font-medium"},{default:s(()=>[n[6]||(n[6]=i(" Code ",-1)),a(te)]),_:1}),a(e(w),{modelValue:u.value,"onUpdate:modelValue":n[0]||(n[0]=d=>u.value=d),type:"text",id:"numero",name:"code",placeholder:"Code",class:"w-full h-10 border border-gray-200/40 bg-white transition-all"},null,8,["modelValue"])]),o("div",ue,[a(e(U),{for:"designation",class:"text-sm font-medium"},{default:s(()=>[...n[7]||(n[7]=[i(" Nom ",-1)])]),_:1}),a(e(w),{modelValue:f.value,"onUpdate:modelValue":n[1]||(n[1]=d=>f.value=d),type:"text",id:"designation",name:"name",placeholder:"Nom",class:"w-full h-10 border border-gray-200/40 bg-white transition-all"},null,8,["modelValue"])]),n[10]||(n[10]=o("div",{class:"mt-1 pb-2"},[o("p",{class:"text-sm text-foreground-muted"}," Les champs marqués sont obligatoires ")],-1)),a(e(G),{class:"flex justify-end gap-2 items-center"},{default:s(()=>[a(e(b),{type:"button",size:"sm",class:"h-9",variant:"outline",onClick:n[2]||(n[2]=d=>_.value=!1)},{default:s(()=>[...n[8]||(n[8]=[o("span",{class:"iconify flex hugeicons--cancel-01 mr-1"},null,-1),i(" Annuler ",-1)])]),_:1}),a(e(b),{size:"sm",class:"h-9",type:"submit",disabled:e(g),"aria-busy":e(g),onClick:$},{default:s(()=>[n[9]||(n[9]=o("span",{class:"iconify flex hugeicons--floppy-disk mr-1"},null,-1)),i(" "+N(e(g)?"Enregistrement...":"Enregistrer"),1)]),_:1},8,["disabled","aria-busy"])]),_:1})],32)]),_:1})]),_:1},8,["open"]))}}),me={class:"flex sm:items-center gap-3 flex-col sm:flex-row sm:justify-between"},fe={class:"relative flex-1"},pe={class:"flex flex-wrap items-center sm:justify-end gap-2.5 flex-1"},ce={class:"mt-4 rounded-md overflow-hidden flex flex-1 bg-white"},ye={class:"flex items-center gap-2 w-max"},Be=j({__name:"PlanAnalytique",setup(B){const{data:_,error:u,loading:f,fetchData:v}=oe(E.GET_ANALYTICS_PLAN);function q(l){return l?Array.isArray(l)?l:l!=null&&l.data&&Array.isArray(l.data)?l.data:l!=null&&l.items&&Array.isArray(l.items)?l.items:typeof l=="object"?Object.values(l).filter(t=>t&&typeof t=="object"):[]:[]}const g=z(()=>q(_.value).map(l=>({id:l.id,code:l.code,name:l.name??l.label??`Plan #${l.id}`,created_at:l.created_at??null}))),A=y(""),C=z(()=>{const l=A.value.trim().toLowerCase();return l?g.value.filter(t=>(t.code||"").toLowerCase().includes(l)||(t.name||"").toLowerCase().includes(l)):g.value}),{errorDelete:$,deleteItem:k}=re();async function n(l,t){try{const r=E.DELETE_ANALYTICS_PLAN(l);if(await k(r),$.value){m({message:$.value,type:"error"});return}m({message:"Plan analytique supprimé avec succès.",type:"success"}),V.emit("analyticsPlanUpdated")}catch{m({message:"Erreur lors de la suppression du plan analytique.",type:"error"})}}M(async()=>{await v(),V.on("analyticsPlanUpdated",v)}),Y(()=>{V.off("analyticsPlanUpdated",v)});const d=y(1),S=y(15),D=y(20);return(l,t)=>(c(),x(ae,{activeBread:"Plan analytique","active-tag-name":"plan-analytique",group:"saisie"},{default:s(()=>[a(Z,null,{default:s(()=>[o("div",me,[o("div",fe,[a(e(w),{modelValue:A.value,"onUpdate:modelValue":t[0]||(t[0]=r=>A.value=r),type:"text",id:"search",name:"search",placeholder:"Rechercher un centre analytique...",class:"w-full max-w-sm ps-10 border border-gray-200/40 bg-white transition-all h-10 rounded-md"},null,8,["modelValue"]),t[3]||(t[3]=o("div",{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-foreground-muted/70"},[o("span",{class:"flex iconify hugeicons--search-01 text-sm"})],-1))]),o("div",pe,[a(de)])]),o("div",ce,[a(e(Q),{class:"rounded-md bg-white"},{default:s(()=>[a(e(W),null,{default:s(()=>[a(e(P),null,{default:s(()=>[a(e(L),{class:"w-[20px]"},{default:s(()=>[a(e(T),{class:"bg-white scale-70"})]),_:1}),a(e(L),null,{default:s(()=>[...t[4]||(t[4]=[i("Code",-1)])]),_:1}),a(e(L),null,{default:s(()=>[...t[5]||(t[5]=[i("Nom",-1)])]),_:1}),a(e(L),null,{default:s(()=>[...t[6]||(t[6]=[i(" Opérations ",-1)])]),_:1})]),_:1})]),_:1}),a(e(X),null,{default:s(()=>[e(f)?(c(),x(e(P),{key:0},{default:s(()=>[a(e(p),{colspan:"4",class:"text-center py-6"},{default:s(()=>[...t[7]||(t[7]=[i("Chargement des plans analytiques...",-1)])]),_:1})]),_:1})):e(u)?(c(),x(e(P),{key:1},{default:s(()=>[a(e(p),{colspan:"4",class:"text-center py-6 text-red-500"},{default:s(()=>[i(N(e(u)),1)]),_:1})]),_:1})):C.value.length===0?(c(),x(e(P),{key:2},{default:s(()=>[a(e(p),{colspan:"4",class:"text-center py-6"},{default:s(()=>[...t[8]||(t[8]=[i("Aucun plan analytique trouvé",-1)])]),_:1})]),_:1})):(c(!0),K(J,{key:3},H(C.value,r=>(c(),x(e(P),{key:r.id},{default:s(()=>[a(e(p),{class:"w-[40px]"},{default:s(()=>[a(e(T),{class:"bg-white scale-70"})]),_:1}),a(e(p),{class:"font-semibold"},{default:s(()=>[i(N(r.code),1)]),_:2},1024),a(e(p),null,{default:s(()=>[i(N(r.name),1)]),_:2},1024),a(e(p),null,{default:s(()=>[o("div",ye,[a(e(b),{variant:"outline",size:"icon",class:"size-8"},{default:s(()=>[...t[9]||(t[9]=[o("span",{class:"iconify hugeicons--edit-02"},null,-1)])]),_:1}),a(ne,{action:"danger",title:"Supprimer un plan analytique",message:`Vous êtes sur le point de supprimer le plan '${r.name}'. Êtes-vous sûr de continuer ?`},{trigger:s(()=>[a(e(b),{variant:"destructive",size:"icon",class:"size-8"},{default:s(()=>[...t[10]||(t[10]=[o("span",{class:"iconify hugeicons--delete-02"},null,-1)])]),_:1})]),"confirm-action-button":s(()=>[a(e(b),{variant:"destructive",size:"sm","aria-label":"Supprimer",onClick:_e=>n(r.id,r.name)},{default:s(()=>[...t[11]||(t[11]=[i(" Oui, supprimer ",-1)])]),_:1},8,["onClick"])]),_:2},1032,["message"])])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),a(ee,{modelValue:d.value,"onUpdate:modelValue":t[1]||(t[1]=r=>d.value=r),perPage:S.value,totalItems:D.value,"onUpdate:perPage":t[2]||(t[2]=r=>S.value=r)},null,8,["modelValue","perPage","totalItems"])]),_:1})]),_:1}))}});export{Be as default};
