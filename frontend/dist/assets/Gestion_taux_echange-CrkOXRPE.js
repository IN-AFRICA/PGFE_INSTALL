import{d as ke,r as D,A as T,p as I,s as f,v as be,x as h,w as s,f as t,b as o,i as a,h as v,k as E,y as l,t as m,K as ee,L as ae,M as te,N as se,O as ne,g as re,c as _,z as g,a4 as V,P as le,F as Ce,G as $e,o as i}from"./index-CJ_PivE-.js";import{_ as Ae}from"./ComptaLayout.vue_vue_type_script_setup_true_lang-Bu3Oqdii.js";import{_ as R}from"./Input.vue_vue_type_script_setup_true_lang-B9adgRZV.js";import{_ as j}from"./Checkbox.vue_vue_type_script_setup_true_lang-DTckireD.js";import{_ as oe}from"./index-BeOV968Y.js";import{_ as we,a as De,b as S,c as k,d as Te,e as p}from"./TableHeader.vue_vue_type_script_setup_true_lang-cS4zBTGx.js";import{_ as Re,a as Se,b as Ge,c as ie}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-DN4DQrTt.js";import{_ as Ne}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-Bm461x8Q.js";import{_ as Fe}from"./BoxPanelWrapper.vue_vue_type_script_setup_true_lang-CmJ-Iy6y.js";import{_ as ue}from"./ListCurrency.vue_vue_type_script_setup_true_lang-BPHzT41E.js";import{u as Ue}from"./useGetApi-EdzHoZm6.js";import{u as Le}from"./usePostApi-Crg8MURP.js";import{u as Ie}from"./usePutApi-BrTvEW5v.js";import{u as Ve}from"./useDeleteApi-D2AjqV8w.js";import{o as je,a3 as ze,s as ce,a4 as Me,aM as Pe,av as Be,u as Oe,aQ as y,t as He}from"./vee-validate-zod-Bra4yLtR.js";import"./DashPageHeader.vue_vue_type_script_setup_true_lang-DucYyTAx.js";import"./DashLayout.vue_vue_type_script_setup_true_lang-Ch2egXHm.js";import"./RightDashHeader.vue_vue_type_script_setup_true_lang-Bn3G870_.js";import"./index-BpkKmY4O.js";import"./RovingFocusGroup-BxePylpC.js";const Xe={class:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6"},qe={class:"flex items-center gap-4"},Qe={class:"relative"},Ke={class:"flex items-center gap-2"},Je={class:"space-y-2"},We={key:0,class:"text-sm text-red-500"},Ye={class:"space-y-2"},Ze={key:0,class:"text-sm text-red-500"},ea={class:"space-y-2"},aa={key:0,class:"text-sm text-red-500"},ta={class:"flex items-center space-x-2"},sa={key:0,class:"iconify hugeicons--loading-03 mr-2 animate-spin"},na={class:"border rounded-lg overflow-hidden flex flex-1 bg-white"},ra={class:"flex flex-col items-center justify-center text-gray-500"},la={key:0},oa={key:1},ia={class:"flex items-center"},ua={class:"space-y-2"},ca={key:0,class:"text-sm text-red-500"},da={class:"space-y-2"},fa={key:0,class:"text-sm text-red-500"},ma={class:"space-y-2"},_a={key:0,class:"text-sm text-red-500"},pa={class:"flex items-center space-x-2"},va={key:0,class:"iconify hugeicons--loading-03 mr-2 animate-spin"},ga={key:1,class:"iconify hugeicons--checkmark-circle-02 mr-2"},za=ke({__name:"Gestion_taux_echange",setup(ya){const de=je({currency_id:Pe([ce().transform(n=>n===""?null:Number(n)),Be()]).nullable().refine(n=>n!==null&&n!==0,"La devise est requise"),rate:Me.number().min(0,"Le taux doit être supérieur ou égal à 0"),date_effective:ce().optional().nullable(),is_active:ze().default(!0)}),b=D(""),u=D([]),C=D(!1),G=D(!1),N=D(null),{handleSubmit:O,resetForm:z,errors:c,values:xa,setFieldValue:$}=Oe({validationSchema:He(de)}),{data:F,error:U,loading:H,fetchData:A}=Ue(T.GET_EXCHANGE_RATES),w=I(()=>{const n=F.value;if(!n)return[];if(console.log("Gestion_taux_echange - Structure de réponse API:",n),Array.isArray(n))return console.log("Gestion_taux_echange - Format tableau direct"),n;if(Array.isArray(n==null?void 0:n.exchange_rates))return console.log("Gestion_taux_echange - Format avec exchange_rates"),n.exchange_rates;if(Array.isArray(n==null?void 0:n.data))return console.log("Gestion_taux_echange - Format avec data"),n.data;if(n&&typeof n=="object"){const e=Object.values(n).filter(r=>r&&typeof r=="object"&&"id"in r);if(e.length>0)return console.log("Gestion_taux_echange - Format objet avec IDs comme clés"),e}return console.log("Gestion_taux_echange - Format non reconnu, retour tableau vide"),[]}),{postData:fe,loading:X,error:q,response:M}=Le(),{putData:me,loading:Q,error:K,response:P}=Ie(),{deleteItem:J,deleting:_e}=Ve(),x=I(()=>{if(!w.value)return[];if(!b.value)return w.value;const n=b.value.toLowerCase();return w.value.filter(e=>{var r,d;return((r=e.currency)==null?void 0:r.name)&&e.currency.name.toLowerCase().includes(n)||((d=e.currency)==null?void 0:d.code)&&e.currency.code.toLowerCase().includes(n)||e.rate.toString().includes(n)})}),W=I(()=>x.value.length>0&&u.value.length===x.value.length);I(()=>w.value&&w.value.length>0);const pe=()=>{W.value?u.value=[]:u.value=x.value.map(n=>n.id)},ve=n=>{const e=u.value.indexOf(n);e>-1?u.value.splice(e,1):u.value.push(n)},ge=()=>{z(),$("is_active",!0),C.value=!0},ye=n=>{N.value=n,$("currency_id",n.currency_id),$("rate",n.rate),$("date_effective",n.date_effective||""),$("is_active",n.is_active),G.value=!0},Y=O(async n=>{try{const e={currency_id:n.currency_id,rate:n.rate,date_effective:n.date_effective||null,is_active:n.is_active};if(await fe(T.CREATE_EXCHANGE_RATE,e),q.value){f({message:q.value,type:"error"});return}M.value&&M.value.success?(f({message:M.value.message||"Taux de change créé avec succès",type:"success"}),z(),C.value=!1,await A()):f({message:"Erreur lors de la création du taux de change",type:"error"})}catch(e){console.error("Erreur lors de la création:",e),f({message:"Erreur lors de la création du taux de change",type:"error"})}}),Z=O(async n=>{if(N.value)try{const e={currency_id:n.currency_id,rate:n.rate,date_effective:n.date_effective||null,is_active:n.is_active};if(await me(T.UPDATE_EXCHANGE_RATE(N.value.id),e),K.value){f({message:K.value,type:"error"});return}P.value&&P.value.success?(f({message:P.value.message||"Taux de change modifié avec succès",type:"success"}),z(),G.value=!1,N.value=null,await A()):f({message:"Erreur lors de la modification du taux de change",type:"error"})}catch(e){console.error("Erreur lors de la modification:",e),f({message:"Erreur lors de la modification du taux de change",type:"error"})}}),xe=async()=>{if(u.value.length===0)return;const n=u.value.map(e=>{var d;const r=x.value.find(L=>L.id===e);return r?`${((d=r.currency)==null?void 0:d.name)||"Devise"} (${B(r.rate)})`:null}).filter(Boolean).join(", ");if(confirm(`Êtes-vous sûr de vouloir supprimer ces taux de change : ${n} ?`))try{for(const e of u.value)await J(T.DELETE_EXCHANGE_RATE(e));f({message:`${u.value.length} taux de change supprimé(s) avec succès`,type:"success"}),u.value=[],await A()}catch(e){console.error("Erreur lors de la suppression:",e),f({message:"Erreur lors de la suppression des taux de change",type:"error"})}},he=async n=>{var r;const e=`${((r=n.currency)==null?void 0:r.name)||"Devise"} (${B(n.rate)})`;if(confirm(`Êtes-vous sûr de vouloir supprimer le taux de change "${e}" ?`))try{await J(T.DELETE_EXCHANGE_RATE(n.id)),f({message:"Taux de change supprimé avec succès",type:"success"}),await A()}catch(d){console.error("Erreur lors de la suppression:",d),f({message:"Erreur lors de la suppression du taux de change",type:"error"})}},Ee=n=>n?new Date(n).toLocaleDateString("fr-FR"):"-",B=n=>new Intl.NumberFormat("fr-FR",{minimumFractionDigits:2,maximumFractionDigits:6}).format(n);return be(async()=>{console.log("Gestion_taux_echange - Chargement des données..."),await A(),console.log("Gestion_taux_echange - Données chargées:",{data:F.value,error:U.value,loading:H.value}),U.value&&console.error("Gestion_taux_echange - Erreur API:",U.value),F.value&&console.log("Gestion_taux_echange - Nombre de taux récupérés:",F.value.length)}),(n,e)=>(i(),h(Ae,{activeBread:"Taux de Change","active-tag-name":"taux-de-change",group:"frais"},{default:s(()=>[t(Fe,null,{default:s(()=>[o("div",Xe,[o("div",qe,[o("div",Qe,[t(a(R),{modelValue:b.value,"onUpdate:modelValue":e[0]||(e[0]=r=>b.value=r),placeholder:"Rechercher par devise ou taux...",class:"pl-10 w-80"},null,8,["modelValue"]),e[6]||(e[6]=o("span",{class:"iconify hugeicons--search-01 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"},null,-1))])]),o("div",Ke,[u.value.length>0?(i(),h(a(E),{key:0,onClick:xe,variant:"destructive",size:"sm",disabled:a(_e)},{default:s(()=>[e[7]||(e[7]=o("span",{class:"iconify hugeicons--delete-02 mr-2"},null,-1)),l(" Supprimer ("+m(u.value.length)+") ",1)]),_:1},8,["disabled"])):v("",!0),t(a(ee),{open:C.value,"onUpdate:open":e[3]||(e[3]=r=>C.value=r)},{default:s(()=>[t(a(Ne),{asChild:""},{default:s(()=>[t(a(E),{onClick:ge,size:"sm"},{default:s(()=>[...e[8]||(e[8]=[o("span",{class:"iconify hugeicons--add-01 mr-2"},null,-1),l(" Nouveau taux ",-1)])]),_:1})]),_:1}),t(a(ae),{class:"max-w-md"},{default:s(()=>[t(a(te),null,{default:s(()=>[t(a(se),null,{default:s(()=>[...e[9]||(e[9]=[l("Créer un nouveau taux de change",-1)])]),_:1}),t(a(ne),null,{default:s(()=>[...e[10]||(e[10]=[l(" Définissez un nouveau taux de change pour une devise. ",-1)])]),_:1})]),_:1}),o("form",{onSubmit:e[2]||(e[2]=re((...r)=>a(Y)&&a(Y)(...r),["prevent"])),class:"space-y-4"},[o("div",Je,[t(a(g),{for:"currency_id"},{default:s(()=>[...e[11]||(e[11]=[l("Devise *",-1)])]),_:1}),t(a(y),{name:"currency_id"},{default:s(({field:r})=>[t(ue,{"model-value":r.value,"onUpdate:modelValue":r.onChange},null,8,["model-value","onUpdate:modelValue"])]),_:1}),a(c).currency_id?(i(),_("p",We,m(a(c).currency_id),1)):v("",!0)]),o("div",Ye,[t(a(g),{for:"rate"},{default:s(()=>[...e[12]||(e[12]=[l("Taux de change *",-1)])]),_:1}),t(a(y),{name:"rate"},{default:s(({field:r})=>[t(a(R),V(r,{type:"number",step:"0.000001",min:"0",placeholder:"Ex: 1.25"}),null,16)]),_:1}),a(c).rate?(i(),_("p",Ze,m(a(c).rate),1)):v("",!0)]),o("div",ea,[t(a(g),{for:"date_effective"},{default:s(()=>[...e[13]||(e[13]=[l("Date d'effet",-1)])]),_:1}),t(a(y),{name:"date_effective"},{default:s(({field:r})=>[t(a(R),V(r,{type:"datetime-local"}),null,16)]),_:1}),a(c).date_effective?(i(),_("p",aa,m(a(c).date_effective),1)):v("",!0)]),o("div",ta,[t(a(y),{name:"is_active"},{default:s(({field:r})=>[t(a(j),{checked:r.value,"onUpdate:checked":r.onChange,id:"is_active"},null,8,["checked","onUpdate:checked"])]),_:1}),t(a(g),{for:"is_active"},{default:s(()=>[...e[14]||(e[14]=[l("Taux actif",-1)])]),_:1})]),t(a(le),null,{default:s(()=>[t(a(E),{type:"button",onClick:e[1]||(e[1]=r=>C.value=!1),variant:"outline"},{default:s(()=>[...e[15]||(e[15]=[l(" Annuler ",-1)])]),_:1}),t(a(E),{type:"submit",disabled:a(X)},{default:s(()=>[a(X)?(i(),_("span",sa)):v("",!0),e[16]||(e[16]=l(" Créer ",-1))]),_:1},8,["disabled"])]),_:1})],32)]),_:1})]),_:1},8,["open"])])]),o("div",na,[t(a(we),null,{default:s(()=>[t(a(De),null,{default:s(()=>[t(a(S),null,{default:s(()=>[t(a(k),{class:"w-[50px]"},{default:s(()=>[t(a(j),{checked:W.value,"onUpdate:checked":pe},null,8,["checked"])]),_:1}),t(a(k),{class:"w-[250px]"},{default:s(()=>[...e[17]||(e[17]=[l("Devise",-1)])]),_:1}),t(a(k),{class:"w-[150px]"},{default:s(()=>[...e[18]||(e[18]=[l("Taux",-1)])]),_:1}),t(a(k),{class:"w-[120px]"},{default:s(()=>[...e[19]||(e[19]=[l("Statut",-1)])]),_:1}),t(a(k),{class:"w-[150px]"},{default:s(()=>[...e[20]||(e[20]=[l("Créé le",-1)])]),_:1}),t(a(k),{class:"w-[100px] text-right"},{default:s(()=>[...e[21]||(e[21]=[l("Actions",-1)])]),_:1})]),_:1})]),_:1}),t(a(Te),null,{default:s(()=>[a(H)?(i(),h(a(S),{key:0},{default:s(()=>[t(a(p),{colspan:"7",class:"text-center py-8"},{default:s(()=>[...e[22]||(e[22]=[o("div",{class:"flex items-center justify-center"},[o("span",{class:"iconify hugeicons--loading-03 mr-2 animate-spin"}),l(" Chargement des taux de change... ")],-1)])]),_:1})]),_:1})):a(U)?(i(),h(a(S),{key:1},{default:s(()=>[t(a(p),{colspan:"7",class:"text-center py-8"},{default:s(()=>[...e[23]||(e[23]=[o("div",{class:"flex items-center justify-center text-red-500"},[o("span",{class:"iconify hugeicons--alert-triangle mr-2"}),l(" Erreur lors du chargement des taux de change ")],-1)])]),_:1})]),_:1})):x.value.length?(i(!0),_($e,{key:3},Ce(x.value,r=>(i(),h(a(S),{key:r.id},{default:s(()=>[t(a(p),null,{default:s(()=>[t(a(j),{checked:u.value.includes(r.id),"onUpdate:checked":()=>ve(r.id)},null,8,["checked","onUpdate:checked"])]),_:2},1024),t(a(p),null,{default:s(()=>{var d;return[o("div",ia,[t(a(oe),{variant:"outline",class:"mr-2"},{default:s(()=>{var L;return[l(m(((L=r.currency)==null?void 0:L.code)||"N/A"),1)]}),_:2},1024),l(" "+m(((d=r.currency)==null?void 0:d.name)||"Devise inconnue"),1)])]}),_:2},1024),t(a(p),{class:"font-mono"},{default:s(()=>[l(m(B(r.rate)),1)]),_:2},1024),t(a(p),null,{default:s(()=>[t(a(oe),{variant:r.is_active?"default":"secondary"},{default:s(()=>[l(m(r.is_active?"Actif":"Inactif"),1)]),_:2},1032,["variant"])]),_:2},1024),t(a(p),null,{default:s(()=>[l(m(Ee(r.created_at)),1)]),_:2},1024),t(a(p),{class:"text-right"},{default:s(()=>[t(a(Re),null,{default:s(()=>[t(a(Se),{asChild:""},{default:s(()=>[t(a(E),{variant:"ghost",size:"sm"},{default:s(()=>[...e[25]||(e[25]=[o("span",{class:"iconify hugeicons--more-horizontal"},null,-1)])]),_:1})]),_:1}),t(a(Ge),{align:"end"},{default:s(()=>[t(a(ie),{onClick:d=>ye(r)},{default:s(()=>[...e[26]||(e[26]=[o("span",{class:"iconify hugeicons--edit-02 mr-2"},null,-1),l(" Modifier ",-1)])]),_:1},8,["onClick"]),t(a(ie),{onClick:d=>he(r),class:"text-red-600"},{default:s(()=>[...e[27]||(e[27]=[o("span",{class:"iconify hugeicons--delete-02 mr-2"},null,-1),l(" Supprimer ",-1)])]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)):(i(),h(a(S),{key:2},{default:s(()=>[t(a(p),{colspan:"7",class:"text-center py-8"},{default:s(()=>[o("div",ra,[e[24]||(e[24]=o("span",{class:"iconify hugeicons--exchange-01 text-4xl mb-2"},null,-1)),b.value?(i(),_("p",la,"Aucun taux de change ne correspond à votre recherche.")):(i(),_("p",oa,"Aucun taux de change défini pour le moment."))])]),_:1})]),_:1}))]),_:1})]),_:1})])]),_:1}),t(a(ee),{open:G.value,"onUpdate:open":e[5]||(e[5]=r=>G.value=r)},{default:s(()=>[t(a(ae),{class:"max-w-md"},{default:s(()=>[t(a(te),null,{default:s(()=>[t(a(se),null,{default:s(()=>[...e[28]||(e[28]=[l("Modifier le taux de change",-1)])]),_:1}),t(a(ne),null,{default:s(()=>[...e[29]||(e[29]=[l(" Modifiez les informations du taux de change sélectionné. ",-1)])]),_:1})]),_:1}),o("form",{onSubmit:e[4]||(e[4]=re((...r)=>a(Z)&&a(Z)(...r),["prevent"])),class:"space-y-4"},[o("div",ua,[t(a(g),{for:"currency_id"},{default:s(()=>[...e[30]||(e[30]=[l("Devise *",-1)])]),_:1}),t(a(y),{name:"currency_id"},{default:s(({field:r})=>[t(ue,{"model-value":r.value,"onUpdate:modelValue":r.onChange},null,8,["model-value","onUpdate:modelValue"])]),_:1}),a(c).currency_id?(i(),_("p",ca,m(a(c).currency_id),1)):v("",!0)]),o("div",da,[t(a(g),{for:"rate"},{default:s(()=>[...e[31]||(e[31]=[l("Taux de change *",-1)])]),_:1}),t(a(y),{name:"rate"},{default:s(({field:r})=>[t(a(R),V(r,{type:"number",step:"0.000001",min:"0",placeholder:"Ex: 1.25"}),null,16)]),_:1}),a(c).rate?(i(),_("p",fa,m(a(c).rate),1)):v("",!0)]),o("div",ma,[t(a(g),{for:"date_effective"},{default:s(()=>[...e[32]||(e[32]=[l("Date d'effet",-1)])]),_:1}),t(a(y),{name:"date_effective"},{default:s(({field:r})=>[t(a(R),V(r,{type:"datetime-local"}),null,16)]),_:1}),a(c).date_effective?(i(),_("p",_a,m(a(c).date_effective),1)):v("",!0)]),o("div",pa,[t(a(y),{name:"is_active"},{default:s(({field:r})=>[t(a(j),{checked:r.value,"onUpdate:checked":r.onChange,id:"is_active_edit"},null,8,["checked","onUpdate:checked"])]),_:1}),t(a(g),{for:"is_active_edit"},{default:s(()=>[...e[33]||(e[33]=[l("Taux actif",-1)])]),_:1})]),t(a(le),null,{default:s(()=>[t(a(E),{type:"submit",disabled:a(Q)},{default:s(()=>[a(Q)?(i(),_("span",va)):(i(),_("span",ga)),e[34]||(e[34]=l(" Modifier ",-1))]),_:1},8,["disabled"])]),_:1})],32)]),_:1})]),_:1},8,["open"])]),_:1}))}});export{za as default};
