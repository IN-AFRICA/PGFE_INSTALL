import{d as J,p as x,a1 as K,r as Q,A as _,v as X,x as Z,w as o,c as v,i as t,f as a,b as u,z as m,y as r,af as w,aY as N,G as P,F as q,k as A,g as ee,a as le,o as f,t as D,s as S}from"./index-CJ_PivE-.js";import{_ as ae}from"./DashFormLayout.vue_vue_type_script_setup_true_lang-3V-LyRCQ.js";import{_ as te}from"./FormSection.vue_vue_type_script_setup_true_lang-C-XSdIg3.js";import{I as p}from"./InputWrapper-tSRHzcjN.js";import{S as b}from"./SpanRequired-COKghTUX.js";import{_ as y}from"./Input.vue_vue_type_script_setup_true_lang-B9adgRZV.js";import{_ as I}from"./IconifySpinner.vue_vue_type_script_setup_true_lang-C3Td1B5O.js";import{u as ie}from"./usePutApi-BrTvEW5v.js";import{u as k}from"./useGetApi-EdzHoZm6.js";import{e as oe}from"./eventBus-CGRXT3Tn.js";import"./DashLayout.vue_vue_type_script_setup_true_lang-Ch2egXHm.js";import"./RightDashHeader.vue_vue_type_script_setup_true_lang-Bn3G870_.js";import"./FormPageHeader.vue_vue_type_script_setup_true_lang-CAg7Z6LS.js";import"./BoxPanelWrapper.vue_vue_type_script_setup_true_lang-CmJ-Iy6y.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-BpkKmY4O.js";const de={key:0,class:"flex items-center justify-center p-8"},se=["disabled"],ne=["value"],ue=["disabled"],re=["value"],me=["disabled"],pe={class:"flex justify-end gap-4"},fe={key:0,class:"flex items-center gap-2"},ve={key:1,class:"flex items-center gap-2"},Pe=J({__name:"EditSchool",setup(ce){const E=le(),G=K(),C=x(()=>Number(G.params.id)),l=Q({name:"",province_id:void 0,country_id:void 0,city:"",address:"",type_id:void 0,latitude:"0",longitude:"0",phone_number:"",email:"",logo:null}),{data:V,fetchData:L}=k(_.GET_PROVINCES),{data:M,fetchData:O}=k(_.GET_TYPES),{data:n,loading:z,fetchData:B}=k(`${_.GET_SCHOOLS}/${C.value}`),{putData:R,loading:d,error:T,response:F}=ie(),U=x(()=>!l.value.province_id||!V.value?null:V.value.find(c=>c.id===l.value.province_id)),j=x(()=>U.value?Number(U.value.country_id):void 0);X(async()=>{await Promise.all([L(),O(),B()]),n.value&&(l.value.name=n.value.name||"",l.value.province_id=n.value.province_id,l.value.type_id=n.value.type_id?Number(n.value.type_id):void 0,l.value.city=n.value.city||"",l.value.address=n.value.address||"",l.value.latitude=n.value.latitude||"",l.value.longitude=n.value.longitude||"",l.value.phone_number=n.value.phone_number||"",l.value.email=n.value.email||"")});function H(c){var g;const i=(g=c.target.files)==null?void 0:g[0];l.value.logo=i||null}function Y(){E.push("/admin/ecoles")}async function W(){const c=(l.value.name||"").trim(),e=(l.value.city||"").trim(),i=(l.value.address||"").trim(),g=l.value.type_id||void 0;if(!c||!l.value.province_id||!e||!i||!g){S({message:"Nom, province, type, ville et adresse sont requis",type:"error"});return}const s=new FormData;s.append("name",c),s.append("province_id",String(l.value.province_id)),s.append("country_id",String(j.value)),s.append("city",e),s.append("address",i),s.append("type_id",String(g)),l.value.latitude!==""&&l.value.latitude!=null&&s.append("latitude",String(l.value.latitude)),l.value.longitude!==""&&l.value.longitude!=null&&s.append("longitude",String(l.value.longitude));const $=(l.value.phone_number||"").trim();$&&s.append("phone_number",$);const h=(l.value.email||"").trim();if(h&&s.append("email",h),l.value.logo&&s.append("logo",l.value.logo),await R(`${_.GET_SCHOOLS}/${C.value}`,s),T.value){S({message:T.value||"Erreur lors de la modification",type:"error"});return}F.value&&(S({message:"École modifiée avec succès",type:"success"}),oe.emit("schoolUpdated"),E.push("/admin/ecoles"))}return(c,e)=>(f(),Z(ae,{"link-back":"/admin/ecoles",title:"Modifier École","group-route":"/admin/ecoles",module:"admin",breadcrumb:[{label:"Administration",href:"/admin"},{label:"Écoles",href:"/admin/ecoles"},{label:"Modifier École",href:"#"}]},{default:o(()=>[t(z)?(f(),v("div",de,[a(I,{size:"lg"}),e[9]||(e[9]=u("span",{class:"ml-2"},"Chargement...",-1))])):(f(),v("form",{key:1,class:"w-full flex flex-col space-y-8",onSubmit:ee(W,["prevent"])},[a(te,{title:"Informations de l'école",class:"grid sm:grid-cols-2 lg:grid-cols-3 gap-y-6 gap-x-10"},{default:o(()=>[a(p,null,{default:o(()=>[a(t(m),{for:"name",class:"text-sm font-medium"},{default:o(()=>[e[10]||(e[10]=r(" Nom de l'école ",-1)),a(b)]),_:1}),a(t(y),{id:"name",modelValue:l.value.name,"onUpdate:modelValue":e[0]||(e[0]=i=>l.value.name=i),class:"h-10",required:"",disabled:t(d)},null,8,["modelValue","disabled"])]),_:1}),a(p,null,{default:o(()=>[a(t(m),{for:"province",class:"text-sm font-medium"},{default:o(()=>[e[11]||(e[11]=r(" Province ",-1)),a(b)]),_:1}),w(u("select",{id:"province","onUpdate:modelValue":e[1]||(e[1]=i=>l.value.province_id=i),class:"h-10 border rounded-md px-3",required:"",disabled:t(d)},[e[12]||(e[12]=u("option",{value:void 0},"-- Sélectionnez une province --",-1)),(f(!0),v(P,null,q(t(V)||[],i=>(f(),v("option",{key:i.id,value:i.id},D(i.name),9,ne))),128))],8,se),[[N,l.value.province_id,void 0,{number:!0}]])]),_:1}),a(p,null,{default:o(()=>[a(t(m),{for:"type",class:"text-sm font-medium"},{default:o(()=>[e[13]||(e[13]=r(" Type ",-1)),a(b)]),_:1}),w(u("select",{id:"type","onUpdate:modelValue":e[2]||(e[2]=i=>l.value.type_id=i),class:"h-10 border rounded-md px-3",required:"",disabled:t(d)},[e[14]||(e[14]=u("option",{value:void 0},"-- Sélectionnez un type --",-1)),(f(!0),v(P,null,q(t(M)||[],i=>(f(),v("option",{key:i.id,value:i.id},D(i.title),9,re))),128))],8,ue),[[N,l.value.type_id,void 0,{number:!0}]])]),_:1}),a(p,null,{default:o(()=>[a(t(m),{for:"city",class:"text-sm font-medium"},{default:o(()=>[e[15]||(e[15]=r(" Ville ",-1)),a(b)]),_:1}),a(t(y),{id:"city",modelValue:l.value.city,"onUpdate:modelValue":e[3]||(e[3]=i=>l.value.city=i),class:"h-10",required:"",disabled:t(d)},null,8,["modelValue","disabled"])]),_:1}),a(p,null,{default:o(()=>[a(t(m),{for:"address",class:"text-sm font-medium"},{default:o(()=>[e[16]||(e[16]=r(" Adresse ",-1)),a(b)]),_:1}),a(t(y),{id:"address",modelValue:l.value.address,"onUpdate:modelValue":e[4]||(e[4]=i=>l.value.address=i),class:"h-10",required:"",disabled:t(d)},null,8,["modelValue","disabled"])]),_:1}),a(p,null,{default:o(()=>[a(t(m),{for:"latitude",class:"text-sm font-medium"},{default:o(()=>[...e[17]||(e[17]=[r("Latitude",-1)])]),_:1}),a(t(y),{id:"latitude",modelValue:l.value.latitude,"onUpdate:modelValue":e[5]||(e[5]=i=>l.value.latitude=i),class:"h-10",type:"number",step:"any",disabled:t(d)},null,8,["modelValue","disabled"])]),_:1}),a(p,null,{default:o(()=>[a(t(m),{for:"longitude",class:"text-sm font-medium"},{default:o(()=>[...e[18]||(e[18]=[r("Longitude",-1)])]),_:1}),a(t(y),{id:"longitude",modelValue:l.value.longitude,"onUpdate:modelValue":e[6]||(e[6]=i=>l.value.longitude=i),class:"h-10",type:"number",step:"any",disabled:t(d)},null,8,["modelValue","disabled"])]),_:1}),a(p,null,{default:o(()=>[a(t(m),{for:"phone",class:"text-sm font-medium"},{default:o(()=>[...e[19]||(e[19]=[r("Téléphone",-1)])]),_:1}),a(t(y),{id:"phone",modelValue:l.value.phone_number,"onUpdate:modelValue":e[7]||(e[7]=i=>l.value.phone_number=i),class:"h-10",disabled:t(d)},null,8,["modelValue","disabled"])]),_:1}),a(p,null,{default:o(()=>[a(t(m),{for:"email",class:"text-sm font-medium"},{default:o(()=>[...e[20]||(e[20]=[r("Email",-1)])]),_:1}),a(t(y),{id:"email",modelValue:l.value.email,"onUpdate:modelValue":e[8]||(e[8]=i=>l.value.email=i),type:"email",class:"h-10",disabled:t(d)},null,8,["modelValue","disabled"])]),_:1}),a(p,{class:"sm:col-span-2 lg:col-span-3"},{default:o(()=>[a(t(m),{for:"logo",class:"text-sm font-medium"},{default:o(()=>[...e[21]||(e[21]=[r("Logo (image)",-1)])]),_:1}),u("input",{id:"logo",type:"file",accept:"image/*",class:"h-10",disabled:t(d),onChange:H},null,40,me)]),_:1})]),_:1}),u("div",pe,[a(t(A),{type:"button",variant:"outline",onClick:Y,disabled:t(d)},{default:o(()=>[...e[22]||(e[22]=[u("span",{class:"iconify hugeicons--cancel-01"},null,-1),r(" Annuler ",-1)])]),_:1},8,["disabled"]),a(t(A),{type:"submit",disabled:t(d)},{default:o(()=>[t(d)?(f(),v("span",ve,[a(I,{size:"lg"}),e[24]||(e[24]=u("span",null,"Modification...",-1))])):(f(),v("span",fe,[...e[23]||(e[23]=[u("span",{class:"iconify hugeicons--floppy-disk"},null,-1),u("span",null,"Enregistrer",-1)])]))]),_:1},8,["disabled"])])],32))]),_:1}))}});export{Pe as default};
