import{d as k,x as w,o as x,w as E,a0 as z,a4 as j,i as u,a5 as q,a6 as H,a7 as W,a8 as X,a9 as G,aa as J,m as T,A as D,p as P,r as B,c as M,b as $,f as I,k as K,H as Q,y as C,t as Y,h as F}from"./index-CJ_PivE-.js";import{_ as Z,a as ee,b as re,c as A}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-DN4DQrTt.js";import{_ as te}from"./_plugin-vue_export-helper-DlAUqK2U.js";var oe=k({__name:"MenuSeparator",props:{asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},setup(a){const l=a;return(e,o)=>(x(),w(u(q),j(l,{role:"separator","aria-orientation":"horizontal"}),{default:E(()=>[z(e.$slots,"default")]),_:3},16))}}),se=oe,ae=k({__name:"DropdownMenuSeparator",props:{asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},setup(a){const l=a;return H(),(e,o)=>(x(),w(u(se),W(X(l)),{default:E(()=>[z(e.$slots,"default")]),_:3},16))}}),le=ae;const ne=k({__name:"DropdownMenuSeparator",props:{asChild:{type:Boolean},as:{},class:{}},setup(a){const l=a,e=G(l,"class");return(o,s)=>(x(),w(u(le),j({"data-slot":"dropdown-menu-separator"},u(e),{class:u(J)("bg-border -mx-1 my-1 h-px",l.class)}),null,16,["class"]))}});class R{static async exportFicheCotation(l){var e,o,s,i,r,m;try{return(await T.post(D.EXPORT_FICHE_COTATION,l||{},{responseType:"blob",headers:{Accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}})).data}catch(f){console.error("Erreur lors de l'export:",f),console.error("Status:",(e=f.response)==null?void 0:e.status),console.error("Data:",(o=f.response)==null?void 0:o.data);let _=`Erreur ${((s=f.response)==null?void 0:s.status)||"r√©seau"} lors de l'export`;throw((i=f.response)==null?void 0:i.status)===401?_="Erreur d'authentification - Veuillez vous reconnecter":((r=f.response)==null?void 0:r.status)===403?_="Acc√®s refus√© pour l'export":((m=f.response)==null?void 0:m.status)===500&&(_="Erreur serveur lors de l'export"),new Error(_)}}static async importFicheCotation(l){var e,o,s,i;try{const r=new FormData;return r.append("file",l),(await T.post(D.IMPORT_FICHE_COTATION,r,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(r){console.error("Erreur lors de l'import:",r);let m="Erreur lors de l'import du fichier";if(((e=r.response)==null?void 0:e.status)===401?m="Erreur d'authentification - Veuillez vous reconnecter":((o=r.response)==null?void 0:o.status)===413?m="Fichier trop volumineux":((s=r.response)==null?void 0:s.status)===422&&(m="Format de fichier invalide"),(i=r.response)!=null&&i.data)return r.response.data;throw new Error(m)}}static async downloadTemplate(){var l,e;try{return(await T.get(`${D.EXPORT_FICHE_COTATION}/template`,{responseType:"blob",headers:{Accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}})).data}catch(o){console.error("Erreur lors du t√©l√©chargement du template:",o);let s="Erreur lors du t√©l√©chargement du template";throw((l=o.response)==null?void 0:l.status)===401?s="Erreur d'authentification - Veuillez vous reconnecter":((e=o.response)==null?void 0:e.status)===404&&(s="Template non trouv√©"),new Error(s)}}static downloadBlob(l,e){const o=window.URL.createObjectURL(l),s=document.createElement("a");s.href=o,s.download=e,document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(o)}}const ie={class:"excel-manager-api"},ce=["accept"],pe={key:0,class:"flex mr-1.5 iconify hugeicons--loading-03 animate-spin"},ue={key:1,class:"flex mr-1.5 iconify hugeicons--arrow-down-01"},de=k({__name:"ExcelManagerWithAPI",props:{buttonText:{default:"Excel"},buttonVariant:{default:"ghost"},buttonSize:{default:"md"},buttonClass:{default:"bg-white border border-border rounded-md"},showImport:{type:Boolean,default:!0},showExport:{type:Boolean,default:void 0},showExportExcel:{type:Boolean,default:!0},showExportPdf:{type:Boolean,default:!1},showTemplate:{type:Boolean,default:!0},importUrl:{},exportUrl:{},templateUrl:{},exportFilters:{},exportFilename:{default:"export"},importAccept:{default:".xlsx,.xls"}},emits:["importSuccess","importError","exportSuccess","exportError","templateSuccess","templateError","beforeExport"],setup(a,{emit:l}){const e=a,o=P(()=>typeof e.showExport=="boolean"?e.showExport:e.showExportExcel),s=P(()=>e.showExportPdf===!0),i=l,r=B(!1),m=B(null),f=async()=>{var d,n,b;if(!r.value){i("beforeExport"),r.value=!0;try{console.log("üîÑ Export en cours..."),console.log("üìç URL:",e.exportUrl||"/fiche-cotations/export"),console.log("üìã Filtres:",e.exportFilters);const t=new URLSearchParams;e.exportFilters&&Object.entries(e.exportFilters).forEach(([y,p])=>{p!=null&&p!==""&&t.append(y,String(p))});const S=t.toString(),h=S?`${e.exportUrl||"/fiche-cotations/export"}?${S}`:e.exportUrl||"/fiche-cotations/export";console.log("üåê URL compl√®te:",h);const g=await T.get(h,{responseType:"blob",headers:{Accept:"application/json"}});console.log("‚úÖ R√©ponse re√ßue:",g),console.log("üì¶ Type de blob:",g.data.type,"Taille:",g.data.size);const c=g.data,v=`${e.exportFilename}_${new Date().toISOString().split("T")[0]}.xlsx`;R.downloadBlob(c,v),i("exportSuccess")}catch(t){console.error("‚ùå Erreur lors de l'export:",t),console.error("üìç URL tent√©e:",e.exportUrl),console.error("üìã Filtres envoy√©s:",e.exportFilters),console.error("üîç D√©tails erreur:",{message:t==null?void 0:t.message,status:(d=t==null?void 0:t.response)==null?void 0:d.status,statusText:(n=t==null?void 0:t.response)==null?void 0:n.statusText,data:(b=t==null?void 0:t.response)==null?void 0:b.data}),i("exportError",t.message||"Erreur lors de l'export")}finally{r.value=!1}}},_=async d=>{var t,S;const n=d.target,b=(t=n.files)==null?void 0:t[0];if(!b){console.log("Aucun fichier s√©lectionn√©");return}if(r.value){console.log("Import d√©j√† en cours");return}console.log("D√©but de l'import du fichier:",b.name),r.value=!0;try{const h=new FormData;h.append("file",b);const c=(await T.post(e.importUrl||"/fiche-cotations/import",h,{headers:{"Content-Type":"multipart/form-data"}})).data;if(console.log("R√©sultat de l'import:",c),c.success)console.log("Import r√©ussi, √©mission de l'√©v√©nement importSuccess"),i("importSuccess",c);else{console.log("Import √©chou√©, √©mission de l'√©v√©nement importError"),console.log("Structure des erreurs:",c.errors);const v=c.message||"Erreur lors de l'import";let y="";if(c.errors){if(Array.isArray(c.errors))y=`

D√©tails:
- ${c.errors.slice(0,5).map(p=>p.message||p).join(`
- `)}`;else if(typeof c.errors=="object"){const p=[];for(const[O,U]of Object.entries(c.errors))Array.isArray(U)?U.forEach(N=>p.push(`${O}: ${N}`)):p.push(`${O}: ${U}`);p.length>0&&(y=`

D√©tails:
- ${p.slice(0,5).join(`
- `)}`,p.length>5&&(y+=`
- ... et ${p.length-5} autres erreurs`))}}i("importError",`${v}${y}`)}}catch(h){if(console.error("Exception lors de l'import:",h),(S=h.response)!=null&&S.data){const g=h.response.data,c=g.message||"Erreur lors de l'import";let v="";g.errors&&Array.isArray(g.errors)&&(v=`

D√©tails:
- ${g.errors.slice(0,5).map(y=>y.message||y).join(`
- `)}`),i("importError",`${c}${v}`)}else i("importError",h.message||"Erreur lors de l'import")}finally{r.value=!1,n.value="",console.log("Fin de l'import")}},L=async()=>{if(!r.value){r.value=!0;try{const n=(await T.get(e.templateUrl||`${e.exportUrl||"/fiche-cotations/export"}/template`,{responseType:"blob",headers:{Accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}})).data,b=`template_${e.exportFilename}.xlsx`;R.downloadBlob(n,b),i("templateSuccess")}catch(d){console.error("Erreur lors du t√©l√©chargement du template:",d),i("templateError",d.message||"Erreur lors du t√©l√©chargement du template")}finally{r.value=!1}}},V=()=>{var d;(d=m.value)==null||d.click()};return(d,n)=>(x(),M("div",ie,[$("input",{ref_key:"fileInput",ref:m,type:"file",accept:a.importAccept,onChange:_,class:"hidden"},null,40,ce),I(u(Z),null,{default:E(()=>[I(u(ee),{"as-child":""},{default:E(()=>[I(u(K),{variant:a.buttonVariant,size:a.buttonSize,class:Q(a.buttonClass),disabled:r.value},{default:E(()=>[r.value?(x(),M("span",pe)):(x(),M("span",ue)),C(" "+Y(a.buttonText),1)]),_:1},8,["variant","size","class","disabled"])]),_:1}),I(u(re),null,{default:E(()=>[a.showImport?(x(),w(u(A),{key:0,onClick:V,disabled:r.value,class:"flex items-center cursor-pointer"},{default:E(()=>[...n[0]||(n[0]=[$("span",{class:"flex mr-1.5 iconify hugeicons--upload-01"},null,-1),C(" Importer un fichier Excel ",-1)])]),_:1},8,["disabled"])):F("",!0),o.value?(x(),w(u(A),{key:1,onClick:f,disabled:r.value,class:"flex items-center cursor-pointer"},{default:E(()=>[...n[1]||(n[1]=[$("span",{class:"flex mr-1.5 iconify hugeicons--download-01"},null,-1),C(" Exporter un fichier Excel ",-1)])]),_:1},8,["disabled"])):F("",!0),s.value?(x(),w(u(A),{key:2,onClick:f,disabled:r.value,class:"flex items-center cursor-pointer"},{default:E(()=>[...n[2]||(n[2]=[$("span",{class:"flex mr-1.5 iconify hugeicons--download-01"},null,-1),C(" Exporter un fichier PDF ",-1)])]),_:1},8,["disabled"])):F("",!0),a.showTemplate&&(a.showImport||o.value||s.value)?(x(),w(u(ne),{key:3})):F("",!0),a.showTemplate?(x(),w(u(A),{key:4,onClick:L,disabled:r.value,class:"flex items-center cursor-pointer"},{default:E(()=>[...n[3]||(n[3]=[$("span",{class:"flex mr-1.5 iconify hugeicons--file-download"},null,-1),C(" T√©l√©charger le template ",-1)])]),_:1},8,["disabled"])):F("",!0)]),_:1})]),_:1})]))}}),he=te(de,[["__scopeId","data-v-04f547f9"]]);export{he as E,ne as _};
