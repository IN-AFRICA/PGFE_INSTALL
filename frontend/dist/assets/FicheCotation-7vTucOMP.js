import{d as pa,A as C,p as b,r as g,v as ga,q as F,x as P,w as r,f as s,b as i,i as t,k as ge,y as o,z as M,B as H,C as L,D as R,E as j,c as x,F as G,G as V,J as w,t as T,h as ya,R as ba,U as Ea,V as xa,W as Sa,X as ha,Y as wa,Z as Ca,s as v,o as f,H as te}from"./index-CJ_PivE-.js";import{_ as Y}from"./Input.vue_vue_type_script_setup_true_lang-B9adgRZV.js";import{_ as Aa,a as Pa,b as ie,c as k,d as $a,e as $}from"./TableHeader.vue_vue_type_script_setup_true_lang-cS4zBTGx.js";import{_ as Ce}from"./Checkbox.vue_vue_type_script_setup_true_lang-DTckireD.js";import{_ as Ia,a as Va,b as Na}from"./PopoverTrigger.vue_vue_type_script_setup_true_lang-DzZWQSaq.js";import{_ as Da,a as Fa,b as Ta,c as de}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-DN4DQrTt.js";import{_ as Ae,E as ka}from"./ExcelManagerWithAPI-DFtMVkSy.js";import{_ as J}from"./SelectGroup.vue_vue_type_script_setup_true_lang-CwIOzTi6.js";import{_ as Oa}from"./LayoutSaisieOperation.vue_vue_type_script_setup_true_lang-bYPLg6Nt.js";import{_ as za}from"./BoxPanelWrapper.vue_vue_type_script_setup_true_lang-CmJ-Iy6y.js";import{u as q}from"./useGetApi-EdzHoZm6.js";import{u as Pe}from"./usePostApi-Crg8MURP.js";import{_ as Ua}from"./FilterBadges.vue_vue_type_script_setup_true_lang-CBuiPNtr.js";import{_ as ye}from"./IconifySpinner.vue_vue_type_script_setup_true_lang-C3Td1B5O.js";import"./index-BpkKmY4O.js";import"./RovingFocusGroup-BxePylpC.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./DashLayoutWithMode.vue_vue_type_script_setup_true_lang-DzpyZ4TL.js";import"./RightDashHeader.vue_vue_type_script_setup_true_lang-Bn3G870_.js";import"./DashPageHeader.vue_vue_type_script_setup_true_lang-DucYyTAx.js";const Ba={class:"flex items-center gap-3 justify-between"},Ma={class:"flex flex-1 items-center gap-2"},Ha={class:"relative w-full max-w-xs"},La={class:"grid gap-4"},Ra={class:"flex flex-col gap-3.5"},ja={class:"space-y-1.5"},Ga={class:"space-y-1.5"},Ya={class:"space-y-1.5"},Ja={class:"space-y-1.5"},qa={class:"space-y-1.5"},Wa={class:"flex flex-wrap items-center gap-2.5"},Xa={key:0,class:"flex items-center gap-2"},Za={key:1,class:"flex items-center gap-2"},Ka={class:"mt-4 rounded-md overflow-hidden flex flex-1 bg-white"},Qa={class:"flex items-center justify-center space-x-2"},el={class:"space-y-4 py-4"},al={class:"space-y-2"},ll={class:"space-y-2"},tl={key:0,class:"flex items-center gap-2"},sl={key:1,class:"flex items-center gap-2"},$e="ficheCotation_lastState",Al=pa({__name:"FicheCotation",setup(rl){const Ie=async()=>{var e;if(!S.value||!D.value){v({message:"Veuillez sÃ©lectionner la classe et le cours Ã  initialiser",type:"error"});return}if(c.value&&m.value&&(((e=U.value)==null?void 0:e.length)||0)>0){console.log("[FICHE] initializeFiche: donnÃ©es dÃ©jÃ  prÃ©sentes, on recharge simplement"),await se(),v({message:"La fiche existe dÃ©jÃ . DonnÃ©es rechargÃ©es.",type:"success"}),Q.value=!1;return}const l=`${C.INITIALIZE_FICHE_COTATION}?classroom_id=${S.value}&course_id=${D.value}`;try{if(await ua(l,{}),he.value){v({message:he.value,type:"error"});return}const a=ia.value,n=(a==null?void 0:a.created_count)||0;Q.value=!1,K.value=!0,c.value=S.value,m.value=D.value,me.value&&(ee.value=me.value),setTimeout(()=>{K.value=!1,Ee()},100),n>0?v({message:`Fiche de cotation initialisÃ©e avec succÃ¨s (${n} Ã©lÃ¨ve(s))`,type:"success"}):v({message:"Les fiches de cotation existent dÃ©jÃ . Chargement en cours...",type:"success"}),await se()}catch(a){console.error("âŒ Erreur initialisation:",a),v({message:"Ã‰chec de l'initialisation de la fiche",type:"error"})}},{data:ce,loading:Ve,fetchData:Ne}=q(C.GET_FICHE_COTATIONS),se=async()=>{if(!c.value||!m.value)return;const l={classroom_id:c.value,course_id:m.value};console.log("[FICHE] loadCoatationData - params",l),await Ne(l)},{data:_,loading:De,fetchData:Fe}=q(C.GET_SCHOOL_YEARS),{data:A,loading:Te,fetchData:ke}=q(`${C.GET_STUDENTS}?per_page=1000`),{data:p,loading:Oe,fetchData:ze}=q(C.GET_CLASSROOMS),{data:O,loading:Ue,fetchData:Be}=q(C.GET_SEMESTERS),{data:y,loading:Me,fetchData:He}=q(C.GET_COURSES),{data:W,fetchData:Le}=q(C.GET_FILLIERES);b(()=>{const l=new Map;return _.value&&Array.isArray(_.value)?_.value.forEach(e=>l.set(e.id,e)):_.value&&_.value.years&&Array.isArray(_.value.years)?_.value.years.forEach(e=>l.set(e.id,e)):_.value&&_.value.data&&Array.isArray(_.value.data)&&_.value.data.forEach(e=>l.set(e.id,e)),l});const Re=b(()=>{const l=new Map;if(A.value&&Array.isArray(A.value))A.value.forEach(e=>l.set(e.id,e));else if(A.value&&A.value.students){const e=A.value.students;e.data&&Array.isArray(e.data)?e.data.forEach(a=>l.set(a.id,a)):Array.isArray(e)?e.forEach(a=>l.set(a.id,a)):Object.values(e).forEach(a=>{a&&typeof a=="object"&&a.id&&l.set(a.id,a)})}else A.value&&A.value.data&&Array.isArray(A.value.data)&&A.value.data.forEach(e=>l.set(e.id,e));return l}),je=b(()=>{const l=new Map;return p.value&&Array.isArray(p.value)?p.value.forEach(e=>l.set(e.id,e)):p.value&&p.value.data&&Array.isArray(p.value.data)&&p.value.data.forEach(e=>l.set(e.id,e)),l});b(()=>{const l=new Map;return O.value&&Array.isArray(O.value)?O.value.forEach(e=>l.set(e.id,e)):O.value&&O.value.data&&Array.isArray(O.value.data)&&O.value.data.forEach(e=>l.set(e.id,e)),l}),b(()=>{const l=new Map;return y.value&&Array.isArray(y.value)?y.value.forEach(e=>l.set(e.id,e)):y.value&&y.value.data&&Array.isArray(y.value.data)&&y.value.data.forEach(e=>l.set(e.id,e)),l});const re=g({}),d=l=>{const e=Number(l||0);return re.value[e]||(re.value[e]={note:{P1:0,P2:0,E1:0,P3:0,P4:0,E2:0},maxima:{}}),re.value[e]},z=(l,e,a)=>{const n=`${l}-${e}`,u=d(l).maxima[e];if(a==null||a==="")return B.value.delete(n),ue.value.delete(n),!0;const I=Number(a);if(I<0){B.value.add(n),be(n);const le=Date.now();return le-oe.value>1e3&&(v({message:"La note ne peut pas Ãªtre nÃ©gative",type:"error"}),oe.value=le),!1}if(u!=null&&I>u){B.value.add(n),be(n);const le=Date.now();return le-oe.value>1e3&&(v({message:`La note ne peut pas dÃ©passer ${u}/${u}`,type:"error"}),oe.value=le),!1}return B.value.delete(n),ue.value.delete(n),!0},be=l=>{ue.value.add(l);let e=0;const a=setInterval(()=>{e++,e>=6&&clearInterval(a)},500)},X=(l,e)=>B.value.has(`${l}-${e}`),Z=(l,e)=>ue.value.has(`${l}-${e}`),Ge=l=>{if(!l)return"-";const e=Re.value.get(l);return e?`${e.firstname||""} ${e.lastname||""}`.trim()||e.name||`ID: ${l}`:`ID: ${l}`},Ye=l=>l.student||Ge(Number(l.student_id)),U=b(()=>{const l=ce.value;return!Array.isArray(l)||l.length===0?[]:(l.forEach(e=>{if(typeof e.note=="string")try{e.note=JSON.parse(e.note)}catch{e.note={}}else typeof e.note=="number"?e.note={}:(e.note===null||e.note===void 0)&&(e.note={})}),console.log(`âœ… ${l.length} fiches chargÃ©es`),l)}),fe=b(()=>{let l=U.value;if(ne.value){const e=ne.value.toLowerCase();l=l.filter(a=>(a.student||"").toLowerCase().includes(e))}return N.value&&(l=l.filter(e=>String(e.school_year_id)===String(N.value))),E.value&&(l=l.filter(e=>{const a=je.value.get(Number(e.classroom_id)),n=(a==null?void 0:a.filiere_id)||(a==null?void 0:a.filiaire_id);return String(n)===String(E.value)})),c.value&&(l=l.filter(e=>String(e.classroom_id)===String(c.value))),m.value&&(l=l.filter(e=>String(e.course_id)===String(m.value))),l}),Je=b(()=>De.value||Te.value||Oe.value||Ue.value||Me.value),qe=async l=>{const e=l.imported_count?`âœ… Import rÃ©ussi ! ${l.imported_count} ligne(s) importÃ©e(s)`:"âœ… Import de la fiche de cotation rÃ©ussi !";v({message:e,type:"success"}),await se()},We=l=>{v({message:`âŒ Erreur lors de l'import : ${l}`,type:"error"})},Xe=()=>{v({message:"âœ… Export de la fiche de cotation rÃ©ussi ! Le fichier a Ã©tÃ© tÃ©lÃ©chargÃ©.",type:"success"})},Ze=l=>{v({message:`âŒ Erreur lors de l'export de la fiche de cotation : ${l}`,type:"error"})},Ke=()=>{v({message:"âœ… Template de fiche de cotation tÃ©lÃ©chargÃ© avec succÃ¨s !",type:"success"})},Qe=l=>{v({message:`âŒ Erreur lors du tÃ©lÃ©chargement du template de fiche de cotation : ${l}`,type:"error"})},ea=()=>{updateExportFilters()},aa=g({annee_scolaire:null,filiere:null,classe:null,cours:null,periode_examen:null,search:null}),ne=g(""),N=g(""),E=g(""),c=g(""),m=g("");g("");const K=g(!1),Ee=()=>{if(!c.value||!m.value)return;const l={classroom_id:c.value,course_id:m.value,timestamp:Date.now()};console.log("[FICHE] saveState ->",l),localStorage.setItem($e,JSON.stringify(l))},la=()=>{const l=localStorage.getItem($e);if(!l)return null;try{const e=JSON.parse(l);return console.log("[FICHE] restoreState <-",e),e}catch(e){return console.warn("[FICHE] restoreState error",e),null}};ga(async()=>{console.log("[FICHE] onMounted START"),await Promise.all([Fe(),ke(),ze(),Be(),He(),Le()]),console.log("[FICHE] onMounted - donnÃ©es de rÃ©fÃ©rence chargÃ©es");const l=la();l?(K.value=!0,c.value=l.classroom_id,m.value=l.course_id,console.log("[FICHE] onMounted - Ã©tat restaurÃ©:",{selectedClasse:c.value,selectedCours:m.value}),console.log("[FICHE] onMounted -> loadCotationData()"),await se(),setTimeout(()=>{K.value=!1,console.log("[FICHE] isRestoringFilters dÃ©sactivÃ©")},500)):console.log("[FICHE] onMounted - aucun Ã©tat Ã  restaurer")});const Q=g(!1),S=g(null),D=g(null),ee=g("P1"),me=g("P1"),h=l=>ee.value!==""&&ee.value!==l;F(()=>ce.value,l=>{var a;const e=Array.isArray(l)?l.length:((a=l==null?void 0:l.data)==null?void 0:a.length)??0;console.log("[FICHE] watch apiCotationData length =",e,l)}),F(fe,l=>{console.log("[FICHE] watch filteredCotationData length =",(l==null?void 0:l.length)||0)});const xe=b(()=>{var l;return(((l=U.value)==null?void 0:l.length)||0)>0}),ta=b(()=>xe.value?"Enregistrer":"Initialiser la fiche"),ae=b(()=>na.value||_e.value),sa=b(()=>y.value?S.value?y.value.filter(l=>String(l.classroom_id)===String(S.value)):[]:[]),Se=()=>{S.value=c.value||null,D.value=m.value||null,me.value=ee.value,Q.value=!0};F(S,(l,e)=>{e!==void 0&&l!==e&&(D.value=null)}),F(()=>U.value,l=>{l&&l.forEach(e=>{const a=Number(e.student_id||0);if(a<=0)return;const n=d(a);e.note&&typeof e.note=="object"&&(n.note={...n.note,...e.note}),e.maxima&&typeof e.maxima=="object"&&(n.maxima={...n.maxima,...e.maxima})})},{immediate:!0}),F(re,l=>{Object.entries(l).forEach(([e,a])=>{const n=Number(e);Object.entries(a.note).forEach(([u,I])=>{z(n,u,I)})})},{deep:!0});const{postData:ra,loading:na,error:ve,errorDetails:oa}=Pe(),{postData:ua,loading:_e,response:ia,error:he}=Pe(),B=g(new Set),oe=g(0),ue=g(new Set),we=async()=>{if(B.value.size>0){v({message:`Impossible d'enregistrer : ${B.value.size} note(s) invalide(s) (nÃ©gative ou dÃ©passant le maximum)`,type:"error"});return}let l=c.value?Number(c.value):null,e=m.value?Number(m.value):null;if((!l||!e)&&U.value&&U.value.length>0){const u=U.value[0];!l&&u.classroom_id&&(l=Number(u.classroom_id),c.value=String(u.classroom_id)),!e&&u.course_id&&(e=Number(u.course_id),m.value=String(u.course_id))}if(!l||!e){v({message:"Veuillez sÃ©lectionner la classe et le cours",type:"error"});return}const a=Object.entries(re.value).filter(([u])=>Number(u)>0).map(([u,I])=>({student_id:Number(u),note:I.note})).filter(u=>Object.values(u.note).some(pe=>pe!=null&&pe!==""));if(a.length===0){v({message:"Aucune modification Ã  enregistrer",type:"error"});return}const n={classroom_id:l,course_id:e,notes:a};console.log("ðŸ’¾ Enregistrement des notes:",n),console.log("ðŸ“ DÃ©tail notes:",JSON.stringify(n,null,2));try{if(await ra(C.GET_FICHE_COTATIONS,n),ve.value){console.error("âŒ Erreur validation backend:",ve.value),console.error("âŒ DÃ©tails erreur complÃ¨te:",oa.value),v({message:ve.value,type:"error"});return}Ee(),v({message:"Fiche de cotation enregistrÃ©e avec succÃ¨s",type:"success"}),await se()}catch(u){console.error("âŒ Erreur enregistrement:",u),v({message:"Erreur lors de l'enregistrement",type:"error"})}},da=b(()=>{var e;return p.value?E.value?(Array.isArray(p.value)?p.value:((e=p.value)==null?void 0:e.data)||[]).filter(a=>String(a.filiere_id||a.filiaire_id)===String(E.value)):p.value:[]}),ca=b(()=>{var e;return y.value?c.value?(Array.isArray(y.value)?y.value:((e=y.value)==null?void 0:e.data)||[]).filter(a=>String(a.classroom_id)===String(c.value)):[]:[]});F(E,(l,e)=>{!K.value&&e!==void 0&&l!==e&&(c.value="",m.value="")}),F(c,(l,e)=>{!K.value&&e!==void 0&&l!==e&&(m.value="")}),F(ce,l=>{var e;if(l&&l.length>0){const a=l[0];if(a.school_year_id&&!N.value&&(N.value=String(a.school_year_id)),a.classroom_id&&!c.value&&(c.value=String(a.classroom_id)),a.course_id&&!m.value&&(m.value=String(a.course_id)),a.classroom_id&&!E.value){const u=(Array.isArray(p.value)?p.value:((e=p.value)==null?void 0:e.data)||[]).find(I=>String(I.id)===String(a.classroom_id));u&&(u.filiere_id||u.filiaire_id)&&(E.value=String(u.filiere_id||u.filiaire_id))}}},{immediate:!0});const fa=b(()=>({school_year_id:N.value||void 0,filiaire_id:E.value||void 0,classroom_id:c.value||void 0,course_id:m.value||void 0})),ma=b(()=>{var l,e,a,n,u;return{school_year_id:Array.isArray(_.value)?_.value:((l=_.value)==null?void 0:l.years)||((e=_.value)==null?void 0:e.data)||[],filiaire_id:Array.isArray(W.value)?W.value:((a=W.value)==null?void 0:a.data)||[],classroom_id:Array.isArray(p.value)?p.value:((n=p.value)==null?void 0:n.data)||[],course_id:Array.isArray(y.value)?y.value:((u=y.value)==null?void 0:u.data)||[]}}),va={school_year_id:(l,e)=>{const a=e==null?void 0:e.find(n=>String(n.id)===String(l));return a?a.name:String(l)},filiaire_id:(l,e)=>{const a=e==null?void 0:e.find(n=>String(n.id)===String(l));return a?a.name:String(l)},classroom_id:(l,e)=>{const a=e==null?void 0:e.find(n=>String(n.id)===String(l));return a?a.name:String(l)},course_id:(l,e)=>{const a=e==null?void 0:e.find(n=>String(n.id)===String(l));return a?a.label||a.name:String(l)}},_a=l=>{l==="school_year_id"&&(N.value=""),l==="filiaire_id"&&(E.value=""),l==="classroom_id"&&(c.value=""),l==="course_id"&&(m.value="")};return(l,e)=>(f(),P(Oa,{"active-tag-name":"fiche-cotation",group:"operations"},{default:r(()=>[s(za,null,{default:r(()=>[i("div",Ba,[i("div",Ma,[i("div",Ha,[s(t(Y),{type:"text",id:"search",name:"search",placeholder:"Rechercher un cours...",modelValue:ne.value,"onUpdate:modelValue":e[0]||(e[0]=a=>ne.value=a),class:"w-full max-w-xs ps-10 border border-gray-200/40 bg-white transition-all h-10 rounded-md"},null,8,["modelValue"]),e[10]||(e[10]=i("div",{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-foreground-muted/70"},[i("span",{class:"flex iconify hugeicons--search-01 text-sm"})],-1))]),s(t(Ia),null,{default:r(()=>[s(t(Va),{"as-child":""},{default:r(()=>[s(t(ge),{variant:"ghost",size:"md",class:"h-10 rounded-md border bg-white"},{default:r(()=>[...e[11]||(e[11]=[o(" Filtre ",-1),i("span",{class:"iconify hugeicons--filter"},"Filtre",-1)])]),_:1})]),_:1}),s(t(Na),{class:"w-80"},{default:r(()=>[i("div",La,[e[23]||(e[23]=i("div",{class:"space-y-2"},[i("h4",{class:"font-medium leading-none"},"Filtrage")],-1)),i("div",Ra,[i("div",ja,[s(t(M),{class:"text-foreground-muted font-light",for:"annee"},{default:r(()=>[...e[12]||(e[12]=[o("AnnÃ©e scolaire",-1)])]),_:1}),s(t(H),{modelValue:N.value,"onUpdate:modelValue":e[1]||(e[1]=a=>N.value=a)},{default:r(()=>[s(t(L),{id:"annee",class:"!h-10 bg-white w-full"},{default:r(()=>[s(t(R),{placeholder:"SÃ©lectionnez l'annÃ©e scolaire"})]),_:1}),s(t(j),null,{default:r(()=>[s(t(J),null,{default:r(()=>{var a,n;return[(f(!0),x(V,null,G(Array.isArray(t(_))?t(_):((a=t(_))==null?void 0:a.years)||((n=t(_))==null?void 0:n.data)||[],u=>(f(),P(t(w),{key:u.id,value:String(u.id)},{default:r(()=>[o(T(u.name),1)]),_:2},1032,["value"]))),128))]}),_:1})]),_:1})]),_:1},8,["modelValue"])]),i("div",Ga,[s(t(M),{class:"text-foreground-muted font-light",for:"filiere"},{default:r(()=>[...e[13]||(e[13]=[o("Section",-1)])]),_:1}),s(t(H),{modelValue:E.value,"onUpdate:modelValue":e[2]||(e[2]=a=>E.value=a)},{default:r(()=>[s(t(L),{id:"filiere",class:"!h-10 bg-white w-full"},{default:r(()=>[s(t(R),{placeholder:"SÃ©lectionnez la filiÃ¨re"})]),_:1}),s(t(j),null,{default:r(()=>[s(t(J),null,{default:r(()=>{var a;return[(f(!0),x(V,null,G(Array.isArray(t(W))?t(W):((a=t(W))==null?void 0:a.data)||[],n=>(f(),P(t(w),{key:n.id,value:String(n.id)},{default:r(()=>[o(T(n.name),1)]),_:2},1032,["value"]))),128))]}),_:1})]),_:1})]),_:1},8,["modelValue"])]),i("div",Ya,[s(t(M),{class:"text-foreground-muted font-light",for:"classe"},{default:r(()=>[...e[14]||(e[14]=[o("Classe",-1)])]),_:1}),s(t(H),{modelValue:c.value,"onUpdate:modelValue":e[3]||(e[3]=a=>c.value=a),disabled:!E.value},{default:r(()=>[s(t(L),{id:"classe",class:"!h-10 bg-white w-full",disabled:!E.value},{default:r(()=>[s(t(R),{placeholder:"SÃ©lectionnez d'abord une filiÃ¨re"})]),_:1},8,["disabled"]),s(t(j),null,{default:r(()=>[s(t(J),null,{default:r(()=>[(f(!0),x(V,null,G(da.value,a=>(f(),P(t(w),{key:a.id,value:String(a.id)},{default:r(()=>[o(T(a.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue","disabled"])]),i("div",Ja,[s(t(M),{class:"text-foreground-muted font-light",for:"cours"},{default:r(()=>[...e[15]||(e[15]=[o("Cours",-1)])]),_:1}),s(t(H),{modelValue:m.value,"onUpdate:modelValue":e[4]||(e[4]=a=>m.value=a),disabled:!c.value},{default:r(()=>[s(t(L),{id:"cours",class:"!h-10 bg-white w-full",disabled:!c.value},{default:r(()=>[s(t(R),{placeholder:"SÃ©lectionnez d'abord une classe"})]),_:1},8,["disabled"]),s(t(j),null,{default:r(()=>[s(t(J),null,{default:r(()=>[(f(!0),x(V,null,G(ca.value,a=>(f(),P(t(w),{key:a.id,value:String(a.id)},{default:r(()=>[o(T(a.label||a.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue","disabled"])]),i("div",qa,[s(t(M),{class:"text-foreground-muted font-light",for:"active_col"},{default:r(()=>[...e[16]||(e[16]=[o("Colonne active (Ã©dition)",-1)])]),_:1}),s(t(H),{modelValue:ee.value,"onUpdate:modelValue":e[5]||(e[5]=a=>ee.value=a)},{default:r(()=>[s(t(L),{id:"active_col",class:"!h-10 bg-white w-full"},{default:r(()=>[s(t(R),{placeholder:"SÃ©lectionnez une colonne (P1, P2, E1, P3, P4, E2)"})]),_:1}),s(t(j),null,{default:r(()=>[s(t(J),null,{default:r(()=>[s(t(w),{value:"P1"},{default:r(()=>[...e[17]||(e[17]=[o("P1",-1)])]),_:1}),s(t(w),{value:"P2"},{default:r(()=>[...e[18]||(e[18]=[o("P2",-1)])]),_:1}),s(t(w),{value:"E1"},{default:r(()=>[...e[19]||(e[19]=[o("E1",-1)])]),_:1}),s(t(w),{value:"P3"},{default:r(()=>[...e[20]||(e[20]=[o("P3",-1)])]),_:1}),s(t(w),{value:"P4"},{default:r(()=>[...e[21]||(e[21]=[o("P4",-1)])]),_:1}),s(t(w),{value:"E2"},{default:r(()=>[...e[22]||(e[22]=[o("E2",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])])])]),_:1})]),_:1}),s(Ua,{filters:fa.value,"reference-data":ma.value,"custom-labels":va,onRemoveFilter:_a},null,8,["filters","reference-data"])]),i("div",Wa,[s(t(Da),null,{default:r(()=>[s(t(Fa),{"as-child":""},{default:r(()=>[s(t(ge),{variant:"default",size:"md",class:"h-10 rounded-md",disabled:ae.value},{default:r(()=>[ae.value?(f(),x("span",Xa,[s(ye,{size:"sm"}),e[24]||(e[24]=i("span",null,"Traitement...",-1))])):(f(),x("span",Za,[e[25]||(e[25]=i("span",{class:"iconify hugeicons--arrow-down-01"},null,-1)),i("span",null,T(ta.value),1)]))]),_:1},8,["disabled"])]),_:1}),s(t(Ta),{align:"end"},{default:r(()=>[xe.value?(f(),x(V,{key:0},[s(t(de),{onClick:we,disabled:ae.value,class:"flex items-center cursor-pointer"},{default:r(()=>[...e[26]||(e[26]=[i("span",{class:"flex mr-1.5 iconify hugeicons--floppy-disk"},null,-1),o(" Enregistrer ",-1)])]),_:1},8,["disabled"]),s(t(Ae)),s(t(de),{onClick:Se,disabled:ae.value,class:"flex items-center cursor-pointer"},{default:r(()=>[...e[27]||(e[27]=[i("span",{class:"flex mr-1.5 iconify hugeicons--exchange-01"},null,-1),o(" Initialiser la fiche ",-1)])]),_:1},8,["disabled"])],64)):(f(),x(V,{key:1},[s(t(de),{onClick:Se,disabled:ae.value,class:"flex items-center cursor-pointer"},{default:r(()=>[...e[28]||(e[28]=[i("span",{class:"flex mr-1.5 iconify hugeicons--exchange-01"},null,-1),o(" Initialiser la fiche ",-1)])]),_:1},8,["disabled"]),s(t(Ae)),s(t(de),{onClick:we,disabled:ae.value,class:"flex items-center cursor-pointer"},{default:r(()=>[...e[29]||(e[29]=[i("span",{class:"flex mr-1.5 iconify hugeicons--floppy-disk"},null,-1),o(" Enregistrer ",-1)])]),_:1},8,["disabled"])],64))]),_:1})]),_:1}),s(ka,{"import-url":t(C).IMPORT_FICHE_COTATION,"export-url":t(C).EXPORT_FICHE_COTATION,"button-text":"Excel","export-filename":"fiche-cotation","export-filters":aa.value,"show-export-excel":!1,"show-export-pdf":!1,onBeforeExport:ea,onImportSuccess:qe,onImportError:We,onExportSuccess:Xe,onExportError:Ze,onTemplateSuccess:Ke,onTemplateError:Qe},null,8,["import-url","export-url","export-filters"])])]),i("div",Ka,[s(t(Aa),{class:"rounded-md bg-white"},{default:r(()=>[s(t(Pa),null,{default:r(()=>[s(t(ie),null,{default:r(()=>[s(t(k),{class:"w-[20px]"},{default:r(()=>[s(t(Ce),{class:"bg-white scale-70"})]),_:1}),s(t(k),null,{default:r(()=>[...e[30]||(e[30]=[o(" Ã‰lÃ¨ve ",-1)])]),_:1}),s(t(k),{class:"text-center w-25"},{default:r(()=>[...e[31]||(e[31]=[o("P1",-1)])]),_:1}),s(t(k),{class:"text-center w-25"},{default:r(()=>[...e[32]||(e[32]=[o("P2",-1)])]),_:1}),s(t(k),{class:"text-center w-25"},{default:r(()=>[...e[33]||(e[33]=[o("E1",-1)])]),_:1}),s(t(k),{class:"text-center w-25"},{default:r(()=>[...e[34]||(e[34]=[o("P3",-1)])]),_:1}),s(t(k),{class:"text-center w-25"},{default:r(()=>[...e[35]||(e[35]=[o("P4",-1)])]),_:1}),s(t(k),{class:"text-center w-25"},{default:r(()=>[...e[36]||(e[36]=[o("E2",-1)])]),_:1})]),_:1})]),_:1}),s(t($a),null,{default:r(()=>[t(Ve)||Je.value?(f(),P(t(ie),{key:0},{default:r(()=>[s(t($),{colspan:"9",class:"text-center py-8"},{default:r(()=>[i("div",Qa,[s(ye,{size:"lg"}),e[37]||(e[37]=i("span",null,"Chargement des donnÃ©es...",-1))])]),_:1})]),_:1})):fe.value.length===0?(f(),P(t(ie),{key:1},{default:r(()=>[s(t($),{colspan:"9",class:"text-center py-8 text-gray-500"},{default:r(()=>[...e[38]||(e[38]=[o(" Aucune donnÃ©e de cotation disponible ",-1)])]),_:1})]),_:1})):ya("",!0),(f(!0),x(V,null,G(fe.value,a=>(f(),P(t(ie),{key:a.id},{default:r(()=>[s(t($),{class:"w-[40px]"},{default:r(()=>[s(t(Ce),{class:"bg-white scale-70"})]),_:1}),s(t($),null,{default:r(()=>[o(T(Ye(a)),1)]),_:2},1024),s(t($),null,{default:r(()=>[s(t(Y),{modelValue:d(a.student_id).note.P1,"onUpdate:modelValue":n=>d(a.student_id).note.P1=n,modelModifiers:{number:!0},max:d(a.student_id).maxima.P1??void 0,min:"0",step:"0.1",type:"number",disabled:h("P1"),class:te(["w-20",X(Number(a.student_id),"P1")?"border-red-500 border-2":"",Z(Number(a.student_id),"P1")?"animate-pulse":"",h("P1")?"opacity-50 bg-gray-100 text-gray-400 cursor-not-allowed":""]),onBlur:n=>z(Number(a.student_id),"P1",d(a.student_id).note.P1)},null,8,["modelValue","onUpdate:modelValue","max","disabled","class","onBlur"])]),_:2},1024),s(t($),null,{default:r(()=>[s(t(Y),{modelValue:d(a.student_id).note.P2,"onUpdate:modelValue":n=>d(a.student_id).note.P2=n,modelModifiers:{number:!0},max:d(a.student_id).maxima.P2??void 0,min:"0",step:"0.1",type:"number",disabled:h("P2"),class:te(["w-20",X(Number(a.student_id),"P2")?"border-red-500 border-2":"",Z(Number(a.student_id),"P2")?"animate-pulse":"",h("P2")?"opacity-50 bg-gray-100 text-gray-400 cursor-not-allowed":""]),onBlur:n=>z(Number(a.student_id),"P2",d(a.student_id).note.P2)},null,8,["modelValue","onUpdate:modelValue","max","disabled","class","onBlur"])]),_:2},1024),s(t($),null,{default:r(()=>[s(t(Y),{modelValue:d(a.student_id).note.E1,"onUpdate:modelValue":n=>d(a.student_id).note.E1=n,modelModifiers:{number:!0},max:d(a.student_id).maxima.E1??void 0,min:"0",step:"0.1",type:"number",disabled:h("E1"),class:te(["w-20",X(Number(a.student_id),"E1")?"border-red-500 border-2":"",Z(Number(a.student_id),"E1")?"animate-pulse":"",h("E1")?"opacity-50 bg-gray-100 text-gray-400 cursor-not-allowed":""]),onBlur:n=>z(Number(a.student_id),"E1",d(a.student_id).note.E1)},null,8,["modelValue","onUpdate:modelValue","max","disabled","class","onBlur"])]),_:2},1024),s(t($),null,{default:r(()=>[s(t(Y),{modelValue:d(a.student_id).note.P3,"onUpdate:modelValue":n=>d(a.student_id).note.P3=n,modelModifiers:{number:!0},max:d(a.student_id).maxima.P3??void 0,min:"0",step:"0.1",type:"number",disabled:h("P3"),class:te(["w-20",X(Number(a.student_id),"P3")?"border-red-500 border-2":"",Z(Number(a.student_id),"P3")?"animate-pulse":"",h("P3")?"opacity-50 bg-gray-100 text-gray-400 cursor-not-allowed":""]),onBlur:n=>z(Number(a.student_id),"P3",d(a.student_id).note.P3)},null,8,["modelValue","onUpdate:modelValue","max","disabled","class","onBlur"])]),_:2},1024),s(t($),null,{default:r(()=>[s(t(Y),{modelValue:d(a.student_id).note.P4,"onUpdate:modelValue":n=>d(a.student_id).note.P4=n,modelModifiers:{number:!0},max:d(a.student_id).maxima.P4??void 0,min:"0",step:"0.1",type:"number",disabled:h("P4"),class:te(["w-20",X(Number(a.student_id),"P4")?"border-red-500 border-2":"",Z(Number(a.student_id),"P4")?"animate-pulse":"",h("P4")?"opacity-50 bg-gray-100 text-gray-400 cursor-not-allowed":""]),onBlur:n=>z(Number(a.student_id),"P4",d(a.student_id).note.P4)},null,8,["modelValue","onUpdate:modelValue","max","disabled","class","onBlur"])]),_:2},1024),s(t($),null,{default:r(()=>[s(t(Y),{modelValue:d(a.student_id).note.E2,"onUpdate:modelValue":n=>d(a.student_id).note.E2=n,modelModifiers:{number:!0},max:d(a.student_id).maxima.E2??void 0,min:"0",step:"0.1",type:"number",disabled:h("E2"),class:te(["w-20",X(Number(a.student_id),"E2")?"border-red-500 border-2":"",Z(Number(a.student_id),"E2")?"animate-pulse":"",h("E2")?"opacity-50 bg-gray-100 text-gray-400 cursor-not-allowed":""]),onBlur:n=>z(Number(a.student_id),"E2",d(a.student_id).note.E2)},null,8,["modelValue","onUpdate:modelValue","max","disabled","class","onBlur"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),s(t(ba),{open:Q.value,"onUpdate:open":e[9]||(e[9]=a=>Q.value=a)},{default:r(()=>[s(t(Ea),{class:"max-w-md"},{default:r(()=>[s(t(xa),null,{default:r(()=>[s(t(Sa),null,{default:r(()=>[...e[39]||(e[39]=[o("Initialiser la fiche de cotation",-1)])]),_:1}),s(t(ha),null,{default:r(()=>[...e[40]||(e[40]=[o(" SÃ©lectionnez la classe et le cours pour initialiser la fiche de cotation. ",-1)])]),_:1})]),_:1}),i("div",el,[i("div",al,[s(t(M),null,{default:r(()=>[...e[41]||(e[41]=[o("Classe *",-1)])]),_:1}),s(t(H),{modelValue:S.value,"onUpdate:modelValue":e[6]||(e[6]=a=>S.value=a)},{default:r(()=>[s(t(L),null,{default:r(()=>[s(t(R),{placeholder:"SÃ©lectionnez une classe"})]),_:1}),s(t(j),null,{default:r(()=>[s(t(J),null,{default:r(()=>[(f(!0),x(V,null,G(t(p),a=>(f(),P(t(w),{key:a.id,value:String(a.id)},{default:r(()=>[o(T(a.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),i("div",ll,[s(t(M),null,{default:r(()=>[...e[42]||(e[42]=[o("Cours *",-1)])]),_:1}),s(t(H),{modelValue:D.value,"onUpdate:modelValue":e[7]||(e[7]=a=>D.value=a),disabled:!S.value},{default:r(()=>[s(t(L),null,{default:r(()=>[s(t(R),{placeholder:S.value?"SÃ©lectionnez un cours":"SÃ©lectionnez d'abord une classe"},null,8,["placeholder"])]),_:1}),s(t(j),null,{default:r(()=>[s(t(J),null,{default:r(()=>[(f(!0),x(V,null,G(sa.value,a=>(f(),P(t(w),{key:a.id,value:String(a.id)},{default:r(()=>[o(T(a.label||a.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue","disabled"])])]),s(t(wa),null,{default:r(()=>[s(t(Ca),{onClick:e[8]||(e[8]=a=>Q.value=!1)},{default:r(()=>[...e[43]||(e[43]=[o("Annuler",-1)])]),_:1}),s(t(ge),{onClick:Ie,disabled:!S.value||!D.value||t(_e)},{default:r(()=>[t(_e)?(f(),x("span",sl,[s(ye,{size:"sm"}),e[44]||(e[44]=i("span",null,"Initialisation...",-1))])):(f(),x("span",tl," Initialiser "))]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"])]),_:1})]),_:1}))}});export{Al as default};
