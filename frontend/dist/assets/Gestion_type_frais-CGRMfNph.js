import{o as ue,s as z,u as pe,aQ as x,t as ce}from"./vee-validate-zod-Bra4yLtR.js";import{_ as fe}from"./ComptaLayout.vue_vue_type_script_setup_true_lang-Bu3Oqdii.js";import{_ as me}from"./BoxPanelWrapper.vue_vue_type_script_setup_true_lang-CmJ-Iy6y.js";import{d as _e,r as F,A as g,p as ye,s as c,v as ve,x as b,w as a,f as t,b as o,i as s,h as f,k as y,y as r,t as p,K as q,L as I,M as Q,N as K,O as H,z as k,c as m,a4 as w,P as J,F as ge,G as Ee,o as u}from"./index-CJ_PivE-.js";import{_ as S}from"./Input.vue_vue_type_script_setup_true_lang-B9adgRZV.js";import{_ as W}from"./Textarea.vue_vue_type_script_setup_true_lang-Bg8QXdyw.js";import{_ as X}from"./Checkbox.vue_vue_type_script_setup_true_lang-DTckireD.js";import{_ as xe,a as be,b as L,c as $,d as ke,e as _}from"./TableHeader.vue_vue_type_script_setup_true_lang-cS4zBTGx.js";import{_ as we}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-Bm461x8Q.js";import{u as $e}from"./useGetApi-EdzHoZm6.js";import{u as Ce}from"./usePostApi-Crg8MURP.js";import{u as De}from"./usePutApi-BrTvEW5v.js";import{u as he}from"./useDeleteApi-D2AjqV8w.js";import"./DashPageHeader.vue_vue_type_script_setup_true_lang-DucYyTAx.js";import"./DashLayout.vue_vue_type_script_setup_true_lang-Ch2egXHm.js";import"./RightDashHeader.vue_vue_type_script_setup_true_lang-Bn3G870_.js";import"./index-BpkKmY4O.js";import"./RovingFocusGroup-BxePylpC.js";const Fe={class:"flex items-center gap-3 justify-between mb-4"},Se={class:"relative flex-1 max-w-md"},Le={class:"flex items-center gap-2"},Te={class:"grid grid-cols-2 gap-4"},Ae={class:"space-y-2"},Pe={key:0,class:"text-sm text-red-500 mt-1"},ze={class:"space-y-2"},Ne={key:0,class:"text-sm text-red-500 mt-1"},Re={class:"space-y-2"},Ve={key:0,class:"text-sm text-red-500 mt-1"},Ue={key:0,class:"iconify hugeicons--loading-03 animate-spin mr-2"},Ye={class:"border rounded-lg overflow-hidden flex flex-1 bg-white"},je={class:"flex items-center justify-center gap-2"},Be={class:"flex items-center justify-center gap-2"},Ge={class:"text-sm font-mono bg-gray-100 px-2 py-1 rounded"},Oe={class:"text-sm text-gray-600"},qe={class:"flex items-center gap-2 w-max"},Ie={class:"grid grid-cols-2 gap-4"},Qe={class:"space-y-2"},Ke={key:0,class:"text-sm text-red-500 mt-1"},He={class:"space-y-2"},Je={key:0,class:"text-sm text-red-500 mt-1"},We={class:"space-y-2"},Xe={key:0,class:"text-sm text-red-500 mt-1"},Ze={key:0,class:"iconify hugeicons--loading-03 animate-spin mr-2"},gs=_e({__name:"Gestion_type_frais",setup(Me){const Z=ue({name:z().min(1,"Le nom est requis").max(100,"Le nom ne peut pas dépasser 100 caractères"),code:z().min(1,"Le code est requis").max(20,"Le code ne peut pas dépasser 20 caractères"),description:z().optional()}),C=F(""),d=F([]),T=F(!1),D=F(!1),A=F(null),{data:P,loading:M,error:N,fetchData:h}=$e(g.GET_FEE_TYPES),{postData:ee,loading:R}=Ce(),{putData:se,loading:V}=De(),{deleteItem:U,deleting:Y,errorDelete:E}=he(),{handleSubmit:j,resetForm:B,setValues:te}=pe({validationSchema:ce(Z)}),v=ye(()=>{var e;if(!((e=P.value)!=null&&e.fee_types))return[];if(!C.value)return P.value.fee_types;const n=C.value.toLowerCase();return P.value.fee_types.filter(l=>l.name.toLowerCase().includes(n)||l.description&&l.description.toLowerCase().includes(n))}),ae=n=>n?new Date(n).toLocaleDateString("fr-FR"):"-",G=j(async n=>{try{await ee(g.CREATE_FEE_TYPE,n),c({message:"Type de frais créé avec succès",type:"success"}),B(),T.value=!1,await h()}catch{c({message:"Erreur lors de la création du type de frais",type:"error"})}}),O=j(async n=>{if(A.value)try{await se(g.UPDATE_FEE_TYPE(A.value.id),n),c({message:"Type de frais modifié avec succès",type:"success"}),B(),D.value=!1,A.value=null,await h()}catch{c({message:"Erreur lors de la modification du type de frais",type:"error"})}}),le=n=>{A.value=n,te({name:n.name,code:n.code,description:n.description||""}),D.value=!0},ie=async n=>{if(confirm("Êtes-vous sûr de vouloir supprimer ce type de frais ?"))try{console.log("Suppression du type de frais ID:",n),console.log("URL de suppression:",g.DELETE_FEE_TYPE(n));const e=await U(g.DELETE_FEE_TYPE(n));if(console.log("Résultat de suppression:",e),console.log("Erreur de suppression:",E.value),E.value){c({message:E.value,type:"error"});return}c({message:"Type de frais supprimé avec succès",type:"success"}),await h()}catch(e){console.error("Erreur lors de la suppression:",e),c({message:(e==null?void 0:e.message)||"Erreur lors de la suppression du type de frais",type:"error"})}},oe=n=>{d.value.includes(n)?d.value=d.value.filter(e=>e!==n):d.value.push(n)},ne=()=>{d.value.length===v.value.length&&v.value.length>0?d.value=[]:d.value=v.value.map(n=>n.id)},re=async()=>{if(d.value.length===0){c({message:"Aucun type de frais sélectionné",type:"warning"});return}if(!confirm(`Êtes-vous sûr de vouloir supprimer ${d.value.length} type(s) de frais ?`))return;console.log("Suppression multiple de types de frais:",d.value);let n=0,e=0;const l=[];try{for(const i of d.value){console.log("Suppression du type de frais ID:",i),console.log("URL:",g.DELETE_FEE_TYPE(i));const de=await U(g.DELETE_FEE_TYPE(i));console.log("Résultat:",de),console.log("Erreur:",E.value),E.value?(e++,l.push(`Type #${i}: ${E.value}`)):n++}e>0?(console.error("Erreurs de suppression:",l),c({message:`${n} supprimé(s), ${e} échec(s). Voir la console pour les détails.`,type:"warning"})):c({message:`${n} type(s) de frais supprimé(s) avec succès`,type:"success"}),d.value=[],await h()}catch(i){console.error("Erreur lors de la suppression des types de frais:",i),c({message:(i==null?void 0:i.message)||"Erreur lors de la suppression des types de frais",type:"error"})}};return ve(()=>{h()}),(n,e)=>(u(),b(fe,{activeBread:"Types de Frais","active-tag-name":"types-frais",group:"frais"},{default:a(()=>[t(me,null,{default:a(()=>[o("div",Fe,[o("div",Se,[t(s(S),{type:"text",id:"search",name:"search",placeholder:"Rechercher par libellé ou description...",modelValue:C.value,"onUpdate:modelValue":e[0]||(e[0]=l=>C.value=l),class:"pl-10"},null,8,["modelValue"]),e[7]||(e[7]=o("div",{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-foreground-muted/70"},[o("span",{class:"flex iconify hugeicons--search-01 text-sm"})],-1))]),o("div",Le,[d.value.length>0?(u(),b(s(y),{key:0,variant:"destructive",size:"sm",onClick:re,disabled:s(Y)},{default:a(()=>[e[8]||(e[8]=o("span",{class:"iconify hugeicons--delete-02 mr-2"},null,-1)),r(" Supprimer ("+p(d.value.length)+") ",1)]),_:1},8,["disabled"])):f("",!0),t(s(q),{open:T.value,"onUpdate:open":e[3]||(e[3]=l=>T.value=l)},{default:a(()=>[t(s(we),{"as-child":""},{default:a(()=>[t(s(y),{size:"md",class:"bg-primary text-primary-foreground"},{default:a(()=>[...e[9]||(e[9]=[o("span",{class:"iconify hugeicons--add-01 mr-2"},null,-1),o("span",{class:"hidden sm:flex"},"Nouveau Type",-1)])]),_:1})]),_:1}),t(s(I),{class:"sm:max-w-[500px]"},{default:a(()=>[t(s(Q),null,{default:a(()=>[t(s(K),null,{default:a(()=>[...e[10]||(e[10]=[r("Créer un nouveau type de frais",-1)])]),_:1}),t(s(H),null,{default:a(()=>[...e[11]||(e[11]=[r(" Remplissez les informations du nouveau type de frais. ",-1)])]),_:1})]),_:1}),o("form",{onSubmit:e[2]||(e[2]=(...l)=>s(G)&&s(G)(...l)),class:"space-y-4"},[o("div",Te,[o("div",Ae,[t(s(k),{for:"name"},{default:a(()=>[...e[12]||(e[12]=[r("Nom *",-1)])]),_:1}),t(s(x),{name:"name"},{default:a(({field:l,errorMessage:i})=>[t(s(S),w({id:"name"},l,{placeholder:"Frais de scolarité",class:{"border-red-500":i}}),null,16,["class"]),i?(u(),m("p",Pe,p(i),1)):f("",!0)]),_:1})]),o("div",ze,[t(s(k),{for:"code"},{default:a(()=>[...e[13]||(e[13]=[r("Code *",-1)])]),_:1}),t(s(x),{name:"code"},{default:a(({field:l,errorMessage:i})=>[t(s(S),w({id:"code"},l,{placeholder:"FS001",class:["font-mono",{"border-red-500":i}]}),null,16,["class"]),i?(u(),m("p",Ne,p(i),1)):f("",!0)]),_:1})])]),o("div",Re,[t(s(k),{for:"description"},{default:a(()=>[...e[14]||(e[14]=[r("Description",-1)])]),_:1}),t(s(x),{name:"description"},{default:a(({field:l,errorMessage:i})=>[t(s(W),w({id:"description"},l,{placeholder:"Description du type de frais (optionnel)",rows:"3",class:{"border-red-500":i}}),null,16,["class"]),i?(u(),m("p",Ve,p(i),1)):f("",!0)]),_:1})]),t(s(J),null,{default:a(()=>[t(s(y),{type:"button",variant:"outline",onClick:e[1]||(e[1]=l=>T.value=!1)},{default:a(()=>[...e[15]||(e[15]=[r(" Annuler ",-1)])]),_:1}),t(s(y),{type:"submit",disabled:s(R)},{default:a(()=>[s(R)?(u(),m("span",Ue)):f("",!0),e[16]||(e[16]=r(" Créer ",-1))]),_:1},8,["disabled"])]),_:1})],32)]),_:1})]),_:1},8,["open"])])]),o("div",Ye,[t(s(xe),null,{default:a(()=>[t(s(be),null,{default:a(()=>[t(s(L),{class:"bg-white"},{default:a(()=>[t(s($),{class:"w-[40px]"},{default:a(()=>[t(s(X),{class:"bg-white scale-70",checked:d.value.length===v.value.length&&v.value.length>0,onClick:ne},null,8,["checked"])]),_:1}),t(s($),null,{default:a(()=>[...e[17]||(e[17]=[r("Nom",-1)])]),_:1}),t(s($),null,{default:a(()=>[...e[18]||(e[18]=[r("Code",-1)])]),_:1}),t(s($),null,{default:a(()=>[...e[19]||(e[19]=[r("Description",-1)])]),_:1}),t(s($),null,{default:a(()=>[...e[20]||(e[20]=[r("Date de création",-1)])]),_:1}),t(s($),null,{default:a(()=>[...e[21]||(e[21]=[r("Actions",-1)])]),_:1})]),_:1})]),_:1}),t(s(ke),null,{default:a(()=>[s(M)?(u(),b(s(L),{key:0},{default:a(()=>[t(s(_),{colspan:6,class:"text-center py-8"},{default:a(()=>[...e[22]||(e[22]=[o("div",{class:"flex items-center justify-center gap-2"},[o("span",{class:"iconify hugeicons--loading-03 animate-spin"}),r(" Chargement des types de frais... ")],-1)])]),_:1})]),_:1})):s(N)?(u(),b(s(L),{key:1},{default:a(()=>[t(s(_),{colspan:6,class:"text-center py-8 text-red-500"},{default:a(()=>[o("div",je,[e[23]||(e[23]=o("span",{class:"iconify hugeicons--alert-circle"},null,-1)),r(" Erreur lors du chargement : "+p(s(N)),1)])]),_:1})]),_:1})):v.value.length===0?(u(),b(s(L),{key:2},{default:a(()=>[t(s(_),{colspan:6,class:"text-center py-8 text-gray-500"},{default:a(()=>[o("div",Be,[e[24]||(e[24]=o("span",{class:"iconify hugeicons--tag-01"},null,-1)),r(" "+p(C.value?"Aucun type de frais trouvé pour cette recherche":"Aucun type de frais configuré"),1)])]),_:1})]),_:1})):(u(!0),m(Ee,{key:3},ge(v.value,l=>(u(),b(s(L),{key:l.id},{default:a(()=>[t(s(_),{class:"w-[40px]"},{default:a(()=>[t(s(X),{class:"bg-white scale-70",checked:d.value.includes(l.id),onClick:i=>oe(l.id)},null,8,["checked","onClick"])]),_:2},1024),t(s(_),{class:"font-medium"},{default:a(()=>[r(p(l.name),1)]),_:2},1024),t(s(_),null,{default:a(()=>[o("span",Ge,p(l.code),1)]),_:2},1024),t(s(_),null,{default:a(()=>[o("span",Oe,p(l.description||"-"),1)]),_:2},1024),t(s(_),null,{default:a(()=>[r(p(ae(l.created_at)),1)]),_:2},1024),t(s(_),null,{default:a(()=>[o("div",qe,[t(s(y),{variant:"outline",size:"icon",class:"size-8",onClick:i=>le(l),title:"Modifier le type de frais"},{default:a(()=>[...e[25]||(e[25]=[o("span",{class:"iconify hugeicons--edit-02"},null,-1)])]),_:1},8,["onClick"]),t(s(y),{variant:"destructive",size:"icon",class:"size-8",onClick:i=>ie(l.id),title:"Supprimer le type de frais",disabled:s(Y)},{default:a(()=>[...e[26]||(e[26]=[o("span",{class:"iconify hugeicons--delete-02"},null,-1)])]),_:1},8,["onClick","disabled"])])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})])]),_:1}),t(s(q),{open:D.value,"onUpdate:open":e[6]||(e[6]=l=>D.value=l)},{default:a(()=>[t(s(I),{class:"sm:max-w-[500px]"},{default:a(()=>[t(s(Q),null,{default:a(()=>[t(s(K),null,{default:a(()=>[...e[27]||(e[27]=[r("Modifier le type de frais",-1)])]),_:1}),t(s(H),null,{default:a(()=>[...e[28]||(e[28]=[r(" Modifiez les informations du type de frais. ",-1)])]),_:1})]),_:1}),o("form",{onSubmit:e[5]||(e[5]=(...l)=>s(O)&&s(O)(...l)),class:"space-y-4"},[o("div",Ie,[o("div",Qe,[t(s(k),{for:"edit_name"},{default:a(()=>[...e[29]||(e[29]=[r("Nom *",-1)])]),_:1}),t(s(x),{name:"name"},{default:a(({field:l,errorMessage:i})=>[t(s(S),w({id:"edit_name"},l,{placeholder:"Frais de scolarité",class:{"border-red-500":i}}),null,16,["class"]),i?(u(),m("p",Ke,p(i),1)):f("",!0)]),_:1})]),o("div",He,[t(s(k),{for:"edit_code"},{default:a(()=>[...e[30]||(e[30]=[r("Code *",-1)])]),_:1}),t(s(x),{name:"code"},{default:a(({field:l,errorMessage:i})=>[t(s(S),w({id:"edit_code"},l,{placeholder:"FS001",class:["font-mono",{"border-red-500":i}]}),null,16,["class"]),i?(u(),m("p",Je,p(i),1)):f("",!0)]),_:1})])]),o("div",We,[t(s(k),{for:"edit_description"},{default:a(()=>[...e[31]||(e[31]=[r("Description",-1)])]),_:1}),t(s(x),{name:"description"},{default:a(({field:l,errorMessage:i})=>[t(s(W),w({id:"edit_description"},l,{placeholder:"Description du type de frais (optionnel)",rows:"3",class:{"border-red-500":i}}),null,16,["class"]),i?(u(),m("p",Xe,p(i),1)):f("",!0)]),_:1})]),t(s(J),null,{default:a(()=>[t(s(y),{type:"button",variant:"outline",onClick:e[4]||(e[4]=l=>D.value=!1)},{default:a(()=>[...e[32]||(e[32]=[r(" Annuler ",-1)])]),_:1}),t(s(y),{type:"submit",disabled:s(V)},{default:a(()=>[s(V)?(u(),m("span",Ze)):f("",!0),e[33]||(e[33]=r(" Modifier ",-1))]),_:1},8,["disabled"])]),_:1})],32)]),_:1})]),_:1},8,["open"])]),_:1}))}});export{gs as default};
