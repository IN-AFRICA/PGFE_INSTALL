import{_ as ye}from"./ComptaLayout.vue_vue_type_script_setup_true_lang-Bu3Oqdii.js";import{d as be,r as $,A as S,p as X,s as p,v as xe,x as A,w as l,f as t,b as i,i as s,h as v,k as y,y as r,t as c,K as Z,L as M,M as ee,N as se,O as te,z as b,c as _,a4 as x,P as le,F as Ce,G as De,o as u,H as he}from"./index-CJ_PivE-.js";import{_ as h}from"./Input.vue_vue_type_script_setup_true_lang-B9adgRZV.js";import{_ as z}from"./Checkbox.vue_vue_type_script_setup_true_lang-DTckireD.js";import{_ as ke,a as we,b as L,c as k,d as Ee,e as m}from"./TableHeader.vue_vue_type_script_setup_true_lang-cS4zBTGx.js";import{_ as $e}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-Bm461x8Q.js";import{_ as Se}from"./BoxPanelWrapper.vue_vue_type_script_setup_true_lang-CmJ-Iy6y.js";import{u as Ae}from"./useGetApi-EdzHoZm6.js";import{u as Re}from"./usePostApi-Crg8MURP.js";import{u as Ne}from"./usePutApi-BrTvEW5v.js";import{u as Le}from"./useDeleteApi-D2AjqV8w.js";import{o as Te,a3 as Ue,s as O,u as je,aQ as C,t as ze}from"./vee-validate-zod-Bra4yLtR.js";import"./DashPageHeader.vue_vue_type_script_setup_true_lang-DucYyTAx.js";import"./DashLayout.vue_vue_type_script_setup_true_lang-Ch2egXHm.js";import"./RightDashHeader.vue_vue_type_script_setup_true_lang-Bn3G870_.js";import"./index-BpkKmY4O.js";import"./RovingFocusGroup-BxePylpC.js";const Oe={class:"flex items-center gap-3 justify-between mb-4"},Pe={class:"relative flex-1 max-w-md"},Ve={class:"flex items-center gap-2"},Fe={class:"grid grid-cols-2 gap-4"},Be={class:"space-y-2"},Ye={key:0,class:"text-sm text-red-500 mt-1"},Ge={class:"space-y-2"},Ie={key:0,class:"text-sm text-red-500 mt-1"},qe={class:"space-y-2"},Qe={key:0,class:"text-sm text-red-500 mt-1"},He={class:"flex items-center space-x-2"},Je={key:0,class:"iconify hugeicons--loading-03 animate-spin mr-2"},Ke={class:"border rounded-lg overflow-hidden flex flex-1 bg-white"},We={class:"flex items-center justify-center gap-2"},Xe={class:"flex items-center justify-center gap-2"},Ze={class:"text-lg"},Me={class:"flex items-center gap-2 w-max"},es={class:"grid grid-cols-2 gap-4"},ss={class:"space-y-2"},ts={key:0,class:"text-sm text-red-500 mt-1"},ls={class:"space-y-2"},as={key:0,class:"text-sm text-red-500 mt-1"},os={class:"space-y-2"},is={key:0,class:"text-sm text-red-500 mt-1"},ns={class:"flex items-center space-x-2"},rs={key:0,class:"iconify hugeicons--loading-03 animate-spin mr-2"},Ss=be({__name:"GestionDevises",setup(ds){const ae=Te({code:O().min(3,"Le code doit faire exactement 3 caractÃ¨res").max(3,"Le code doit faire exactement 3 caractÃ¨res").transform(a=>a.toUpperCase()),name:O().min(1,"Le nom est requis").max(100,"Le nom ne peut pas dÃ©passer 100 caractÃ¨res"),symbol:O().optional().nullable(),is_default:Ue().default(!1)}),R=$("");$([]);const T=$(!1),N=$(!1),U=$(null),d=$([]),{data:f,loading:oe,error:P,fetchData:w}=Ae(S.GET_CURRENCIES),{postData:ie,loading:V,response:F,success:ne,error:B}=Re(),{putData:re,loading:Y}=Ne(),{deleteItem:G,deleting:I}=Le(),{handleSubmit:q,resetForm:Q,setValues:de}=je({validationSchema:ze(ae)}),g=X(()=>{const a=f.value;if(!a)return[];if(Array.isArray(a))return a;if(Array.isArray(a==null?void 0:a.currencies))return a.currencies;if(Array.isArray(a==null?void 0:a.data))return a.data;if(a&&typeof a=="object"){const e=Object.values(a).filter(o=>o&&typeof o=="object"&&"id"in o);if(e.length>0)return e}return[]}),D=X(()=>{if(!g.value||g.value.length===0)return[];if(!R.value)return g.value;const a=R.value.toLowerCase();return g.value.filter(e=>e.code.toLowerCase().includes(a)||e.name.toLowerCase().includes(a)||e.symbol&&e.symbol.toLowerCase().includes(a))}),ue=a=>a?"Oui":"Non",ce=a=>a?new Date(a).toLocaleDateString("fr-FR"):"-",H=q(async a=>{var e,o,n,K,W;try{if(console.log("ðŸ” DonnÃ©es envoyÃ©es pour crÃ©ation de devise:",a),console.log("ðŸ” Route utilisÃ©e:",S.CREATE_CURRENCY),await ie(S.CREATE_CURRENCY,a),console.log("âœ… RÃ©ponse de crÃ©ation:",F.value),ne.value&&!B.value)p({message:((e=F.value)==null?void 0:e.message)||"Devise crÃ©Ã©e avec succÃ¨s",type:"success"}),Q(),T.value=!1,console.log("ðŸ”„ RafraÃ®chissement des donnÃ©es..."),await w(),setTimeout(async()=>{console.log("ðŸ”„ Double vÃ©rification des donnÃ©es..."),await w(),console.log("ðŸ“Š DonnÃ©es aprÃ¨s rafraÃ®chissement:",f.value)},1e3);else throw new Error(B.value||"Ã‰chec de la crÃ©ation de la devise")}catch(E){let j="Erreur lors de la crÃ©ation de la devise";if((n=(o=E.response)==null?void 0:o.data)!=null&&n.message)j=E.response.data.message;else if((W=(K=E.response)==null?void 0:K.data)!=null&&W.errors){const ge=E.response.data.errors;j=`Erreurs de validation: ${Object.values(ge).flat().join(", ")}`}else E.message&&(j=E.message);p({message:j,type:"error"})}}),J=q(async a=>{if(U.value)try{await re(S.UPDATE_CURRENCY(U.value.id),a),p({message:"Devise modifiÃ©e avec succÃ¨s",type:"success"}),Q(),N.value=!1,U.value=null,await w()}catch{p({message:"Erreur lors de la modification de la devise",type:"error"})}}),fe=a=>{U.value=a,de({code:a.code,name:a.name,symbol:a.symbol||"",is_default:a.is_default}),N.value=!0},me=async a=>{if(confirm("ÃŠtes-vous sÃ»r de vouloir supprimer cette devise ?"))try{await G(S.DELETE_CURRENCY(a)),p({message:"Devise supprimÃ©e avec succÃ¨s",type:"success"}),await w()}catch{p({message:"Erreur lors de la suppression de la devise",type:"error"})}},pe=a=>{d.value.includes(a)?d.value=d.value.filter(e=>e!==a):d.value.push(a)},ve=()=>{d.value.length===D.value.length&&D.value.length>0?d.value=[]:d.value=D.value.map(a=>a.id)},_e=async()=>{if(d.value.length===0){p({message:"Aucune devise sÃ©lectionnÃ©e",type:"warning"});return}if(confirm(`ÃŠtes-vous sÃ»r de vouloir supprimer ${d.value.length} devise(s) ?`))try{for(const a of d.value)await G(S.DELETE_CURRENCY(a));p({message:`${d.value.length} devise(s) supprimÃ©e(s) avec succÃ¨s`,type:"success"}),d.value=[],await w()}catch{p({message:"Erreur lors de la suppression des devises",type:"error"})}};return xe(async()=>{console.log("ðŸš€ Chargement initial des devises..."),await w(),console.log("ðŸ“Š Devises chargÃ©es au montage:",f.value),f.value?(console.log("ðŸ” Type de currenciesData.value:",typeof f.value),console.log("ðŸ” ClÃ©s disponibles:",Object.keys(f.value)),console.log("ðŸ” Contenu complet:",JSON.stringify(f.value,null,2)),f.value.data?console.log("âœ… Structure avec .data - Nombre:",f.value.data.length):Array.isArray(f.value)?console.log("âœ… Structure tableau direct - Nombre:",f.value.length):f.value.currencies?console.log("âœ… Structure avec .currencies - Nombre:",f.value.currencies.length):console.log("âš ï¸ Structure inconnue"),console.log("ðŸ”„ Devises normalisÃ©es:",g.value),console.log("âœ… Nombre de devises normalisÃ©es:",g.value.length),g.value.length>0&&console.log("ðŸ“Š PremiÃ¨re devise:",g.value[0])):console.log("âŒ currenciesData.value est null/undefined")}),(a,e)=>(u(),A(ye,{activeBread:"Devises","active-tag-name":"devises",group:"frais"},{default:l(()=>[t(Se,null,{default:l(()=>[i("div",Oe,[i("div",Pe,[t(s(h),{type:"text",id:"search",name:"search",placeholder:"Rechercher par code, nom ou symbole...",modelValue:R.value,"onUpdate:modelValue":e[0]||(e[0]=o=>R.value=o),class:"pl-10"},null,8,["modelValue"]),e[7]||(e[7]=i("div",{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-foreground-muted/70"},[i("span",{class:"flex iconify hugeicons--search-01 text-sm"})],-1))]),i("div",Ve,[d.value.length>0?(u(),A(s(y),{key:0,variant:"destructive",size:"sm",onClick:_e,disabled:s(I)},{default:l(()=>[e[8]||(e[8]=i("span",{class:"iconify hugeicons--delete-02 mr-2"},null,-1)),r(" Supprimer ("+c(d.value.length)+") ",1)]),_:1},8,["disabled"])):v("",!0),t(s(Z),{open:T.value,"onUpdate:open":e[3]||(e[3]=o=>T.value=o)},{default:l(()=>[t(s($e),{"as-child":""},{default:l(()=>[t(s(y),{size:"md",class:"bg-primary text-primary-foreground"},{default:l(()=>[...e[9]||(e[9]=[i("span",{class:"iconify hugeicons--add-01 mr-2"},null,-1),i("span",{class:"hidden sm:flex"},"Nouvelle Devise",-1)])]),_:1})]),_:1}),t(s(M),{class:"sm:max-w-[500px]"},{default:l(()=>[t(s(ee),null,{default:l(()=>[t(s(se),null,{default:l(()=>[...e[10]||(e[10]=[r("CrÃ©er une nouvelle devise",-1)])]),_:1}),t(s(te),null,{default:l(()=>[...e[11]||(e[11]=[r(" Remplissez les informations de la nouvelle devise. ",-1)])]),_:1})]),_:1}),i("form",{onSubmit:e[2]||(e[2]=(...o)=>s(H)&&s(H)(...o)),class:"space-y-4"},[i("div",Fe,[i("div",Be,[t(s(b),{for:"code"},{default:l(()=>[...e[12]||(e[12]=[r("Code devise *",-1)])]),_:1}),t(s(C),{name:"code"},{default:l(({field:o,errorMessage:n})=>[t(s(h),x({id:"code"},o,{placeholder:"USD",maxlength:"3",class:["uppercase",{"border-red-500":n}]}),null,16,["class"]),n?(u(),_("p",Ye,c(n),1)):v("",!0)]),_:1})]),i("div",Ge,[t(s(b),{for:"symbol"},{default:l(()=>[...e[13]||(e[13]=[r("Symbole",-1)])]),_:1}),t(s(C),{name:"symbol"},{default:l(({field:o,errorMessage:n})=>[t(s(h),x({id:"symbol"},o,{placeholder:"$",class:{"border-red-500":n}}),null,16,["class"]),n?(u(),_("p",Ie,c(n),1)):v("",!0)]),_:1})])]),i("div",qe,[t(s(b),{for:"name"},{default:l(()=>[...e[14]||(e[14]=[r("Nom de la devise *",-1)])]),_:1}),t(s(C),{name:"name"},{default:l(({field:o,errorMessage:n})=>[t(s(h),x({id:"name"},o,{placeholder:"Dollar amÃ©ricain",class:{"border-red-500":n}}),null,16,["class"]),n?(u(),_("p",Qe,c(n),1)):v("",!0)]),_:1})]),i("div",He,[t(s(C),{name:"is_default"},{default:l(({field:o})=>[t(s(z),x({id:"is_default"},o),null,16)]),_:1}),t(s(b),{for:"is_default"},{default:l(()=>[...e[15]||(e[15]=[r("Devise par dÃ©faut",-1)])]),_:1})]),t(s(le),null,{default:l(()=>[t(s(y),{type:"button",variant:"outline",onClick:e[1]||(e[1]=o=>T.value=!1)},{default:l(()=>[...e[16]||(e[16]=[r(" Annuler ",-1)])]),_:1}),t(s(y),{type:"submit",disabled:s(V)},{default:l(()=>[s(V)?(u(),_("span",Je)):v("",!0),e[17]||(e[17]=r(" CrÃ©er ",-1))]),_:1},8,["disabled"])]),_:1})],32)]),_:1})]),_:1},8,["open"])])]),i("div",Ke,[t(s(ke),null,{default:l(()=>[t(s(we),null,{default:l(()=>[t(s(L),{class:"bg-white"},{default:l(()=>[t(s(k),{class:"w-[40px]"},{default:l(()=>[t(s(z),{class:"bg-white scale-70",checked:d.value.length===D.value.length&&D.value.length>0,onClick:ve},null,8,["checked"])]),_:1}),t(s(k),null,{default:l(()=>[...e[18]||(e[18]=[r("Code",-1)])]),_:1}),t(s(k),null,{default:l(()=>[...e[19]||(e[19]=[r("Nom",-1)])]),_:1}),t(s(k),null,{default:l(()=>[...e[20]||(e[20]=[r("Symbole",-1)])]),_:1}),t(s(k),null,{default:l(()=>[...e[21]||(e[21]=[r("Par dÃ©faut",-1)])]),_:1}),t(s(k),null,{default:l(()=>[...e[22]||(e[22]=[r("Date de crÃ©ation",-1)])]),_:1}),t(s(k),null,{default:l(()=>[...e[23]||(e[23]=[r("Actions",-1)])]),_:1})]),_:1})]),_:1}),t(s(Ee),null,{default:l(()=>[s(oe)?(u(),A(s(L),{key:0},{default:l(()=>[t(s(m),{colspan:7,class:"text-center py-8"},{default:l(()=>[...e[24]||(e[24]=[i("div",{class:"flex items-center justify-center gap-2"},[i("span",{class:"iconify hugeicons--loading-03 animate-spin"}),r(" Chargement des devises... ")],-1)])]),_:1})]),_:1})):s(P)?(u(),A(s(L),{key:1},{default:l(()=>[t(s(m),{colspan:7,class:"text-center py-8 text-red-500"},{default:l(()=>[i("div",We,[e[25]||(e[25]=i("span",{class:"iconify hugeicons--alert-circle"},null,-1)),r(" Erreur lors du chargement : "+c(s(P)),1)])]),_:1})]),_:1})):D.value.length===0?(u(),A(s(L),{key:2},{default:l(()=>[t(s(m),{colspan:7,class:"text-center py-8 text-gray-500"},{default:l(()=>[i("div",Xe,[e[26]||(e[26]=i("span",{class:"iconify hugeicons--coins-01"},null,-1)),r(" "+c(R.value?"Aucune devise trouvÃ©e pour cette recherche":"Aucune devise configurÃ©e"),1)])]),_:1})]),_:1})):(u(!0),_(De,{key:3},Ce(D.value,o=>(u(),A(s(L),{key:o.id},{default:l(()=>[t(s(m),{class:"w-[40px]"},{default:l(()=>[t(s(z),{class:"bg-white scale-70",checked:d.value.includes(o.id),onClick:n=>pe(o.id)},null,8,["checked","onClick"])]),_:2},1024),t(s(m),{class:"font-mono font-medium"},{default:l(()=>[r(c(o.code),1)]),_:2},1024),t(s(m),{class:"font-medium"},{default:l(()=>[r(c(o.name),1)]),_:2},1024),t(s(m),null,{default:l(()=>[i("span",Ze,c(o.symbol||"-"),1)]),_:2},1024),t(s(m),null,{default:l(()=>[i("span",{class:he(o.is_default?"text-green-600 font-medium":"text-gray-500")},c(ue(o.is_default)),3)]),_:2},1024),t(s(m),null,{default:l(()=>[r(c(ce(o.created_at)),1)]),_:2},1024),t(s(m),null,{default:l(()=>[i("div",Me,[t(s(y),{variant:"outline",size:"icon",class:"size-8",onClick:n=>fe(o),title:"Modifier la devise"},{default:l(()=>[...e[27]||(e[27]=[i("span",{class:"iconify hugeicons--edit-02"},null,-1)])]),_:1},8,["onClick"]),t(s(y),{variant:"destructive",size:"icon",class:"size-8",onClick:n=>me(o.id),title:"Supprimer la devise",disabled:s(I)},{default:l(()=>[...e[28]||(e[28]=[i("span",{class:"iconify hugeicons--delete-02"},null,-1)])]),_:1},8,["onClick","disabled"])])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})])]),_:1}),t(s(Z),{open:N.value,"onUpdate:open":e[6]||(e[6]=o=>N.value=o)},{default:l(()=>[t(s(M),{class:"sm:max-w-[500px]"},{default:l(()=>[t(s(ee),null,{default:l(()=>[t(s(se),null,{default:l(()=>[...e[29]||(e[29]=[r("Modifier la devise",-1)])]),_:1}),t(s(te),null,{default:l(()=>[...e[30]||(e[30]=[r(" Modifiez les informations de la devise. ",-1)])]),_:1})]),_:1}),i("form",{onSubmit:e[5]||(e[5]=(...o)=>s(J)&&s(J)(...o)),class:"space-y-4"},[i("div",es,[i("div",ss,[t(s(b),{for:"edit_code"},{default:l(()=>[...e[31]||(e[31]=[r("Code devise *",-1)])]),_:1}),t(s(C),{name:"code"},{default:l(({field:o,errorMessage:n})=>[t(s(h),x({id:"edit_code"},o,{placeholder:"USD",maxlength:"3",class:["uppercase",{"border-red-500":n}]}),null,16,["class"]),n?(u(),_("p",ts,c(n),1)):v("",!0)]),_:1})]),i("div",ls,[t(s(b),{for:"edit_symbol"},{default:l(()=>[...e[32]||(e[32]=[r("Symbole",-1)])]),_:1}),t(s(C),{name:"symbol"},{default:l(({field:o,errorMessage:n})=>[t(s(h),x({id:"edit_symbol"},o,{placeholder:"$",class:{"border-red-500":n}}),null,16,["class"]),n?(u(),_("p",as,c(n),1)):v("",!0)]),_:1})])]),i("div",os,[t(s(b),{for:"edit_name"},{default:l(()=>[...e[33]||(e[33]=[r("Nom de la devise *",-1)])]),_:1}),t(s(C),{name:"name"},{default:l(({field:o,errorMessage:n})=>[t(s(h),x({id:"edit_name"},o,{placeholder:"Dollar amÃ©ricain",class:{"border-red-500":n}}),null,16,["class"]),n?(u(),_("p",is,c(n),1)):v("",!0)]),_:1})]),i("div",ns,[t(s(C),{name:"is_default"},{default:l(({field:o})=>[t(s(z),x({id:"edit_is_default"},o),null,16)]),_:1}),t(s(b),{for:"edit_is_default"},{default:l(()=>[...e[34]||(e[34]=[r("Devise par dÃ©faut",-1)])]),_:1})]),t(s(le),null,{default:l(()=>[t(s(y),{type:"button",variant:"outline",onClick:e[4]||(e[4]=o=>N.value=!1)},{default:l(()=>[...e[35]||(e[35]=[r(" Annuler ",-1)])]),_:1}),t(s(y),{type:"submit",disabled:s(Y)},{default:l(()=>[s(Y)?(u(),_("span",rs)):v("",!0),e[36]||(e[36]=r(" Modifier ",-1))]),_:1},8,["disabled"])]),_:1})],32)]),_:1})]),_:1},8,["open"])]),_:1}))}});export{Ss as default};
