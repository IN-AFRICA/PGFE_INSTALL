import{d as F,r as x,A as $,p as C,v as Y,a2 as Q,q as H,x as h,w as t,f as l,b as o,c as v,h as U,i as s,k as b,y as u,t as _,$ as J,G as K,F as W,s as E,o as d}from"./index-CJ_PivE-.js";import{_ as X}from"./Input.vue_vue_type_script_setup_true_lang-B9adgRZV.js";import{_ as Z,a as ee,b as V,c as y,d as se,e as w}from"./TableHeader.vue_vue_type_script_setup_true_lang-cS4zBTGx.js";import{_ as M}from"./Checkbox.vue_vue_type_script_setup_true_lang-DTckireD.js";import{_ as te,a as le,b as ae,c as O}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-DN4DQrTt.js";import{_ as oe}from"./ComptaLayout.vue_vue_type_script_setup_true_lang-Bu3Oqdii.js";import{_ as ie}from"./BoxPanelWrapper.vue_vue_type_script_setup_true_lang-CmJ-Iy6y.js";import{_ as ne}from"./TabPagination.vue_vue_type_script_setup_true_lang-Dsg8W898.js";import{e as R}from"./eventBus-CGRXT3Tn.js";import{u as re}from"./useGetApi-EdzHoZm6.js";import{u as ue}from"./useDeleteApi-D2AjqV8w.js";import"./index-BpkKmY4O.js";import"./RovingFocusGroup-BxePylpC.js";import"./DashPageHeader.vue_vue_type_script_setup_true_lang-DucYyTAx.js";import"./DashLayout.vue_vue_type_script_setup_true_lang-Ch2egXHm.js";import"./RightDashHeader.vue_vue_type_script_setup_true_lang-Bn3G870_.js";const de={class:"flex sm:items-center gap-3 flex-col sm:flex-row sm:justify-between"},me={class:"relative flex-1"},ce={class:"flex flex-wrap items-center sm:justify-end gap-2.5 flex-1"},fe={key:0,class:"mt-4 rounded-md overflow-hidden flex flex-1 bg-white p-8"},pe={key:1,class:"mt-4 rounded-md overflow-hidden flex flex-1 bg-white p-8"},ve={class:"flex flex-col items-center justify-center w-full gap-3"},_e={class:"text-sm text-foreground-muted"},ge={key:2,class:"mt-4 rounded-md overflow-hidden flex flex-1 bg-white p-8"},xe={class:"flex flex-col items-center justify-center w-full gap-3"},he={class:"text-sm text-foreground-muted"},be={key:3,class:"mt-4 rounded-md overflow-hidden flex flex-1 bg-white"},Re=F({__name:"Immobilisations",setup(ye){const f=x(""),p=x(1),c=x(15),n=x([]),{data:D,loading:A,error:k,fetchData:g,meta:I,refresh:L}=re($.GET_IMMOBILISATION),{deleteItem:N}=ue(),S=C(()=>{const i=D.value??[];if(!f.value)return i;const e=f.value.toLowerCase();return i.filter(r=>(r.name??"").toLowerCase().includes(e)||(r.code??"").toLowerCase().includes(e))}),m=C(()=>{const i=S.value;if(!f.value)return i;const e=(p.value-1)*c.value,r=e+c.value;return i.slice(e,r)}),j=C(()=>{var i;return((i=I==null?void 0:I.value)==null?void 0:i.total)??S.value.length});Y(async()=>{await g({page:p.value,per_page:c.value}),R.on("immobilisationUpdated",async()=>await g({page:p.value,per_page:c.value}))}),Q(()=>{R.off("immobilisationUpdated")}),H([p,c],([i,e])=>{g({page:i??1,per_page:e??15})});const P=async(i,e)=>{if(!confirm(`Supprimer "${e}" ?`))return;const r=$.DELETE_IMMOBILISATION_ENTRY(i);await N(r)?(E({message:"Immobilisation supprimée avec succès",type:"success"}),await L()):E({message:"Erreur lors de la suppression",type:"error"})},z=async()=>{if(n.value.length===0)return;const i=n.value.length;if(confirm(`Supprimer ${i} immobilisation(s) sélectionnée(s) ?`)){for(const e of n.value){const r=$.DELETE_IMMOBILISATION_ENTRY(e);await N(r)}n.value=[],await L(),E({message:`${i} immobilisation(s) supprimée(s)`,type:"success"})}},G=()=>{n.value.length===m.value.length?n.value=[]:n.value=m.value.map(i=>i.id??i.code)};return(i,e)=>{const r=J("RouterLink");return d(),h(oe,{activeBread:"immobilisations","active-tag-name":"immobilisations",group:"operations"},{default:t(()=>[l(ie,null,{default:t(()=>[o("div",de,[o("div",me,[l(s(X),{modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=a=>f.value=a),type:"text",id:"search",name:"search",placeholder:"Rechercher par nom ou code...",class:"w-full max-w-sm ps-10 border border-gray-200/40 bg-white transition-all h-10 rounded-md"},null,8,["modelValue"]),e[4]||(e[4]=o("div",{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-foreground-muted/70"},[o("span",{class:"flex iconify hugeicons--search-01 text-sm"})],-1))]),o("div",ce,[n.value.length>0?(d(),h(s(b),{key:0,variant:"destructive",size:"md",onClick:z},{default:t(()=>[e[5]||(e[5]=o("span",{class:"iconify hugeicons--delete-02 mr-1"},null,-1)),u(" Supprimer ("+_(n.value.length)+") ",1)]),_:1})):U("",!0),l(r,{to:"/comptabilite/saisie-operations/nouvelle-immobilisation"},{default:t(()=>[l(s(b),{size:"md"},{default:t(()=>[...e[6]||(e[6]=[o("span",{class:"iconify hugeicons--add-01 mr-2"},null,-1),u(" Nouvelle immobilisation ",-1)])]),_:1})]),_:1})])]),s(A)?(d(),v("div",fe,[...e[7]||(e[7]=[o("div",{class:"flex flex-col items-center justify-center w-full gap-3"},[o("span",{class:"iconify hugeicons--loading-03 animate-spin text-4xl text-blue-500"}),o("p",{class:"text-sm text-foreground-muted"},"Chargement des immobilisations...")],-1)])])):s(k)?(d(),v("div",pe,[o("div",ve,[e[9]||(e[9]=o("span",{class:"iconify hugeicons--alert-circle text-4xl text-red-500"},null,-1)),o("p",_e,_(s(k)),1),l(s(b),{onClick:e[1]||(e[1]=()=>s(g)()),size:"sm",variant:"outline"},{default:t(()=>[...e[8]||(e[8]=[o("span",{class:"iconify hugeicons--refresh mr-1"},null,-1),u(" Réessayer ",-1)])]),_:1})])])):!m.value||m.value.length===0?(d(),v("div",ge,[o("div",xe,[e[10]||(e[10]=o("span",{class:"iconify hugeicons--notebook text-4xl text-foreground-muted/50"},null,-1)),o("p",he,_(f.value?"Aucune immobilisation trouvée pour cette recherche":"Aucune immobilisation enregistrée"),1)])])):(d(),v("div",be,[l(s(Z),{class:"rounded-md bg-white"},{default:t(()=>[l(s(ee),null,{default:t(()=>[l(s(V),null,{default:t(()=>[l(s(y),{class:"w-[20px]"},{default:t(()=>[l(s(M),{checked:n.value.length===m.value.length&&m.value.length>0,"onUpdate:checked":G},null,8,["checked"])]),_:1}),l(s(y),null,{default:t(()=>[...e[11]||(e[11]=[u("Nom",-1)])]),_:1}),l(s(y),null,{default:t(()=>[...e[12]||(e[12]=[u("Code",-1)])]),_:1}),l(s(y),{class:"text-right"},{default:t(()=>[...e[13]||(e[13]=[u("Actions",-1)])]),_:1})]),_:1})]),_:1}),l(s(se),null,{default:t(()=>[(d(!0),v(K,null,W(m.value,a=>(d(),h(s(V),{key:a.id??a.code},{default:t(()=>[l(s(w),null,{default:t(()=>[l(s(M),{checked:n.value.includes(a.id??a.code),"onUpdate:checked":T=>{const B=a.id??a.code;T?n.value.push(B):n.value=n.value.filter(q=>q!==B)}},null,8,["checked","onUpdate:checked"])]),_:2},1024),l(s(w),{class:"font-medium"},{default:t(()=>[u(_(a.name),1)]),_:2},1024),l(s(w),null,{default:t(()=>[u(_(a.code),1)]),_:2},1024),l(s(w),{class:"text-right"},{default:t(()=>[l(s(te),null,{default:t(()=>[l(s(le),{"as-child":""},{default:t(()=>[l(s(b),{variant:"ghost",size:"icon"},{default:t(()=>[...e[14]||(e[14]=[o("span",{class:"iconify hugeicons--more-vertical"},null,-1)])]),_:1})]),_:1}),l(s(ae),{align:"end"},{default:t(()=>[l(r,{to:`/comptabilite/saisie-operations/upate-immobilisation?id=${a.id??a.code}`},{default:t(()=>[l(s(O),null,{default:t(()=>[...e[15]||(e[15]=[o("span",{class:"iconify hugeicons--pencil-edit-01 mr-2"},null,-1),u(" Modifier ",-1)])]),_:1})]),_:1},8,["to"]),l(s(O),{class:"text-red-600",onClick:T=>P(a.id??a.code,a.name)},{default:t(()=>[...e[16]||(e[16]=[o("span",{class:"iconify hugeicons--delete-02 mr-2"},null,-1),u(" Supprimer ",-1)])]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})])),!s(A)&&!s(k)&&m.value.length>0?(d(),h(ne,{key:4,modelValue:p.value,"onUpdate:modelValue":e[2]||(e[2]=a=>p.value=a),perPage:c.value,"onUpdate:perPage":e[3]||(e[3]=a=>c.value=a),totalItems:j.value,class:"mt-4"},null,8,["modelValue","perPage","totalItems"])):U("",!0)]),_:1})]),_:1})}}});export{Re as default};
