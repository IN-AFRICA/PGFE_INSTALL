import{d as Y,r as A,A as p,v as j,p as D,x as _,w as t,f as n,b as r,i as s,k as b,$ as F,y as l,c as h,F as U,G as q,a as H,o as u,t as f,s as $}from"./index-CJ_PivE-.js";import{_ as J}from"./Input.vue_vue_type_script_setup_true_lang-B9adgRZV.js";import{_ as M,a as K,b as g,c as m,d as Q,e as i}from"./TableHeader.vue_vue_type_script_setup_true_lang-cS4zBTGx.js";import{_ as R}from"./Checkbox.vue_vue_type_script_setup_true_lang-DTckireD.js";import{_ as W}from"./BoxPanelWrapper.vue_vue_type_script_setup_true_lang-CmJ-Iy6y.js";import{_ as X}from"./SaisieRhLayout.vue_vue_type_script_setup_true_lang-CNwSXs2g.js";import{_ as Z}from"./TabPagination.vue_vue_type_script_setup_true_lang-Dsg8W898.js";import{u as E}from"./useGetApi-EdzHoZm6.js";import{u as ee}from"./useDeleteApi-D2AjqV8w.js";import"./index-BpkKmY4O.js";import"./RovingFocusGroup-BxePylpC.js";import"./DashPageHeader.vue_vue_type_script_setup_true_lang-DucYyTAx.js";import"./DashLayout.vue_vue_type_script_setup_true_lang-Ch2egXHm.js";import"./RightDashHeader.vue_vue_type_script_setup_true_lang-Bn3G870_.js";const se={class:"flex sm:items-center gap-3 flex-col sm:flex-row sm:justify-between"},ae={class:"relative flex-1"},te={class:"flex flex-wrap items-center sm:justify-end gap-2.5 flex-1"},ne={class:"mt-4 rounded-md overflow-hidden flex flex-1 bg-white"},oe={class:"flex items-center gap-2 w-max"},le={key:0,class:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white"},re={key:1,class:"iconify hugeicons--delete-02"},$e=Y({__name:"ListeConge",setup(ie){H();const C=A(1),N=A(15),{data:v,fetchData:k,loading:L}=E(p.GET_PERSONNEL_CONGE),{data:y,fetchData:P}=E(p.GET_PERSONALS),{data:S,fetchData:O}=E(p.GET_SCHOOL_YEARS);j(async()=>{await Promise.all([k(),P(),O()])});const G=d=>{var a;const o=(Array.isArray(y.value)?y.value:((a=y.value)==null?void 0:a.data)||[]).find(c=>c.id===d);return o?`${o.name||o.nom||""} ${o.postnom||""} ${o.firstname||o.prenom||""}`.trim():"Inconnu"},T=d=>{const e=S.value,a=(Array.isArray(e)?e:(e==null?void 0:e.years)??(e==null?void 0:e.data)??[]).find(c=>c.id===d);return(a==null?void 0:a.name)||(a==null?void 0:a.year)||(a==null?void 0:a.libelle)||`${a==null?void 0:a.start_year}-${a==null?void 0:a.end_year}`||"N/A"},x=D(()=>{var e;return(Array.isArray(v.value)?v.value:((e=v.value)==null?void 0:e.data)||[]).map(o=>({id:o.id,date:o.creer_a?new Date(o.creer_a).toLocaleDateString("fr-FR"):"N/A",nom:G(Number(o.academic_personal_id)),year:T(Number(o.school_year_id)),dayReq:o.jour_demand||0,raison:o.description||"-"}))}),V=D(()=>x.value.length),{deleteItem:z,deleting:w}=ee();function B(d){$({message:"La fonction d'édition sera disponible prochainement.",type:"info"})}async function I(d){if(window.confirm("Êtes-vous sûr de vouloir supprimer ce congé ?"))try{await z(p.DELETE_PERSONNEL_CONGE(d)),$({message:"Congé supprimé avec succès !",type:"success"}),await k()}catch(o){console.error("Erreur lors de la suppression:",o),$({message:"Erreur lors de la suppression du congé.",type:"error"})}}return(d,e)=>{const o=F("RouterLink");return u(),_(X,{activeBread:"Conge","active-tag-name":"conge",group:"saisie"},{default:t(()=>[n(W,null,{default:t(()=>[r("div",se,[r("div",ae,[n(s(J),{type:"text",id:"search",name:"search",placeholder:"Rechercher un personnel...",class:"w-full max-w-sm ps-10 border border-gray-200/40 bg-white transition-all h-10 rounded-md"}),e[2]||(e[2]=r("div",{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-foreground-muted/70"},[r("span",{class:"flex iconify hugeicons--search-01 text-sm"})],-1))]),r("div",te,[n(s(b),{size:"md",class:"rounded-md","as-child":""},{default:t(()=>[n(o,{to:"/rh/saisie/conge/nouveau-conge",class:""},{default:t(()=>[...e[3]||(e[3]=[r("span",{class:"iconify hugeicons--plus-sign"},null,-1),r("span",{class:"hidden sm:flex"},"Nouveau congé",-1)])]),_:1})]),_:1})])]),r("div",ne,[n(s(M),{class:"rounded-md bg-white"},{default:t(()=>[n(s(K),null,{default:t(()=>[n(s(g),null,{default:t(()=>[n(s(m),{class:"w-[20px]"},{default:t(()=>[n(s(R),{class:"bg-white scale-70"})]),_:1}),n(s(m),{class:"w-50"},{default:t(()=>[...e[4]||(e[4]=[l("Nom",-1)])]),_:1}),n(s(m),null,{default:t(()=>[...e[5]||(e[5]=[l("Jours demandés",-1)])]),_:1}),n(s(m),null,{default:t(()=>[...e[6]||(e[6]=[l("Date demande",-1)])]),_:1}),n(s(m),null,{default:t(()=>[...e[7]||(e[7]=[l("Année",-1)])]),_:1}),n(s(m),null,{default:t(()=>[...e[8]||(e[8]=[l("Raison",-1)])]),_:1}),n(s(m),null,{default:t(()=>[...e[9]||(e[9]=[l(" Opérations ",-1)])]),_:1})]),_:1})]),_:1}),n(s(Q),null,{default:t(()=>[s(L)?(u(),_(s(g),{key:0},{default:t(()=>[n(s(i),{colspan:"7",class:"text-center py-8"},{default:t(()=>[...e[10]||(e[10]=[l(" Chargement... ",-1)])]),_:1})]),_:1})):x.value.length===0?(u(),_(s(g),{key:1},{default:t(()=>[n(s(i),{colspan:"7",class:"text-center py-8 text-gray-500"},{default:t(()=>[...e[11]||(e[11]=[l(" Aucune demande de congé trouvée. ",-1)])]),_:1})]),_:1})):(u(!0),h(q,{key:2},U(x.value,a=>(u(),_(s(g),{key:a.id},{default:t(()=>[n(s(i),{class:"w-[40px]"},{default:t(()=>[n(s(R),{class:"bg-white scale-70"})]),_:1}),n(s(i),{class:"font-medium"},{default:t(()=>[l(f(a.nom),1)]),_:2},1024),n(s(i),{class:"font-medium"},{default:t(()=>[l(f(a.dayReq),1)]),_:2},1024),n(s(i),{class:"font-medium"},{default:t(()=>[l(f(a.date),1)]),_:2},1024),n(s(i),{class:"font-medium"},{default:t(()=>[l(f(a.year),1)]),_:2},1024),n(s(i),{class:"font-medium max-w-xs truncate",title:a.raison},{default:t(()=>[l(f(a.raison),1)]),_:2},1032,["title"]),n(s(i),null,{default:t(()=>[r("div",oe,[n(s(b),{variant:"outline",size:"icon",class:"size-8",onClick:c=>B(a.id),disabled:s(w)},{default:t(()=>[...e[12]||(e[12]=[r("span",{class:"iconify hugeicons--edit-02"},null,-1)])]),_:1},8,["onClick","disabled"]),n(s(b),{variant:"destructive",size:"icon",class:"size-8",onClick:c=>I(a.id),disabled:s(w)},{default:t(()=>[s(w)?(u(),h("span",le)):(u(),h("span",re))]),_:1},8,["onClick","disabled"])])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),n(Z,{modelValue:C.value,"onUpdate:modelValue":e[0]||(e[0]=a=>C.value=a),perPage:N.value,totalItems:V.value,"onUpdate:perPage":e[1]||(e[1]=a=>N.value=a)},null,8,["modelValue","perPage","totalItems"])]),_:1})]),_:1})}}});export{$e as default};
