import{d as te,r as f,v as ne,A as y,s as k,x as L,i as e,K as ae,w as n,f as s,k as p,b as a,L as le,M as oe,N as ie,y as m,O as re,g as ue,c as u,h as B,z as O,j as H,t as g,B as ye,C as ge,D as xe,E as be,F as Y,G as I,P as de,o as i,J as $e,p as Q,a2 as Ce,q as ee,af as ke,aY as Ee,R as we,S as he,U as Se,V as Ve,W as Ne,X as Ue,Y as Me,Z as ze}from"./index-CJ_PivE-.js";import{_ as Ae}from"./DashLayout.vue_vue_type_script_setup_true_lang-Ch2egXHm.js";import{_ as Pe}from"./DashPageHeader.vue_vue_type_script_setup_true_lang-DucYyTAx.js";import{_ as Te}from"./BoxPanelWrapper.vue_vue_type_script_setup_true_lang-CmJ-Iy6y.js";import{_ as J}from"./Input.vue_vue_type_script_setup_true_lang-B9adgRZV.js";import{u as j}from"./useGetApi-EdzHoZm6.js";import{e as M}from"./eventBus-CGRXT3Tn.js";import{_ as De}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-Bm461x8Q.js";import{_ as Ie}from"./SelectGroup.vue_vue_type_script_setup_true_lang-CwIOzTi6.js";import{u as je}from"./usePostApi-Crg8MURP.js";import{u as Oe,a as se,t as Re}from"./vee-validate-zod-Bra4yLtR.js";import{z as F}from"./external-CYeExkxg.js";import{_ as K}from"./IconifySpinner.vue_vue_type_script_setup_true_lang-C3Td1B5O.js";import{u as Ge}from"./useDeleteApi-D2AjqV8w.js";import{u as qe}from"./usePutApi-BrTvEW5v.js";import{_ as Be}from"./TableRowActions.vue_vue_type_script_setup_true_lang-C8PT7-8D.js";import"./RightDashHeader.vue_vue_type_script_setup_true_lang-Bn3G870_.js";import"./index-BpkKmY4O.js";const Fe={class:"grid gap-4 py-4"},Le={class:"flex flex-col space-y-1.5"},Ye={key:0,class:"text-xs text-red-500"},Je={class:"flex flex-col space-y-1.5 flex-1"},Ke={key:0,class:"text-xs text-red-500"},We={key:1,class:"text-xs text-red-500"},Xe={key:0,class:"flex items-center gap-2"},Ze={key:1,class:"flex items-center gap-2"},He=te({__name:"NewCommunes",setup(me){const{loading:c,error:x,response:b,postData:v,success:R}=je(),$=f(!1),{data:G,loading:q,error:z,fetchData:E}=j(y.GET_PROVINCES);ne(()=>{E()});const w=F.object({name:F.string({required_error:"Veuillez saisir le nom de la commune"}).min(2).max(100),province_id:F.string({required_error:"Veuillez sélectionner une province"}).min(1,"Veuillez sélectionner une province")}),{handleSubmit:C,resetForm:A}=Oe({validationSchema:Re(w)}),{value:_,errorMessage:h}=se("name"),{value:S,errorMessage:P}=se("province_id"),V=C(async N=>{var d;const l={name:N.name.trim(),province_id:Number(N.province_id)};if(await v(y.CREATE_COMMUNE,l),x.value){k({message:x.value,type:"error"});return}R.value&&(M.emit("communeUpdated"),k({message:((d=b.value)==null?void 0:d.message)||"Commune ajoutée avec succès",type:"success"}),A(),$.value=!1)});return(N,l)=>(i(),L(e(ae),{open:$.value,"onUpdate:open":l[4]||(l[4]=d=>$.value=d)},{default:n(()=>[s(e(De),{"as-child":""},{default:n(()=>[s(e(p),{size:"md",class:"rounded-md"},{default:n(()=>[...l[5]||(l[5]=[a("span",{class:"iconify hugeicons--plus-sign"},null,-1),a("span",{class:"hidden sm:flex"}," Nouvelle commune ",-1)])]),_:1})]),_:1}),s(e(le),{class:"sm:max-w-[540px]"},{default:n(()=>[s(e(oe),null,{default:n(()=>[s(e(ie),null,{default:n(()=>[...l[6]||(l[6]=[m("Nouvelle commune",-1)])]),_:1}),s(e(re),null,{default:n(()=>[...l[7]||(l[7]=[m(" Enregistrer une nouvelle commune ",-1)])]),_:1})]),_:1}),a("form",{onSubmit:l[3]||(l[3]=ue((...d)=>e(V)&&e(V)(...d),["prevent"]))},[a("div",Fe,[a("div",Le,[s(e(O),{for:"name",class:"text-sm font-medium"},{default:n(()=>[...l[8]||(l[8]=[m(" Nom ",-1)])]),_:1}),s(e(J),{type:"text",id:"name",name:"name",modelValue:e(_),"onUpdate:modelValue":l[0]||(l[0]=d=>H(_)?_.value=d:null),placeholder:"Entrez le nom de la commune",class:"w-full h-10 border border-gray-200/40 bg-white transition-all",disabled:e(c)||e(q)},null,8,["modelValue","disabled"]),e(h)?(i(),u("span",Ye,g(e(h)),1)):B("",!0)]),a("div",Je,[s(e(O),{for:"province_id",class:"text-sm font-medium"},{default:n(()=>[...l[9]||(l[9]=[m(" Associer à une province ",-1)])]),_:1}),s(e(ye),{id:"province_id",name:"province_id",modelValue:e(S),"onUpdate:modelValue":l[1]||(l[1]=d=>H(S)?S.value=d:null)},{default:n(()=>[s(e(ge),{id:"province_id",class:"h-10 w-full"},{default:n(()=>[s(e(xe),{placeholder:"Sélectionnez une province"})]),_:1}),s(e(be),null,{default:n(()=>[s(e(Ie),null,{default:n(()=>[(i(!0),u(I,null,Y(e(G)||[],d=>(i(),L(e($e),{key:d.id,value:String(d.id)},{default:n(()=>[m(g(d.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(P)?(i(),u("span",Ke,g(e(P)),1)):B("",!0),e(z)?(i(),u("span",We,g(e(z)),1)):B("",!0)])]),s(e(de),{class:"flex justify-end gap-2 items-center"},{default:n(()=>[s(e(p),{size:"sm",class:"h-9",variant:"outline",type:"button",onClick:l[2]||(l[2]=()=>{e(A)(),$.value=!1})},{default:n(()=>[...l[10]||(l[10]=[a("span",{class:"iconify flex hugeicons--cancel-01 mr-1"},null,-1),m(" Annuler ",-1)])]),_:1}),s(e(p),{size:"sm",class:"h-9",type:"submit",disabled:e(c)},{default:n(()=>[e(c)?(i(),u("span",Ze,[s(K,{size:"lg"}),l[12]||(l[12]=a("span",null,"Enregistrement en cours...",-1))])):(i(),u("span",Xe,[...l[11]||(l[11]=[a("span",{class:"iconify hugeicons--floppy-disk mr-1"},null,-1),a("span",null,"Enregistrer",-1)])]))]),_:1},8,["disabled"])]),_:1})],32)]),_:1})]),_:1},8,["open"]))}}),Qe={class:"pb-6 mx-auto w-full max-w-7xl"},es={class:"flex flex-col gap-3"},ss={class:"flex items-center gap-3 justify-between"},ts={class:"relative flex-1"},ns={class:"flex items-center gap-2"},as={class:"mt-4 flex-1 min-h-0 overflow-auto bg-white rounded-md border border-gray-100"},ls={key:0,class:"p-4 text-sm text-gray-600"},os={key:1,class:"p-4 text-sm text-red-600"},is={key:0,class:"p-4 text-sm text-gray-600"},rs={key:1,class:"divide-y"},us={class:"flex items-center gap-3"},ds={class:"font-medium"},ms={key:0,class:"flex items-center gap-2"},cs={key:1},fs={class:"grid gap-4 py-4"},ps={class:"flex flex-col space-y-1.5"},vs={class:"flex flex-col space-y-1.5"},_s=["disabled"],ys=["value"],gs={key:0,class:"flex items-center gap-2"},xs={key:1,class:"flex items-center gap-2"},js=te({__name:"Communes",setup(me){const c=f(!1),x=f(null),b=f(""),v=f(void 0);function R(r){x.value=r.id,b.value=r.name,v.value=r.province_id,c.value=!0,(!_.value||_.value.length===0)&&h()}async function $(){if(!x.value)return;const r={name:b.value.trim()};if(v.value&&(r.province_id=v.value),await fe(`${y.GET_COMMUNES}/${x.value}`,r),W.value){k({message:W.value,type:"error"});return}pe.value&&(k({message:"Commune mise à jour avec succès",type:"success"}),c.value=!1,M.emit("communeUpdated"))}const G={items:[{label:"Accueil",href:"/",icon:"hugeicons--home-01"},{label:"Administration",href:"/admin"},{label:"Communes",isActive:!0}]},q=[{name:"pays",text:"Pays",href:"/admin/countries"},{name:"provinces",text:"Provinces",href:"/admin/provinces"},{name:"territoires",text:"Territoires",href:"/admin/territoires"},{name:"communes",text:"Communes",href:"/admin/communes"}],z=Q(()=>"communes"),E=f(""),w=f(),C=f(),{fetchData:A}=j(y.GET_COUNTRIES),{data:_,fetchData:h}=j(y.GET_PROVINCES),{data:S,loading:P,error:V,fetchData:N}=j(y.GET_COMMUNES),{deleteItem:l,deleting:d,errorDelete:ce}=Ge(),{putData:fe,loading:U,error:W,response:pe}=qe(),T=f(null);async function ve(r,t){T.value=r,await l(`${y.GET_COMMUNES}/${r}`)?(k({message:`Commune "${t}" supprimée avec succès.`,type:"success"}),M.emit("communeUpdated")):k({message:ce.value||"Suppression impossible",type:"error"}),T.value=null}ne(()=>{A(),D(),M.on("communeUpdated",X)}),Ce(()=>{M.off("communeUpdated",X)});function X(){D()}ee(w,async r=>{C.value=void 0,r&&await h({country_id:r}),D()}),ee(C,()=>{D()});function D(){const r={};C.value?r.province_id=C.value:w.value&&(r.country_id=w.value),N(r)}const Z=Q(()=>{const r=S.value||[],t=E.value.trim().toLowerCase();return t?r.filter(o=>o.name.toLowerCase().includes(t)):r});return(r,t)=>(i(),L(Ae,{breadcrumb:G,"active-route":"/admin","module-name":"admin"},{default:n(()=>[a("div",Qe,[s(Pe,{title:"Administration",tags:q,"active-tag-name":z.value},null,8,["active-tag-name"]),s(Te,null,{default:n(()=>[a("div",es,[a("div",ss,[a("div",ts,[s(e(J),{modelValue:E.value,"onUpdate:modelValue":t[0]||(t[0]=o=>E.value=o),placeholder:"Rechercher une commune...",class:"w-full max-w-sm ps-10 h-10"},null,8,["modelValue"]),t[5]||(t[5]=a("div",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-foreground-muted/70"},[a("span",{class:"iconify hugeicons--search-01 text-sm"})],-1))]),a("div",ns,[s(He)])])]),a("div",as,[e(P)?(i(),u("div",ls,"Chargement...")):e(V)?(i(),u("div",os,g(e(V)),1)):(i(),u(I,{key:2},[(Z.value||[]).length===0?(i(),u("div",is,"Aucune commune trouvée.")):(i(),u("ul",rs,[(i(!0),u(I,null,Y(Z.value,o=>(i(),u("li",{key:o.id,class:"px-4 py-3 flex items-center justify-between"},[a("div",us,[a("span",ds,g(o.name),1)]),s(Be,null,{actions:n(()=>[s(e(p),{size:"sm",variant:"outline",class:"h-8",onClick:_e=>R(o)},{default:n(()=>[...t[6]||(t[6]=[a("span",{class:"iconify hugeicons--edit-01"},null,-1),a("span",{class:"sr-only"},"Modifier",-1)])]),_:1},8,["onClick"]),s(e(we),null,{default:n(()=>[s(e(he),{"as-child":""},{default:n(()=>[s(e(p),{size:"sm",variant:"destructive",class:"h-8"},{default:n(()=>[...t[7]||(t[7]=[a("span",{class:"iconify hugeicons--delete-02"},null,-1),a("span",{class:"sr-only"},"Supprimer",-1)])]),_:1})]),_:1}),s(e(Se),null,{default:n(()=>[s(e(Ve),null,{default:n(()=>[s(e(Ne),null,{default:n(()=>[...t[8]||(t[8]=[m("Supprimer cette commune ?",-1)])]),_:1}),s(e(Ue),null,{default:n(()=>[...t[9]||(t[9]=[m(" Action irréversible. Si des éléments dépendent de cette commune, la suppression peut être refusée. ",-1)])]),_:1})]),_:1}),s(e(Me),null,{default:n(()=>[s(e(ze),null,{default:n(()=>[...t[10]||(t[10]=[m("Annuler",-1)])]),_:1}),s(e(p),{variant:"destructive",disabled:e(d)&&T.value===o.id,onClick:_e=>ve(o.id,o.name)},{default:n(()=>[e(d)&&T.value===o.id?(i(),u("span",ms,[s(K,{size:"sm"}),t[11]||(t[11]=a("span",null,"Suppression...",-1))])):(i(),u("span",cs,"Confirmer"))]),_:2},1032,["disabled","onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]))),128)),s(e(ae),{open:c.value,"onUpdate:open":t[4]||(t[4]=o=>c.value=o)},{default:n(()=>[s(e(le),{class:"sm:max-w-[480px]"},{default:n(()=>[s(e(oe),null,{default:n(()=>[s(e(ie),null,{default:n(()=>[...t[12]||(t[12]=[m("Modifier une Commune",-1)])]),_:1}),s(e(re),null,{default:n(()=>[...t[13]||(t[13]=[m("Mettre à jour les informations de la commune",-1)])]),_:1})]),_:1}),a("form",{onSubmit:ue($,["prevent"])},[a("div",fs,[a("div",ps,[s(e(O),{for:"name",class:"text-sm font-medium"},{default:n(()=>[...t[14]||(t[14]=[m("Nom",-1)])]),_:1}),s(e(J),{id:"name",modelValue:b.value,"onUpdate:modelValue":t[1]||(t[1]=o=>b.value=o),class:"h-10",disabled:e(U),required:""},null,8,["modelValue","disabled"])]),a("div",vs,[s(e(O),{for:"province",class:"text-sm font-medium"},{default:n(()=>[...t[15]||(t[15]=[m("Province",-1)])]),_:1}),ke(a("select",{id:"province","onUpdate:modelValue":t[2]||(t[2]=o=>v.value=o),class:"h-10 border rounded-md px-3",disabled:e(U)},[t[16]||(t[16]=a("option",{value:void 0},"-- Sélectionnez une province --",-1)),(i(!0),u(I,null,Y(e(_)||[],o=>(i(),u("option",{key:o.id,value:o.id},g(o.name),9,ys))),128))],8,_s),[[Ee,v.value,void 0,{number:!0}]])])]),s(e(de),{class:"flex justify-end gap-2 items-center"},{default:n(()=>[s(e(p),{size:"sm",class:"h-9",variant:"outline",type:"button",disabled:e(U),onClick:t[3]||(t[3]=o=>c.value=!1)},{default:n(()=>[...t[17]||(t[17]=[m("Annuler",-1)])]),_:1},8,["disabled"]),s(e(p),{size:"sm",class:"h-9",type:"submit",disabled:e(U)},{default:n(()=>[e(U)?(i(),u("span",xs,[s(K,{size:"lg"}),t[19]||(t[19]=a("span",null,"Mise à jour...",-1))])):(i(),u("span",gs,[...t[18]||(t[18]=[a("span",{class:"iconify hugeicons--floppy-disk"},null,-1),a("span",null,"Enregistrer",-1)])]))]),_:1},8,["disabled"])]),_:1})],32)]),_:1})]),_:1},8,["open"])]))],64))])]),_:1})])]),_:1}))}});export{js as default};
