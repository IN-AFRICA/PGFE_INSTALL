import{_ as H}from"./LayoutGestionDisciplinaire.vue_vue_type_script_setup_true_lang-skQCPo4l.js";import{d as U,r as f,v as I,s as h,p as J,x as C,w as t,b as d,f as i,i as s,ab as z,k as _,y as r,c as K,F as P,G as Q,o as S,t as c}from"./index-CJ_PivE-.js";import{_ as W}from"./Input.vue_vue_type_script_setup_true_lang-B9adgRZV.js";import{S as X,a as Z}from"./SemestreService-BP5X1NpV.js";import{S as ee,F as te}from"./FiliaireService-CYGYY8j2.js";import{S as B}from"./StudentExitService-D4KBsVc2.js";import{a as ae}from"./AlertMessage.vue_vue_type_script_setup_true_lang-DthA28zY.js";import{a as le,b as k,c as m,d as se,e as u,_ as ie}from"./TableHeader.vue_vue_type_script_setup_true_lang-cS4zBTGx.js";import"./LayoutSaisieOperation.vue_vue_type_script_setup_true_lang-bYPLg6Nt.js";import"./DashLayoutWithMode.vue_vue_type_script_setup_true_lang-DzpyZ4TL.js";import"./RightDashHeader.vue_vue_type_script_setup_true_lang-Bn3G870_.js";import"./DashPageHeader.vue_vue_type_script_setup_true_lang-DucYyTAx.js";import"./BoxPanelWrapper.vue_vue_type_script_setup_true_lang-CmJ-Iy6y.js";import"./index-BpkKmY4O.js";import"./DialogTrigger.vue_vue_type_script_setup_true_lang-Bm461x8Q.js";const ne={class:"flex flex-col md:flex-row gap-3 md:items-center md:justify-between"},re={class:"relative w-full md:w-96"},oe={class:"mt-4 rounded-md overflow-hidden flex flex-1 bg-white"},de={class:"flex items-center gap-2"},Ce=U({__name:"SortieElves",setup(ue){const y=f(!1),g=f(!1),b=f([]),x=f(""),w=f([{id:1,label:"--------"}]),A=f([{id:1,name:"----------------------"}]),R=f([{id:1,label:"----------"}]),v=f([{id:1,full_name:"-------------"}]);I(()=>{T(),Y(),q(),j(),E()});const T=async()=>{var e;const a=await ee.getAllSchoolYear();a&&(w.value=(e=a==null?void 0:a.data)==null?void 0:e.years.map(l=>({id:l.id,label:l.name})))},Y=async()=>{var e;const a=await te.getAllFiliaire();a&&(A.value=(e=a==null?void 0:a.data)==null?void 0:e.data.map(l=>({id:l.id,name:l.name})))},j=async()=>{var e;const a=await X.getAllSemestre();a&&(R.value=(e=a==null?void 0:a.data)==null?void 0:e.data.map(l=>({id:l.id,label:l.name})))},q=async()=>{var e,l;const a=await Z.getAllStudents();a&&(v.value=(l=(e=a==null?void 0:a.data)==null?void 0:e.students)==null?void 0:l.data.map(n=>({id:n==null?void 0:n.id,full_name:`${(n==null?void 0:n.name)??""} ${(n==null?void 0:n.firstname)??""} ${(n==null?void 0:n.lastname)??""}`})))},E=async()=>{var a;y.value=!0;try{const e=await B.getAllStudentExits();(a=e==null?void 0:e.data)!=null&&a.data?b.value=e.data.data:e!=null&&e.data&&(b.value=e.data)}catch{h({message:"Erreur lors du chargement des sorties",type:"error"})}finally{y.value=!1}},G=async a=>{g.value=!0;try{await B.deleteStudentExit(a),h({message:"Sortie supprimée avec succès",type:"success"}),await E()}catch{h({message:"Erreur lors de la suppression",type:"error"})}finally{g.value=!1}},M=J(()=>{const a=b.value||[],e=x.value.trim().toLowerCase();return e?a.filter(l=>{var L,N,D,F,V;const n=v.value.find(p=>String(p.id)===String(l.student_id)),o=A.value.find(p=>String(p.id)===String(l.filiere_id)),$=w.value.find(p=>String(p.id)===String(l.school_year_id));return((L=n==null?void 0:n.full_name)==null?void 0:L.toLowerCase().includes(e))||((N=o==null?void 0:o.name)==null?void 0:N.toLowerCase().includes(e))||((D=$==null?void 0:$.label)==null?void 0:D.toLowerCase().includes(e))||((F=l.motif)==null?void 0:F.toLowerCase().includes(e))||((V=l.semester)==null?void 0:V.toLowerCase().includes(e))}):a});function O(a){if(!a)return"N/A";const e=new Date(a);return isNaN(e.getTime())?"Date invalide":e.toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric"})}return(a,e)=>(S(),C(H,{"active-tag-name":"index",breadcrumb:[{label:"Élèves",href:"/apprenants"},{label:"Opérations",href:"/apprenants/operations"},{label:"Gestion Disciplinaire",href:"/apprenants/operations/gestion-disciplinaire"},{label:"Sorties d'Élèves",href:"/apprenants/operations/gestion-disciplinaire/sorties"}]},{default:t(()=>[d("div",ne,[d("div",re,[i(s(W),{modelValue:x.value,"onUpdate:modelValue":e[0]||(e[0]=l=>x.value=l),placeholder:"Rechercher une sortie...",class:"w-full ps-10 border border-gray-200/40 bg-white h-9 rounded-md"},null,8,["modelValue"]),e[1]||(e[1]=d("div",{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-foreground-muted/70"},[d("span",{class:"flex iconify hugeicons--search-01 text-sm"})],-1))]),i(s(_),{size:"md",class:"rounded-md","as-child":""},{default:t(()=>[i(s(z),{to:"/apprenants/operations/gestion-disciplinaire/sortie"},{default:t(()=>[...e[2]||(e[2]=[d("span",{class:"flex iconify hugeicons--plus-sign"},null,-1),d("span",{class:"hidden sm:flex"},"Ajouter Sortie",-1)])]),_:1})]),_:1})]),d("div",oe,[i(s(ie),{class:"rounded-md bg-white"},{default:t(()=>[i(s(le),null,{default:t(()=>[i(s(k),null,{default:t(()=>[i(s(m),null,{default:t(()=>[...e[3]||(e[3]=[r("Date",-1)])]),_:1}),i(s(m),null,{default:t(()=>[...e[4]||(e[4]=[r("Heure",-1)])]),_:1}),i(s(m),null,{default:t(()=>[...e[5]||(e[5]=[r("Élève",-1)])]),_:1}),i(s(m),null,{default:t(()=>[...e[6]||(e[6]=[r("Section",-1)])]),_:1}),i(s(m),null,{default:t(()=>[...e[7]||(e[7]=[r("Année scolaire",-1)])]),_:1}),i(s(m),null,{default:t(()=>[...e[8]||(e[8]=[r("Semestre",-1)])]),_:1}),i(s(m),null,{default:t(()=>[...e[9]||(e[9]=[r("Motif",-1)])]),_:1}),i(s(m),null,{default:t(()=>[...e[10]||(e[10]=[r("Actions",-1)])]),_:1})]),_:1})]),_:1}),i(s(se),null,{default:t(()=>[y.value?(S(),C(s(k),{key:0},{default:t(()=>[i(s(u),{colspan:"8",class:"text-center py-10 text-gray-500"},{default:t(()=>[...e[11]||(e[11]=[r(" Chargement des sorties... ",-1)])]),_:1})]),_:1})):(S(!0),K(Q,{key:1},P(M.value,l=>(S(),C(s(k),{key:l.id,class:"group hover:bg-gray-50"},{default:t(()=>[i(s(u),null,{default:t(()=>[r(c(O(l.date)),1)]),_:2},1024),i(s(u),null,{default:t(()=>[r(c(String(l.exit_time||"").slice(0,5)),1)]),_:2},1024),i(s(u),null,{default:t(()=>{var n;return[r(c(((n=v.value.find(o=>String(o.id)===String(l.student_id)))==null?void 0:n.full_name)||"N/A"),1)]}),_:2},1024),i(s(u),null,{default:t(()=>{var n;return[r(c(((n=A.value.find(o=>String(o.id)===String(l.filiere_id)))==null?void 0:n.name)||"N/A"),1)]}),_:2},1024),i(s(u),null,{default:t(()=>{var n;return[r(c(((n=w.value.find(o=>String(o.id)===String(l.school_year_id)))==null?void 0:n.label)||"N/A"),1)]}),_:2},1024),i(s(u),null,{default:t(()=>[r(c(l.semester),1)]),_:2},1024),i(s(u),null,{default:t(()=>[r(c(l.motif),1)]),_:2},1024),i(s(u),null,{default:t(()=>{var n;return[d("div",de,[i(s(z),{to:`/apprenants/operations/gestion-disciplinaire/sortie?edit=${l.id}`},{default:t(()=>[i(s(_),{variant:"ghost",size:"icon",class:"text-gray-500 hover:text-blue-600 hover:bg-blue-50"},{default:t(()=>[...e[12]||(e[12]=[d("span",{class:"iconify hugeicons--edit-02"},null,-1)])]),_:1})]),_:1},8,["to"]),i(ae,{action:"danger",title:"Supprimer une sortie",message:`Voulez-vous supprimer la sortie de ${((n=v.value.find(o=>String(o.id)===String(l.student_id)))==null?void 0:n.full_name)||"cet apprenant"} ?`},{trigger:t(()=>[i(s(_),{variant:"ghost",size:"icon",class:"text-gray-500 hover:text-red-600 hover:bg-red-50",disabled:g.value},{default:t(()=>[...e[13]||(e[13]=[d("span",{class:"iconify hugeicons--delete-02"},null,-1)])]),_:1},8,["disabled"])]),"confirm-action-button":t(()=>[i(s(_),{variant:"destructive",onClick:o=>G(l.id),size:"sm",class:"h-10 px-4",disabled:g.value},{default:t(()=>[...e[14]||(e[14]=[r(" Oui, Supprimer ",-1)])]),_:1},8,["onClick","disabled"])]),_:2},1032,["message"])])]}),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})])]),_:1}))}});export{Ce as default};
