import{d as H,p as m,r as q,A as S,v as U,q as K,x as $,w as u,f as l,b as d,c as j,h as Q,i as o,y as D,B as W,C as X,H as Z,D as w,E as ee,J as k,F as te,G as se,I as ne,o as g,t as ae}from"./index-CJ_PivE-.js";import{_ as h}from"./CardDashStat.vue_vue_type_script_setup_true_lang-B8zO29KP.js";import{_ as oe}from"./DashLayout.vue_vue_type_script_setup_true_lang-Ch2egXHm.js";import{_ as re}from"./BarChart.vue_vue_type_script_setup_true_lang-D20XYPzz.js";import{_ as le}from"./SelectGroup.vue_vue_type_script_setup_true_lang-CwIOzTi6.js";import{u as V}from"./useGetApi-EdzHoZm6.js";import"./RightDashHeader.vue_vue_type_script_setup_true_lang-Bn3G870_.js";import"./Input.vue_vue_type_script_setup_true_lang-B9adgRZV.js";import"./index-BpkKmY4O.js";import"./Card.vue_vue_type_script_setup_true_lang-D6d8RJcP.js";const ce={class:"pt-7 md:pt-12 pb-20 mx-auto w-full max-w-7xl"},ue={class:"flex items-center justify-between mb-6 gap-3"},de={key:0,class:"text-sm text-red-600 bg-red-50 border border-red-200 px-3 py-2 rounded-md"},ie={class:"w-64"},me={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4 h-[50px] w-[100%] mb-40"},Ne=H({__name:"MainDashCompta",setup(pe){const F=m(()=>{const e=f.value??null,s=(e==null?void 0:e.chart)??e;return O(s)}),_=["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"];function b(e){if(typeof e=="number"){const s=Math.max(1,Math.min(12,e))-1;return _[s]}if(typeof e=="string"){const s=e.toLowerCase(),i=["january","february","march","april","may","june","july","august","september","october","november","december"].indexOf(s);return i>=0?_[i]:e}return"-"}function O(e){var s,n;try{if(!e)return[];if(console.log("Dashboard - Raw data received:",e),e.recette!==void 0||e.dependances!==void 0){const t=Number(e.recette??0),v=Number(e.dependances??e.depenses??0);console.log("Dashboard - Direct format detected:",{recette:t,depenses:v});const E=new Date().getMonth();return _.map((a,r)=>{const c=r===E;return{name:a,recettes:c?t:0,depenses:c?v:0}})}const i=((s=e==null?void 0:e.chart)==null?void 0:s.monthly)||(e==null?void 0:e.monthly)||((n=e==null?void 0:e.chartData)==null?void 0:n.monthly);if(Array.isArray(i))return i.map(t=>({name:b(t.month??t.name??t.label),recettes:Number(t.recettes??t.recette??t.revenue??t.income??0),depenses:Number(t.depenses??t.dependances??t.expense??t.expenses??0)}));const C=(e==null?void 0:e.revenues)||(e==null?void 0:e.income),M=(e==null?void 0:e.expenses)||(e==null?void 0:e.depenses)||(e==null?void 0:e.dependances);if(Array.isArray(C)&&Array.isArray(M)){const t=new Map;for(const a of C){const r=b(a.month??a.name),c=t.get(r)||{recettes:0,depenses:0};c.recettes+=Number(a.amount??a.total??0),t.set(r,c)}for(const a of M){const r=b(a.month??a.name),c=t.get(r)||{recettes:0,depenses:0};c.depenses+=Number(a.amount??a.total??0),t.set(r,c)}const v=_.map(a=>{var r,c;return{name:a,recettes:((r=t.get(a))==null?void 0:r.recettes)??0,depenses:((c=t.get(a))==null?void 0:c.depenses)??0}});return v.some(a=>a.recettes||a.depenses)?v:Array.from(t.entries()).map(([a,r])=>({name:a,recettes:r.recettes,depenses:r.depenses}))}return Array.isArray(e)?e.map(t=>({name:b(t.month??t.name??t.label),recettes:Number(t.recettes??t.recette??t.revenue??t.income??0),depenses:Number(t.depenses??t.dependances??t.expense??t.expenses??0)})):Array.isArray(e==null?void 0:e.data)?e.data.map(t=>({name:b(t.month??t.name??t.label),recettes:Number(t.recettes??t.recette??t.revenue??t.income??0),depenses:Number(t.depenses??t.dependances??t.expense??t.expenses??0)})):(console.warn("Dashboard - No matching format found, returning empty array"),[])}catch(i){console.warn("Dashboard chart normalization error:",i)}return[]}const p=q("all"),{data:y,loading:x,fetchData:T}=V(S.GET_SHOOL_YEARS),R=m(()=>{const e=y==null?void 0:y.value;let s=[];return Array.isArray(e)?s=e:e!=null&&e.years&&Array.isArray(e.years)?s=e.years:e!=null&&e.data&&Array.isArray(e.data)?s=e.data:e&&typeof e=="object"&&(s=Object.values(e).filter(n=>n&&typeof n=="object"&&(n.id||n.value))),s.map(n=>({id:String(n.id??n.value??""),name:n.name||n.label||n.year||`Année #${n.id??n.value}`}))}),{data:f,loading:N,error:G,fetchData:B}=V(S.GET_DATA_DASHBOARD);async function A(){p.value&&p.value!=="all"?await B({school_year_id:p.value}):await B()}U(async()=>{await Promise.all([T(),A()])}),K(p,()=>{A()});const I=m(()=>{var e;return Number(((e=f.value)==null?void 0:e.total_accounts)??0)}),J=m(()=>{var e;return Number(((e=f.value)==null?void 0:e.total_budgets)??0)}),L=m(()=>{var e;return Number(((e=f.value)==null?void 0:e.total_balance)??0)}),P=m(()=>{var e;return Number(((e=f.value)==null?void 0:e.total_paid)??0)}),Y=m(()=>{var e;return Number(((e=f.value)==null?void 0:e.students_paid)??0)}),z={items:[{label:"Accueil",href:"/",icon:"hugeicons--home-01"},{label:"Comptabilité",isActive:!0}]};return(e,s)=>(g(),$(oe,{"active-route":"/comptabilite","module-name":"compta",breadcrumb:z},{default:u(()=>[l(ne,null,{default:u(()=>[s[5]||(s[5]=d("div",{class:"flex flex-col max-w-2xl"},[d("h1",{class:"font-semibold text-xl text-foreground-title"},"Dashboard Comptabilité"),d("p",{class:"text-foreground-muted mt-0.5"}," Bonjour In Afrique, Bienvenu à nouveau sur votre plateforme de gestion financière. ")],-1)),d("div",ce,[d("div",ue,[o(G)?(g(),j("div",de,[s[1]||(s[1]=D(" Erreur de chargement du tableau de bord. ",-1)),d("button",{type:"button",class:"ml-2 underline",onClick:A},"Réessayer")])):Q("",!0),d("div",ie,[l(o(W),{modelValue:p.value,"onUpdate:modelValue":s[0]||(s[0]=n=>p.value=n),disabled:o(x)||o(N)},{default:u(()=>[l(o(X),{class:Z(["!h-9 rounded-md border bg-white",o(x)||o(N)?"opacity-60 cursor-not-allowed":""])},{default:u(()=>[l(o(w),{placeholder:o(x)?"Chargement...":"Année scolaire"},null,8,["placeholder"])]),_:1},8,["class"]),l(o(ee),null,{default:u(()=>[l(o(le),null,{default:u(()=>[l(o(k),{value:"all"},{default:u(()=>[...s[2]||(s[2]=[D("Toutes les années",-1)])]),_:1}),(g(!0),j(se,null,te(R.value,n=>(g(),$(o(k),{key:n.id||n.name,value:n.id},{default:u(()=>[D(ae(n.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue","disabled"])])]),d("div",me,[l(h,{icon:"hugeicons--money-receive-01",value:P.value,title:"Montant total payé",description:"Somme des paiements",color:"#10B981"},null,8,["value"]),l(h,{icon:"hugeicons--money-receive-circle",value:L.value,title:"Solde total",description:"Balance comptable",color:"#3B82F6"},null,8,["value"]),l(h,{icon:"hugeicons--wallet-01",value:J.value,title:"Budgets",description:"Budgets enregistrés",color:"#F59E0B"},null,8,["value"]),l(h,{icon:"hugeicons--bank",value:I.value,title:"Comptes bancaires",description:"Comptes enregistrés",color:"#EF4444"},null,8,["value"]),l(h,{icon:"hugeicons--user-group",value:Y.value,title:"Élèves payants",description:"Élèves avec frais à jour",color:"#8B5CF6"},null,8,["value"])]),l(o(re),{data:F.value,index:"name",categories:["recettes","depenses"],"rounded-corners":30,class:"mt-10 bg-white rounded-lg p-3"},{title:u(()=>[...s[3]||(s[3]=[d("h3",{class:"text-foreground-title font-semibold text-lg"}," Évolution Financière ",-1)])]),actions:u(()=>[...s[4]||(s[4]=[d("div",null,null,-1)])]),_:1},8,["data"])])]),_:1})]),_:1}))}});export{Ne as default};
