import{d as B,u as L,n as q,A as h,p as S,v as H,x as A,w as s,b as u,f as r,i as t,z as i,y as n,B as J,C as W,D as Y,E as K,c as w,F as Q,G as X,k as E,t as j,g as Z,a as ee,o as m,J as ae,s as p}from"./index-CJ_PivE-.js";import{_ as C}from"./FormSection.vue_vue_type_script_setup_true_lang-C-XSdIg3.js";import{I as d}from"./InputWrapper-tSRHzcjN.js";import{S as x}from"./SpanRequired-COKghTUX.js";import{_ as re}from"./DashFormLayout.vue_vue_type_script_setup_true_lang-3V-LyRCQ.js";import{_}from"./Input.vue_vue_type_script_setup_true_lang-B9adgRZV.js";import{_ as te}from"./SelectGroup.vue_vue_type_script_setup_true_lang-CwIOzTi6.js";import{_ as le}from"./Textarea.vue_vue_type_script_setup_true_lang-Bg8QXdyw.js";import{u as se}from"./usePostApi-Crg8MURP.js";import{u as k}from"./useGetApi-EdzHoZm6.js";import"./BoxPanelWrapper.vue_vue_type_script_setup_true_lang-CmJ-Iy6y.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./DashLayout.vue_vue_type_script_setup_true_lang-Ch2egXHm.js";import"./RightDashHeader.vue_vue_type_script_setup_true_lang-Bn3G870_.js";import"./FormPageHeader.vue_vue_type_script_setup_true_lang-CAg7Z6LS.js";import"./index-BpkKmY4O.js";const oe={class:"flex items-center justify-end gap-2"},ne={key:0,class:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white mr-1.5"},ie={key:1,class:"flex iconify hugeicons--money-bag-02 mr-1.5"},$e=B({__name:"NouveauConge",setup(de){const D=ee();L();const l=q({personal_id:void 0,jour_demand:void 0,description:"",creer_a:new Date().toISOString().split("T")[0]}),{data:g,fetchData:P,loading:T}=k(h.GET_PERSONALS),{data:c,fetchData:F}=k(h.GET_FONCTIONS),O=o=>{var v;if(!o||!c.value)return"N/A";const e=(Array.isArray(c.value)?c.value:((v=c.value)==null?void 0:v.data)||[]).find(y=>y.id==o);return(e==null?void 0:e.name)||(e==null?void 0:e.title)||(e==null?void 0:e.libelle)||"N/A"},N=S(()=>{var a;return(Array.isArray(g.value)?g.value:((a=g.value)==null?void 0:a.data)||[]).map(e=>({id:e.id,name:`${e.name||e.nom||""} ${e.postnom||""} ${e.firstname||e.prenom||""}`.trim(),matricule:e.matricule,fonction:O(e.fonction_id)}))}),$=S(()=>l.personal_id?N.value.find(o=>o.id===l.personal_id):null),{loading:f,error:b,postData:I}=se(),V=S(()=>l.personal_id!==void 0&&l.jour_demand!==void 0&&l.jour_demand>=1&&l.creer_a!=="");async function R(){if(!V.value){p({message:"Veuillez remplir tous les champs obligatoires correctement.",type:"error"});return}const o=new Date(l.creer_a),a=String(o.getDate()).padStart(2,"0"),e=String(o.getMonth()+1).padStart(2,"0"),y=`${o.getFullYear()}-${e}-${a}`,U={academic_personal_id:Number(l.personal_id),jour_demand:Number(l.jour_demand),creer_a:y,...l.description.trim()&&{description:l.description.trim()}};try{if(await I(h.CREATE_PERSONNEL_CONGE,U),b.value){console.error("❌ Erreur API:",b.value),p({message:b.value,type:"error"});return}p({message:"Congé créé avec succès !",type:"success"}),G(),setTimeout(()=>{D.push("/rh/saisie/conge")},1e3)}catch(z){console.error("Erreur lors de la soumission:",z),p({message:"Une erreur inattendue s'est produite.",type:"error"})}}function G(){l.personal_id=void 0,l.jour_demand=void 0,l.description="",l.creer_a=new Date().toISOString().split("T")[0]}function M(){D.push("/rh/saisie/conge")}return H(async()=>{await Promise.all([P(),F()])}),(o,a)=>(m(),A(re,{title:"Nouveau congé","link-back":"/rh/saisie/conge","group-route":"/rh/saisie/personnel",module:"rh",breadcrumb:[{label:"GRH",href:"/rh"},{label:"Congé",href:"/rh/saisie/conge"},{label:"Nouveau congé",isActive:!0}]},{default:s(()=>[u("form",{onSubmit:Z(R,["prevent"]),class:"w-full flex flex-col space-y-8"},[r(C,{class:"grid sm:grid-cols-2 lg:grid-cols-3 gap-y-6 gap-x-10",title:"Informations générales"},{default:s(()=>[r(d,null,{default:s(()=>[r(t(i),{class:"text-sm font-medium"},{default:s(()=>[a[4]||(a[4]=n(" Personnel ",-1)),r(x)]),_:1}),r(t(J),{modelValue:l.personal_id,"onUpdate:modelValue":a[0]||(a[0]=e=>l.personal_id=e),disabled:t(T)},{default:s(()=>[r(t(W),{class:"!h-10 bg-white w-full"},{default:s(()=>[r(t(Y),{placeholder:"Sélectionnez le personnel"})]),_:1}),r(t(K),null,{default:s(()=>[r(t(te),null,{default:s(()=>[(m(!0),w(X,null,Q(N.value,e=>(m(),A(t(ae),{key:e.id,value:e.id},{default:s(()=>[n(j(e.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1}),r(d,null,{default:s(()=>{var e;return[r(t(i),{class:"text-sm font-medium"},{default:s(()=>[...a[5]||(a[5]=[n("Matricule",-1)])]),_:1}),r(t(_),{value:((e=$.value)==null?void 0:e.matricule)||"",class:"bg-gray-100 transition-all h-10 rounded-md",readonly:"",placeholder:"Sélectionner d'abord un personnel"},null,8,["value"])]}),_:1}),r(d,null,{default:s(()=>{var e;return[r(t(i),{class:"text-sm font-medium"},{default:s(()=>[...a[6]||(a[6]=[n("Fonction",-1)])]),_:1}),r(t(_),{value:((e=$.value)==null?void 0:e.fonction)||"",class:"bg-gray-100 transition-all h-10 rounded-md",readonly:"",placeholder:"Sélectionner d'abord un personnel"},null,8,["value"])]}),_:1}),r(d,null,{default:s(()=>[r(t(i),{class:"text-sm font-medium"},{default:s(()=>[a[7]||(a[7]=n(" Date de demande ",-1)),r(x)]),_:1}),r(t(_),{type:"date",modelValue:l.creer_a,"onUpdate:modelValue":a[1]||(a[1]=e=>l.creer_a=e),class:"w-full h-10 border border-gray-200/40 bg-white transition-all rounded-md"},null,8,["modelValue"])]),_:1}),r(d,null,{default:s(()=>[r(t(i),{class:"text-sm font-medium"},{default:s(()=>[a[8]||(a[8]=n(" Durée (jours) ",-1)),r(x)]),_:1}),r(t(_),{modelValue:l.jour_demand,"onUpdate:modelValue":a[2]||(a[2]=e=>l.jour_demand=e),modelModifiers:{number:!0},type:"number",min:"1",placeholder:"Nombre de jours",class:"w-full h-10 border border-gray-200/40 bg-white transition-all rounded-md"},null,8,["modelValue"])]),_:1})]),_:1}),a[11]||(a[11]=u("div",{class:"w-full flex h-px bg-gray-300"},null,-1)),r(C,{class:"grid gap-y-6",title:"Détails"},{default:s(()=>[r(d,null,{default:s(()=>[r(t(i),{class:"text-sm font-medium"},{default:s(()=>[...a[9]||(a[9]=[n(" Motif / Description ",-1)])]),_:1}),r(t(le),{modelValue:l.description,"onUpdate:modelValue":a[3]||(a[3]=e=>l.description=e),placeholder:"Décrivez le motif de la demande de congé...",class:"w-full min-h-[100px] border border-gray-200/40 bg-white transition-all resize-none rounded-md"},null,8,["modelValue"])]),_:1})]),_:1}),a[12]||(a[12]=u("div",{class:"w-full flex h-px bg-gray-300"},null,-1)),u("div",oe,[r(t(E),{type:"button",variant:"outline",onClick:M,disabled:t(f)},{default:s(()=>[...a[10]||(a[10]=[u("span",{class:"flex iconify hugeicons--cancel-01 mr-1.5"},null,-1),n(" Annuler ",-1)])]),_:1},8,["disabled"]),r(t(E),{type:"submit",disabled:!V.value||t(f)},{default:s(()=>[t(f)?(m(),w("span",ne)):(m(),w("span",ie)),n(" "+j(t(f)?"Enregistrement...":"Soumettre la demande"),1)]),_:1},8,["disabled"])])],32)]),_:1}))}});export{$e as default};
