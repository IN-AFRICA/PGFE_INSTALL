import{d as se,r as v,v as te,A as k,s as C,x as F,i as e,K as ne,w as n,f as s,k as _,b as a,L as ae,M as le,N as ie,y as m,O as oe,g as re,c as u,h as G,z as R,j as Q,t as x,B as pe,C as ve,D as _e,E as ye,F as L,G as I,P as ue,o,J as ge,p as q,a2 as xe,q as be,af as $e,aY as ke,R as Ce,S as Ee,U as we,V as Se,W as he,X as Ve,Y as Ne,Z as Pe}from"./index-CJ_PivE-.js";import{_ as ze}from"./DashLayout.vue_vue_type_script_setup_true_lang-Ch2egXHm.js";import{_ as Ae}from"./DashPageHeader.vue_vue_type_script_setup_true_lang-DucYyTAx.js";import{_ as Ue}from"./BoxPanelWrapper.vue_vue_type_script_setup_true_lang-CmJ-Iy6y.js";import{_ as Y}from"./Input.vue_vue_type_script_setup_true_lang-B9adgRZV.js";import{_ as Te}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-Bm461x8Q.js";import{_ as J}from"./IconifySpinner.vue_vue_type_script_setup_true_lang-C3Td1B5O.js";import{_ as Ie}from"./SelectGroup.vue_vue_type_script_setup_true_lang-CwIOzTi6.js";import{u as Re}from"./usePostApi-Crg8MURP.js";import{u as K}from"./useGetApi-EdzHoZm6.js";import{e as P}from"./eventBus-CGRXT3Tn.js";import{u as je,a as ee,t as De}from"./vee-validate-zod-Bra4yLtR.js";import{z as B}from"./external-CYeExkxg.js";import{u as Me}from"./useDeleteApi-D2AjqV8w.js";import{u as Oe}from"./usePutApi-BrTvEW5v.js";import{_ as Ge}from"./TableRowActions.vue_vue_type_script_setup_true_lang-C8PT7-8D.js";import"./RightDashHeader.vue_vue_type_script_setup_true_lang-Bn3G870_.js";import"./index-BpkKmY4O.js";const qe={class:"grid gap-4 py-4"},Be={class:"flex flex-col space-y-1.5"},Fe={key:0,class:"text-xs text-red-500"},Le={class:"flex flex-col space-y-1.5 flex-1"},Ye={key:0,class:"text-xs text-red-500"},Je={key:1,class:"text-xs text-red-500"},Ke={key:0,class:"flex items-center gap-2"},We={key:1,class:"flex items-center gap-2"},Xe=se({__name:"NewProvinces",setup(de){const f=v(!1),{loading:c,error:y,response:g,postData:j,success:D}=Re(),{data:M,loading:O,error:z,fetchData:E}=K(k.GET_COUNTRIES);te(()=>{E()});const p=B.object({name:B.string({required_error:"veuillez saisir le nom de la province"}).min(2).max(100),country_id:B.string({required_error:"veuillez séléctionner un pays"}).min(1,"veuillez séléctionner un pays")}),{handleSubmit:w,resetForm:S}=je({validationSchema:De(p)}),{value:h,errorMessage:A}=ee("name"),{value:b,errorMessage:V}=ee("country_id"),U=w(async $=>{var d;const l={name:$.name.trim(),country_id:Number($.country_id)};if(await j(k.CREATE_PROVINCE,l),y.value){C({message:y.value,type:"error"});return}D.value&&(P.emit("provinceUpdated"),C({message:((d=g.value)==null?void 0:d.message)||"Province ajoutée avec succès",type:"success"}),S(),f.value=!1)});return($,l)=>(o(),F(e(ne),{open:f.value,"onUpdate:open":l[4]||(l[4]=d=>f.value=d)},{default:n(()=>[s(e(Te),{"as-child":""},{default:n(()=>[s(e(_),{size:"md",class:"rounded-md"},{default:n(()=>[...l[5]||(l[5]=[a("span",{class:"iconify hugeicons--plus-sign"},null,-1),a("span",{class:"hidden sm:flex"}," Nouvelle province ",-1)])]),_:1})]),_:1}),s(e(ae),{class:"sm:max-w-[540px]"},{default:n(()=>[s(e(le),null,{default:n(()=>[s(e(ie),null,{default:n(()=>[...l[6]||(l[6]=[m("Nouvelle province",-1)])]),_:1}),s(e(oe),null,{default:n(()=>[...l[7]||(l[7]=[m(" Enregistrer une nouvelle province ",-1)])]),_:1})]),_:1}),a("form",{onSubmit:l[3]||(l[3]=re((...d)=>e(U)&&e(U)(...d),["prevent"]))},[a("div",qe,[a("div",Be,[s(e(R),{for:"name",class:"text-sm font-medium"},{default:n(()=>[...l[8]||(l[8]=[m(" Nom ",-1)])]),_:1}),s(e(Y),{type:"text",id:"name",name:"name",modelValue:e(h),"onUpdate:modelValue":l[0]||(l[0]=d=>Q(h)?h.value=d:null),placeholder:"Entrez le nom de la province",class:"w-full h-10 border border-gray-200/40 bg-white transition-all"},null,8,["modelValue"]),e(A)?(o(),u("span",Fe,x(e(A)),1)):G("",!0)]),a("div",Le,[s(e(R),{for:"country_id",class:"text-sm font-medium"},{default:n(()=>[...l[9]||(l[9]=[m(" Associer à un pays ",-1)])]),_:1}),s(e(pe),{id:"country_id",name:"country_id",modelValue:e(b),"onUpdate:modelValue":l[1]||(l[1]=d=>Q(b)?b.value=d:null),disabled:e(c)||e(O)},{default:n(()=>[s(e(ve),{id:"country_id",class:"h-10 w-full"},{default:n(()=>[s(e(_e),{placeholder:"Sélectionnez un pays"})]),_:1}),s(e(ye),null,{default:n(()=>[s(e(Ie),null,{default:n(()=>[(o(!0),u(I,null,L(e(M)||[],d=>(o(),F(e(ge),{key:d.id,value:String(d.id)},{default:n(()=>[m(x(d.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue","disabled"]),e(V)?(o(),u("span",Ye,x(e(V)),1)):G("",!0),e(z)?(o(),u("span",Je,x(e(z)),1)):G("",!0)])]),s(e(ue),{class:"flex justify-end gap-2 items-center"},{default:n(()=>[s(e(_),{size:"sm",class:"h-9",variant:"outline",type:"button",onClick:l[2]||(l[2]=()=>{e(S)(),f.value=!1}),disabled:e(c)},{default:n(()=>[...l[10]||(l[10]=[a("span",{class:"iconify flex hugeicons--cancel-01 mr-1"},null,-1),m(" Annuler ",-1)])]),_:1},8,["disabled"]),s(e(_),{size:"sm",class:"h-9",type:"submit",disabled:e(c)},{default:n(()=>[e(c)?(o(),u("span",We,[s(J,{size:"lg"}),l[12]||(l[12]=a("span",null,"Enregistrement en cours...",-1))])):(o(),u("span",Ke,[...l[11]||(l[11]=[a("span",{class:"iconify hugeicons--floppy-disk mr-1"},null,-1),a("span",null,"Enregistrer",-1)])]))]),_:1},8,["disabled"])]),_:1})],32)]),_:1})]),_:1},8,["open"]))}}),Ze={class:"pb-6 mx-auto w-full max-w-7xl"},He={class:"flex flex-col gap-3"},Qe={class:"flex items-center gap-3 justify-between"},es={class:"relative flex-1"},ss={class:"flex items-center gap-2"},ts={class:"mt-4 flex-1 min-h-0 overflow-auto bg-white rounded-md border border-gray-100"},ns={key:0,class:"p-4 text-sm text-gray-600"},as={key:1,class:"p-4 text-sm text-red-600"},ls={key:0,class:"p-4 text-sm text-gray-600"},is={key:1,class:"divide-y"},os={class:"flex items-center gap-3"},rs={class:"font-medium"},us={key:0,class:"flex items-center gap-2"},ds={key:1},ms={class:"grid gap-4 py-4"},fs={class:"flex flex-col space-y-1.5"},cs={class:"flex flex-col space-y-1.5"},ps=["disabled"],vs=["value"],_s={key:0,class:"flex items-center gap-2"},ys={key:1,class:"flex items-center gap-2"},Rs=se({__name:"Provinces",setup(de){const f=v(!1),c=v(null),y=v(""),g=v(void 0);function j(r){c.value=r.id,y.value=r.name,g.value=r.country_id,f.value=!0,(!w.value||w.value.length===0)&&S()}async function D(){if(!c.value)return;const r={name:y.value.trim()};if(g.value&&(r.country_id=g.value),await d(`${k.GET_PROVINCES}/${c.value}`,r),W.value){C({message:W.value,type:"error"});return}me.value&&(C({message:"Province mise à jour avec succès",type:"success"}),f.value=!1,P.emit("provinceUpdated"))}const M={items:[{label:"Accueil",href:"/",icon:"hugeicons--home-01"},{label:"Administration",href:"/admin"},{label:"Provinces",isActive:!0}]},O=[{name:"pays",text:"Pays",href:"/admin/countries"},{name:"provinces",text:"Provinces",href:"/admin/provinces"},{name:"territoires",text:"Territoires",href:"/admin/territoires"},{name:"communes",text:"Communes",href:"/admin/communes"}],z=q(()=>"provinces"),E=v(""),p=v();q({get:()=>p.value!=null?String(p.value):void 0,set:r=>{p.value=r?Number(r):void 0}});const{data:w,fetchData:S}=K(k.GET_COUNTRIES),{data:h,loading:A,error:b,fetchData:V}=K(k.GET_PROVINCES),{deleteItem:U,deleting:$,errorDelete:l}=Me(),{putData:d,loading:N,error:W,response:me}=Oe(),T=v(null);async function fe(r,t){T.value=r,await U(`${k.GET_PROVINCES}/${r}`)?(C({message:`Provinces "${t} supprimé avec success"`,type:"success"}),P.emit("provinceUpdated")):C({message:l.value||"Suppression impossible",type:"error"}),T.value=null}te(()=>{S(),V(),P.on("provinceUpdated",X)}),xe(()=>{P.off("provinceUpdated",X)});function X(){Z()}be(p,()=>{Z()});function Z(){const r={};p.value&&(r.country_id=p.value),V(r)}const H=q(()=>{const r=h.value||[],t=E.value.trim().toLowerCase();return t?r.filter(i=>i.name.toLowerCase().includes(t)):r});return(r,t)=>(o(),F(ze,{breadcrumb:M,"active-route":"/admin","module-name":"admin"},{default:n(()=>[a("div",Ze,[s(Ae,{title:"Administration",tags:O,"active-tag-name":z.value},null,8,["active-tag-name"]),s(Ue,null,{default:n(()=>[a("div",He,[a("div",Qe,[a("div",es,[s(e(Y),{modelValue:E.value,"onUpdate:modelValue":t[0]||(t[0]=i=>E.value=i),placeholder:"Rechercher une province...",class:"w-full max-w-sm ps-10 h-10"},null,8,["modelValue"]),t[5]||(t[5]=a("div",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-foreground-muted/70"},[a("span",{class:"iconify hugeicons--search-01 text-sm"})],-1))]),a("div",ss,[s(Xe)])])]),a("div",ts,[e(A)?(o(),u("div",ns,"Chargement...")):e(b)?(o(),u("div",as,x(e(b)),1)):(o(),u(I,{key:2},[(H.value||[]).length===0?(o(),u("div",ls," Aucune province trouvée. ")):(o(),u("ul",is,[(o(!0),u(I,null,L(H.value,i=>(o(),u("li",{key:i.id,class:"px-4 py-3 flex items-center justify-between"},[a("div",os,[a("span",rs,x(i.name),1)]),s(Ge,null,{actions:n(()=>[s(e(_),{size:"sm",variant:"outline",class:"h-8",onClick:ce=>j(i)},{default:n(()=>[...t[6]||(t[6]=[a("span",{class:"iconify hugeicons--edit-01"},null,-1),a("span",{class:"sr-only"},"Modifier",-1)])]),_:1},8,["onClick"]),s(e(Ce),null,{default:n(()=>[s(e(Ee),{"as-child":""},{default:n(()=>[s(e(_),{size:"sm",variant:"destructive",class:"h-8"},{default:n(()=>[...t[7]||(t[7]=[a("span",{class:"iconify hugeicons--delete-02"},null,-1),a("span",{class:"sr-only"},"Supprimer",-1)])]),_:1})]),_:1}),s(e(we),null,{default:n(()=>[s(e(Se),null,{default:n(()=>[s(e(he),null,{default:n(()=>[...t[8]||(t[8]=[m("Supprimer cette province ?",-1)])]),_:1}),s(e(Ve),null,{default:n(()=>[...t[9]||(t[9]=[m(" Action irréversible. Si des éléments dépendent de cette province, la suppression peut être refusée. ",-1)])]),_:1})]),_:1}),s(e(Ne),null,{default:n(()=>[s(e(Pe),null,{default:n(()=>[...t[10]||(t[10]=[m("Annuler",-1)])]),_:1}),s(e(_),{variant:"destructive",disabled:e($)&&T.value===i.id,onClick:ce=>fe(i.id,i.name)},{default:n(()=>[e($)&&T.value===i.id?(o(),u("span",us,[s(J,{size:"sm"}),t[11]||(t[11]=a("span",null,"Suppression...",-1))])):(o(),u("span",ds,"Confirmer"))]),_:2},1032,["disabled","onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]))),128)),s(e(ne),{open:f.value,"onUpdate:open":t[4]||(t[4]=i=>f.value=i)},{default:n(()=>[s(e(ae),{class:"sm:max-w-[480px]"},{default:n(()=>[s(e(le),null,{default:n(()=>[s(e(ie),null,{default:n(()=>[...t[12]||(t[12]=[m("Modifier une Province",-1)])]),_:1}),s(e(oe),null,{default:n(()=>[...t[13]||(t[13]=[m("Mettre à jour les informations de la province",-1)])]),_:1})]),_:1}),a("form",{onSubmit:re(D,["prevent"])},[a("div",ms,[a("div",fs,[s(e(R),{for:"name",class:"text-sm font-medium"},{default:n(()=>[...t[14]||(t[14]=[m("Nom",-1)])]),_:1}),s(e(Y),{id:"name",modelValue:y.value,"onUpdate:modelValue":t[1]||(t[1]=i=>y.value=i),class:"h-10",disabled:e(N),required:""},null,8,["modelValue","disabled"])]),a("div",cs,[s(e(R),{for:"country",class:"text-sm font-medium"},{default:n(()=>[...t[15]||(t[15]=[m("Pays",-1)])]),_:1}),$e(a("select",{id:"country","onUpdate:modelValue":t[2]||(t[2]=i=>g.value=i),class:"h-10 border rounded-md px-3",disabled:e(N)},[t[16]||(t[16]=a("option",{value:void 0},"-- Sélectionnez un pays --",-1)),(o(!0),u(I,null,L(e(w)||[],i=>(o(),u("option",{key:i.id,value:i.id},x(i.name),9,vs))),128))],8,ps),[[ke,g.value,void 0,{number:!0}]])])]),s(e(ue),{class:"flex justify-end gap-2 items-center"},{default:n(()=>[s(e(_),{size:"sm",class:"h-9",variant:"outline",type:"button",disabled:e(N),onClick:t[3]||(t[3]=i=>f.value=!1)},{default:n(()=>[...t[17]||(t[17]=[m("Annuler",-1)])]),_:1},8,["disabled"]),s(e(_),{size:"sm",class:"h-9",type:"submit",disabled:e(N)},{default:n(()=>[e(N)?(o(),u("span",ys,[s(J,{size:"lg"}),t[19]||(t[19]=a("span",null,"Mise à jour...",-1))])):(o(),u("span",_s,[...t[18]||(t[18]=[a("span",{class:"iconify hugeicons--floppy-disk"},null,-1),a("span",null,"Enregistrer",-1)])]))]),_:1},8,["disabled"])]),_:1})],32)]),_:1})]),_:1},8,["open"])]))],64))])]),_:1})])]),_:1}))}});export{Rs as default};
