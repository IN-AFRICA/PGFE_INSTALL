import{d as te,r as f,v as ae,A as b,s as h,x as F,i as e,K as ie,w as a,f as s,k as v,b as i,L as ne,M as le,N as oe,y as m,O as re,g as ue,c as u,h as q,z as D,j as H,t as $,B as ye,C as ge,D as xe,E as be,F as L,G as U,P as de,o,J as $e,p as Q,a2 as Ee,q as ee,af as Te,aY as ke,R as we,S as he,U as Se,V as Ve,W as Ce,X as Re,Y as Ie,Z as ze}from"./index-CJ_PivE-.js";import{_ as Ae}from"./DashLayout.vue_vue_type_script_setup_true_lang-Ch2egXHm.js";import{_ as Ne}from"./DashPageHeader.vue_vue_type_script_setup_true_lang-DucYyTAx.js";import{_ as Ue}from"./BoxPanelWrapper.vue_vue_type_script_setup_true_lang-CmJ-Iy6y.js";import{_ as Y}from"./Input.vue_vue_type_script_setup_true_lang-B9adgRZV.js";import{_ as Pe}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-Bm461x8Q.js";import{_ as De}from"./SelectGroup.vue_vue_type_script_setup_true_lang-CwIOzTi6.js";import{u as je}from"./usePostApi-Crg8MURP.js";import{e as V}from"./eventBus-CGRXT3Tn.js";import{u as Me,a as se,t as Oe}from"./vee-validate-zod-Bra4yLtR.js";import{z as B}from"./external-CYeExkxg.js";import{u as P}from"./useGetApi-EdzHoZm6.js";import{_ as J}from"./IconifySpinner.vue_vue_type_script_setup_true_lang-C3Td1B5O.js";import{u as Ge}from"./useDeleteApi-D2AjqV8w.js";import{u as qe}from"./usePutApi-BrTvEW5v.js";import{_ as Be}from"./TableRowActions.vue_vue_type_script_setup_true_lang-C8PT7-8D.js";import"./RightDashHeader.vue_vue_type_script_setup_true_lang-Bn3G870_.js";import"./index-BpkKmY4O.js";const Fe={class:"grid gap-4 py-4"},Le={class:"flex flex-col space-y-1.5"},Ye={key:0,class:"text-xs text-red-500"},Je={class:"flex flex-col space-y-1.5 flex-1"},Ke={key:0,class:"text-xs text-red-500"},We={key:1,class:"text-xs text-red-500"},Xe={key:0,class:"flex items-center gap-2"},Ze={key:1,class:"flex items-center gap-2"},He=te({__name:"NewTerritories",setup(me){const{loading:S,error:c,response:C,postData:j,success:y}=je(),p=f(!1),{data:E,loading:g,error:R,fetchData:M}=P(b.GET_PROVINCES);ae(()=>{M()});const O=B.object({name:B.string({required_error:"Veuillez saisir le nom du territoire"}).min(2).max(100),province_id:B.string({required_error:"Veuillez sélectionner une province"}).min(1,"Veuillez sélectionner une province")}),{handleSubmit:G,resetForm:I}=Me({validationSchema:Oe(O)}),{value:x,errorMessage:T}=se("name"),{value:_,errorMessage:z}=se("province_id"),k=G(async w=>{var d;const n={name:w.name.trim(),province_id:Number(w.province_id)};if(await j(b.CREATE_TERRITORY,n),c.value){h({message:c.value,type:"error"});return}y.value&&(V.emit("territoryUpdated"),h({message:((d=C.value)==null?void 0:d.message)||"Territoire ajouté avec succès",type:"success"}),I(),p.value=!1)});return(w,n)=>(o(),F(e(ie),{open:p.value,"onUpdate:open":n[4]||(n[4]=d=>p.value=d)},{default:a(()=>[s(e(Pe),{"as-child":""},{default:a(()=>[s(e(v),{size:"md",class:"rounded-md"},{default:a(()=>[...n[5]||(n[5]=[i("span",{class:"iconify hugeicons--plus-sign"},null,-1),i("span",{class:"hidden sm:flex"}," Nouveau territoire ",-1)])]),_:1})]),_:1}),s(e(ne),{class:"sm:max-w-[540px]"},{default:a(()=>[s(e(le),null,{default:a(()=>[s(e(oe),null,{default:a(()=>[...n[6]||(n[6]=[m("Nouveau territoire",-1)])]),_:1}),s(e(re),null,{default:a(()=>[...n[7]||(n[7]=[m(" Enregistrer un territoire ",-1)])]),_:1})]),_:1}),i("form",{onSubmit:n[3]||(n[3]=ue((...d)=>e(k)&&e(k)(...d),["prevent"]))},[i("div",Fe,[i("div",Le,[s(e(D),{for:"name",class:"text-sm font-medium"},{default:a(()=>[...n[8]||(n[8]=[m(" Nom ",-1)])]),_:1}),s(e(Y),{type:"text",id:"name",name:"name",modelValue:e(x),"onUpdate:modelValue":n[0]||(n[0]=d=>H(x)?x.value=d:null),placeholder:"Entrez le nom du territoire",class:"w-full h-10 border border-gray-200/40 bg-white transition-all",disabled:e(S)||e(g)},null,8,["modelValue","disabled"]),e(T)?(o(),u("span",Ye,$(e(T)),1)):q("",!0)]),i("div",Je,[s(e(D),{for:"province_id",class:"text-sm font-medium"},{default:a(()=>[...n[9]||(n[9]=[m(" Associer à une province ",-1)])]),_:1}),s(e(ye),{id:"province_id",name:"province_id",modelValue:e(_),"onUpdate:modelValue":n[1]||(n[1]=d=>H(_)?_.value=d:null)},{default:a(()=>[s(e(ge),{id:"province_id",class:"h-10 w-full"},{default:a(()=>[s(e(xe),{placeholder:"Sélectionnez une province"})]),_:1}),s(e(be),null,{default:a(()=>[s(e(De),null,{default:a(()=>[(o(!0),u(U,null,L(e(E)||[],d=>(o(),F(e($e),{key:d.id,value:String(d.id)},{default:a(()=>[m($(d.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(z)?(o(),u("span",Ke,$(e(z)),1)):q("",!0),e(R)?(o(),u("span",We,$(e(R)),1)):q("",!0)])]),s(e(de),{class:"flex justify-end gap-2 items-center"},{default:a(()=>[s(e(v),{size:"sm",class:"h-9",variant:"outline",type:"button",onClick:n[2]||(n[2]=()=>{e(I)(),p.value=!1})},{default:a(()=>[...n[10]||(n[10]=[i("span",{class:"iconify flex hugeicons--cancel-01 mr-1"},null,-1),m(" Annuler ",-1)])]),_:1}),s(e(v),{size:"sm",class:"h-9",type:"submit",disabled:e(S)},{default:a(()=>[e(S)?(o(),u("span",Ze,[s(J,{size:"lg"}),n[12]||(n[12]=i("span",null,"Enregistrement en cours...",-1))])):(o(),u("span",Xe,[...n[11]||(n[11]=[i("span",{class:"iconify hugeicons--floppy-disk mr-1"},null,-1),i("span",null,"Enregistrer",-1)])]))]),_:1},8,["disabled"])]),_:1})],32)]),_:1})]),_:1},8,["open"]))}}),Qe={class:"pb-6 mx-auto w-full max-w-7xl"},es={class:"flex flex-col gap-3"},ss={class:"flex items-center gap-3 justify-between"},ts={class:"relative flex-1"},as={class:"flex items-center gap-2"},is={class:"mt-4 flex-1 min-h-0 overflow-auto bg-white rounded-md border border-gray-100"},ns={key:0,class:"p-4 text-sm text-gray-600"},ls={key:1,class:"p-4 text-sm text-red-600"},os={key:0,class:"p-4 text-sm text-gray-600"},rs={key:1,class:"divide-y"},us={class:"flex items-center gap-3"},ds={class:"font-medium"},ms={key:0,class:"flex items-center gap-2"},fs={key:1},cs={class:"grid gap-4 py-4"},ps={class:"flex flex-col space-y-1.5"},_s={class:"flex flex-col space-y-1.5"},vs=["disabled"],ys=["value"],gs={key:0,class:"flex items-center gap-2"},xs={key:1,class:"flex items-center gap-2"},js=te({__name:"Territoires",setup(me){const{putData:S,loading:c,error:C,response:j}=qe(),y=f(!1),p=f(null),E=f(""),g=f(void 0);function R(r){p.value=r.id,E.value=r.name,g.value=r.province_id,y.value=!0,(!k.value||k.value.length===0)&&w()}async function M(){if(!p.value)return;const r={name:E.value.trim()};if(g.value&&(r.province_id=g.value),await S(`${b.GET_TERRITORIES}/${p.value}`,r),C.value){h({message:C.value,type:"error"});return}j.value&&(h({message:"Territoire mis à jour avec succès",type:"success"}),y.value=!1,V.emit("territoryUpdated"))}const O={items:[{label:"Accueil",href:"/",icon:"hugeicons--home-01"},{label:"Administration",href:"/admin"},{label:"Territoire",isActive:!0}]},G=[{name:"pays",text:"Pays",href:"/admin/countries"},{name:"provinces",text:"Provinces",href:"/admin/provinces"},{name:"territoires",text:"Territoires",href:"/admin/territoires"},{name:"communes",text:"Communes",href:"/admin/communes"}],I=Q(()=>"territoires"),x=f(""),T=f(),_=f(),{fetchData:z}=P(b.GET_COUNTRIES),{data:k,fetchData:w}=P(b.GET_PROVINCES),{data:n,loading:d,error:K,fetchData:fe}=P(b.GET_TERRITORIES),{deleteItem:ce,deleting:W,errorDelete:pe}=Ge(),A=f(null);async function _e(r,t){A.value=r,await ce(`${b.GET_TERRITORIES}/${r}`)?(h({message:`Territoire "${t}" supprimé avec succès.`,type:"success"}),V.emit("territoryUpdated")):h({message:pe.value||"Suppression impossible",type:"error"}),A.value=null}ae(()=>{z(),N(),V.on("territoryUpdated",X)}),Ee(()=>{V.off("territoryUpdated",X)});function X(){N()}ee(T,async r=>{_.value=void 0,r&&await w({country_id:r}),N()}),ee(_,()=>{N()});function N(){const r={};_.value?r.province_id=_.value:T.value&&(r.country_id=T.value),fe(r)}const Z=Q(()=>{const r=n.value||[],t=x.value.trim().toLowerCase();return t?r.filter(l=>l.name.toLowerCase().includes(t)):r});return(r,t)=>(o(),F(Ae,{breadcrumb:O,"active-route":"/admin","module-name":"admin"},{default:a(()=>[i("div",Qe,[s(Ne,{title:"Administration",tags:G,"active-tag-name":I.value},null,8,["active-tag-name"]),s(Ue,null,{default:a(()=>[i("div",es,[i("div",ss,[i("div",ts,[s(e(Y),{modelValue:x.value,"onUpdate:modelValue":t[0]||(t[0]=l=>x.value=l),placeholder:"Rechercher un territoire...",class:"w-full max-w-sm ps-10 h-10"},null,8,["modelValue"]),t[5]||(t[5]=i("div",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-foreground-muted/70"},[i("span",{class:"iconify hugeicons--search-01 text-sm"})],-1))]),i("div",as,[s(He)])])]),i("div",is,[e(d)?(o(),u("div",ns,"Chargement...")):e(K)?(o(),u("div",ls,$(e(K)),1)):(o(),u(U,{key:2},[(Z.value||[]).length===0?(o(),u("div",os,"Aucun territoire trouvé.")):(o(),u("ul",rs,[(o(!0),u(U,null,L(Z.value,l=>(o(),u("li",{key:l.id,class:"px-4 py-3 flex items-center justify-between"},[i("div",us,[i("span",ds,$(l.name),1)]),s(Be,null,{actions:a(()=>[s(e(v),{size:"sm",variant:"outline",class:"h-8",onClick:ve=>R(l)},{default:a(()=>[...t[6]||(t[6]=[i("span",{class:"iconify hugeicons--edit-01"},null,-1),i("span",{class:"sr-only"},"Modifier",-1)])]),_:1},8,["onClick"]),s(e(we),null,{default:a(()=>[s(e(he),{"as-child":""},{default:a(()=>[s(e(v),{size:"sm",variant:"destructive",class:"h-8"},{default:a(()=>[...t[7]||(t[7]=[i("span",{class:"iconify hugeicons--delete-02"},null,-1),i("span",{class:"sr-only"},"Supprimer",-1)])]),_:1})]),_:1}),s(e(Se),null,{default:a(()=>[s(e(Ve),null,{default:a(()=>[s(e(Ce),null,{default:a(()=>[...t[8]||(t[8]=[m("Supprimer ce territoire ?",-1)])]),_:1}),s(e(Re),null,{default:a(()=>[...t[9]||(t[9]=[m(" Action irréversible. Si des éléments dépendent de ce territoire, la suppression peut être refusée. ",-1)])]),_:1})]),_:1}),s(e(Ie),null,{default:a(()=>[s(e(ze),null,{default:a(()=>[...t[10]||(t[10]=[m("Annuler",-1)])]),_:1}),s(e(v),{variant:"destructive",disabled:e(W)&&A.value===l.id,onClick:ve=>_e(l.id,l.name)},{default:a(()=>[e(W)&&A.value===l.id?(o(),u("span",ms,[s(J,{size:"sm"}),t[11]||(t[11]=i("span",null,"Suppression...",-1))])):(o(),u("span",fs,"Confirmer"))]),_:2},1032,["disabled","onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]))),128)),s(e(ie),{open:y.value,"onUpdate:open":t[4]||(t[4]=l=>y.value=l)},{default:a(()=>[s(e(ne),{class:"sm:max-w-[480px]"},{default:a(()=>[s(e(le),null,{default:a(()=>[s(e(oe),null,{default:a(()=>[...t[12]||(t[12]=[m("Modifier un Territoire",-1)])]),_:1}),s(e(re),null,{default:a(()=>[...t[13]||(t[13]=[m("Mettre à jour les informations du territoire",-1)])]),_:1})]),_:1}),i("form",{onSubmit:ue(M,["prevent"])},[i("div",cs,[i("div",ps,[s(e(D),{for:"name",class:"text-sm font-medium"},{default:a(()=>[...t[14]||(t[14]=[m("Nom",-1)])]),_:1}),s(e(Y),{id:"name",modelValue:E.value,"onUpdate:modelValue":t[1]||(t[1]=l=>E.value=l),class:"h-10",disabled:e(c),required:""},null,8,["modelValue","disabled"])]),i("div",_s,[s(e(D),{for:"province",class:"text-sm font-medium"},{default:a(()=>[...t[15]||(t[15]=[m("Province",-1)])]),_:1}),Te(i("select",{id:"province","onUpdate:modelValue":t[2]||(t[2]=l=>g.value=l),class:"h-10 border rounded-md px-3",disabled:e(c)},[t[16]||(t[16]=i("option",{value:void 0},"-- Sélectionnez une province --",-1)),(o(!0),u(U,null,L(e(k)||[],l=>(o(),u("option",{key:l.id,value:l.id},$(l.name),9,ys))),128))],8,vs),[[ke,g.value,void 0,{number:!0}]])])]),s(e(de),{class:"flex justify-end gap-2 items-center"},{default:a(()=>[s(e(v),{size:"sm",class:"h-9",variant:"outline",type:"button",disabled:e(c),onClick:t[3]||(t[3]=l=>y.value=!1)},{default:a(()=>[...t[17]||(t[17]=[m("Annuler",-1)])]),_:1},8,["disabled"]),s(e(v),{size:"sm",class:"h-9",type:"submit",disabled:e(c)},{default:a(()=>[e(c)?(o(),u("span",xs,[s(J,{size:"lg"}),t[19]||(t[19]=i("span",null,"Mise à jour...",-1))])):(o(),u("span",gs,[...t[18]||(t[18]=[i("span",{class:"iconify hugeicons--floppy-disk"},null,-1),i("span",null,"Enregistrer",-1)])]))]),_:1},8,["disabled"])]),_:1})],32)]),_:1})]),_:1},8,["open"])]))],64))])]),_:1})])]),_:1}))}});export{js as default};
