import{_ as Ae}from"./LayoutGestionDisciplinaire.vue_vue_type_script_setup_true_lang-skQCPo4l.js";import{d as pe,c as R,b as i,f as a,h as ge,i as s,H as ce,o as v,r as me,p as u,q as ke,A,v as fe,a3 as Ve,n as Ee,x as te,w as n,j as De,k as P,$ as Ie,y as d,F as Te,G as Be,t as k,R as ze,S as Re,U as Ue,V as Oe,W as Fe,X as Ge,Y as Le,Z as Me,s as se}from"./index-CJ_PivE-.js";import{_ as Pe}from"./Input.vue_vue_type_script_setup_true_lang-B9adgRZV.js";import{a as qe,b as Qe,_ as je}from"./PopoverTrigger.vue_vue_type_script_setup_true_lang-DzZWQSaq.js";import{_ as He}from"./FilterBadges.vue_vue_type_script_setup_true_lang-CBuiPNtr.js";import{_ as Ye}from"./ListClassRoom.vue_vue_type_script_setup_true_lang-crHdkUu0.js";import{_ as Je}from"./ListSchoolYear.vue_vue_type_script_setup_true_lang-FGtf-Ajw.js";import{a as We,b as ae,c as S,d as Xe,e as b,_ as Ze}from"./TableHeader.vue_vue_type_script_setup_true_lang-cS4zBTGx.js";import{_ as _e}from"./Checkbox.vue_vue_type_script_setup_true_lang-DTckireD.js";import{u as z}from"./useGetApi-EdzHoZm6.js";import{u as Ke}from"./useDeleteApi-D2AjqV8w.js";import{e as ne}from"./eventBus-CGRXT3Tn.js";import{_ as et}from"./AlertDialogAction.vue_vue_type_script_setup_true_lang-DdUVYLnm.js";import"./LayoutSaisieOperation.vue_vue_type_script_setup_true_lang-bYPLg6Nt.js";import"./DashLayoutWithMode.vue_vue_type_script_setup_true_lang-DzpyZ4TL.js";import"./RightDashHeader.vue_vue_type_script_setup_true_lang-Bn3G870_.js";import"./DashPageHeader.vue_vue_type_script_setup_true_lang-DucYyTAx.js";import"./BoxPanelWrapper.vue_vue_type_script_setup_true_lang-CmJ-Iy6y.js";import"./index-BpkKmY4O.js";import"./SelectGroup.vue_vue_type_script_setup_true_lang-CwIOzTi6.js";import"./RovingFocusGroup-BxePylpC.js";const tt={class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-foreground-muted/70"},st={key:0,class:"flex iconify hugeicons--search-01 text-sm"},at={key:1,class:"flex iconify hugeicons--loading-03 text-sm animate-spin"},nt=pe({__name:"SearchInput",props:{modelValue:{type:String,default:""},placeholder:{type:String,default:"Rechercher..."},id:{type:String,default:"search"},name:{type:String,default:"search"},isSearching:{type:Boolean,default:!1},showClear:{type:Boolean,default:!0},wrapperClass:{type:String,default:"w-full max-w-xs"},inputClass:{type:String,default:""}},emits:["update:modelValue","clear"],setup(c){return(y,_)=>(v(),R("div",{class:ce(["relative",c.wrapperClass])},[i("div",tt,[c.isSearching?(v(),R("span",at)):(v(),R("span",st))]),a(s(Pe),{type:"text",id:c.id,name:c.name,placeholder:c.placeholder,"model-value":c.modelValue,"onUpdate:modelValue":_[0]||(_[0]=m=>y.$emit("update:modelValue",m)),class:ce(["w-full ps-10 border border-gray-200/40 bg-white transition-all h-10 rounded-md",c.inputClass])},null,8,["id","name","placeholder","model-value","class"]),c.modelValue&&c.showClear?(v(),R("button",{key:0,type:"button",class:"absolute right-3 top-1/2 transform -translate-y-1/2 text-foreground-muted/70 hover:text-foreground-muted transition-colors",onClick:_[1]||(_[1]=m=>y.$emit("clear"))},[..._[2]||(_[2]=[i("span",{class:"flex iconify hugeicons--cancel-01 text-sm"},null,-1)])])):ge("",!0)],2))}});function rt(c){const{data:y,searchableFields:_,mode:m="local",debounceMs:q=300,onBackendSearch:V,caseSensitive:U=!1,minQueryLength:E=1}=c,D=me(""),w=me(!1);let O=null;const x=r=>r==null?"":typeof r=="object"?r.name?String(r.name):r.label?String(r.label):JSON.stringify(r):String(r),Q=(r,p)=>{const h=U?p:p.toLowerCase();return _&&_.length>0?_.some(I=>{const N=x(r[I]);return(U?N:N.toLowerCase()).includes(h)}):Object.values(r).some(I=>(U?x(I):x(I).toLowerCase()).includes(h))},C=u(()=>{const r=y.value;if(!r||!Array.isArray(r))return[];const p=D.value.trim();return!p||p.length<E||m==="backend"?r:r.filter(h=>Q(h,p))}),F=u(()=>C.value.length>0),j=u(()=>C.value.length),$=r=>{V&&(m==="backend"||m==="hybrid")&&(w.value=!0,Promise.resolve(V(r)).finally(()=>{w.value=!1}))};return ke(D,r=>{O&&clearTimeout(O);const p=r.trim();(m==="backend"||m==="hybrid")&&(p.length>=E||p.length===0)&&(O=setTimeout(()=>{$(p)},q))}),{query:D,filteredData:C,isSearching:w,clearSearch:()=>{D.value="",(m==="backend"||m==="hybrid")&&$("")},hasResults:F,resultCount:j}}function lt(c,y){return rt({data:c,searchableFields:y,mode:"local",debounceMs:150})}const it={class:"flex flex-col md:flex-row gap-3 md:items-center md:justify-between"},ot={class:"flex flex-1 items-center gap-2"},dt={class:"grid gap-4"},ut={class:"flex flex-col gap-3.5"},ct={class:"flex flex-wrap items-center gap-2.5"},mt={class:"mt-4 rounded-md overflow-hidden flex flex-1 bg-white"},ft={class:"flex items-center gap-2 w-max"},_t={class:"hidden group-hover:flex items-center gap-2"},pt={key:0,class:"text-red-500 text-xs mt-1"},Ut=pe({__name:"NoteConduite",setup(c){const{data:y,fetchData:_}=z(A.GET_FILLIERES),{data:m,fetchData:q}=z(A.GET_CLASSROOMS),{data:V,fetchData:U}=z(A.GET_STUDENTS),{data:E,fetchData:D}=z(A.GET_SCHOOL_YEARS),{data:w,fetchData:O}=z(A.GET_CONDUITE),{data:x,loading:Q,fetchData:C}=z(A.GET_NOTE_CONDUITES);fe(async()=>{await D(),await Promise.all([_(),q(),U(),C(),O()])}),fe(()=>{ne.on("noteConduiteUpdated",async()=>{console.log("Event noteConduiteUpdated reçu - rechargement des données..."),await C(),console.log("Données rechargées avec succès")})}),Ve(()=>{ne.off("noteConduiteUpdated")});const F=u(()=>{var t;const e=y==null?void 0:y.value;return Array.isArray(e)?e:((t=e==null?void 0:e.filiaires)==null?void 0:t.data)??(e==null?void 0:e.data)??[]}),j=u(()=>new Map(((F==null?void 0:F.value)??[]).map(e=>[Number(e.id),e]))),$=u(()=>{var t;const e=m==null?void 0:m.value;return Array.isArray(e)?e:((t=e==null?void 0:e.classrooms)==null?void 0:t.data)??(e==null?void 0:e.data)??[]}),re=u(()=>new Map((($==null?void 0:$.value)??[]).map(e=>[Number(e.id),e]))),r=u(()=>{var t;const e=V==null?void 0:V.value;return Array.isArray(e)?e:((t=e==null?void 0:e.students)==null?void 0:t.data)??[]}),p=u(()=>new Map(((r==null?void 0:r.value)??[]).map(e=>[Number(e.id),e]))),h=u(()=>{const e=E==null?void 0:E.value;return Array.isArray(e)?e:(e==null?void 0:e.years)??[]}),I=u(()=>{const e=(h==null?void 0:h.value)??[];return new Map(e.map(t=>[Number(t.id),t]))}),N=u(()=>{var t;const e=w==null?void 0:w.value;return Array.isArray(e)?e:((t=e==null?void 0:e.conduites)==null?void 0:t.data)??(e==null?void 0:e.data)??[]}),H=u(()=>new Map(((N==null?void 0:N.value)??[]).map(e=>[Number(e.id),e]))),G=e=>e?e.name??e.label??e.libelle??e.title??(typeof e=="string"?e:""):"",{deleteItem:ye,deleting:le,errorDelete:L}=Ke(),he=async(e,t)=>{const f=typeof e=="string"?Number(e):e;if(!Number.isInteger(f)||f<=0){se({message:"ID invalide: un entier positif est requis",type:"error"});return}const l=A.DELETE_NOTE_CONDUITE(f);await ye(l),await new Promise(T=>setTimeout(T,100)),L.value?se({message:L.value||"Erreur lors de la suppression",type:"error"}):(await C(),se({message:`Note de conduite "${t||f}" supprimée avec succès`,type:"success"})(ne).emit("noteConduiteUpdated"))},be=u(()=>{var T,M,ie,oe,de,ue;const e=x==null?void 0:x.value,f=Array.isArray(e)?e:Array.isArray(e==null?void 0:e.data)?e==null?void 0:e.data:Array.isArray((T=e==null?void 0:e.data)==null?void 0:T.data)?(M=e==null?void 0:e.data)==null?void 0:M.data:[],l=[];for(const o of f){const J=I.value.get(Number(o.school_year_id)),W=j.value.get(Number(o.filiere_id)),X=re.value.get(Number(o.classroom_id)),Z=p.value.get(Number(o.student_id)),B=o,K=o.id??o.conduiteGradeId??o.conduite_grade_id,ee=K?Number(K):null,Ne={id:Number.isFinite(ee)&&ee>0?ee:null,originalIdRaw:K,school_year_id:o.school_year_id,filiere_id:o.filiere_id,classroom_id:o.classroom_id,student_id:o.student_id,conduite_semester_1_id:o.conduite_semester_1_id,conduite_semester_2_id:o.conduite_semester_2_id,anneeScolaire:((ie=B.school_year)==null?void 0:ie.name)??(J==null?void 0:J.name)??String(o.school_year_id),filiere:((oe=B.filiere)==null?void 0:oe.name)??(W==null?void 0:W.name)??String(o.filiere_id),classe:((de=B.classroom)==null?void 0:de.name)??(X==null?void 0:X.name)??String(o.classroom_id),apprenant:((ue=B.student)==null?void 0:ue.name)??(Z?`${Z.name??""} ${Z.firstname??""}`.trim():String(o.student_id)),numeroFauteCommisse:Number(o.fault_count),conduiteSemestre1:G(H.value.get(Number(o.conduite_semester_1_id)))||G(B.conduite_semester_1)||String(o.conduite_semester_1_id??""),conduiteSemestre2:G(H.value.get(Number(o.conduite_semester_2_id)))||G(B.conduite_semester_2)||String(o.conduite_semester_2_id??"")};l.push(Ne)}return l}),g=Ee({classroom_id:void 0,school_year_id:void 0}),ve=u(()=>({classroom_id:$.value||[],school_year_id:h.value||[]})),Se={classroom_id:(e,t)=>{const f=t==null?void 0:t.find(l=>l.id===e);return f?f.name:e},school_year_id:(e,t)=>{const f=t==null?void 0:t.find(l=>l.id===e);return f?f.name:e}},we=e=>{e==="classroom_id"&&(g.classroom_id=void 0),e==="school_year_id"&&(g.school_year_id=void 0)},xe=u(()=>{let e=be.value;return g.classroom_id&&(e=e.filter(t=>Number(t.classroom_id)===Number(g.classroom_id))),g.school_year_id&&(e=e.filter(t=>Number(t.school_year_id)===Number(g.school_year_id))),e}),{query:Y,filteredData:Ce,clearSearch:$e}=lt(xe,["anneeScolaire","filiere","classe","apprenant","conduiteSemestre1","conduiteSemestre2"]);return(e,t)=>{const f=Ie("RouterLink");return v(),te(Ae,{"active-tag-name":"note-conduite",breadcrumb:[{label:"Élèves",href:"/apprenants"},{label:"Opérations",href:"/apprenants/operations"},{label:"Gestion Disciplinaire",href:"/apprenants/operations/gestion-disciplinaire"},{label:"Notes de Conduite",href:"/apprenants/operations/gestion-disciplinaire/note-conduite"}]},{default:n(()=>[i("div",it,[i("div",ot,[a(nt,{modelValue:s(Y),"onUpdate:modelValue":t[0]||(t[0]=l=>De(Y)?Y.value=l:null),placeholder:"Rechercher (année, section, classe, élève...)","wrapper-class":"w-full max-w-xs",onClear:s($e)},null,8,["modelValue","onClear"]),a(s(je),null,{default:n(()=>[a(s(qe),{"as-child":""},{default:n(()=>[a(s(P),{variant:"ghost",size:"sm",class:"h-9 rounded-md border bg-white"},{default:n(()=>[...t[3]||(t[3]=[i("span",{class:"hidden sm:flex"},"Filtre",-1),i("span",{class:"iconify hugeicons--filter"},null,-1)])]),_:1})]),_:1}),a(s(Qe),{class:"w-80"},{default:n(()=>[i("div",dt,[t[4]||(t[4]=i("div",{class:"space-y-2"},[i("h4",{class:"font-medium leading-none"},"Filtrage")],-1)),i("div",ut,[a(Ye,{modelValue:g.classroom_id,"onUpdate:modelValue":t[1]||(t[1]=l=>g.classroom_id=l)},null,8,["modelValue"]),a(Je,{modelValue:g.school_year_id,"onUpdate:modelValue":t[2]||(t[2]=l=>g.school_year_id=l)},null,8,["modelValue"])])])]),_:1})]),_:1}),a(He,{filters:g,"reference-data":ve.value,"custom-labels":Se,onRemoveFilter:we},null,8,["filters","reference-data"])]),i("div",ct,[a(s(P),{size:"md",class:"rounded-md","as-child":""},{default:n(()=>[a(f,{to:"/apprenants/operations/gestion-disciplinaire/note"},{default:n(()=>[...t[5]||(t[5]=[i("span",{class:"flex iconify hugeicons--plus-sign"},null,-1),i("span",{class:"hidden sm:flex"},"Ajouter Note",-1)])]),_:1})]),_:1})])]),i("div",mt,[a(s(Ze),{class:"rounded-md bg-white"},{default:n(()=>[a(s(We),null,{default:n(()=>[a(s(ae),null,{default:n(()=>[a(s(S),{class:"w-[20px]"},{default:n(()=>[a(s(_e),{class:"bg-white scale-70"})]),_:1}),a(s(S),null,{default:n(()=>[...t[6]||(t[6]=[d("Année scolaire",-1)])]),_:1}),a(s(S),null,{default:n(()=>[...t[7]||(t[7]=[d("Section",-1)])]),_:1}),a(s(S),null,{default:n(()=>[...t[8]||(t[8]=[d("Classe",-1)])]),_:1}),a(s(S),null,{default:n(()=>[...t[9]||(t[9]=[d("Élève",-1)])]),_:1}),a(s(S),null,{default:n(()=>[...t[10]||(t[10]=[d("Conduite-semestre 1",-1)])]),_:1}),a(s(S),null,{default:n(()=>[...t[11]||(t[11]=[d("Conduite-semestre 2",-1)])]),_:1}),a(s(S))]),_:1})]),_:1}),a(s(Xe),null,{default:n(()=>[s(Q)?(v(),te(s(ae),{key:0},{default:n(()=>[a(s(b),{colspan:9,class:"text-center py-10"},{default:n(()=>[...t[12]||(t[12]=[i("div",{class:"flex flex-col items-center justify-center text-gray-500"},[i("svg",{class:"animate-spin h-6 w-6 text-gray-400 mb-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[i("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),i("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8z"})]),i("span",null,"Chargement des notes de conduite...")],-1)])]),_:1})]),_:1})):(v(!0),R(Be,{key:1},Te(s(Ce),(l,T)=>(v(),te(s(ae),{key:l.id+"-"+T,class:"group hover:bg-gray-50"},{default:n(()=>[a(s(b),{class:"w-[40px]"},{default:n(()=>[a(s(_e),{class:"bg-white scale-70"})]),_:1}),a(s(b),null,{default:n(()=>[d(k(l.anneeScolaire),1)]),_:2},1024),a(s(b),null,{default:n(()=>[d(k(l.filiere),1)]),_:2},1024),a(s(b),null,{default:n(()=>[d(k(l.classe),1)]),_:2},1024),a(s(b),null,{default:n(()=>[d(k(l.apprenant),1)]),_:2},1024),a(s(b),null,{default:n(()=>[d(k(l.conduiteSemestre1),1)]),_:2},1024),a(s(b),null,{default:n(()=>[d(k(l.conduiteSemestre2),1)]),_:2},1024),a(s(b),null,{default:n(()=>[i("div",ft,[t[19]||(t[19]=i("button",{class:"flex group-hover:hidden rounded-full size-8 items-center justify-center hover:bg-gray-100 transition","aria-label":"Plus d'actions"},[i("span",{class:"iconify hugeicons--more-vertical-circle-01","aria-hidden":"true"})],-1)),i("div",_t,[a(s(P),{variant:"ghost",size:"icon",class:"size-8 justify-center text-gray-500 hover:text-blue-600 hover:bg-blue-50",onClick:M=>e.$router.push(`/apprenants/operations/gestion-disciplinaire/note-conduite/edit/${l.id}`)},{default:n(()=>[...t[13]||(t[13]=[i("span",{class:"iconify hugeicons--edit-02"},null,-1)])]),_:1},8,["onClick"]),a(s(ze),null,{default:n(()=>[a(s(Re),{"as-child":""},{default:n(()=>[a(s(P),{title:"Supprimer cette note de conduite",disabled:s(le),variant:"ghost",size:"icon",class:"size-8 justify-center text-gray-500 hover:text-red-600 hover:bg-red-50","aria-label":"Supprimer"},{default:n(()=>[...t[14]||(t[14]=[i("span",{class:"iconify hugeicons--delete-02","aria-hidden":"true"},null,-1)])]),_:1},8,["disabled"])]),_:1}),a(s(Ue),null,{default:n(()=>[a(s(Oe),null,{default:n(()=>[a(s(Fe),null,{default:n(()=>[...t[15]||(t[15]=[d("Supprimer cette note de conduite ?",-1)])]),_:1}),a(s(Ge),null,{default:n(()=>[...t[16]||(t[16]=[d(" Cette action est irréversible. ",-1)])]),_:1})]),_:1}),a(s(Le),null,{default:n(()=>[a(s(Me),null,{default:n(()=>[...t[17]||(t[17]=[d("Annuler",-1)])]),_:1}),a(s(et),{disabled:s(le),onClick:M=>he(Number(l.id??l.originalIdRaw),l.apprenant)},{default:n(()=>[...t[18]||(t[18]=[d(" Confirmer ",-1)])]),_:1},8,["disabled","onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)])]),s(L)?(v(),R("div",pt,k(s(L)),1)):ge("",!0)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})])]),_:1})}}});export{Ut as default};
