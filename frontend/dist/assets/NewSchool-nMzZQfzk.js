import{d as M,r as Y,p as N,v as h,x as j,w as d,b as n,f as t,i as a,z as r,y as u,af as T,aY as w,c,F as C,G as q,k as A,g as H,a as W,A as _,o as f,t as P,s as V}from"./index-CJ_PivE-.js";import{_ as J}from"./DashFormLayout.vue_vue_type_script_setup_true_lang-3V-LyRCQ.js";import{_ as K}from"./FormSection.vue_vue_type_script_setup_true_lang-C-XSdIg3.js";import{I as m}from"./InputWrapper-tSRHzcjN.js";import{S as y}from"./SpanRequired-COKghTUX.js";import{_ as v}from"./Input.vue_vue_type_script_setup_true_lang-B9adgRZV.js";import{_ as Q}from"./IconifySpinner.vue_vue_type_script_setup_true_lang-C3Td1B5O.js";import{u as X}from"./usePostApi-Crg8MURP.js";import{u as D}from"./useGetApi-EdzHoZm6.js";import{e as Z}from"./eventBus-CGRXT3Tn.js";import"./DashLayout.vue_vue_type_script_setup_true_lang-Ch2egXHm.js";import"./RightDashHeader.vue_vue_type_script_setup_true_lang-Bn3G870_.js";import"./FormPageHeader.vue_vue_type_script_setup_true_lang-CAg7Z6LS.js";import"./BoxPanelWrapper.vue_vue_type_script_setup_true_lang-CmJ-Iy6y.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-BpkKmY4O.js";const ee=["disabled"],le=["value"],te=["disabled"],ae=["value"],oe=["disabled"],de={class:"flex justify-end gap-4"},ie={key:0,class:"flex items-center gap-2"},se={key:1,class:"flex items-center gap-2"},Ue=M({__name:"NewSchool",setup(ne){const x=W(),l=Y({name:"",province_id:void 0,country_id:void 0,city:"",address:"",type_id:void 0,latitude:"0",longitude:"0",phone_number:"",email:"",logo:null}),{data:b,fetchData:I}=D(_.GET_PROVINCES),{data:$,fetchData:B}=D(_.GET_TYPES),{postData:G,loading:i,error:S,response:L}=X(),k=N(()=>!l.value.province_id||!b.value?null:b.value.find(p=>p.id===l.value.province_id)),z=N(()=>k.value?Number(k.value.country_id):void 0);h(()=>{I(),B()});function F(p){var g;const o=(g=p.target.files)==null?void 0:g[0];l.value.logo=o||null}function O(){x.push("/admin/ecoles")}async function R(){const p=(l.value.name||"").trim(),e=(l.value.city||"").trim(),o=(l.value.address||"").trim(),g=l.value.type_id||void 0;if(!p||!l.value.province_id||!e||!o||!g){V({message:"Nom, province, type, ville et adresse sont requis",type:"error"});return}const s=new FormData;s.append("name",p),s.append("province_id",String(l.value.province_id)),s.append("country_id",String(z.value)),s.append("city",e),s.append("address",o),s.append("type_id",String(g)),l.value.latitude!==""&&l.value.latitude!=null&&s.append("latitude",String(l.value.latitude)),l.value.longitude!==""&&l.value.longitude!=null&&s.append("longitude",String(l.value.longitude));const E=(l.value.phone_number||"").trim();E&&s.append("phone_number",E);const U=(l.value.email||"").trim();if(U&&s.append("email",U),l.value.logo&&s.append("logo",l.value.logo),await G(_.GET_SCHOOLS,s),S.value){V({message:S.value||"Erreur lors de la création",type:"error"});return}L.value&&(V({message:"École créée avec succès",type:"success"}),Z.emit("schoolUpdated"),x.push("/admin/ecoles"))}return(p,e)=>(f(),j(J,{"link-back":"/admin/ecoles",title:"Nouvelle École","group-route":"/admin/ecoles",module:"admin",breadcrumb:[{label:"Administration",href:"/admin"},{label:"Écoles",href:"/admin/ecoles"},{label:"Nouvelle École",href:"#"}]},{default:d(()=>[n("form",{class:"w-full flex flex-col space-y-8",onSubmit:H(R,["prevent"])},[t(K,{title:"Informations de l'école",class:"grid sm:grid-cols-2 lg:grid-cols-3 gap-y-6 gap-x-10"},{default:d(()=>[t(m,null,{default:d(()=>[t(a(r),{for:"name",class:"text-sm font-medium"},{default:d(()=>[e[9]||(e[9]=u(" Nom de l'école ",-1)),t(y)]),_:1}),t(a(v),{id:"name",modelValue:l.value.name,"onUpdate:modelValue":e[0]||(e[0]=o=>l.value.name=o),class:"h-10",required:"",disabled:a(i)},null,8,["modelValue","disabled"])]),_:1}),t(m,null,{default:d(()=>[t(a(r),{for:"province",class:"text-sm font-medium"},{default:d(()=>[e[10]||(e[10]=u(" Province ",-1)),t(y)]),_:1}),T(n("select",{id:"province","onUpdate:modelValue":e[1]||(e[1]=o=>l.value.province_id=o),class:"h-10 border rounded-md px-3",required:"",disabled:a(i)},[e[11]||(e[11]=n("option",{value:void 0},"-- Sélectionnez une province --",-1)),(f(!0),c(q,null,C(a(b)||[],o=>(f(),c("option",{key:o.id,value:o.id},P(o.name),9,le))),128))],8,ee),[[w,l.value.province_id,void 0,{number:!0}]])]),_:1}),t(m,null,{default:d(()=>[t(a(r),{for:"type",class:"text-sm font-medium"},{default:d(()=>[e[12]||(e[12]=u(" Type ",-1)),t(y)]),_:1}),T(n("select",{id:"type","onUpdate:modelValue":e[2]||(e[2]=o=>l.value.type_id=o),class:"h-10 border rounded-md px-3",required:"",disabled:a(i)},[e[13]||(e[13]=n("option",{value:void 0},"-- Sélectionnez un type --",-1)),(f(!0),c(q,null,C(a($)||[],o=>(f(),c("option",{key:o.id,value:o.id},P(o.title),9,ae))),128))],8,te),[[w,l.value.type_id,void 0,{number:!0}]])]),_:1}),t(m,null,{default:d(()=>[t(a(r),{for:"city",class:"text-sm font-medium"},{default:d(()=>[e[14]||(e[14]=u(" Ville ",-1)),t(y)]),_:1}),t(a(v),{id:"city",modelValue:l.value.city,"onUpdate:modelValue":e[3]||(e[3]=o=>l.value.city=o),class:"h-10",required:"",disabled:a(i)},null,8,["modelValue","disabled"])]),_:1}),t(m,null,{default:d(()=>[t(a(r),{for:"address",class:"text-sm font-medium"},{default:d(()=>[e[15]||(e[15]=u(" Adresse ",-1)),t(y)]),_:1}),t(a(v),{id:"address",modelValue:l.value.address,"onUpdate:modelValue":e[4]||(e[4]=o=>l.value.address=o),class:"h-10",required:"",disabled:a(i)},null,8,["modelValue","disabled"])]),_:1}),t(m,null,{default:d(()=>[t(a(r),{for:"latitude",class:"text-sm font-medium"},{default:d(()=>[...e[16]||(e[16]=[u("Latitude",-1)])]),_:1}),t(a(v),{id:"latitude",modelValue:l.value.latitude,"onUpdate:modelValue":e[5]||(e[5]=o=>l.value.latitude=o),class:"h-10",type:"number",step:"any",disabled:a(i)},null,8,["modelValue","disabled"])]),_:1}),t(m,null,{default:d(()=>[t(a(r),{for:"longitude",class:"text-sm font-medium"},{default:d(()=>[...e[17]||(e[17]=[u("Longitude",-1)])]),_:1}),t(a(v),{id:"longitude",modelValue:l.value.longitude,"onUpdate:modelValue":e[6]||(e[6]=o=>l.value.longitude=o),class:"h-10",type:"number",step:"any",disabled:a(i)},null,8,["modelValue","disabled"])]),_:1}),t(m,null,{default:d(()=>[t(a(r),{for:"phone",class:"text-sm font-medium"},{default:d(()=>[...e[18]||(e[18]=[u("Téléphone",-1)])]),_:1}),t(a(v),{id:"phone",modelValue:l.value.phone_number,"onUpdate:modelValue":e[7]||(e[7]=o=>l.value.phone_number=o),class:"h-10",disabled:a(i)},null,8,["modelValue","disabled"])]),_:1}),t(m,null,{default:d(()=>[t(a(r),{for:"email",class:"text-sm font-medium"},{default:d(()=>[...e[19]||(e[19]=[u("Email",-1)])]),_:1}),t(a(v),{id:"email",modelValue:l.value.email,"onUpdate:modelValue":e[8]||(e[8]=o=>l.value.email=o),type:"email",class:"h-10",disabled:a(i)},null,8,["modelValue","disabled"])]),_:1}),t(m,{class:"sm:col-span-2 lg:col-span-3"},{default:d(()=>[t(a(r),{for:"logo",class:"text-sm font-medium"},{default:d(()=>[...e[20]||(e[20]=[u("Logo (image)",-1)])]),_:1}),n("input",{id:"logo",type:"file",accept:"image/*",class:"h-10",disabled:a(i),onChange:F},null,40,oe)]),_:1})]),_:1}),n("div",de,[t(a(A),{type:"button",variant:"outline",onClick:O,disabled:a(i)},{default:d(()=>[...e[21]||(e[21]=[n("span",{class:"iconify hugeicons--cancel-01"},null,-1),u(" Annuler ",-1)])]),_:1},8,["disabled"]),t(a(A),{type:"submit",disabled:a(i)},{default:d(()=>[a(i)?(f(),c("span",se,[t(Q,{size:"lg"}),e[23]||(e[23]=n("span",null,"Enregistrement...",-1))])):(f(),c("span",ie,[...e[22]||(e[22]=[n("span",{class:"iconify hugeicons--floppy-disk"},null,-1),n("span",null,"Enregistrer",-1)])]))]),_:1},8,["disabled"])])],32)]),_:1}))}});export{Ue as default};
