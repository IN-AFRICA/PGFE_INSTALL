import{d as Se,r as A,A as y,p as f,q as B,v as we,x as p,w as t,f as r,b as u,i as a,k as Ae,y as o,z as k,B as G,C as L,D as I,E as O,c as D,F as N,G as M,t as m,s as b,o as i,J as P}from"./index-CJ_PivE-.js";import{_ as be}from"./Input.vue_vue_type_script_setup_true_lang-B9adgRZV.js";import{_ as Ce,a as $e,b as C,c as E,d as Re,e as _}from"./TableHeader.vue_vue_type_script_setup_true_lang-cS4zBTGx.js";import{_ as W}from"./Checkbox.vue_vue_type_script_setup_true_lang-DTckireD.js";import{_ as Te,a as Ve,b as De}from"./PopoverTrigger.vue_vue_type_script_setup_true_lang-DzZWQSaq.js";import{_ as U}from"./SelectGroup.vue_vue_type_script_setup_true_lang-CwIOzTi6.js";import{_ as Ne}from"./LayoutSaisieOperation.vue_vue_type_script_setup_true_lang-bYPLg6Nt.js";import{_ as Me}from"./BoxPanelWrapper.vue_vue_type_script_setup_true_lang-CmJ-Iy6y.js";import{_ as Fe}from"./FilterBadges.vue_vue_type_script_setup_true_lang-CBuiPNtr.js";import{E as ke}from"./ExcelManagerWithAPI-DFtMVkSy.js";import{u as $}from"./useGetApi-EdzHoZm6.js";import{e as Ge}from"./eventBus-CGRXT3Tn.js";import"./index-BpkKmY4O.js";import"./RovingFocusGroup-BxePylpC.js";import"./DashLayoutWithMode.vue_vue_type_script_setup_true_lang-DzpyZ4TL.js";import"./RightDashHeader.vue_vue_type_script_setup_true_lang-Bn3G870_.js";import"./DashPageHeader.vue_vue_type_script_setup_true_lang-DucYyTAx.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-DN4DQrTt.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Le={class:"flex items-center gap-3 justify-between"},Ie={class:"flex flex-1 items-center gap-2"},Oe={class:"relative w-full max-w-xs"},Pe={class:"grid gap-4"},Ue={class:"flex flex-col gap-3.5"},Be={class:"space-y-1.5"},ze={class:"space-y-1.5"},He={class:"space-y-1.5"},Ye={class:"space-y-1.5"},je={class:"flex flex-wrap items-center gap-2.5"},qe={class:"mt-4 rounded-md overflow-hidden flex flex-1 bg-white"},_a=Se({__name:"ListeRepechage",setup(Je){const R=A(""),T=A(""),g=A(""),d=A(""),c=A(""),{data:z,loading:X,error:H,fetchData:K}=$(y.GET_REPECHAGES),{data:S,fetchData:Z}=$(y.GET_SCHOOL_YEARS),{data:h,fetchData:ee}=$(y.GET_CLASSROOMS),{data:x,fetchData:ae}=$(y.GET_COURSES),{data:V,fetchData:le}=$(y.GET_FILLIERES),{data:F,fetchData:se}=$(`${y.GET_STUDENTS}?per_page=1000`),te=f(()=>{var e,s,n;const l=new Map;if(F.value){const v=((s=(e=F.value)==null?void 0:e.students)==null?void 0:s.data)||((n=F.value)==null?void 0:n.data)||F.value;Array.isArray(v)&&v.forEach(w=>l.set(w.id,w))}return l}),re=f(()=>{const l=new Map;return h.value&&Array.isArray(h.value)&&h.value.forEach(e=>l.set(e.id,e)),l}),oe=f(()=>{const l=new Map;return x.value&&Array.isArray(x.value)&&x.value.forEach(e=>l.set(e.id,e)),l}),Y=f(()=>{const l=new Map;return V.value&&Array.isArray(V.value)&&V.value.forEach(e=>l.set(e.id,e)),l}),j=f(()=>{var s,n;const l=new Map,e=((s=S.value)==null?void 0:s.years)||((n=S.value)==null?void 0:n.data)||S.value;return Array.isArray(e)&&e.forEach(v=>l.set(v.id,v)),l}),q=async()=>{if(!d.value||!c.value)return;const l={classroom_id:d.value,course_id:c.value};await K(l)},ne=f(()=>z.value?z.value.map(l=>{const e=te.value.get(Number(l.student_id)),s=re.value.get(Number(l.classroom_id)),n=oe.value.get(Number(l.course_id)),v=j.value.get(Number(l.school_year_id)),w=s?Y.value.get(Number(s.filiaire_id)):null;return{...l,student_name:(e==null?void 0:e.name)||"N/A",classroom_name:(s==null?void 0:s.name)||"N/A",course_name:(n==null?void 0:n.label)||"N/A",school_year_name:(v==null?void 0:v.name)||"N/A",filiere_name:(w==null?void 0:w.name)||"N/A"}}):[]),J=f(()=>{let l=ne.value;if(R.value){const e=R.value.toLowerCase();l=l.filter(s=>s.student_name.toLowerCase().includes(e)||s.course_name.toLowerCase().includes(e))}return l}),ue=f(()=>!x.value||!d.value?[]:x.value.filter(l=>String(l.classroom_id)===String(d.value))),ie=f(()=>h.value?g.value?h.value.filter(l=>String(l.filiaire_id)===String(g.value)):h.value:[]);B([d,c],()=>{d.value&&c.value&&q()}),B(d,(l,e)=>{e!==void 0&&l!==e&&(c.value="")}),B(g,(l,e)=>{e!==void 0&&l!==e&&(d.value="",c.value="")}),we(async()=>{await Promise.all([Z(),ee(),ae(),le(),se()])});const de=f(()=>({school_year_id:T.value||void 0,filiaire_id:g.value||void 0,classroom_id:d.value||void 0,course_id:c.value||void 0})),ce=f(()=>{var l,e;return{school_year_id:((l=S.value)==null?void 0:l.years)||((e=S.value)==null?void 0:e.data)||S.value||[],filiaire_id:Array.isArray(V.value)?V.value:[],classroom_id:Array.isArray(h.value)?h.value:[],course_id:Array.isArray(x.value)?x.value:[]}}),fe={school_year_id:(l,e)=>{const s=e==null?void 0:e.find(n=>String(n.id)===String(l));return s?s.name:String(l)},filiaire_id:(l,e)=>{const s=e==null?void 0:e.find(n=>String(n.id)===String(l));return s?s.name:String(l)},classroom_id:(l,e)=>{const s=e==null?void 0:e.find(n=>String(n.id)===String(l));return s?s.name:String(l)},course_id:(l,e)=>{const s=e==null?void 0:e.find(n=>String(n.id)===String(l));return s?s.label||s.name:String(l)}},me=l=>{l==="school_year_id"&&(T.value=""),l==="filiaire_id"&&(g.value=""),l==="classroom_id"&&(d.value=""),l==="course_id"&&(c.value="")},Q=A({classroom_id:"",course_id:"",school_year_id:"",filiere_id:"",search:""}),_e=()=>{Q.value={classroom_id:d.value,course_id:c.value,school_year_id:T.value,filiere_id:g.value,search:R.value}},pe=l=>{const e=l.imported_count||l.count||"plusieurs";b({message:`${e} repêchage(s) importé(s) avec succès.`,type:"success"}),q(),Ge.emit("repechageUpdated")},ve=l=>{b({message:l||"Erreur lors de l'import des repêchages.",type:"error"})},ge=()=>{b({message:"Export des repêchages réussi.",type:"success"})},he=l=>{b({message:"Erreur lors de l'export des repêchages.",type:"error"})},ye=()=>{b({message:"Template téléchargé avec succès.",type:"success"})},xe=l=>{b({message:"Erreur lors du téléchargement du template.",type:"error"})},Ee=()=>{_e()};return(l,e)=>(i(),p(Ne,{group:"operations","active-tag-name":"repechage",breadcrumb:[{label:"Élèves",href:"/apprenants"},{label:"Opérations",href:"/apprenants/operations"},{label:"Repêchage",href:"/apprenants/operations/repechage"}]},{default:t(()=>[r(Me,null,{default:t(()=>[u("div",Le,[u("div",Ie,[u("div",Oe,[r(a(be),{modelValue:R.value,"onUpdate:modelValue":e[0]||(e[0]=s=>R.value=s),type:"text",id:"search",name:"search",placeholder:"Rechercher un apprenant...",class:"w-full max-w-xs ps-10 border border-gray-200/40 bg-white transition-all h-10 rounded-md"},null,8,["modelValue"]),e[5]||(e[5]=u("div",{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-foreground-muted/70"},[u("span",{class:"flex iconify hugeicons--search-01 text-sm"})],-1))]),r(a(Te),null,{default:t(()=>[r(a(Ve),{"as-child":""},{default:t(()=>[r(a(Ae),{variant:"ghost",size:"md",class:"h-10 rounded-md border bg-white"},{default:t(()=>[...e[6]||(e[6]=[o(" Filtre ",-1),u("span",{class:"iconify hugeicons--filter"},"Filtre",-1)])]),_:1})]),_:1}),r(a(De),{class:"w-80"},{default:t(()=>[u("div",Pe,[e[11]||(e[11]=u("div",{class:"space-y-2"},[u("h4",{class:"font-medium leading-none"}," Filtrage ")],-1)),u("div",Ue,[u("div",Be,[r(a(k),{class:"text-foreground-muted font-light",for:"annee"},{default:t(()=>[...e[7]||(e[7]=[o("Année scolaire",-1)])]),_:1}),r(a(G),{modelValue:T.value,"onUpdate:modelValue":e[1]||(e[1]=s=>T.value=s)},{default:t(()=>[r(a(L),{id:"annee",class:"!h-10 bg-white w-full"},{default:t(()=>[r(a(I),{placeholder:"Sélectionnez l'année scolaire"})]),_:1}),r(a(O),null,{default:t(()=>[r(a(U),null,{default:t(()=>[(i(!0),D(M,null,N(Array.from(j.value.values()),s=>(i(),p(a(P),{key:s.id,value:String(s.id)},{default:t(()=>[o(m(s.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),u("div",ze,[r(a(k),{class:"text-foreground-muted font-light",for:"filiere"},{default:t(()=>[...e[8]||(e[8]=[o("Section",-1)])]),_:1}),r(a(G),{modelValue:g.value,"onUpdate:modelValue":e[2]||(e[2]=s=>g.value=s)},{default:t(()=>[r(a(L),{id:"filiere",class:"!h-10 bg-white w-full"},{default:t(()=>[r(a(I),{placeholder:"Sélectionnez la filière"})]),_:1}),r(a(O),null,{default:t(()=>[r(a(U),null,{default:t(()=>[(i(!0),D(M,null,N(Array.from(Y.value.values()),s=>(i(),p(a(P),{key:s.id,value:String(s.id)},{default:t(()=>[o(m(s.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),u("div",He,[r(a(k),{class:"text-foreground-muted font-light",for:"classe"},{default:t(()=>[...e[9]||(e[9]=[o("Classe",-1)])]),_:1}),r(a(G),{modelValue:d.value,"onUpdate:modelValue":e[3]||(e[3]=s=>d.value=s)},{default:t(()=>[r(a(L),{id:"classe",class:"!h-10 bg-white w-full"},{default:t(()=>[r(a(I),{placeholder:"Sélectionnez la classe"})]),_:1}),r(a(O),null,{default:t(()=>[r(a(U),null,{default:t(()=>[(i(!0),D(M,null,N(ie.value,s=>(i(),p(a(P),{key:s.id,value:String(s.id)},{default:t(()=>[o(m(s.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),u("div",Ye,[r(a(k),{class:"text-foreground-muted font-light",for:"cours"},{default:t(()=>[...e[10]||(e[10]=[o("Cours",-1)])]),_:1}),r(a(G),{modelValue:c.value,"onUpdate:modelValue":e[4]||(e[4]=s=>c.value=s)},{default:t(()=>[r(a(L),{id:"cours",class:"!h-10 bg-white w-full"},{default:t(()=>[r(a(I),{placeholder:"Sélectionnez le cours"})]),_:1}),r(a(O),null,{default:t(()=>[r(a(U),null,{default:t(()=>[(i(!0),D(M,null,N(ue.value,s=>(i(),p(a(P),{key:s.id,value:String(s.id)},{default:t(()=>[o(m(s.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"])])])])]),_:1})]),_:1}),r(Fe,{filters:de.value,"reference-data":ce.value,"custom-labels":fe,onRemoveFilter:me},null,8,["filters","reference-data"])]),u("div",je,[r(ke,{"import-url":a(y).IMPORT_REPECHAGE,"export-url":a(y).EXPORT_REPECHAGE,"export-filename":"repechages","export-filters":Q.value,"show-export-excel":!0,"show-export-pdf":!0,onBeforeExport:Ee,onImportSuccess:pe,onImportError:ve,onExportSuccess:ge,onExportError:he,onTemplateSuccess:ye,onTemplateError:xe},null,8,["import-url","export-url","export-filters"])])]),u("div",qe,[r(a(Ce),{class:"rounded-md bg-white"},{default:t(()=>[r(a($e),null,{default:t(()=>[r(a(C),null,{default:t(()=>[r(a(E),{class:"w-[20px]"},{default:t(()=>[r(a(W),{class:"bg-white scale-70"})]),_:1}),r(a(E),null,{default:t(()=>[...e[12]||(e[12]=[o(" Année scolaire ",-1)])]),_:1}),r(a(E),null,{default:t(()=>[...e[13]||(e[13]=[o(" Section ",-1)])]),_:1}),r(a(E),null,{default:t(()=>[...e[14]||(e[14]=[o(" Classe ",-1)])]),_:1}),r(a(E),null,{default:t(()=>[...e[15]||(e[15]=[o(" Cours ",-1)])]),_:1}),r(a(E),null,{default:t(()=>[...e[16]||(e[16]=[o(" Élève ",-1)])]),_:1}),r(a(E),null,{default:t(()=>[...e[17]||(e[17]=[o(" Note obtenue (%) ",-1)])]),_:1})]),_:1})]),_:1}),r(a(Re),null,{default:t(()=>[a(X)?(i(),p(a(C),{key:0},{default:t(()=>[r(a(_),{colspan:7,class:"text-center py-8 text-gray-500"},{default:t(()=>[...e[18]||(e[18]=[o(" Chargement des données... ",-1)])]),_:1})]),_:1})):a(H)?(i(),p(a(C),{key:1},{default:t(()=>[r(a(_),{colspan:7,class:"text-center py-8 text-red-500"},{default:t(()=>[o(" Erreur: "+m(a(H)),1)]),_:1})]),_:1})):!d.value||!c.value?(i(),p(a(C),{key:2},{default:t(()=>[r(a(_),{colspan:7,class:"text-center py-8 text-gray-500"},{default:t(()=>[...e[19]||(e[19]=[o(" Veuillez sélectionner une classe et un cours pour voir les repêchages ",-1)])]),_:1})]),_:1})):J.value.length===0?(i(),p(a(C),{key:3},{default:t(()=>[r(a(_),{colspan:7,class:"text-center py-8 text-gray-500"},{default:t(()=>[...e[20]||(e[20]=[o(" Aucun repêchage trouvé ",-1)])]),_:1})]),_:1})):(i(!0),D(M,{key:4},N(J.value,s=>(i(),p(a(C),{key:s.id},{default:t(()=>[r(a(_),{class:"w-[40px]"},{default:t(()=>[r(a(W),{class:"bg-white scale-70"})]),_:1}),r(a(_),null,{default:t(()=>[o(m(s.school_year_name),1)]),_:2},1024),r(a(_),null,{default:t(()=>[o(m(s.filiere_name),1)]),_:2},1024),r(a(_),null,{default:t(()=>[o(m(s.classroom_name),1)]),_:2},1024),r(a(_),null,{default:t(()=>[o(m(s.course_name),1)]),_:2},1024),r(a(_),null,{default:t(()=>[o(m(s.student_name),1)]),_:2},1024),r(a(_),null,{default:t(()=>[o(m(s.pourcentage.toFixed(2))+"%",1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})])]),_:1})]),_:1}))}});export{_a as default};
