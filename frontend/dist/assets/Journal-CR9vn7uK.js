import{d as ee,A as b,p as w,a1 as te,r as E,v as se,x as y,w as s,f as a,b as n,c as $,h as P,i as t,k as _,y as r,t as m,$ as S,g as G,G as ae,F as le,s as f,o as c,H as oe,m as Y}from"./index-CJ_PivE-.js";import{_ as ne}from"./Input.vue_vue_type_script_setup_true_lang-B9adgRZV.js";import{_ as re,a as ie,b as q,c as p,d as ue,e as v}from"./TableHeader.vue_vue_type_script_setup_true_lang-cS4zBTGx.js";import{_ as M}from"./Checkbox.vue_vue_type_script_setup_true_lang-DTckireD.js";import{_ as de,a as ce,b as me,c as X}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-DN4DQrTt.js";import{_ as fe}from"./BoxPanelWrapper.vue_vue_type_script_setup_true_lang-CmJ-Iy6y.js";import{_ as pe}from"./TabPagination.vue_vue_type_script_setup_true_lang-Dsg8W898.js";import{_ as ve}from"./ComptaLayout.vue_vue_type_script_setup_true_lang-Bu3Oqdii.js";import{u as ge}from"./useGetApi-EdzHoZm6.js";import{u as _e}from"./useDeleteApi-D2AjqV8w.js";import{e as U}from"./eventBus-CGRXT3Tn.js";import"./index-BpkKmY4O.js";import"./RovingFocusGroup-BxePylpC.js";import"./DashPageHeader.vue_vue_type_script_setup_true_lang-DucYyTAx.js";import"./DashLayout.vue_vue_type_script_setup_true_lang-Ch2egXHm.js";import"./RightDashHeader.vue_vue_type_script_setup_true_lang-Bn3G870_.js";const xe={class:"flex sm:items-center gap-3 flex-col sm:flex-row sm:justify-between"},be={class:"relative flex-1"},we={class:"flex flex-wrap items-center sm:justify-end gap-2.5 flex-1"},ye={key:0,class:"mt-4 rounded-md overflow-hidden flex flex-1 bg-white p-8"},he={key:1,class:"mt-4 rounded-md overflow-hidden flex flex-1 bg-white p-8"},ke={class:"flex flex-col items-center justify-center w-full gap-3"},je={class:"text-sm text-foreground-muted"},Ee={key:2,class:"mt-4 rounded-md overflow-hidden flex flex-1 bg-white p-8"},$e={class:"flex flex-col items-center justify-center w-full gap-3"},Ce={class:"text-sm text-foreground-muted"},Re={key:3,class:"mt-4 rounded-md overflow-hidden flex flex-1 bg-white"},Ue={class:"flex items-center gap-2 w-max"},Me=ee({__name:"Journal",setup(Ne){const{data:N,loading:T,error:A,fetchData:L}=ge(b.GET_JOURNAL),D=te();w(()=>D.path.includes("/comptabilite/journal")),w(()=>D.path.includes("/comptabilite/recettes")),w(()=>D.path.includes("/comptabilite/depenses"));const h=E(""),O=E(1),C=E(15),u=E([]),{deleteItem:B,deleting:z}=_e(),J=w(()=>{if(!N.value)return[];if(!h.value)return N.value;const o=h.value.toLowerCase();return N.value.filter(e=>{var i,d,l,g;return((i=e.piece_number)==null?void 0:i.toLowerCase().includes(o))||((d=e.account.code)==null?void 0:d.toLowerCase().includes(o))||((l=e.account.name)==null?void 0:l.toLowerCase().includes(o))||((g=e.label)==null?void 0:g.toLowerCase().includes(o))})}),x=w(()=>{const o=(O.value-1)*C.value,e=o+C.value;return J.value.slice(o,e)}),H=w(()=>J.value.length),Q=async()=>{if(u.value.length===0){f({message:"Aucune écriture sélectionnée",type:"info"});return}if(confirm(`Êtes-vous sûr de vouloir supprimer ${u.value.length} écriture(s) ?`))try{let o=0;for(const e of u.value){const i=b.ABANDONED_JOURNAL_ENTRY(e),d=await B(i);d&&d.success&&o++}f({message:`${o} ${o>1?"journaux":"journal"} abandonné${o>1?"s":""} avec succès`,type:"success"}),u.value=[],U.emit("journalUpdated")}catch(o){console.log("erreur suppression journal : ",o),f({message:"Erreur lors de la suppression des journaux",type:"error"})}},K=async(o,e)=>{if(confirm(`Êtes-vous sûr de vouloir abandonner l'écriture "${e||o}" ?`))try{const i=await B(b.ABANDONED_JOURNAL_ENTRY(o));i&&i.success?(f({message:"Journal abandonné avec succès",type:"success"}),U.emit("journalUpdated")):f({message:i.message,type:"error"})}catch(i){console.error("Erreur désactivation journal : ",i),f({message:"Erreur lors de l'abandon du journal",type:"error"})}},W=async o=>{if(confirm("Êtes-vous sûr de vouloir réactiver ce journal ?"))try{await Y.put(b.ABANDONED_JOURNAL_ENTRY(o)),f({message:"journal réactivé avec succès",type:"success"}),U.emit("journalUpdated")}catch(e){console.error("Erreur activation journal : ",e),f({message:"Erreur lors de la réactivation",type:"error"})}},Z=o=>o?new Date(o).toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric"}):"-",V=o=>new Intl.NumberFormat("fr-FR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(o),k=E(!1),F=async(o="excel")=>{try{k.value=!0;const e=o==="pdf"?b.EXPORT_JOURNALS_PDF:b.EXPORT_JOURNALS,i=await Y.get(e,{responseType:"blob"});let d=`journals_${new Date().toISOString()}`;const l=i.headers["content-disposition"]||i.headers["Content-Disposition"];if(l){const I=/filename\*?=([^;]+)/i.exec(l);I&&I[1]&&(d=decodeURIComponent(I[1].replace(/UTF-8''/,"").trim().replace(/"/g,"")))}const g=new Blob([i.data],{type:i.headers["content-type"]}),R=window.URL.createObjectURL(g),j=document.createElement("a");j.href=R,j.download=d,document.body.appendChild(j),j.click(),j.remove(),window.URL.revokeObjectURL(R),f({message:`Export ${o.toUpperCase()} téléchargé avec succès`,type:"success"})}catch(e){console.error("Export journals error: ",e),f({message:"Erreur lors de l'export",type:"error"})}finally{k.value=!1}};return se(async()=>{await L()}),U.on("journalUpdated",()=>{L()}),(o,e)=>{const i=S("RouterLink"),d=S("router-link");return c(),y(ve,{activeBread:"journal","active-tag-name":"journal",group:"operations"},{default:s(()=>[a(fe,null,{default:s(()=>[n("div",xe,[n("div",be,[a(t(ne),{modelValue:h.value,"onUpdate:modelValue":e[0]||(e[0]=l=>h.value=l),type:"text",id:"search",name:"search",placeholder:"Rechercher un compte bancaire...",class:"w-full max-w-sm ps-10 border border-gray-200/40 bg-white transition-all h-10 rounded-md"},null,8,["modelValue"]),e[7]||(e[7]=n("div",{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-foreground-muted/70"},[n("span",{class:"flex iconify hugeicons--search-01 text-sm"})],-1))]),n("div",we,[u.value.length>0?(c(),y(t(_),{key:0,variant:"destructive",size:"md",onClick:Q,disabled:t(z)},{default:s(()=>[e[8]||(e[8]=n("span",{class:"iconify hugeicons--delete-02 mr-1"},null,-1)),r(" Supprimer ("+m(u.value.length)+") ",1)]),_:1},8,["disabled"])):P("",!0),a(i,{to:"/comptabilite/saisie-operations/nouveau-journal"},{default:s(()=>[a(t(_),{size:"md"},{default:s(()=>[...e[9]||(e[9]=[n("span",{class:"iconify hugeicons--add-01 mr-2"},null,-1),r(" Nouveau journal ",-1)])]),_:1})]),_:1}),a(t(de),null,{default:s(()=>[a(t(ce),{"as-child":""},{default:s(()=>[a(t(_),{variant:"ghost",size:"md",class:"bg-white border border-border rounded-md",disabled:k.value},{default:s(()=>[...e[10]||(e[10]=[r(" Exporter ",-1),n("span",{class:"iconify hugeicons--arrow-down-01"},null,-1)])]),_:1},8,["disabled"])]),_:1}),a(t(me),null,{default:s(()=>[a(t(X),{class:"flex items-center",onClick:e[1]||(e[1]=G(l=>F("pdf"),["prevent"])),disabled:k.value},{default:s(()=>[...e[11]||(e[11]=[n("span",{class:"flex mr-1.5 iconify hugeicons--pdf-02"},null,-1),r(" Exporter pdf ",-1)])]),_:1},8,["disabled"]),a(t(X),{class:"flex items-center",onClick:e[2]||(e[2]=G(l=>F("excel"),["prevent"])),disabled:k.value},{default:s(()=>[...e[12]||(e[12]=[n("span",{class:"flex mr-1.5 iconify hugeicons--ai-sheets"},null,-1),r(" Exporter Excel ",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1})])]),t(T)?(c(),$("div",ye,[...e[13]||(e[13]=[n("div",{class:"flex flex-col items-center justify-center w-full gap-3"},[n("span",{class:"iconify hugeicons--loading-03 animate-spin text-4xl text-blue-500"}),n("p",{class:"text-sm text-foreground-muted"},"Chargement des écritures de journal...")],-1)])])):t(A)?(c(),$("div",he,[n("div",ke,[e[15]||(e[15]=n("span",{class:"iconify hugeicons--alert-circle text-4xl text-red-500"},null,-1)),n("p",je,m(t(A)),1),a(t(_),{onClick:e[3]||(e[3]=()=>t(L)()),size:"sm",variant:"outline"},{default:s(()=>[...e[14]||(e[14]=[n("span",{class:"iconify hugeicons--refresh mr-1"},null,-1),r(" Réessayer ",-1)])]),_:1})])])):!x.value||x.value.length===0?(c(),$("div",Ee,[n("div",$e,[e[16]||(e[16]=n("span",{class:"iconify hugeicons--notebook text-4xl text-foreground-muted/50"},null,-1)),n("p",Ce,m(h.value?"Aucune écriture trouvée pour cette recherche":"Aucune écriture de journal enregistrée"),1)])])):(c(),$("div",Re,[a(t(re),{class:"rounded-md bg-white"},{default:s(()=>[a(t(ie),null,{default:s(()=>[a(t(q),null,{default:s(()=>[a(t(p),{class:"w-[20px]"},{default:s(()=>[a(t(M),{class:"bg-white scale-70",checked:u.value.length===x.value.length&&x.value.length>0,"onUpdate:checked":e[4]||(e[4]=()=>console.log("toggleSelectAll"))},null,8,["checked"])]),_:1}),a(t(p),null,{default:s(()=>[...e[17]||(e[17]=[r("Date",-1)])]),_:1}),a(t(p),null,{default:s(()=>[...e[18]||(e[18]=[r("N° Pièce",-1)])]),_:1}),a(t(p),null,{default:s(()=>[...e[19]||(e[19]=[r("Code Compte",-1)])]),_:1}),a(t(p),null,{default:s(()=>[...e[20]||(e[20]=[r("Nom du Compte",-1)])]),_:1}),a(t(p),null,{default:s(()=>[...e[21]||(e[21]=[r("Libellé",-1)])]),_:1}),a(t(p),{class:"text-right"},{default:s(()=>[...e[22]||(e[22]=[r("Débit",-1)])]),_:1}),a(t(p),{class:"text-right"},{default:s(()=>[...e[23]||(e[23]=[r("Crédit",-1)])]),_:1}),a(t(p),null,{default:s(()=>[...e[24]||(e[24]=[r(" Opérations ",-1)])]),_:1})]),_:1})]),_:1}),a(t(ue),null,{default:s(()=>[(c(!0),$(ae,null,le(x.value,l=>(c(),y(t(q),{key:l.id,class:oe({"opacity-60 text-foreground-muted/70":l.abandoned})},{default:s(()=>[a(t(v),{class:"w-[40px]"},{default:s(()=>[a(t(M),{class:"bg-white scale-70",checked:u.value.includes(l.id),"onUpdate:checked":g=>{g?u.value.push(l.id):u.value=u.value.filter(R=>R!==l.id)}},null,8,["checked","onUpdate:checked"])]),_:2},1024),a(t(v),null,{default:s(()=>[r(m(Z(l.date)),1)]),_:2},1024),a(t(v),null,{default:s(()=>[r(m(l.piece_number||"-"),1)]),_:2},1024),a(t(v),null,{default:s(()=>[r(m(l.account.code||"-"),1)]),_:2},1024),a(t(v),null,{default:s(()=>[r(m(l.account.name||"-"),1)]),_:2},1024),a(t(v),null,{default:s(()=>[r(m(l.label||"-"),1)]),_:2},1024),a(t(v),{class:"text-right font-medium"},{default:s(()=>[r(m(parseInt(l.output_account.amount)>0?V(parseInt(l.output_account.amount)):"-"),1)]),_:2},1024),a(t(v),{class:"text-right font-medium"},{default:s(()=>[r(m(parseInt(l.input_account.amount)>0?V(parseInt(l.input_account.amount)):"-"),1)]),_:2},1024),a(t(v),null,{default:s(()=>[n("div",Ue,[a(d,{to:`/comptabilite/journal/${l.id}`},{default:s(()=>[a(t(_),{variant:"outline",size:"icon",class:"size-8"},{default:s(()=>[...e[25]||(e[25]=[n("span",{class:"iconify hugeicons--view"},null,-1)])]),_:1})]),_:1},8,["to"]),a(d,{to:{path:`/comptabilite/journal/${l.id}`,query:{edit:"true"}}},{default:s(()=>[a(t(_),{variant:"outline",size:"icon",class:"size-8"},{default:s(()=>[...e[26]||(e[26]=[n("span",{class:"iconify hugeicons--edit-02"},null,-1)])]),_:1})]),_:1},8,["to"]),l.abandoned?(c(),y(t(_),{key:0,variant:"ghost",size:"icon",class:"size-8",onClick:g=>W(l.id),disabled:t(z),title:"Réactiver"},{default:s(()=>[...e[27]||(e[27]=[n("span",{class:"iconify hugeicons--restore-bin"},null,-1)])]),_:1},8,["onClick","disabled"])):(c(),y(t(_),{key:1,variant:"destructive",size:"icon",class:"size-8",onClick:g=>K(l.id,l.label),disabled:t(z),title:"Abandonner"},{default:s(()=>[...e[28]||(e[28]=[n("span",{class:"iconify hugeicons--delete-02"},null,-1)])]),_:1},8,["onClick","disabled"]))])]),_:2},1024)]),_:2},1032,["class"]))),128))]),_:1})]),_:1})])),!t(T)&&!t(A)&&x.value.length>0?(c(),y(pe,{key:4,modelValue:O.value,"onUpdate:modelValue":e[5]||(e[5]=l=>O.value=l),perPage:C.value,totalItems:H.value,"onUpdate:perPage":e[6]||(e[6]=l=>C.value=l)},null,8,["modelValue","perPage","totalItems"])):P("",!0)]),_:1})]),_:1})}}});export{Me as default};
