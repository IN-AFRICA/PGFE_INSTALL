import{d as se,u as re,n as oe,A as c,p,v as ne,x as h,w as s,b as m,f as l,i as t,z as d,y as n,B as V,C as D,D as E,E as $,c as f,F as C,G as k,h as ie,t as _,k as G,g as de,a as ue,o as i,J as F,s as b}from"./index-CJ_PivE-.js";import{_ as P}from"./FormSection.vue_vue_type_script_setup_true_lang-C-XSdIg3.js";import{I as u}from"./InputWrapper-tSRHzcjN.js";import{S as x}from"./SpanRequired-COKghTUX.js";import{_ as me}from"./DashFormLayout.vue_vue_type_script_setup_true_lang-3V-LyRCQ.js";import{_ as I}from"./Input.vue_vue_type_script_setup_true_lang-B9adgRZV.js";import{_ as T}from"./SelectGroup.vue_vue_type_script_setup_true_lang-CwIOzTi6.js";import{_ as fe}from"./Textarea.vue_vue_type_script_setup_true_lang-Bg8QXdyw.js";import{u as ce}from"./usePostApi-Crg8MURP.js";import{u as A}from"./useGetApi-EdzHoZm6.js";import"./BoxPanelWrapper.vue_vue_type_script_setup_true_lang-CmJ-Iy6y.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./DashLayout.vue_vue_type_script_setup_true_lang-Ch2egXHm.js";import"./RightDashHeader.vue_vue_type_script_setup_true_lang-Bn3G870_.js";import"./FormPageHeader.vue_vue_type_script_setup_true_lang-CAg7Z6LS.js";import"./index-BpkKmY4O.js";const pe={key:0,class:"text-xs text-gray-600 mt-1"},_e={class:"flex items-center justify-end gap-2"},be={key:0,class:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white mr-1.5"},ge={key:1,class:"flex iconify hugeicons--money-bag-02 mr-1.5"},Te=se({__name:"NouveauPaiement",setup(ve){const M=ue(),B=re(),r=oe({personal_id:void 0,mois_id:void 0,montant:void 0,school_year_id:void 0,description:""}),{data:S,fetchData:Y,loading:z}=A(c.GET_PERSONALS),{data:g,fetchData:L}=A(c.GET_FONCTIONS),{data:H,fetchData:j,loading:q}=A(c.GET_SCHOOL_YEARS),{data:w,fetchData:J}=A(c.GET_MOIS),W=p(()=>{var a;return(Array.isArray(w.value)?w.value:((a=w.value)==null?void 0:a.data)||[]).map(e=>({id:e.id,name:e.name||e.libelle||e.month||"N/A"}))}),K=o=>{var y;if(!o||!g.value)return"N/A";const e=(Array.isArray(g.value)?g.value:((y=g.value)==null?void 0:y.data)||[]).find(te=>te.id==o);return(e==null?void 0:e.name)||(e==null?void 0:e.title)||(e==null?void 0:e.libelle)||"N/A"},O=p(()=>{var a;return(Array.isArray(S.value)?S.value:((a=S.value)==null?void 0:a.data)||[]).map(e=>({id:e.id,name:`${e.name||e.nom||""} ${e.postnom||""} ${e.firstname||e.prenom||""}`.trim(),matricule:e.matricule,fonction:K(e.fonction_id)}))}),Q=p(()=>{const o=H.value;return(Array.isArray(o)?o:(o==null?void 0:o.years)??(o==null?void 0:o.data)??[]).map(e=>({id:e.id,label:e.name||e.year||e.libelle||`${e.start_year}-${e.end_year}`||"N/A"}))}),R=p(()=>r.personal_id?O.value.find(o=>o.id===r.personal_id):null),{loading:v,error:N,postData:X}=ce(),U=p(()=>r.personal_id!==void 0&&r.mois_id!==void 0&&r.montant!==void 0&&r.montant>0&&r.school_year_id!==void 0),Z=o=>new Intl.NumberFormat("fr-CD",{style:"currency",currency:"CDF",minimumFractionDigits:0}).format(o);async function ee(){var e;if(!U.value){b({message:"Veuillez remplir tous les champs obligatoires correctement.",type:"error"});return}const o=(e=B.user)==null?void 0:e.id;if(!o){b({message:"Impossible d'identifier l'utilisateur connecté.",type:"error"});return}const a={academic_personal_id:Number(r.personal_id),mois_id:Number(r.mois_id),montant:Number(r.montant),school_year_id:Number(r.school_year_id),description:r.description.trim()||null,author_id:Number(o)};try{if(await X(c.CREATE_SALAIRE,a),N.value){console.error("❌ Erreur API:",N.value),b({message:N.value,type:"error"});return}b({message:"Salaire enregistré avec succès !",type:"success"}),ae(),setTimeout(()=>{M.push("/rh/saisie/salaire")},1e3)}catch(y){console.error("Erreur lors de la soumission:",y),b({message:"Une erreur inattendue s'est produite.",type:"error"})}}function ae(){r.personal_id=void 0,r.mois_id=void 0,r.montant=void 0,r.school_year_id=void 0,r.description=""}function le(){M.push("/rh/saisie/salaire")}return ne(async()=>{await Promise.all([Y(),L(),j(),J()])}),(o,a)=>(i(),h(me,{title:"Nouveau Paiement de Salaire","link-back":"/rh/saisie/salaire","group-route":"/rh/saisie/personnel",module:"rh",breadcrumb:[{label:"GRH",href:"/rh"},{label:"Salaire",href:"/rh/saisie/salaire"},{label:"Nouveau Paiement",isActive:!0}]},{default:s(()=>[m("form",{onSubmit:de(ee,["prevent"]),class:"w-full flex flex-col space-y-8"},[l(P,{class:"grid sm:grid-cols-2 lg:grid-cols-3 gap-y-6 gap-x-10",title:"Informations du personnel"},{default:s(()=>[l(u,null,{default:s(()=>[l(t(d),{class:"text-sm font-medium"},{default:s(()=>[a[5]||(a[5]=n(" Personnel ",-1)),l(x)]),_:1}),l(t(V),{modelValue:r.personal_id,"onUpdate:modelValue":a[0]||(a[0]=e=>r.personal_id=e),disabled:t(z)},{default:s(()=>[l(t(D),{class:"!h-10 bg-white w-full"},{default:s(()=>[l(t(E),{placeholder:"Sélectionnez le personnel"})]),_:1}),l(t($),null,{default:s(()=>[l(t(T),null,{default:s(()=>[(i(!0),f(k,null,C(O.value,e=>(i(),h(t(F),{key:e.id,value:e.id},{default:s(()=>[n(_(e.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1}),l(u,null,{default:s(()=>{var e;return[l(t(d),{class:"text-sm font-medium"},{default:s(()=>[...a[6]||(a[6]=[n("Matricule",-1)])]),_:1}),l(t(I),{value:((e=R.value)==null?void 0:e.matricule)||"",class:"bg-gray-100 transition-all h-10 rounded-md",readonly:"",placeholder:"Sélectionner d'abord un personnel"},null,8,["value"])]}),_:1}),l(u,null,{default:s(()=>{var e;return[l(t(d),{class:"text-sm font-medium"},{default:s(()=>[...a[7]||(a[7]=[n("Fonction",-1)])]),_:1}),l(t(I),{value:((e=R.value)==null?void 0:e.fonction)||"",class:"bg-gray-100 transition-all h-10 rounded-md",readonly:"",placeholder:"Sélectionner d'abord un personnel"},null,8,["value"])]}),_:1})]),_:1}),a[13]||(a[13]=m("div",{class:"w-full flex h-px bg-gray-300"},null,-1)),l(P,{class:"grid sm:grid-cols-2 lg:grid-cols-3 gap-y-6 gap-x-10",title:"Détails du paiement"},{default:s(()=>[l(u,null,{default:s(()=>[l(t(d),{class:"text-sm font-medium"},{default:s(()=>[a[8]||(a[8]=n(" Année scolaire ",-1)),l(x)]),_:1}),l(t(V),{modelValue:r.school_year_id,"onUpdate:modelValue":a[1]||(a[1]=e=>r.school_year_id=e),disabled:t(q)},{default:s(()=>[l(t(D),{class:"!h-10 bg-white w-full"},{default:s(()=>[l(t(E),{placeholder:"Sélectionner l'année scolaire"})]),_:1}),l(t($),null,{default:s(()=>[l(t(T),null,{default:s(()=>[(i(!0),f(k,null,C(Q.value,e=>(i(),h(t(F),{key:e.id,value:e.id},{default:s(()=>[n(_(e.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1}),l(u,null,{default:s(()=>[l(t(d),{class:"text-sm font-medium"},{default:s(()=>[a[9]||(a[9]=n(" Mois ",-1)),l(x)]),_:1}),l(t(V),{modelValue:r.mois_id,"onUpdate:modelValue":a[2]||(a[2]=e=>r.mois_id=e)},{default:s(()=>[l(t(D),{class:"!h-10 bg-white w-full"},{default:s(()=>[l(t(E),{placeholder:"Sélectionner le mois"})]),_:1}),l(t($),null,{default:s(()=>[l(t(T),null,{default:s(()=>[(i(!0),f(k,null,C(W.value,e=>(i(),h(t(F),{key:e.id,value:e.id},{default:s(()=>[n(_(e.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(u,null,{default:s(()=>[l(t(d),{class:"text-sm font-medium"},{default:s(()=>[a[10]||(a[10]=n(" Montant (FC) ",-1)),l(x)]),_:1}),l(t(I),{modelValue:r.montant,"onUpdate:modelValue":a[3]||(a[3]=e=>r.montant=e),modelModifiers:{number:!0},type:"number",min:"0",step:"0.01",placeholder:"Montant du salaire",class:"w-full h-10 border border-gray-200/40 bg-white transition-all rounded-md"},null,8,["modelValue"]),r.montant?(i(),f("p",pe,_(Z(r.montant)),1)):ie("",!0)]),_:1})]),_:1}),a[14]||(a[14]=m("div",{class:"w-full flex h-px bg-gray-300"},null,-1)),l(P,{class:"grid gap-y-6",title:"Informations complémentaires"},{default:s(()=>[l(u,null,{default:s(()=>[l(t(d),{class:"text-sm font-medium"},{default:s(()=>[...a[11]||(a[11]=[n(" Description / Observations ",-1)])]),_:1}),l(t(fe),{modelValue:r.description,"onUpdate:modelValue":a[4]||(a[4]=e=>r.description=e),placeholder:"Notes ou observations sur ce paiement...",class:"w-full min-h-[100px] border border-gray-200/40 bg-white transition-all resize-none rounded-md"},null,8,["modelValue"])]),_:1})]),_:1}),a[15]||(a[15]=m("div",{class:"w-full flex h-px bg-gray-300"},null,-1)),m("div",_e,[l(t(G),{type:"button",variant:"outline",onClick:le,disabled:t(v)},{default:s(()=>[...a[12]||(a[12]=[m("span",{class:"flex iconify hugeicons--cancel-01 mr-1.5"},null,-1),n(" Annuler ",-1)])]),_:1},8,["disabled"]),l(t(G),{type:"submit",disabled:!U.value||t(v)},{default:s(()=>[t(v)?(i(),f("span",be)):(i(),f("span",ge)),n(" "+_(t(v)?"Enregistrement...":"Enregistrer le paiement"),1)]),_:1},8,["disabled"])])],32)]),_:1}))}});export{Te as default};
