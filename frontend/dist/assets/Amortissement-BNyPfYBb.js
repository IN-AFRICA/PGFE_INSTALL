import{d as Y,A as ee,p as w,a1 as te,r as g,am as se,v as le,q as ae,x as U,w as l,f as s,b as o,c as D,h as S,i as t,k as y,y as i,t as d,$ as ne,G as oe,F as ie,L as ue,M as re,N as de,O as me,z as b,B as fe,C as ce,D as pe,E as _e,J as j,P as ve,g as ge,K as xe,s as E,o as p,H as ye}from"./index-CJ_PivE-.js";import{_ as V}from"./Input.vue_vue_type_script_setup_true_lang-B9adgRZV.js";import{_ as be,a as Ve,b as P,c as m,d as $e,e as f}from"./TableHeader.vue_vue_type_script_setup_true_lang-cS4zBTGx.js";import{_ as R}from"./Checkbox.vue_vue_type_script_setup_true_lang-DTckireD.js";import{_ as we}from"./BoxPanelWrapper.vue_vue_type_script_setup_true_lang-CmJ-Iy6y.js";import{_ as ke}from"./TabPagination.vue_vue_type_script_setup_true_lang-Dsg8W898.js";import{_ as Ce}from"./ComptaLayout.vue_vue_type_script_setup_true_lang-Bu3Oqdii.js";import"./eventBus-CGRXT3Tn.js";import{u as he}from"./useGetApi-EdzHoZm6.js";import"./index-BpkKmY4O.js";import"./RovingFocusGroup-BxePylpC.js";import"./DashPageHeader.vue_vue_type_script_setup_true_lang-DucYyTAx.js";import"./DashLayout.vue_vue_type_script_setup_true_lang-Ch2egXHm.js";import"./RightDashHeader.vue_vue_type_script_setup_true_lang-Bn3G870_.js";const De={class:"flex sm:items-center gap-3 flex-col sm:flex-row sm:justify-between"},Ae={class:"relative flex-1"},qe={class:"flex flex-wrap items-center sm:justify-end gap-2.5 flex-1"},Ue={key:0,class:"mt-4 rounded-md overflow-hidden flex flex-1 bg-white p-8"},Ee={key:1,class:"mt-4 rounded-md overflow-hidden flex flex-1 bg-white p-8"},Ie={class:"flex flex-col items-center justify-center w-full gap-3"},Me={class:"text-sm text-foreground-muted"},Se={key:2,class:"mt-4 rounded-md overflow-hidden flex flex-1 bg-white p-8"},Fe={class:"flex flex-col items-center justify-center w-full gap-3"},Le={class:"text-sm text-foreground-muted"},Ne={key:3,class:"mt-4 rounded-md overflow-hidden flex flex-1 bg-white"},je={class:"px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs"},Pe={class:"px-2 py-1 bg-gray-100 text-gray-700 rounded text-xs"},Re={class:"flex justify-center gap-2"},ze={class:"grid grid-cols-2 gap-4"},Te={class:"space-y-2"},Be={class:"space-y-2"},Oe={class:"grid grid-cols-2 gap-4"},Ge={class:"space-y-2"},He={class:"space-y-2"},Je={class:"grid grid-cols-2 gap-4"},Ke={class:"space-y-2"},Qe={class:"space-y-2"},We={class:"space-y-2"},ft=Y({__name:"Amortissement",setup(Xe){const I=te(),{data:_,loading:z,error:F,fetchData:L}=he(ee.GET_AMORTISSEMENT);w(()=>I.path.includes("/comptabilite/journal")),w(()=>I.path.includes("/comptabilite/amortissements")),w(()=>I.path.includes("/comptabilite/depenses"));const k=g(""),$=g(1),x=g(15),r=g([]),C=g(!1),A=g(null),u=g({asset_name:"",asset_code:"",acquisition_date:"",original_value:0,duration_years:5,method:"lineaire",account_code:""}),h=g([]);se(()=>{h.value=_.value});const N=w(()=>{if(_.value===null)return[];if(!k.value)return _.value;const n=k.value.toLowerCase();return _.value.filter(e=>{var c,a;return((c=e.name)==null?void 0:c.toLowerCase().includes(n))||((a=e.code)==null?void 0:a.toLowerCase().includes(n))})}),v=w(()=>{const n=($.value-1)*x.value,e=n+x.value;return N.value.slice(n,e)}),T=w(()=>N.value.length),B=(n,e,c)=>c==="lineaire"?n/e:n*2.5/e,O=()=>{u.value={asset_name:"",asset_code:"",acquisition_date:"",original_value:0,duration_years:5,method:"lineaire",account_code:""}},G=n=>{A.value=n,u.value={asset_name:n.name,asset_code:n.code,acquisition_date:n.purchase_date.split("T")[0],original_value:n.amount,duration_years:n.number_years,method:n.model,account_code:n.immo_account_id.toString()||""},C.value=!0},H=()=>{if(_.value===null)return[];if(!A.value)return;const n=B(u.value.original_value,u.value.duration_years,u.value.method),e=_.value.findIndex(c=>c.id===A.value.id);e!==-1&&(_.value[e]={..._.value[e],...u.value,annual_depreciation:n}),E({message:"Amortissement modifié avec succès",type:"success"}),C.value=!1,A.value=null,O()},J=(n,e)=>{confirm(`Êtes-vous sûr de vouloir supprimer "${e}" ?`)&&(h.value=h.value.filter(c=>c.id!==n),E({message:"Amortissement supprimé avec succès",type:"success"}))},K=()=>{if(r.value.length===0){E({message:"Aucun amortissement sélectionné",type:"error"});return}const n=r.value.length;confirm(`Supprimer ${n} amortissement(s) ?`)&&(h.value=h.value.filter(e=>!r.value.includes(e.id)),r.value=[],E({message:`${n} amortissement(s) supprimé(s)`,type:"success"}))},Q=()=>{r.value.length===v.value.length?r.value=[]:r.value=v.value.map(n=>n.id)},W=n=>{if(!n)return"-";try{return new Date(n).toLocaleDateString("fr-FR")}catch{return n}},q=n=>!n&&n!==0?"-":new Intl.NumberFormat("fr-FR",{style:"currency",currency:"CDF",minimumFractionDigits:2}).format(n),X=(n,e)=>e?`${(n/e*100).toFixed(1)}%`:"0%";return le(()=>{L({page:$.value,perPage:x.value})}),ae([$,x],()=>{L({page:$.value,perPage:x.value})}),(n,e)=>{const c=ne("RouterLink");return p(),U(Ce,{activeBread:"amortissements","active-tag-name":"amortissements",group:"operations"},{default:l(()=>[s(we,null,{default:l(()=>[o("div",De,[o("div",Ae,[s(t(V),{modelValue:k.value,"onUpdate:modelValue":e[0]||(e[0]=a=>k.value=a),type:"text",id:"search",name:"search",placeholder:"Rechercher par nom, code, compte...",class:"w-full max-w-sm ps-10 border border-gray-200/40 bg-white transition-all h-10 rounded-md"},null,8,["modelValue"]),e[12]||(e[12]=o("div",{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-foreground-muted/70"},[o("span",{class:"flex iconify hugeicons--search-01 text-sm"})],-1))]),o("div",qe,[r.value.length>0?(p(),U(t(y),{key:0,variant:"destructive",size:"md",onClick:K},{default:l(()=>[e[13]||(e[13]=o("span",{class:"iconify hugeicons--delete-02 mr-1"},null,-1)),i(" Supprimer ("+d(r.value.length)+") ",1)]),_:1})):S("",!0),s(c,{to:"/comptabilite/saisie-operations/nouvel-amortissement"},{default:l(()=>[s(t(y),{size:"md"},{default:l(()=>[...e[14]||(e[14]=[o("span",{class:"iconify hugeicons--add-01 mr-2"},null,-1),i(" Nouvel amortissement ",-1)])]),_:1})]),_:1})])]),t(z)?(p(),D("div",Ue,[...e[15]||(e[15]=[o("div",{class:"flex flex-col items-center justify-center w-full gap-3"},[o("span",{class:"iconify hugeicons--loading-03 animate-spin text-4xl text-blue-500"}),o("p",{class:"text-sm text-foreground-muted"},"Chargement des écritures de journal...")],-1)])])):t(F)?(p(),D("div",Ee,[o("div",Ie,[e[17]||(e[17]=o("span",{class:"iconify hugeicons--alert-circle text-4xl text-red-500"},null,-1)),o("p",Me,d(t(F)),1),s(t(y),{onClick:()=>{},size:"sm",variant:"outline"},{default:l(()=>[...e[16]||(e[16]=[o("span",{class:"iconify hugeicons--refresh mr-1"},null,-1),i(" Réessayer ",-1)])]),_:1})])])):S("",!0),!v.value||v.value.length===0?(p(),D("div",Se,[o("div",Fe,[e[18]||(e[18]=o("span",{class:"iconify hugeicons--calculator text-4xl text-foreground-muted/50"},null,-1)),o("p",Le,d(k.value?"Aucun amortissement trouvé pour cette recherche":"Aucun amortissement enregistré"),1)])])):(p(),D("div",Ne,[s(t(be),{class:"rounded-md bg-white"},{default:l(()=>[s(t(Ve),null,{default:l(()=>[s(t(P),null,{default:l(()=>[s(t(m),{class:"w-[20px]"},{default:l(()=>[s(t(R),{checked:r.value.length===v.value.length&&v.value.length>0,"onUpdate:checked":Q},null,8,["checked"])]),_:1}),s(t(m),null,{default:l(()=>[...e[19]||(e[19]=[i("Immobilisation",-1)])]),_:1}),s(t(m),null,{default:l(()=>[...e[20]||(e[20]=[i("Code",-1)])]),_:1}),s(t(m),null,{default:l(()=>[...e[21]||(e[21]=[i("Date acquisition",-1)])]),_:1}),s(t(m),{class:"text-right"},{default:l(()=>[...e[22]||(e[22]=[i("Valeur origine",-1)])]),_:1}),s(t(m),{class:"text-center"},{default:l(()=>[...e[23]||(e[23]=[i("Durée (ans)",-1)])]),_:1}),s(t(m),null,{default:l(()=>[...e[24]||(e[24]=[i("Méthode",-1)])]),_:1}),s(t(m),{class:"text-right"},{default:l(()=>[...e[25]||(e[25]=[i("Dotation annuelle",-1)])]),_:1}),s(t(m),{class:"text-right"},{default:l(()=>[...e[26]||(e[26]=[i("Cumul amort.",-1)])]),_:1}),s(t(m),{class:"text-right"},{default:l(()=>[...e[27]||(e[27]=[i("VNC",-1)])]),_:1}),s(t(m),{class:"text-center"},{default:l(()=>[...e[28]||(e[28]=[i("% amort.",-1)])]),_:1}),s(t(m),{class:"text-center"},{default:l(()=>[...e[29]||(e[29]=[i("Actions",-1)])]),_:1})]),_:1})]),_:1}),s(t($e),null,{default:l(()=>[(p(!0),D(oe,null,ie(v.value,a=>(p(),U(t(P),{key:a.id},{default:l(()=>[s(t(f),null,{default:l(()=>[s(t(R),{checked:r.value.includes(a.id),"onUpdate:checked":M=>{M?r.value.push(a.id):r.value=r.value.filter(Z=>Z!==a.id)}},null,8,["checked","onUpdate:checked"])]),_:2},1024),s(t(f),{class:"font-medium"},{default:l(()=>[i(d(a.name),1)]),_:2},1024),s(t(f),null,{default:l(()=>[o("span",je,d(a.code),1)]),_:2},1024),s(t(f),null,{default:l(()=>[i(d(W(a.purchase_date)),1)]),_:2},1024),s(t(f),{class:"text-right font-medium"},{default:l(()=>[i(d(q(a.amount)),1)]),_:2},1024),s(t(f),{class:"text-center"},{default:l(()=>[i(d(a.number_years),1)]),_:2},1024),s(t(f),null,{default:l(()=>[o("span",{class:ye([a.model==="lineaire"?"bg-green-100 text-green-700":"bg-purple-100 text-purple-700","px-2 py-1 rounded text-xs capitalize"])},d(a.model),3)]),_:2},1024),s(t(f),{class:"text-right"},{default:l(()=>[i(d(q(a.annual_depreciation)),1)]),_:2},1024),s(t(f),{class:"text-right text-orange-600"},{default:l(()=>[i(d(q(a.cumulative_depreciation)),1)]),_:2},1024),s(t(f),{class:"text-right font-semibold text-blue-600"},{default:l(()=>[i(d(q(a.net_book_value)),1)]),_:2},1024),s(t(f),{class:"text-center"},{default:l(()=>[o("span",Pe,d(X(a.cumulative_depreciation,a.original_value)),1)]),_:2},1024),s(t(f),null,{default:l(()=>[o("div",Re,[s(t(y),{variant:"ghost",size:"sm",onClick:M=>G(a)},{default:l(()=>[...e[30]||(e[30]=[o("span",{class:"hugeicons--pencil-edit-01 text-green-500"},null,-1)])]),_:1},8,["onClick"]),s(t(y),{variant:"ghost",size:"sm",onClick:M=>J(a.id,a.name)},{default:l(()=>[...e[31]||(e[31]=[o("span",{class:"hugeicons--delete-02 text-red-500"},null,-1)])]),_:1},8,["onClick"])])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})])),v.value.length>0?(p(),U(ke,{key:4,modelValue:$.value,"onUpdate:modelValue":e[1]||(e[1]=a=>$.value=a),perPage:x.value,totalItems:T.value,"onUpdate:perPage":e[2]||(e[2]=a=>x.value=a),class:"mt-4"},null,8,["modelValue","perPage","totalItems"])):S("",!0)]),_:1}),s(t(xe),{open:C.value,"onUpdate:open":e[11]||(e[11]=a=>C.value=a)},{default:l(()=>[s(t(ue),{class:"sm:max-w-[600px]"},{default:l(()=>[s(t(re),null,{default:l(()=>[s(t(de),null,{default:l(()=>[...e[32]||(e[32]=[i("Modifier l'amortissement",-1)])]),_:1}),s(t(me),null,{default:l(()=>[...e[33]||(e[33]=[i("Modifier les informations de l'immobilisation",-1)])]),_:1})]),_:1}),o("form",{onSubmit:ge(H,["prevent"]),class:"space-y-4"},[o("div",ze,[o("div",Te,[s(t(b),{for:"edit_asset_name"},{default:l(()=>[...e[34]||(e[34]=[i("Nom de l'immobilisation *",-1)])]),_:1}),s(t(V),{id:"edit_asset_name",modelValue:u.value.asset_name,"onUpdate:modelValue":e[3]||(e[3]=a=>u.value.asset_name=a),required:""},null,8,["modelValue"])]),o("div",Be,[s(t(b),{for:"edit_asset_code"},{default:l(()=>[...e[35]||(e[35]=[i("Code *",-1)])]),_:1}),s(t(V),{id:"edit_asset_code",modelValue:u.value.asset_code,"onUpdate:modelValue":e[4]||(e[4]=a=>u.value.asset_code=a),required:""},null,8,["modelValue"])])]),o("div",Oe,[o("div",Ge,[s(t(b),{for:"edit_acquisition_date"},{default:l(()=>[...e[36]||(e[36]=[i("Date d'acquisition *",-1)])]),_:1}),s(t(V),{id:"edit_acquisition_date",modelValue:u.value.acquisition_date,"onUpdate:modelValue":e[5]||(e[5]=a=>u.value.acquisition_date=a),type:"date",required:""},null,8,["modelValue"])]),o("div",He,[s(t(b),{for:"edit_original_value"},{default:l(()=>[...e[37]||(e[37]=[i("Valeur d'origine (CDF) *",-1)])]),_:1}),s(t(V),{id:"edit_original_value",modelValue:u.value.original_value,"onUpdate:modelValue":e[6]||(e[6]=a=>u.value.original_value=a),modelModifiers:{number:!0},type:"number",min:"0",step:"0.01",required:""},null,8,["modelValue"])])]),o("div",Je,[o("div",Ke,[s(t(b),{for:"edit_duration_years"},{default:l(()=>[...e[38]||(e[38]=[i("Durée (années) *",-1)])]),_:1}),s(t(V),{id:"edit_duration_years",modelValue:u.value.duration_years,"onUpdate:modelValue":e[7]||(e[7]=a=>u.value.duration_years=a),modelModifiers:{number:!0},type:"number",min:"1",required:""},null,8,["modelValue"])]),o("div",Qe,[s(t(b),{for:"edit_method"},{default:l(()=>[...e[39]||(e[39]=[i("Méthode *",-1)])]),_:1}),s(t(fe),{modelValue:u.value.method,"onUpdate:modelValue":e[8]||(e[8]=a=>u.value.method=a)},{default:l(()=>[s(t(ce),null,{default:l(()=>[s(t(pe),{placeholder:"Sélectionner"})]),_:1}),s(t(_e),null,{default:l(()=>[s(t(j),{value:"lineaire"},{default:l(()=>[...e[40]||(e[40]=[i("Linéaire",-1)])]),_:1}),s(t(j),{value:"degressif"},{default:l(()=>[...e[41]||(e[41]=[i("Dégressive",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),o("div",We,[s(t(b),{for:"edit_account_code"},{default:l(()=>[...e[42]||(e[42]=[i("Code compte (optionnel)",-1)])]),_:1}),s(t(V),{id:"edit_account_code",modelValue:u.value.account_code,"onUpdate:modelValue":e[9]||(e[9]=a=>u.value.account_code=a),placeholder:"Ex: 2183"},null,8,["modelValue"])]),s(t(ve),null,{default:l(()=>[s(t(y),{type:"button",variant:"outline",onClick:e[10]||(e[10]=a=>C.value=!1)},{default:l(()=>[...e[43]||(e[43]=[i("Annuler",-1)])]),_:1}),s(t(y),{type:"submit"},{default:l(()=>[...e[44]||(e[44]=[i("Modifier",-1)])]),_:1})]),_:1})],32)]),_:1})]),_:1},8,["open"])]),_:1})}}});export{ft as default};
