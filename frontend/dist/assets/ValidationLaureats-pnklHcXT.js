import{d as he,r as m,A as S,q as Ae,p as E,v as we,x as _,w as r,f as s,b as o,i as t,k as be,y as n,z as $,B as L,C as V,D as T,E as F,c as p,F as I,G as k,J as w,t as d,h as Ce,s as b,o as i}from"./index-CJ_PivE-.js";import{_ as $e}from"./Input.vue_vue_type_script_setup_true_lang-B9adgRZV.js";import{_ as Le,a as Ve,b as P,c,d as Te,e as f}from"./TableHeader.vue_vue_type_script_setup_true_lang-cS4zBTGx.js";import{_ as W}from"./Checkbox.vue_vue_type_script_setup_true_lang-DTckireD.js";import{_ as Fe,a as Ie,b as ke}from"./PopoverTrigger.vue_vue_type_script_setup_true_lang-DzZWQSaq.js";import{_ as B}from"./SelectGroup.vue_vue_type_script_setup_true_lang-CwIOzTi6.js";import{_ as Be}from"./LayoutSaisieOperation.vue_vue_type_script_setup_true_lang-bYPLg6Nt.js";import{_ as De}from"./BoxPanelWrapper.vue_vue_type_script_setup_true_lang-CmJ-Iy6y.js";import{u as D}from"./useGetApi-EdzHoZm6.js";import{E as Ge}from"./ExcelManagerWithAPI-DFtMVkSy.js";import{e as X}from"./eventBus-CGRXT3Tn.js";import{_ as Ue}from"./FilterBadges.vue_vue_type_script_setup_true_lang-CBuiPNtr.js";import"./index-BpkKmY4O.js";import"./RovingFocusGroup-BxePylpC.js";import"./DashLayoutWithMode.vue_vue_type_script_setup_true_lang-DzpyZ4TL.js";import"./RightDashHeader.vue_vue_type_script_setup_true_lang-Bn3G870_.js";import"./DashPageHeader.vue_vue_type_script_setup_true_lang-DucYyTAx.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-DN4DQrTt.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Re={class:"flex items-center gap-3 justify-between"},Me={class:"flex flex-1 items-center gap-2"},Ne={class:"relative w-full max-w-xs"},je={class:"grid gap-4"},Oe={class:"flex flex-col gap-3.5"},Pe={class:"space-y-1.5"},Ye={class:"space-y-1.5"},qe={class:"space-y-1.5"},ze={class:"space-y-1.5"},He={class:"space-y-1.5"},Je={class:"flex flex-wrap items-center gap-2.5"},Qe={class:"mt-4 rounded-md overflow-hidden flex flex-1 bg-white"},We={key:0,class:"flex items-center justify-center w-full h-64"},Xe={key:1,class:"flex items-center justify-center w-full h-64"},Ke={class:"flex items-center gap-2 text-red-600"},Ze={class:"flex flex-col items-center gap-2 text-foreground-muted"},el={key:0},ll={key:1},hl=he({__name:"ValidationLaureats",setup(tl){const v=m(""),g=m(""),y=m(""),x=m(""),K=m(""),h=m(""),A=m("");m("");const{data:M,error:Y,loading:Z,fetchData:N}=D(S.GET_LAUREAT);Ae(M,l=>{var e,a;l&&l.length>0&&(console.log("ðŸ“Š DonnÃ©es laurÃ©ats reÃ§ues:",l),console.log("ðŸ“Š Premier Ã©lÃ©ment:",l[0]),console.log("ðŸ“Š Type de pourcentage:",typeof((e=l[0])==null?void 0:e.percentage),"- Valeur:",(a=l[0])==null?void 0:a.percentage))},{immediate:!0});const{data:C,fetchData:ee}=D(S.GET_SCHOOL_YEARS),{data:G,fetchData:le}=D(S.GET_CLASSROOMS),{data:U,fetchData:te}=D(S.GET_FILLIERES),{data:R,fetchData:ae}=D(S.GET_CYCLES),se=l=>{if(!U.value||!l)return"-";const e=Array.isArray(U.value)?U.value.find(a=>String(a.id)===String(l)):null;return(e==null?void 0:e.name)||l},re=l=>{if(!G.value||!l)return"-";const e=Array.isArray(G.value)?G.value.find(a=>String(a.id)===String(l)):null;return(e==null?void 0:e.name)||l},ne=l=>{var u,Q;if(!C.value||!l)return"-";const e=((u=C.value)==null?void 0:u.years)||((Q=C.value)==null?void 0:Q.data)||C.value,a=Array.isArray(e)?e.find(Ee=>String(Ee.id)===String(l)):null;return(a==null?void 0:a.name)||l},oe=l=>{if(!R.value||!l)return"-";const e=Array.isArray(R.value)?R.value.find(a=>String(a.id)===String(l)):null;return(e==null?void 0:e.name)||l},ue=l=>{if(!l)return"-";const e=l.toLowerCase();return e==="m"||e==="masculin"||e==="male"?"Masculin":e==="f"||e==="fÃ©minin"||e==="feminin"||e==="female"?"FÃ©minin":l},q=E(()=>{const l=C.value;return Array.isArray(l)?l:(l==null?void 0:l.years)??(l==null?void 0:l.data)??[]}),z=E(()=>{const l=U.value;return Array.isArray(l)?l:(l==null?void 0:l.data)??[]}),H=E(()=>{const l=G.value;return Array.isArray(l)?l:(l==null?void 0:l.data)??[]}),J=E(()=>{const l=R.value;return Array.isArray(l)?l:(l==null?void 0:l.data)??[]}),j=E(()=>{if(!M.value)return[];let l=M.value;if(v.value){const e=v.value.toLowerCase();l=l.filter(a=>a.last_name.toLowerCase().includes(e)||a.first_name.toLowerCase().includes(e)||a.middle_name&&a.middle_name.toLowerCase().includes(e))}if(g.value&&(l=l.filter(e=>String(e.year)===String(g.value))),y.value&&(l=l.filter(e=>String(e.department)===String(y.value))),x.value&&(l=l.filter(e=>String(e.class)===String(x.value))),h.value){const e=h.value.toLowerCase();l=l.filter(a=>{if(!a.gender)return!1;const u=a.gender.toLowerCase();return e==="m"?u==="m"||u==="masculin"||u==="male":e==="f"?u==="f"||u==="fÃ©minin"||u==="feminin"||u==="female":u===e})}return A.value&&(l=l.filter(e=>String(e.cycle)===String(A.value))),l}),ie=l=>{console.log("Import rÃ©ussi:",l);const e=l.imported_count||l.count||"plusieurs";b({message:`${e} validation(s) de laurÃ©at(s) importÃ©e(s) avec succÃ¨s.`,type:"success"}),N(),X.emit("laureatUpdated")},de=l=>{console.error("Erreur import:",l);let e="Erreur lors de l'import des validations de laurÃ©ats.";l.message?e=l.message:l.errors&&(Array.isArray(l.errors)?e=l.errors.join(", "):typeof l.errors=="object"&&(e=Object.values(l.errors).flat().join(", "))),b({message:e,type:"error"})},fe=()=>{b({message:"Export des validations de laurÃ©ats rÃ©ussi.",type:"success"})},ce=l=>{console.error("Erreur export:",l),b({message:"Erreur lors de l'export des validations de laurÃ©ats.",type:"error"})},me=()=>{b({message:"Template tÃ©lÃ©chargÃ© avec succÃ¨s.",type:"success"})},pe=l=>{console.error("Erreur template:",l),b({message:"Erreur lors du tÃ©lÃ©chargement du template.",type:"error"})},_e=()=>{ve()},O=m({annee_scolaire:"",filiere:"",classe:"",date:"",search:""}),ve=()=>{O.value={annee_scolaire:g.value,filiere:y.value,classe:x.value,date:K.value,search:v.value},console.log("Filtres d'export mis Ã  jour:",O.value)};we(()=>{N(),ee(),le(),te(),ae()}),X.on("laureatUpdated",()=>{N()});const ge=E(()=>({school_year_id:g.value||void 0,filiaire_id:y.value||void 0,classroom_id:x.value||void 0,gender:h.value||void 0,cycle_id:A.value||void 0})),ye=E(()=>({school_year_id:q.value,filiaire_id:z.value,classroom_id:H.value,cycle_id:J.value})),xe={school_year_id:(l,e)=>{const a=e==null?void 0:e.find(u=>String(u.id)===String(l));return a?`AnnÃ©e: ${a.name}`:String(l)},filiaire_id:(l,e)=>{const a=e==null?void 0:e.find(u=>String(u.id)===String(l));return a?`Section: ${a.name}`:String(l)},classroom_id:(l,e)=>{const a=e==null?void 0:e.find(u=>String(u.id)===String(l));return a?`Classe: ${a.name}`:String(l)},cycle_id:(l,e)=>{const a=e==null?void 0:e.find(u=>String(u.id)===String(l));return a?`Cycle: ${a.name}`:String(l)},gender:l=>`Genre: ${l==="M"?"Masculin":"FÃ©minin"}`},Se=l=>{l==="school_year_id"&&(g.value=""),l==="filiaire_id"&&(y.value=""),l==="classroom_id"&&(x.value=""),l==="gender"&&(h.value=""),l==="cycle_id"&&(A.value="")};return(l,e)=>(i(),_(Be,{"active-tag-name":"validation-laureats",group:"operations",breadcrumb:[{label:"Ã‰lÃ¨ves",href:"/apprenants"},{label:"OpÃ©rations",href:"/apprenants/operations"},{label:"Validation LaurÃ©at",href:"/apprenants/operations/validation-laureats"}]},{default:r(()=>[s(De,null,{default:r(()=>[o("div",Re,[o("div",Me,[o("div",Ne,[s(t($e),{type:"text",id:"search",name:"search",placeholder:"Rechercher un laurÃ©at...",modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=a=>v.value=a),class:"w-full max-w-xs ps-10 border border-gray-200/40 bg-white transition-all h-10 rounded-md"},null,8,["modelValue"]),e[6]||(e[6]=o("div",{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-foreground-muted/70"},[o("span",{class:"flex iconify hugeicons--search-01 text-sm"})],-1))]),s(t(Fe),null,{default:r(()=>[s(t(Ie),{"as-child":""},{default:r(()=>[s(t(be),{variant:"ghost",size:"md",class:"h-10 rounded-md border bg-white"},{default:r(()=>[...e[7]||(e[7]=[n(" Filtre ",-1),o("span",{class:"iconify hugeicons--filter"},"Filtre",-1)])]),_:1})]),_:1}),s(t(ke),{class:"w-80"},{default:r(()=>[o("div",je,[e[15]||(e[15]=o("div",{class:"space-y-2"},[o("h4",{class:"font-medium leading-none"}," Filtrage ")],-1)),o("div",Oe,[o("div",Pe,[s(t($),{class:"text-foreground-muted font-light",for:"annee"},{default:r(()=>[...e[8]||(e[8]=[n("AnnÃ©e scolaire",-1)])]),_:1}),s(t(L),{modelValue:g.value,"onUpdate:modelValue":e[1]||(e[1]=a=>g.value=a)},{default:r(()=>[s(t(V),{class:"w-full"},{default:r(()=>[s(t(T),{placeholder:"SÃ©lectionner une annÃ©e"})]),_:1}),s(t(F),null,{default:r(()=>[s(t(B),null,{default:r(()=>[(i(!0),p(k,null,I(q.value,a=>(i(),_(t(w),{key:a.id,value:String(a.id)},{default:r(()=>[n(d(a.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),o("div",Ye,[s(t($),{class:"text-foreground-muted font-light",for:"filiere"},{default:r(()=>[...e[9]||(e[9]=[n("Section",-1)])]),_:1}),s(t(L),{modelValue:y.value,"onUpdate:modelValue":e[2]||(e[2]=a=>y.value=a)},{default:r(()=>[s(t(V),{class:"w-full"},{default:r(()=>[s(t(T),{placeholder:"SÃ©lectionner une section"})]),_:1}),s(t(F),null,{default:r(()=>[s(t(B),null,{default:r(()=>[(i(!0),p(k,null,I(z.value,a=>(i(),_(t(w),{key:a.id,value:String(a.id)},{default:r(()=>[n(d(a.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),o("div",qe,[s(t($),{class:"text-foreground-muted font-light",for:"classe"},{default:r(()=>[...e[10]||(e[10]=[n("Classe",-1)])]),_:1}),s(t(L),{modelValue:x.value,"onUpdate:modelValue":e[3]||(e[3]=a=>x.value=a)},{default:r(()=>[s(t(V),{class:"w-full"},{default:r(()=>[s(t(T),{placeholder:"SÃ©lectionner une classe"})]),_:1}),s(t(F),null,{default:r(()=>[s(t(B),null,{default:r(()=>[(i(!0),p(k,null,I(H.value,a=>(i(),_(t(w),{key:a.id,value:String(a.id)},{default:r(()=>[n(d(a.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),o("div",ze,[s(t($),{class:"text-foreground-muted font-light",for:"genre"},{default:r(()=>[...e[11]||(e[11]=[n("Genre",-1)])]),_:1}),s(t(L),{modelValue:h.value,"onUpdate:modelValue":e[4]||(e[4]=a=>h.value=a)},{default:r(()=>[s(t(V),{class:"w-full"},{default:r(()=>[s(t(T),{placeholder:"SÃ©lectionner un genre"})]),_:1}),s(t(F),null,{default:r(()=>[s(t(B),null,{default:r(()=>[s(t(w),{value:"M"},{default:r(()=>[...e[12]||(e[12]=[n("Masculin",-1)])]),_:1}),s(t(w),{value:"F"},{default:r(()=>[...e[13]||(e[13]=[n("FÃ©minin",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),o("div",He,[s(t($),{class:"text-foreground-muted font-light",for:"cycle"},{default:r(()=>[...e[14]||(e[14]=[n("Cycle",-1)])]),_:1}),s(t(L),{modelValue:A.value,"onUpdate:modelValue":e[5]||(e[5]=a=>A.value=a)},{default:r(()=>[s(t(V),{class:"w-full"},{default:r(()=>[s(t(T),{placeholder:"SÃ©lectionner un cycle"})]),_:1}),s(t(F),null,{default:r(()=>[s(t(B),null,{default:r(()=>[(i(!0),p(k,null,I(J.value,a=>(i(),_(t(w),{key:a.id,value:String(a.id)},{default:r(()=>[n(d(a.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"])])])])]),_:1})]),_:1}),s(Ue,{filters:ge.value,"reference-data":ye.value,"custom-labels":xe,onRemoveFilter:Se},null,8,["filters","reference-data"])]),o("div",Je,[s(Ge,{"import-url":t(S).IMPORT_LAUREAT,"export-url":t(S).EXPORT_LAUREAT,"export-filename":"validation-laureats","export-filters":O.value,"show-export-excel":!0,"show-export-pdf":!1,onImportSuccess:ie,onImportError:de,onExportSuccess:fe,onExportError:ce,onTemplateSuccess:me,onTemplateError:pe,onBeforeExport:_e},null,8,["import-url","export-url","export-filters"])])]),o("div",Qe,[t(Z)?(i(),p("div",We,[...e[16]||(e[16]=[o("div",{class:"flex items-center gap-2"},[o("div",{class:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary"}),o("span",{class:"text-foreground-muted"},"Chargement des donnÃ©es de validation des laurÃ©ats...")],-1)])])):t(Y)?(i(),p("div",Xe,[o("div",Ke,[e[17]||(e[17]=o("span",{class:"iconify hugeicons--alert-triangle text-xl"},null,-1)),o("span",null,"Erreur lors du chargement des donnÃ©es: "+d(t(Y)),1)])])):(i(),_(t(Le),{key:2,class:"rounded-md bg-white"},{default:r(()=>[s(t(Ve),null,{default:r(()=>[s(t(P),{class:"bg-primary"},{default:r(()=>[s(t(c),{class:"w-[20px]"},{default:r(()=>[s(t(W),{class:"bg-white scale-70"})]),_:1}),s(t(c),null,{default:r(()=>[...e[18]||(e[18]=[n("Nom",-1)])]),_:1}),s(t(c),null,{default:r(()=>[...e[19]||(e[19]=[n("PrÃ©nom",-1)])]),_:1}),s(t(c),null,{default:r(()=>[...e[20]||(e[20]=[n("Post-nom",-1)])]),_:1}),s(t(c),null,{default:r(()=>[...e[21]||(e[21]=[n("Genre",-1)])]),_:1}),s(t(c),null,{default:r(()=>[...e[22]||(e[22]=[n("Section",-1)])]),_:1}),s(t(c),null,{default:r(()=>[...e[23]||(e[23]=[n("Classe",-1)])]),_:1}),s(t(c),null,{default:r(()=>[...e[24]||(e[24]=[n("AnnÃ©e",-1)])]),_:1}),s(t(c),null,{default:r(()=>[...e[25]||(e[25]=[n("Cycle",-1)])]),_:1}),s(t(c),null,{default:r(()=>[...e[26]||(e[26]=[n("Pourcentage",-1)])]),_:1}),s(t(c),null,{default:r(()=>[...e[27]||(e[27]=[n("Commentaire",-1)])]),_:1})]),_:1})]),_:1}),s(t(Te),null,{default:r(()=>[!j.value||j.value.length===0?(i(),_(t(P),{key:0},{default:r(()=>[s(t(f),{colspan:11,class:"text-center py-8"},{default:r(()=>[o("div",Ze,[e[28]||(e[28]=o("span",{class:"iconify hugeicons--file-search text-2xl"},null,-1)),v.value?(i(),p("span",el,' Aucun rÃ©sultat trouvÃ© pour "'+d(v.value)+'" ',1)):(i(),p("span",ll," Aucune validation de laurÃ©at disponible "))])]),_:1})]),_:1})):Ce("",!0),(i(!0),p(k,null,I(j.value,(a,u)=>(i(),_(t(P),{key:a.id||u},{default:r(()=>[s(t(f),{class:"w-[40px]"},{default:r(()=>[s(t(W),{class:"bg-white scale-70"})]),_:1}),s(t(f),null,{default:r(()=>[n(d(a.last_name||"-"),1)]),_:2},1024),s(t(f),null,{default:r(()=>[n(d(a.middle_name||"-"),1)]),_:2},1024),s(t(f),null,{default:r(()=>[n(d(a.first_name||"-"),1)]),_:2},1024),s(t(f),null,{default:r(()=>[n(d(ue(a.gender)),1)]),_:2},1024),s(t(f),null,{default:r(()=>[n(d(se(a.department)),1)]),_:2},1024),s(t(f),null,{default:r(()=>[n(d(re(a.class)),1)]),_:2},1024),s(t(f),null,{default:r(()=>[n(d(ne(a.year)),1)]),_:2},1024),s(t(f),null,{default:r(()=>[n(d(oe(a.cycle)),1)]),_:2},1024),s(t(f),null,{default:r(()=>[n(d(a.percentage!=null&&a.percentage!==""?Number(a.percentage)+"%":"-"),1)]),_:2},1024),s(t(f),null,{default:r(()=>[n(d(a.comment||"-"),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}))])]),_:1})]),_:1}))}});export{hl as default};
