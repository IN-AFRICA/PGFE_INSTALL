import{d as G,r as E,A as p,v as J,p as N,x as _,w as t,f as n,b as d,i as a,k as w,$ as U,y as o,c as A,F as j,G as H,a as q,o as c,t as f,s as h}from"./index-CJ_PivE-.js";import{_ as K}from"./Input.vue_vue_type_script_setup_true_lang-B9adgRZV.js";import{_ as Q,a as W,b as g,c as u,d as X,e as r}from"./TableHeader.vue_vue_type_script_setup_true_lang-cS4zBTGx.js";import{_ as C}from"./Checkbox.vue_vue_type_script_setup_true_lang-DTckireD.js";import{_ as Z}from"./BoxPanelWrapper.vue_vue_type_script_setup_true_lang-CmJ-Iy6y.js";import{_ as ee}from"./SaisieRhLayout.vue_vue_type_script_setup_true_lang-CNwSXs2g.js";import{_ as ae}from"./TabPagination.vue_vue_type_script_setup_true_lang-Dsg8W898.js";import{u as $}from"./useGetApi-EdzHoZm6.js";import{u as se}from"./useDeleteApi-D2AjqV8w.js";import"./index-BpkKmY4O.js";import"./RovingFocusGroup-BxePylpC.js";import"./DashPageHeader.vue_vue_type_script_setup_true_lang-DucYyTAx.js";import"./DashLayout.vue_vue_type_script_setup_true_lang-Ch2egXHm.js";import"./RightDashHeader.vue_vue_type_script_setup_true_lang-Bn3G870_.js";const te={class:"flex sm:items-center gap-3 flex-col sm:flex-row sm:justify-between"},ne={class:"relative flex-1"},le={class:"flex flex-wrap items-center sm:justify-end gap-2.5 flex-1"},oe={class:"mt-4 rounded-md overflow-hidden flex flex-1 bg-white"},re={class:"flex items-center gap-2 w-max"},ie={key:0,class:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white"},de={key:1,class:"iconify hugeicons--delete-02"},De=G({__name:"ListeSalaire",setup(ue){q();const D=E(1),S=E(15),{data:v,fetchData:k,loading:I}=$(p.GET_SALAIRES),{data:y,fetchData:L}=$(p.GET_PERSONALS),{data:P,fetchData:R}=$(p.GET_SCHOOL_YEARS);J(async()=>{await Promise.all([k(),L(),R()])});const F=["","Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"],M=i=>{var s;const l=(Array.isArray(y.value)?y.value:((s=y.value)==null?void 0:s.data)||[]).find(m=>m.id===i);return{name:l?`${l.name||l.nom||""} ${l.postnom||""} ${l.firstname||l.prenom||""}`.trim():"Inconnu",matricule:(l==null?void 0:l.matricule)||"N/A"}},T=i=>{const e=P.value,s=(Array.isArray(e)?e:(e==null?void 0:e.years)??(e==null?void 0:e.data)??[]).find(m=>m.id===i);return(s==null?void 0:s.name)||(s==null?void 0:s.year)||(s==null?void 0:s.libelle)||(s!=null&&s.start_year?`${s.start_year}-${s.end_year}`:"N/A")},O=i=>new Intl.NumberFormat("fr-CD",{style:"currency",currency:"CDF",minimumFractionDigits:0}).format(i),x=N(()=>{var e;return(Array.isArray(v.value)?v.value:((e=v.value)==null?void 0:e.data)||[]).map(l=>{const s=l.academic_personal_id||l.personal_id,m=M(Number(s));return{id:l.id,matricule:m.matricule,nom:m.name,schoolYear:T(Number(l.school_year_id)),mois:F[l.mois_id]||`Mois ${l.mois_id}`,montant:l.montant||0,description:l.description||"-",date:l.created_at?new Date(l.created_at).toLocaleDateString("fr-FR"):"N/A"}})}),V=N(()=>x.value.length),{deleteItem:Y,deleting:b}=se();function z(i){h({message:"La fonction d'édition sera disponible prochainement.",type:"info"})}async function B(i){if(window.confirm("Êtes-vous sûr de vouloir supprimer ce paiement de salaire ?"))try{await Y(p.DELETE_SALAIRE(i)),h({message:"Paiement supprimé avec succès !",type:"success"}),await k()}catch(l){console.error("Erreur lors de la suppression:",l),h({message:"Erreur lors de la suppression du paiement.",type:"error"})}}return(i,e)=>{const l=U("RouterLink");return c(),_(ee,{activeBread:"Salaires","active-tag-name":"salaire",group:"saisie"},{default:t(()=>[n(Z,null,{default:t(()=>[d("div",te,[d("div",ne,[n(a(K),{type:"text",id:"search",name:"search",placeholder:"Rechercher un personnel...",class:"w-full max-w-sm ps-10 border border-gray-200/40 bg-white transition-all h-10 rounded-md"}),e[2]||(e[2]=d("div",{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-foreground-muted/70"},[d("span",{class:"flex iconify hugeicons--search-01 text-sm"})],-1))]),d("div",le,[n(a(w),{size:"md",class:"rounded-md max-sm:flex-1 sm:w-max","as-child":""},{default:t(()=>[n(l,{to:"/rh/saisie/salaire/nouveau-salaire"},{default:t(()=>[...e[3]||(e[3]=[d("span",{class:"flex iconify hugeicons--plus-sign"},null,-1),d("span",{class:"hidden sm:flex"},"Nouveau Salaire",-1)])]),_:1})]),_:1})])]),d("div",oe,[n(a(Q),{class:"rounded-md bg-white"},{default:t(()=>[n(a(W),null,{default:t(()=>[n(a(g),null,{default:t(()=>[n(a(u),{class:"w-[20px]"},{default:t(()=>[n(a(C),{class:"bg-white scale-70"})]),_:1}),n(a(u),null,{default:t(()=>[...e[4]||(e[4]=[o("Matricule",-1)])]),_:1}),n(a(u),null,{default:t(()=>[...e[5]||(e[5]=[o("Nom du personnel",-1)])]),_:1}),n(a(u),null,{default:t(()=>[...e[6]||(e[6]=[o("Année scolaire",-1)])]),_:1}),n(a(u),null,{default:t(()=>[...e[7]||(e[7]=[o("Mois",-1)])]),_:1}),n(a(u),null,{default:t(()=>[...e[8]||(e[8]=[o("Montant",-1)])]),_:1}),n(a(u),null,{default:t(()=>[...e[9]||(e[9]=[o("Description",-1)])]),_:1}),n(a(u),null,{default:t(()=>[...e[10]||(e[10]=[o("Date",-1)])]),_:1}),n(a(u),null,{default:t(()=>[...e[11]||(e[11]=[o(" Opérations ",-1)])]),_:1})]),_:1})]),_:1}),n(a(X),null,{default:t(()=>[a(I)?(c(),_(a(g),{key:0},{default:t(()=>[n(a(r),{colspan:"9",class:"text-center py-8"},{default:t(()=>[...e[12]||(e[12]=[o(" Chargement... ",-1)])]),_:1})]),_:1})):x.value.length===0?(c(),_(a(g),{key:1},{default:t(()=>[n(a(r),{colspan:"9",class:"text-center py-8 text-gray-500"},{default:t(()=>[...e[13]||(e[13]=[o(" Aucun paiement de salaire trouvé. ",-1)])]),_:1})]),_:1})):(c(!0),A(H,{key:2},j(x.value,s=>(c(),_(a(g),{key:s.id},{default:t(()=>[n(a(r),{class:"w-[40px]"},{default:t(()=>[n(a(C),{class:"bg-white scale-70"})]),_:1}),n(a(r),{class:"font-medium"},{default:t(()=>[o(f(s.matricule),1)]),_:2},1024),n(a(r),{class:"font-medium"},{default:t(()=>[o(f(s.nom),1)]),_:2},1024),n(a(r),null,{default:t(()=>[o(f(s.schoolYear),1)]),_:2},1024),n(a(r),null,{default:t(()=>[o(f(s.mois),1)]),_:2},1024),n(a(r),{class:"font-semibold text-green-700"},{default:t(()=>[o(f(O(s.montant)),1)]),_:2},1024),n(a(r),{class:"max-w-xs truncate",title:s.description},{default:t(()=>[o(f(s.description),1)]),_:2},1032,["title"]),n(a(r),null,{default:t(()=>[o(f(s.date),1)]),_:2},1024),n(a(r),null,{default:t(()=>[d("div",re,[n(a(w),{variant:"outline",size:"icon",class:"size-8",onClick:m=>z(s.id),disabled:a(b)},{default:t(()=>[...e[14]||(e[14]=[d("span",{class:"iconify hugeicons--edit-02"},null,-1)])]),_:1},8,["onClick","disabled"]),n(a(w),{variant:"destructive",size:"icon",class:"size-8",onClick:m=>B(s.id),disabled:a(b)},{default:t(()=>[a(b)?(c(),A("span",ie)):(c(),A("span",de))]),_:1},8,["onClick","disabled"])])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),n(ae,{modelValue:D.value,"onUpdate:modelValue":e[0]||(e[0]=s=>D.value=s),perPage:S.value,totalItems:V.value,"onUpdate:perPage":e[1]||(e[1]=s=>S.value=s)},null,8,["modelValue","perPage","totalItems"])]),_:1})]),_:1})}}});export{De as default};
