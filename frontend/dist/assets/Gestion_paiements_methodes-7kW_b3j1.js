import{_ as de}from"./ComptaLayout.vue_vue_type_script_setup_true_lang-Bu3Oqdii.js";import{_ as ue}from"./BoxPanelWrapper.vue_vue_type_script_setup_true_lang-CmJ-Iy6y.js";import{d as B,n as j,q as J,x as M,i as e,K as X,w as s,f as t,k as L,b as c,y as u,L as Z,M as ee,N as te,O as se,c as C,h as k,z as q,H as z,t as x,P as ae,g as le,o as h,G as me,F as ce,a0 as fe,A as T,s as _,r as U,p as Q,v as pe}from"./index-CJ_PivE-.js";import{_ as N}from"./Input.vue_vue_type_script_setup_true_lang-B9adgRZV.js";import{_ as ge}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-Bm461x8Q.js";import{_ as K}from"./Checkbox.vue_vue_type_script_setup_true_lang-DTckireD.js";import{_ as ye}from"./index-BeOV968Y.js";import{_ as ve,a as he,b as V,c as P,d as _e,e as A}from"./TableHeader.vue_vue_type_script_setup_true_lang-cS4zBTGx.js";import{_ as ne,a as oe,b as ie,c as F}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-DN4DQrTt.js";import{u as Ee}from"./useGetApi-EdzHoZm6.js";import{u as $e}from"./usePostApi-Crg8MURP.js";import{u as De}from"./usePutApi-BrTvEW5v.js";import{u as be}from"./useDeleteApi-D2AjqV8w.js";import"./DashPageHeader.vue_vue_type_script_setup_true_lang-DucYyTAx.js";import"./DashLayout.vue_vue_type_script_setup_true_lang-Ch2egXHm.js";import"./RightDashHeader.vue_vue_type_script_setup_true_lang-Bn3G870_.js";import"./index-BpkKmY4O.js";import"./RovingFocusGroup-BxePylpC.js";const xe={class:"space-y-2"},Se={key:0,class:"text-sm text-red-500 mt-1"},Ce={class:"space-y-2"},Ae={key:0,class:"text-sm text-red-500 mt-1"},Me={key:0,class:"iconify hugeicons--loading-03 mr-2 animate-spin"},Le=B({__name:"CreatePaymentMethodDialog",props:{isOpen:{type:Boolean},isLoading:{type:Boolean}},emits:["update:isOpen","submit"],setup(d,{emit:n}){const r=d,p=n,o=j({name:"",code:""}),i=j({name:"",code:""});J(()=>r.isOpen,l=>{l&&(o.name="",o.code="",i.name="",i.code="")});const D=()=>{let l=!0;return i.name="",i.code="",!o.name||o.name.trim()===""?(i.name="Le nom est requis",l=!1):o.name.length>255&&(i.name="Le nom ne peut pas dépasser 255 caractères",l=!1),!o.code||o.code.trim()===""?(i.code="Le code est requis",l=!1):o.code.length>50&&(i.code="Le code ne peut pas dépasser 50 caractères",l=!1),l},m=()=>{D()&&p("submit",{name:o.name.trim(),code:o.code.trim()})},f=()=>{p("update:isOpen",!1)};return(l,a)=>(h(),M(e(X),{open:d.isOpen,"onUpdate:open":a[3]||(a[3]=g=>l.$emit("update:isOpen",g))},{default:s(()=>[t(e(ge),{"as-child":""},{default:s(()=>[t(e(L),{size:"md",onClick:a[0]||(a[0]=g=>l.$emit("update:isOpen",!0)),class:"bg-primary text-primary-foreground"},{default:s(()=>[...a[4]||(a[4]=[c("span",{class:"iconify hugeicons--add-01 mr-2"},null,-1),u(" Nouvelle méthode ",-1)])]),_:1})]),_:1}),t(e(Z),{class:"sm:max-w-[500px]"},{default:s(()=>[t(e(ee),null,{default:s(()=>[t(e(te),null,{default:s(()=>[...a[5]||(a[5]=[u("Créer une nouvelle méthode de paiement",-1)])]),_:1}),t(e(se),null,{default:s(()=>[...a[6]||(a[6]=[u(" Ajoutez une nouvelle méthode de paiement au système. ",-1)])]),_:1})]),_:1}),c("form",{onSubmit:le(m,["prevent"]),class:"space-y-4"},[c("div",xe,[t(e(q),{for:"create-name"},{default:s(()=>[...a[7]||(a[7]=[u("Nom de la méthode *",-1)])]),_:1}),t(e(N),{id:"create-name",modelValue:o.name,"onUpdate:modelValue":a[1]||(a[1]=g=>o.name=g),placeholder:"Ex: Carte bancaire, Espèces, Virement...",class:z({"border-red-500":i.name})},null,8,["modelValue","class"]),i.name?(h(),C("p",Se,x(i.name),1)):k("",!0)]),c("div",Ce,[t(e(q),{for:"create-code"},{default:s(()=>[...a[8]||(a[8]=[u("Code de la méthode *",-1)])]),_:1}),t(e(N),{id:"create-code",modelValue:o.code,"onUpdate:modelValue":a[2]||(a[2]=g=>o.code=g),placeholder:"Ex: CARD, CASH, WIRE...",class:z({"border-red-500":i.code})},null,8,["modelValue","class"]),i.code?(h(),C("p",Ae,x(i.code),1)):k("",!0)]),t(e(ae),null,{default:s(()=>[t(e(L),{type:"button",variant:"outline",onClick:f},{default:s(()=>[...a[9]||(a[9]=[u(" Annuler ",-1)])]),_:1}),t(e(L),{type:"submit",disabled:d.isLoading},{default:s(()=>[d.isLoading?(h(),C("span",Me)):k("",!0),u(" "+x(d.isLoading?"Création...":"Créer la méthode"),1)]),_:1},8,["disabled"])]),_:1})],32)]),_:1})]),_:1},8,["open"]))}}),we={class:"space-y-2"},ke={key:0,class:"text-sm text-red-500 mt-1"},Oe={class:"space-y-2"},Te={key:0,class:"text-sm text-red-500 mt-1"},Ve={key:0,class:"iconify hugeicons--loading-03 mr-2 animate-spin"},Pe=B({__name:"EditPaymentMethodDialog",props:{isOpen:{type:Boolean},isLoading:{type:Boolean},method:{}},emits:["update:isOpen","submit"],setup(d,{emit:n}){const r=d,p=n,o=j({name:"",code:""}),i=j({name:"",code:""});J([()=>r.isOpen,()=>r.method],([l,a])=>{l&&a&&(o.name=a.name||"",o.code=a.code||"",i.name="",i.code="")},{immediate:!0});const D=()=>{let l=!0;return i.name="",i.code="",!o.name||o.name.trim()===""?(i.name="Le nom est requis",l=!1):o.name.length>255&&(i.name="Le nom ne peut pas dépasser 255 caractères",l=!1),!o.code||o.code.trim()===""?(i.code="Le code est requis",l=!1):o.code.length>50&&(i.code="Le code ne peut pas dépasser 50 caractères",l=!1),l},m=()=>{D()&&p("submit",{name:o.name.trim(),code:o.code.trim()})},f=()=>{p("update:isOpen",!1)};return(l,a)=>(h(),M(e(X),{open:d.isOpen,"onUpdate:open":a[2]||(a[2]=g=>l.$emit("update:isOpen",g))},{default:s(()=>[t(e(Z),{class:"sm:max-w-[500px]"},{default:s(()=>[t(e(ee),null,{default:s(()=>[t(e(te),null,{default:s(()=>[...a[3]||(a[3]=[u("Modifier la méthode de paiement",-1)])]),_:1}),t(e(se),null,{default:s(()=>[...a[4]||(a[4]=[u(" Modifiez les informations de la méthode de paiement. ",-1)])]),_:1})]),_:1}),c("form",{onSubmit:le(m,["prevent"]),class:"space-y-4"},[c("div",we,[t(e(q),{for:"edit-name"},{default:s(()=>[...a[5]||(a[5]=[u("Nom de la méthode *",-1)])]),_:1}),t(e(N),{id:"edit-name",modelValue:o.name,"onUpdate:modelValue":a[0]||(a[0]=g=>o.name=g),placeholder:"Ex: Carte bancaire, Espèces, Virement...",class:z({"border-red-500":i.name})},null,8,["modelValue","class"]),i.name?(h(),C("p",ke,x(i.name),1)):k("",!0)]),c("div",Oe,[t(e(q),{for:"edit-code"},{default:s(()=>[...a[6]||(a[6]=[u("Code de la méthode *",-1)])]),_:1}),t(e(N),{id:"edit-code",modelValue:o.code,"onUpdate:modelValue":a[1]||(a[1]=g=>o.code=g),placeholder:"Ex: CARD, CASH, WIRE...",class:z({"border-red-500":i.code})},null,8,["modelValue","class"]),i.code?(h(),C("p",Te,x(i.code),1)):k("",!0)]),t(e(ae),null,{default:s(()=>[t(e(L),{type:"button",variant:"outline",onClick:f},{default:s(()=>[...a[7]||(a[7]=[u(" Annuler ",-1)])]),_:1}),t(e(L),{type:"submit",disabled:d.isLoading},{default:s(()=>[d.isLoading?(h(),C("span",Ve)):k("",!0),u(" "+x(d.isLoading?"Modification...":"Modifier la méthode"),1)]),_:1},8,["disabled"])]),_:1})],32)]),_:1})]),_:1},8,["open"]))}}),Ue={class:"border rounded-lg overflow-hidden flex flex-1 bg-white"},Ne={class:"flex items-center justify-center text-red-500"},Be=B({__name:"PaymentMethodsTable",props:{methods:{},isLoading:{type:Boolean},error:{},selectedItems:{},isAllSelected:{type:Boolean}},emits:["edit","delete","toggle-selection","toggle-select-all"],setup(d,{emit:n}){const r=n,p=f=>{if(!f)return"-";try{return new Date(f).toLocaleDateString("fr-FR",{year:"numeric",month:"short",day:"numeric"})}catch{return"-"}},o=f=>{r("edit",f)},i=f=>{r("delete",f)},D=f=>{r("toggle-selection",f)},m=()=>{r("toggle-select-all")};return(f,l)=>(h(),C("div",Ue,[t(e(ve),null,{default:s(()=>[t(e(he),null,{default:s(()=>[t(e(V),null,{default:s(()=>[t(e(P),{class:"w-12"},{default:s(()=>[t(e(K),{checked:d.isAllSelected,"onUpdate:checked":m},null,8,["checked"])]),_:1}),t(e(P),{class:"w-1/3"},{default:s(()=>[...l[0]||(l[0]=[u("Nom",-1)])]),_:1}),t(e(P),{class:"w-1/4"},{default:s(()=>[...l[1]||(l[1]=[u("Code",-1)])]),_:1}),t(e(P),{class:"w-1/4"},{default:s(()=>[...l[2]||(l[2]=[u("Date de création",-1)])]),_:1}),t(e(P),{class:"w-1/6 text-right"},{default:s(()=>[...l[3]||(l[3]=[u("Actions",-1)])]),_:1})]),_:1})]),_:1}),t(e(_e),null,{default:s(()=>[d.isLoading?(h(),M(e(V),{key:0},{default:s(()=>[t(e(A),{colspan:"5",class:"text-center py-8"},{default:s(()=>[...l[4]||(l[4]=[c("div",{class:"flex items-center justify-center"},[c("span",{class:"iconify hugeicons--loading-03 mr-2 animate-spin"}),u(" Chargement des méthodes de paiement... ")],-1)])]),_:1})]),_:1})):d.error?(h(),M(e(V),{key:1},{default:s(()=>[t(e(A),{colspan:"5",class:"text-center py-8"},{default:s(()=>[c("div",Ne,[l[5]||(l[5]=c("span",{class:"iconify hugeicons--alert-triangle mr-2"},null,-1)),u(" "+x(d.error),1)])]),_:1})]),_:1})):d.methods.length===0?(h(),M(e(V),{key:2},{default:s(()=>[t(e(A),{colspan:"5",class:"text-center py-8"},{default:s(()=>[...l[6]||(l[6]=[c("div",{class:"flex flex-col items-center justify-center text-gray-500"},[c("span",{class:"iconify hugeicons--credit-card text-4xl mb-2"}),c("p",{class:"font-medium"},"Aucune méthode de paiement"),c("p",{class:"text-sm"},"Commencez par créer votre première méthode de paiement")],-1)])]),_:1})]),_:1})):(h(!0),C(me,{key:3},ce(d.methods,a=>(h(),M(e(V),{key:a.id},{default:s(()=>[t(e(A),null,{default:s(()=>[t(e(K),{checked:d.selectedItems.includes(a.id),"onUpdate:checked":g=>D(a.id)},null,8,["checked","onUpdate:checked"])]),_:2},1024),t(e(A),{class:"font-medium"},{default:s(()=>[u(x(a.name),1)]),_:2},1024),t(e(A),null,{default:s(()=>[t(e(ye),{variant:"outline"},{default:s(()=>[u(x(a.code),1)]),_:2},1024)]),_:2},1024),t(e(A),null,{default:s(()=>[u(x(p(a.created_at)),1)]),_:2},1024),t(e(A),{class:"text-right"},{default:s(()=>[t(e(ne),null,{default:s(()=>[t(e(oe),{"as-child":""},{default:s(()=>[t(e(L),{variant:"ghost",size:"sm"},{default:s(()=>[...l[7]||(l[7]=[c("span",{class:"iconify hugeicons--more-vertical"},null,-1)])]),_:1})]),_:1}),t(e(ie),{align:"end"},{default:s(()=>[t(e(F),{onClick:g=>o(a)},{default:s(()=>[...l[8]||(l[8]=[c("span",{class:"iconify hugeicons--edit-02 mr-2"},null,-1),u(" Modifier ",-1)])]),_:1},8,["onClick"]),t(e(F),{onClick:g=>i(a.id),class:"text-red-600 focus:text-red-600"},{default:s(()=>[...l[9]||(l[9]=[c("span",{class:"iconify hugeicons--delete-02 mr-2"},null,-1),u(" Supprimer ",-1)])]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]))}}),Re={class:"flex items-center gap-3 justify-between mb-4"},je={class:"relative flex-1 max-w-md"},qe={class:"flex items-center gap-2"},ze=B({__name:"PaymentMethodsActionBar",props:{searchQuery:{},selectedCount:{},isDeleting:{type:Boolean}},emits:["update:searchQuery","delete-selected"],setup(d){return(n,r)=>(h(),C("div",Re,[c("div",je,[t(e(N),{type:"text",value:d.searchQuery,onInput:r[0]||(r[0]=p=>n.$emit("update:searchQuery",p.target.value)),placeholder:"Rechercher par nom ou code...",class:"pl-10"},null,8,["value"]),r[2]||(r[2]=c("span",{class:"iconify hugeicons--search-01 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"},null,-1))]),c("div",qe,[d.selectedCount>0?(h(),M(e(L),{key:0,variant:"destructive",size:"sm",onClick:r[1]||(r[1]=p=>n.$emit("delete-selected")),disabled:d.isDeleting},{default:s(()=>[r[3]||(r[3]=c("span",{class:"iconify hugeicons--delete-02 mr-2"},null,-1)),u(" Supprimer ("+x(d.selectedCount)+") ",1)]),_:1},8,["disabled"])):k("",!0),t(e(ne),null,{default:s(()=>[t(e(oe),{"as-child":""},{default:s(()=>[t(e(L),{variant:"outline",size:"sm"},{default:s(()=>[...r[4]||(r[4]=[c("span",{class:"iconify hugeicons--download-01 mr-2"},null,-1),u(" Exporter ",-1)])]),_:1})]),_:1}),t(e(ie),null,{default:s(()=>[t(e(F),null,{default:s(()=>[...r[5]||(r[5]=[c("span",{class:"iconify hugeicons--file-02 mr-2"},null,-1),u(" Excel ",-1)])]),_:1}),t(e(F),null,{default:s(()=>[...r[6]||(r[6]=[c("span",{class:"iconify hugeicons--file-02 mr-2"},null,-1),u(" PDF ",-1)])]),_:1})]),_:1})]),_:1}),fe(n.$slots,"create")])]))}});function Fe(){const{data:d,error:n,loading:r,fetchData:p}=Ee(T.GET_PAYMENT_METHODE),{response:o,error:i,loading:D,postData:m}=$e(),{response:f,error:l,loading:a,putData:g}=De(),{deleteResponse:O,errorDelete:y,deleting:E,deleteItem:b}=be();return{methodsData:d,methodsError:n,methodsLoading:r,fetchMethods:p,createLoading:D,updateLoading:a,deleteLoading:E,handleCreateSubmit:async v=>{var S,$,w,Y,G,W;if(!(v!=null&&v.name)||!(v!=null&&v.code))return _({message:"Veuillez remplir tous les champs requis.",type:"error"}),!1;try{return await m(T.CREATE_PAYMENT_METHODE,v),i.value?(_({message:i.value,type:"error"}),!1):(S=o.value)!=null&&S.success?(_({message:o.value.message||"Méthode de paiement créée avec succès.",type:"success"}),await p(),!0):(_({message:(($=o.value)==null?void 0:$.message)||"Erreur lors de la création de la méthode de paiement.",type:"error"}),!1)}catch(H){let I="Une erreur inattendue s'est produite.";if(H instanceof Object&&"response"in H){const R=H;if((Y=(w=R.response)==null?void 0:w.data)!=null&&Y.message)I=R.response.data.message;else if((W=(G=R.response)==null?void 0:G.data)!=null&&W.errors){const re=R.response.data.errors;I=`Erreurs de validation: ${Object.values(re).flat().join(", ")}`}}return _({message:I,type:"error"}),!1}},handleUpdateSubmit:async(v,S)=>{var $,w;try{return await g(T.UPDATE_PAYMENT_METHODE(v),S),l.value?(_({message:l.value,type:"error"}),!1):($=f.value)!=null&&$.success?(_({message:f.value.message||"Méthode de paiement modifiée avec succès.",type:"success"}),await p(),!0):(_({message:((w=f.value)==null?void 0:w.message)||"Erreur lors de la modification de la méthode de paiement.",type:"error"}),!1)}catch{return _({message:"Une erreur inattendue s'est produite.",type:"error"}),!1}},handleDeleteSingle:async v=>{var S,$;if(!confirm("Êtes-vous sûr de vouloir supprimer cette méthode de paiement ?"))return!1;try{return await b(T.DELETE_PAYMENT_METHODE(v)),y.value?(_({message:y.value,type:"error"}),!1):(S=O.value)!=null&&S.success?(_({message:O.value.message||"Méthode de paiement supprimée avec succès.",type:"success"}),await p(),!0):(_({message:(($=O.value)==null?void 0:$.message)||"Erreur lors de la suppression de la méthode de paiement.",type:"error"}),!1)}catch{return _({message:"Une erreur inattendue s'est produite.",type:"error"}),!1}},handleDeleteMultiple:async v=>{if(v.length===0)return!1;const S=v.map($=>$.name).join(", ");if(!confirm(`Êtes-vous sûr de vouloir supprimer ces ${v.length} méthode(s) de paiement ?

${S}`))return!1;try{const $=v.map(w=>b(T.DELETE_PAYMENT_METHODE(w.id)));return await Promise.all($),_({message:`${v.length} méthode(s) de paiement supprimée(s) avec succès.`,type:"success"}),await p(),!0}catch{return _({message:"Erreur lors de la suppression des méthodes de paiement.",type:"error"}),!1}}}}function He(d){const n=U([]),r=Q(()=>{const m=d()||[];return Array.isArray(m)?m.filter(f=>n.value.includes(f.id)):(console.warn("filteredMethods is not an array:",m),[])}),p=Q(()=>{const m=d()||[];return m.length>0&&n.value.length===m.length});return{selectedItems:n,selectedMethods:r,isAllSelected:p,toggleSelection:m=>{const f=n.value.indexOf(m);f>-1?n.value.splice(f,1):n.value.push(m)},toggleSelectAll:()=>{p.value?n.value=[]:n.value=d().map(m=>m.id)},clearSelection:()=>{n.value=[]}}}const pt=B({__name:"Gestion_paiements_methodes",setup(d){const n=Fe(),r=U(""),p=U(!1),o=U(!1),i=U(null),D=Q(()=>{let y=[];if(n.methodsData.value&&(Array.isArray(n.methodsData.value)?y=n.methodsData.value:"data"in n.methodsData.value&&Array.isArray(n.methodsData.value.data)?y=n.methodsData.value.data:"methods"in n.methodsData.value&&Array.isArray(n.methodsData.value.methods)&&(y=n.methodsData.value.methods)),!r.value)return y;const E=r.value.toLowerCase();return y.filter(b=>b.name.toLowerCase().includes(E)||b.code.toLowerCase().includes(E))}),m=He(()=>D.value),f=async y=>{await n.handleCreateSubmit(y)&&(p.value=!1)},l=async y=>{if(!i.value)return;await n.handleUpdateSubmit(i.value.id,y)&&(o.value=!1,i.value=null)},a=y=>{i.value=y,o.value=!0},g=async y=>{await n.handleDeleteSingle(y)},O=async()=>{await n.handleDeleteMultiple(m.selectedMethods.value)&&m.clearSelection()};return pe(async()=>{await n.fetchMethods()}),(y,E)=>(h(),M(de,{activeBread:"Méthodes de Paiement","active-tag-name":"methodes-paiement",group:"frais"},{default:s(()=>[t(ue,null,{default:s(()=>[t(ze,{"search-query":r.value,"selected-count":e(m).selectedMethods.value.length,"is-deleting":e(n).deleteLoading.value,"onUpdate:searchQuery":E[1]||(E[1]=b=>r.value=b),onDeleteSelected:O},{create:s(()=>[t(Le,{"is-open":p.value,"is-loading":e(n).createLoading.value,"onUpdate:isOpen":E[0]||(E[0]=b=>p.value=b),onSubmit:f},null,8,["is-open","is-loading"])]),_:1},8,["search-query","selected-count","is-deleting"]),t(Be,{methods:D.value,"is-loading":e(n).methodsLoading.value,error:e(n).methodsError.value,"selected-items":e(m).selectedItems.value,"is-all-selected":e(m).isAllSelected.value,onEdit:a,onDelete:g,onToggleSelection:e(m).toggleSelection,onToggleSelectAll:e(m).toggleSelectAll},null,8,["methods","is-loading","error","selected-items","is-all-selected","onToggleSelection","onToggleSelectAll"]),t(Pe,{"is-open":o.value,"is-loading":e(n).updateLoading.value,method:i.value,"onUpdate:isOpen":E[2]||(E[2]=b=>o.value=b),onSubmit:l},null,8,["is-open","is-loading","method"])]),_:1})]),_:1}))}});export{pt as default};
