import{d as P,a1 as R,p as E,A as g,s as S,a as U,x as F,w as i,c as m,i as a,b as r,f as s,z as N,y as _,h as T,a4 as k,t as b,k as A,g as G,o as n}from"./index-CJ_PivE-.js";import{_ as B}from"./Input.vue_vue_type_script_setup_true_lang-B9adgRZV.js";import{_ as z}from"./ComptaLayout.vue_vue_type_script_setup_true_lang-Bu3Oqdii.js";import{_ as Q}from"./FormSection.vue_vue_type_script_setup_true_lang-C-XSdIg3.js";import{I as M}from"./InputWrapper-tSRHzcjN.js";import{S as w}from"./SpanRequired-COKghTUX.js";import{u as W}from"./usePostApi-Crg8MURP.js";import{u as H}from"./useGetApi-EdzHoZm6.js";import{u as J}from"./usePutApi-BrTvEW5v.js";import{o as K,s as C,u as X,aQ as O,t as Y}from"./vee-validate-zod-Bra4yLtR.js";import{e as Z}from"./eventBus-CGRXT3Tn.js";import"./index-BpkKmY4O.js";import"./DashPageHeader.vue_vue_type_script_setup_true_lang-DucYyTAx.js";import"./DashLayout.vue_vue_type_script_setup_true_lang-Ch2egXHm.js";import"./RightDashHeader.vue_vue_type_script_setup_true_lang-Bn3G870_.js";import"./BoxPanelWrapper.vue_vue_type_script_setup_true_lang-CmJ-Iy6y.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ee={key:0,class:"mt-10 flex items-center justify-center"},se={key:0,class:"text-sm text-red-500"},te={key:0,class:"text-sm text-red-500"},ae={class:"flex items-center justify-end gap-2"},ie={key:0},oe={key:1},Se=P({__name:"New_Immobilisation",setup(ne){const D=K({name:C().min(1,"Le nom est requis").max(255,"255 caractères maximum"),code:C().min(1,"Le code est requis").max(50,"50 caractères maximum")}),{handleSubmit:j,resetForm:y}=X({validationSchema:Y(D),initialValues:{name:"",code:""}}),{loading:L,postData:V}=W(),{loading:$,putData:q}=J(),x=U(),v=R(),d=v.query.id?String(v.query.id):null,l=!!d,I=E(()=>L.value||$.value);let u;if(l&&d){const c=g.GET_ONE_IMMOBILISATION(d),{data:e,fetchData:t,loading:o}=H(c);u=o,(async()=>{await t(),e.value&&y({values:{name:e.value.name,code:e.value.code}})})()}const p=E(()=>I.value||!!(u!=null&&u.value)),h=j(async c=>{try{const e={name:c.name,code:c.code};if(console.log("Données d'immobilisation à envoyer:",e),l&&d){const t=g.UPDATE_IMMOBILISATION(d);await q(t,e)}else await V(g.CREATE_IMMOBILISATION,e);S({message:l?"Immobilisation mise à jour avec succès":"Immobilisation créée avec succès",type:"success"}),y(),Z.emit("immobilisationUpdated"),x.push("immobilisations")}catch(e){const t=e instanceof Error?e.message:String(e);console.error("Erreur lors de la soumission:",t),S({message:"Une erreur inattendue s'est produite.",type:"error"})}});return(c,e)=>(n(),F(z,{activeBread:"Nouvelle Immobilisation","active-tag-name":"immobilisations",group:"operations","show-header":!1},{default:i(()=>[l&&a(u)?(n(),m("div",ee,[...e[2]||(e[2]=[r("div",{class:"flex flex-col items-center justify-center w-full gap-3"},[r("span",{class:"iconify hugeicons--loading-03 animate-spin text-4xl text-blue-500"}),r("p",{class:"text-sm text-foreground-muted"},"Chargement de l'immobilisation...")],-1)])])):(n(),m("form",{key:1,onSubmit:e[1]||(e[1]=G((...t)=>a(h)&&a(h)(...t),["prevent"])),class:"mt-10 space-y-8"},[s(Q,{class:"grid sm:grid-cols-2 lg:grid-cols-3 gap-y-6 gap-x-10",title:l?"Modifier l'immobilisation":"Nouvelle immobilisation"},{default:i(()=>[s(M,{class:"lg:col-span-1"},{default:i(()=>[s(a(N),{class:"text-sm"},{default:i(()=>[e[3]||(e[3]=_(" Nom ",-1)),s(w)]),_:1}),s(a(O),{name:"name"},{default:i(({field:t,errorMessage:o,meta:f})=>[s(a(B),k(t,{type:"text",disabled:p.value,class:"bg-gray-100 transition-all h-10 rounded-md",placeholder:"Nom de l'immobilisation"}),null,16,["disabled"]),f.touched&&o?(n(),m("span",se,b(o),1)):T("",!0)]),_:1})]),_:1}),s(M,{class:"lg:col-span-1"},{default:i(()=>[s(a(N),{class:"text-sm"},{default:i(()=>[e[4]||(e[4]=_(" Code ",-1)),s(w)]),_:1}),s(a(O),{name:"code"},{default:i(({field:t,errorMessage:o,meta:f})=>[s(a(B),k(t,{type:"text",disabled:p.value,class:"bg-gray-100 transition-all h-10 rounded-md",placeholder:"Ex: IMM-2025"}),null,16,["disabled"]),f.touched&&o?(n(),m("span",te,b(o),1)):T("",!0)]),_:1})]),_:1})]),_:1},8,["title"]),r("div",ae,[s(a(A),{variant:"outline",type:"button",disabled:p.value,onClick:e[0]||(e[0]=t=>a(x).push("/comptabilite/saisie-operations/immobilisations"))},{default:i(()=>[...e[5]||(e[5]=[r("span",{class:"flex iconify hugeicons--cancel-01 mr-1.5"},null,-1),_(" Annuler ",-1)])]),_:1},8,["disabled"]),s(a(A),{type:"submit",disabled:p.value},{default:i(()=>[e[6]||(e[6]=r("span",{class:"flex iconify hugeicons--add-01"},null,-1)),I.value?(n(),m("span",oe,"Enregistrement...")):(n(),m("span",ie,b(l?"Mettre à jour":"Enregistrer")+" l'immobilisation",1))]),_:1},8,["disabled"])])],32))]),_:1}))}});export{Se as default};
