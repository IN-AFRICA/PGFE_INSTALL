import{_ as $e}from"./ComptaLayout.vue_vue_type_script_setup_true_lang-Bu3Oqdii.js";import{d as X,c as C,b as m,f as t,i as e,x as P,h as D,k as F,w as s,y as d,t as x,o as $,G as xe,F as Me,p as I,s as _,v as ye,z as Q,a4 as H,P as Ee,g as Se,r as O,A as z,j as he,L as ie,M as re,N as de,O as ue,K as me}from"./index-CJ_PivE-.js";import{_ as Ce}from"./BoxPanelWrapper.vue_vue_type_script_setup_true_lang-CmJ-Iy6y.js";import{_ as J}from"./Input.vue_vue_type_script_setup_true_lang-B9adgRZV.js";import{_ as ge,a as ve,b as _e,c as K}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-DN4DQrTt.js";import{_ as fe}from"./index-BeOV968Y.js";import{_ as ce}from"./Checkbox.vue_vue_type_script_setup_true_lang-DTckireD.js";import{_ as be,a as we,b as B,c as L,d as Te,e as E}from"./TableHeader.vue_vue_type_script_setup_true_lang-cS4zBTGx.js";import{_ as ke}from"./Textarea.vue_vue_type_script_setup_true_lang-Bg8QXdyw.js";import{_ as Ae}from"./ListFeeType.vue_vue_type_script_setup_true_lang-DyY8dJdH.js";import{o as Le,s as R,u as De,aQ as Y,t as Pe}from"./vee-validate-zod-Bra4yLtR.js";import{u as Fe}from"./useGetApi-EdzHoZm6.js";import{u as Ne}from"./usePostApi-Crg8MURP.js";import{u as Ue}from"./usePutApi-BrTvEW5v.js";import{u as qe}from"./useDeleteApi-D2AjqV8w.js";import{e as G}from"./eventBus-CGRXT3Tn.js";import"./DashPageHeader.vue_vue_type_script_setup_true_lang-DucYyTAx.js";import"./DashLayout.vue_vue_type_script_setup_true_lang-Ch2egXHm.js";import"./RightDashHeader.vue_vue_type_script_setup_true_lang-Bn3G870_.js";import"./index-BpkKmY4O.js";import"./RovingFocusGroup-BxePylpC.js";const ze={class:"flex items-center gap-3 justify-between mb-4"},Be={class:"relative flex-1 max-w-md"},Ie={class:"flex items-center gap-2"},Oe=X({__name:"PaymentMotifsActions",props:{searchQuery:{},selectedCount:{},deleteLoading:{type:Boolean,default:!1}},emits:["update:search-query","delete-selected","export","create-motif"],setup(r){return(u,o)=>($(),C("div",ze,[m("div",Be,[t(e(J),{type:"text","model-value":r.searchQuery,"onUpdate:modelValue":o[0]||(o[0]=i=>u.$emit("update:search-query",String(i))),placeholder:"Rechercher par nom, code ou description...",class:"pl-10"},null,8,["model-value"]),o[5]||(o[5]=m("span",{class:"iconify hugeicons--search-01 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"},null,-1))]),m("div",Ie,[r.selectedCount>0?($(),P(e(F),{key:0,variant:"destructive",size:"sm",onClick:o[1]||(o[1]=i=>u.$emit("delete-selected")),disabled:r.deleteLoading},{default:s(()=>[o[6]||(o[6]=m("span",{class:"iconify hugeicons--delete-02 mr-2"},null,-1)),d(" Supprimer ("+x(r.selectedCount)+") ",1)]),_:1},8,["disabled"])):D("",!0),t(e(ge),null,{default:s(()=>[t(e(ve),{"as-child":""},{default:s(()=>[t(e(F),{variant:"outline",size:"sm"},{default:s(()=>[...o[7]||(o[7]=[m("span",{class:"iconify hugeicons--download-01 mr-2"},null,-1),d(" Exporter ",-1)])]),_:1})]),_:1}),t(e(_e),null,{default:s(()=>[t(e(K),{onClick:o[2]||(o[2]=i=>u.$emit("export","excel"))},{default:s(()=>[...o[8]||(o[8]=[m("span",{class:"iconify hugeicons--file-02 mr-2"},null,-1),d(" Excel ",-1)])]),_:1}),t(e(K),{onClick:o[3]||(o[3]=i=>u.$emit("export","pdf"))},{default:s(()=>[...o[9]||(o[9]=[m("span",{class:"iconify hugeicons--file-02 mr-2"},null,-1),d(" PDF ",-1)])]),_:1})]),_:1})]),_:1}),t(e(F),{size:"md",onClick:o[4]||(o[4]=i=>u.$emit("create-motif")),class:"bg-primary text-primary-foreground"},{default:s(()=>[...o[10]||(o[10]=[m("span",{class:"iconify hugeicons--add-01 mr-2"},null,-1),d(" Nouveau motif ",-1)])]),_:1})])]))}}),Ve={class:"border rounded-lg overflow-hidden flex flex-1 bg-white"},je={class:"flex items-center justify-center text-red-500"},Qe={class:"flex flex-col items-center justify-center text-gray-500"},Re={class:"font-medium"},Ye={class:"text-sm"},Ge=X({__name:"PaymentMotifsTable",props:{motifs:{},selectedItems:{},loading:{type:Boolean,default:!1},error:{default:null},hasSearchQuery:{type:Boolean,default:!1},isAllSelected:{type:Boolean,default:!1}},emits:["toggle-selection","toggle-select-all","edit-motif","delete-motif"],setup(r){const u=i=>{if(!i)return"-";try{return new Date(i).toLocaleDateString("fr-FR",{year:"numeric",month:"short",day:"numeric"})}catch{return"-"}},o=i=>{var l;return((l=i.fee_type)==null?void 0:l.name)||"Non défini"};return(i,l)=>($(),C("div",Ve,[t(e(be),null,{default:s(()=>[t(e(we),null,{default:s(()=>[t(e(B),null,{default:s(()=>[t(e(L),{class:"w-12"},{default:s(()=>[t(e(ce),{checked:r.isAllSelected,"onUpdate:checked":l[0]||(l[0]=f=>i.$emit("toggle-select-all"))},null,8,["checked"])]),_:1}),t(e(L),null,{default:s(()=>[...l[1]||(l[1]=[d("Nom",-1)])]),_:1}),t(e(L),null,{default:s(()=>[...l[2]||(l[2]=[d("Code",-1)])]),_:1}),t(e(L),null,{default:s(()=>[...l[3]||(l[3]=[d("Type de frais",-1)])]),_:1}),t(e(L),null,{default:s(()=>[...l[4]||(l[4]=[d("Description",-1)])]),_:1}),t(e(L),null,{default:s(()=>[...l[5]||(l[5]=[d("Date de création",-1)])]),_:1}),t(e(L),{class:"text-right"},{default:s(()=>[...l[6]||(l[6]=[d("Actions",-1)])]),_:1})]),_:1})]),_:1}),t(e(Te),null,{default:s(()=>[r.loading?($(),P(e(B),{key:0},{default:s(()=>[t(e(E),{colspan:"7",class:"text-center py-8"},{default:s(()=>[...l[7]||(l[7]=[m("div",{class:"flex items-center justify-center"},[m("span",{class:"iconify hugeicons--loading-03 mr-2 animate-spin"}),d(" Chargement des motifs de paiement... ")],-1)])]),_:1})]),_:1})):r.error?($(),P(e(B),{key:1},{default:s(()=>[t(e(E),{colspan:"7",class:"text-center py-8"},{default:s(()=>[m("div",je,[l[8]||(l[8]=m("span",{class:"iconify hugeicons--alert-triangle mr-2"},null,-1)),d(" "+x(r.error),1)])]),_:1})]),_:1})):r.motifs.length===0?($(),P(e(B),{key:2},{default:s(()=>[t(e(E),{colspan:"7",class:"text-center py-8"},{default:s(()=>[m("div",Qe,[l[9]||(l[9]=m("span",{class:"iconify hugeicons--note-01 text-4xl mb-2"},null,-1)),m("p",Re,x(r.hasSearchQuery?"Aucun motif trouvé":"Aucun motif de paiement"),1),m("p",Ye,x(r.hasSearchQuery?"Essayez avec d'autres mots-clés":"Commencez par créer votre premier motif de paiement"),1)])]),_:1})]),_:1})):($(!0),C(xe,{key:3},Me(r.motifs,f=>($(),P(e(B),{key:f.id},{default:s(()=>[t(e(E),null,{default:s(()=>[t(e(ce),{checked:r.selectedItems.includes(f.id),"onUpdate:checked":M=>i.$emit("toggle-selection",f.id)},null,8,["checked","onUpdate:checked"])]),_:2},1024),t(e(E),{class:"font-medium"},{default:s(()=>[d(x(f.name),1)]),_:2},1024),t(e(E),null,{default:s(()=>[t(e(fe),{variant:"outline"},{default:s(()=>[d(x(f.code),1)]),_:2},1024)]),_:2},1024),t(e(E),null,{default:s(()=>[t(e(fe),{variant:"secondary"},{default:s(()=>[d(x(o(f)),1)]),_:2},1024)]),_:2},1024),t(e(E),{class:"max-w-xs truncate",title:f.description},{default:s(()=>[d(x(f.description),1)]),_:2},1032,["title"]),t(e(E),null,{default:s(()=>[d(x(u(f.created_at)),1)]),_:2},1024),t(e(E),{class:"text-right"},{default:s(()=>[t(e(ge),null,{default:s(()=>[t(e(ve),{"as-child":""},{default:s(()=>[t(e(F),{variant:"ghost",size:"sm"},{default:s(()=>[...l[10]||(l[10]=[m("span",{class:"iconify hugeicons--more-vertical"},null,-1)])]),_:1})]),_:1}),t(e(_e),{align:"end"},{default:s(()=>[t(e(K),{onClick:M=>i.$emit("edit-motif",f)},{default:s(()=>[...l[11]||(l[11]=[m("span",{class:"iconify hugeicons--edit-02 mr-2"},null,-1),d(" Modifier ",-1)])]),_:1},8,["onClick"]),t(e(K),{onClick:M=>i.$emit("delete-motif",f.id),class:"text-red-600 focus:text-red-600"},{default:s(()=>[...l[12]||(l[12]=[m("span",{class:"iconify hugeicons--delete-02 mr-2"},null,-1),d(" Supprimer ",-1)])]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]))}}),Ke={class:"grid grid-cols-2 gap-4"},Xe={class:"space-y-2"},He={key:0,class:"text-sm text-red-500"},Je={class:"space-y-2"},We={key:0,class:"text-sm text-red-500 mt-1"},Ze={class:"space-y-2"},et={key:0,class:"text-sm text-red-500 mt-1"},tt={class:"space-y-2"},st={key:0,class:"text-sm text-red-500 mt-1"},at={key:0,class:"iconify hugeicons--loading-03 mr-2 animate-spin"},pe=X({__name:"PaymentMotifForm",props:{mode:{},loading:{type:Boolean,default:!1},motif:{default:null}},emits:["submit","cancel"],setup(r,{expose:u,emit:o}){const i=r,l=o,f=Le({fee_type_id:R().transform(g=>g===""?null:Number(g)).nullable().refine(g=>g!==null,"Le type de frais est requis"),name:R().min(1,"Le nom est requis").max(255,"Le nom ne peut pas dépasser 255 caractères"),code:R().min(1,"Le code est requis").max(50,"Le code ne peut pas dépasser 50 caractères"),description:R().min(1,"La description est requise").max(500,"La description ne peut pas dépasser 500 caractères")}),{handleSubmit:M,resetForm:T,setFieldValue:b}=De({validationSchema:Pe(f),initialValues:{fee_type_id:"",name:"",code:"",description:""}}),N=I(()=>i.mode==="create"?"Créer le motif":"Modifier le motif"),k=I(()=>i.mode==="create"?"Création...":"Modification..."),A=M(async g=>{const c={...g,fee_type_id:Number(g.fee_type_id)};l("submit",c)},async g=>{console.log("❌ Form validation errors:",g),_({message:"Veuillez corriger les erreurs dans le formulaire",type:"error"})}),U=()=>{i.mode==="edit"&&i.motif&&(b("fee_type_id",i.motif.fee_type_id.toString()),b("name",i.motif.name),b("code",i.motif.code),b("description",i.motif.description))},q=()=>{T()};return ye(()=>{i.mode==="create"?T():U()}),u({reset:q}),(g,c)=>($(),C("form",{onSubmit:c[1]||(c[1]=Se((...v)=>e(A)&&e(A)(...v),["prevent"])),class:"space-y-4"},[m("div",Ke,[m("div",Xe,[t(e(Q),{for:`${r.mode}-fee_type_id`},{default:s(()=>[...c[2]||(c[2]=[d("Type de frais *",-1)])]),_:1},8,["for"]),t(e(Y),{name:"fee_type_id"},{default:s(({field:v,errorMessage:y})=>[t(Ae,{"model-value":v.value,"onUpdate:modelValue":v.onChange,placeholder:"Sélectionner un type"},null,8,["model-value","onUpdate:modelValue"]),y?($(),C("span",He,x(y),1)):D("",!0)]),_:1})]),m("div",Je,[t(e(Q),{for:`${r.mode}-code`},{default:s(()=>[...c[3]||(c[3]=[d("Code du motif *",-1)])]),_:1},8,["for"]),t(e(Y),{name:"code"},{default:s(({field:v,errorMessage:y})=>[t(e(J),H({id:`${r.mode}-code`},v,{placeholder:"Ex: SCOL, EXAM, INSC...",class:{"border-red-500":y}}),null,16,["id","class"]),y?($(),C("p",We,x(y),1)):D("",!0)]),_:1})])]),m("div",Ze,[t(e(Q),{for:`${r.mode}-name`},{default:s(()=>[...c[4]||(c[4]=[d("Nom du motif *",-1)])]),_:1},8,["for"]),t(e(Y),{name:"name"},{default:s(({field:v,errorMessage:y})=>[t(e(J),H({id:`${r.mode}-name`},v,{placeholder:"Ex: Frais de scolarité, Frais d'examen...",class:{"border-red-500":y}}),null,16,["id","class"]),y?($(),C("p",et,x(y),1)):D("",!0)]),_:1})]),m("div",tt,[t(e(Q),{for:`${r.mode}-description`},{default:s(()=>[...c[5]||(c[5]=[d("Description *",-1)])]),_:1},8,["for"]),t(e(Y),{name:"description"},{default:s(({field:v,errorMessage:y})=>[t(e(ke),H({id:`${r.mode}-description`},v,{placeholder:"Décrivez le motif de paiement...",rows:"3",class:{"border-red-500":y}}),null,16,["id","class"]),y?($(),C("p",st,x(y),1)):D("",!0)]),_:1})]),t(e(Ee),null,{default:s(()=>[t(e(F),{type:"button",variant:"outline",onClick:c[0]||(c[0]=v=>g.$emit("cancel"))},{default:s(()=>[...c[6]||(c[6]=[d(" Annuler ",-1)])]),_:1}),t(e(F),{type:"submit",disabled:r.loading},{default:s(()=>[r.loading?($(),C("span",at)):D("",!0),d(" "+x(r.loading?k.value:N.value),1)]),_:1},8,["disabled"])]),_:1})],32))}});function lt(){const r=O(""),u=O([]),{data:o,error:i,loading:l,fetchData:f}=Fe(z.GET_PAYMENT_MOTIFS),{response:M,error:T,loading:b,postData:N}=Ne(),{response:k,error:A,loading:U,putData:q}=Ue(),{deleteResponse:g,errorDelete:c,deleting:v,deleteItem:y}=qe(),S=I(()=>{var a;if(!((a=o.value)!=null&&a.motifs))return[];if(!r.value)return o.value.motifs;const n=r.value.toLowerCase();return o.value.motifs.filter(p=>{var h,j;return p.name.toLowerCase().includes(n)||p.code.toLowerCase().includes(n)||p.description.toLowerCase().includes(n)||((j=(h=p.fee_type)==null?void 0:h.name)==null?void 0:j.toLowerCase().includes(n))})}),w=I(()=>!S.value||!Array.isArray(S.value)?[]:S.value.filter(n=>u.value.includes(n.id))),V=I(()=>S.value.length>0&&u.value.length===S.value.length);return{searchQuery:r,selectedItems:u,motifsData:o,motifsError:i,motifsLoading:l,createLoading:b,updateLoading:U,deleteLoading:v,filteredMotifs:S,selectedMotifs:w,isAllSelected:V,fetchMotifs:f,createPaymentMotif:async n=>{var a,p;try{return await N(z.CREATE_PAYMENT_MOTIF,n),T.value?(_({message:T.value,type:"error"}),!1):(a=M.value)!=null&&a.success?(_({message:M.value.message||"Motif de paiement créé avec succès.",type:"success"}),await f(),!0):(_({message:((p=M.value)==null?void 0:p.message)||"Erreur lors de la création du motif de paiement.",type:"error"}),!1)}catch(h){return console.error("Erreur lors de la création:",h),_({message:"Une erreur inattendue s'est produite.",type:"error"}),!1}},updatePaymentMotif:async(n,a)=>{var p,h;try{return await q(z.UPDATE_PAYMENT_MOTIF(n),a),A.value?(_({message:A.value,type:"error"}),!1):(p=k.value)!=null&&p.success?(_({message:k.value.message||"Motif de paiement modifié avec succès.",type:"success"}),await f(),!0):(_({message:((h=k.value)==null?void 0:h.message)||"Erreur lors de la modification du motif de paiement.",type:"error"}),!1)}catch(j){return console.error("Erreur lors de la modification:",j),_({message:"Une erreur inattendue s'est produite.",type:"error"}),!1}},deletePaymentMotif:async n=>{var a,p;if(!confirm("Êtes-vous sûr de vouloir supprimer ce motif de paiement ?"))return!1;try{return await y(z.DELETE_PAYMENT_MOTIF(n)),c.value?(_({message:c.value,type:"error"}),!1):(a=g.value)!=null&&a.success?(_({message:g.value.message||"Motif de paiement supprimé avec succès.",type:"success"}),await f(),!0):(_({message:((p=g.value)==null?void 0:p.message)||"Erreur lors de la suppression du motif de paiement.",type:"error"}),!1)}catch(h){return console.error("Erreur lors de la suppression:",h),_({message:"Une erreur inattendue s'est produite.",type:"error"}),!1}},deleteSelectedMotifs:async()=>{if(w.value.length===0)return!1;const n=w.value.map(a=>a.name).join(", ");if(!confirm(`Êtes-vous sûr de vouloir supprimer ces ${w.value.length} motif(s) de paiement ?

${n}`))return!1;try{const a=w.value.map(p=>y(z.DELETE_PAYMENT_MOTIF(p.id)));return await Promise.all(a),_({message:`${w.value.length} motif(s) de paiement supprimé(s) avec succès.`,type:"success"}),u.value=[],await f(),!0}catch(a){return console.error("Erreur lors de la suppression multiple:",a),_({message:"Erreur lors de la suppression des motifs de paiement.",type:"error"}),!1}},toggleSelection:n=>{const a=u.value.indexOf(n);a>-1?u.value.splice(a,1):u.value.push(n)},toggleSelectAll:()=>{V.value?u.value=[]:u.value=S.value.map(n=>n.id)},clearSelection:()=>{u.value=[]},formatDate:n=>{if(!n)return"-";try{return new Date(n).toLocaleDateString("fr-FR",{year:"numeric",month:"short",day:"numeric"})}catch{return"-"}},getFeeTypeName:n=>{var a;return((a=n.fee_type)==null?void 0:a.name)||"Non défini"}}}const bt=X({__name:"Gestion_paiements_motifi",setup(r){const u=O(!1),o=O(!1),i=O(null),{searchQuery:l,selectedItems:f,motifsLoading:M,motifsError:T,createLoading:b,updateLoading:N,deleteLoading:k,filteredMotifs:A,selectedMotifs:U,isAllSelected:q,fetchMotifs:g,createPaymentMotif:c,updatePaymentMotif:v,deletePaymentMotif:y,deleteSelectedMotifs:S,toggleSelection:w,toggleSelectAll:V}=lt(),W=()=>{u.value=!0},Z=n=>{i.value=n,o.value=!0},ee=async n=>{await y(n)&&G.emit("motifUpdated")},te=async()=>{await S()},se=n=>{console.log("Export format:",n)},ae=async n=>{await c(n)&&(u.value=!1,G.emit("motifUpdated"))},le=async n=>{if(!i.value)return;await v(i.value.id,n)&&(o.value=!1,i.value=null,G.emit("motifUpdated"))},oe=()=>{u.value=!1},ne=()=>{o.value=!1,i.value=null};return ye(async()=>{await g()}),G.on("motifUpdated",()=>{g()}),(n,a)=>($(),P($e,{activeBread:"Motifs de Paiement","active-tag-name":"motifs-paiement",group:"frais"},{default:s(()=>[t(Ce,null,{default:s(()=>[t(Oe,{"search-query":e(l),"onUpdate:searchQuery":a[0]||(a[0]=p=>he(l)?l.value=p:null),"selected-count":e(U).length,"delete-loading":e(k),onDeleteSelected:te,onExport:se,onCreateMotif:W},null,8,["search-query","selected-count","delete-loading"]),t(Ge,{motifs:e(A),"selected-items":e(f),loading:e(M),error:e(T),"has-search-query":!!e(l),"is-all-selected":e(q),onToggleSelection:e(w),onToggleSelectAll:e(V),onEditMotif:Z,onDeleteMotif:ee},null,8,["motifs","selected-items","loading","error","has-search-query","is-all-selected","onToggleSelection","onToggleSelectAll"])]),_:1}),t(e(me),{open:u.value,"onUpdate:open":a[1]||(a[1]=p=>u.value=p)},{default:s(()=>[t(e(ie),{class:"sm:max-w-[600px]"},{default:s(()=>[t(e(re),null,{default:s(()=>[t(e(de),null,{default:s(()=>[...a[3]||(a[3]=[d("Créer un nouveau motif de paiement",-1)])]),_:1}),t(e(ue),null,{default:s(()=>[...a[4]||(a[4]=[d(" Ajoutez un nouveau motif de paiement au système. ",-1)])]),_:1})]),_:1}),t(pe,{mode:"create",loading:e(b),onSubmit:ae,onCancel:oe},null,8,["loading"])]),_:1})]),_:1},8,["open"]),t(e(me),{open:o.value,"onUpdate:open":a[2]||(a[2]=p=>o.value=p)},{default:s(()=>[t(e(ie),{class:"sm:max-w-[600px]"},{default:s(()=>[t(e(re),null,{default:s(()=>[t(e(de),null,{default:s(()=>[...a[5]||(a[5]=[d("Modifier le motif de paiement",-1)])]),_:1}),t(e(ue),null,{default:s(()=>[...a[6]||(a[6]=[d(" Modifiez les informations du motif de paiement. ",-1)])]),_:1})]),_:1}),t(pe,{mode:"edit",loading:e(N),motif:i.value,onSubmit:le,onCancel:ne},null,8,["loading","motif"])]),_:1})]),_:1},8,["open"])]),_:1}))}});export{bt as default};
