import{d as ne,u as ue,A as de,s as X,a as me,v as pe,x as ce,w as r,b as x,f as t,c as i,h as u,i as e,j as d,t as m,z as _,y as c,k as Y,g as _e,o}from"./index-CJ_PivE-.js";import{_ as fe}from"./FormSection.vue_vue_type_script_setup_true_lang-C-XSdIg3.js";import{I as p}from"./InputWrapper-tSRHzcjN.js";import{S as f}from"./SpanRequired-COKghTUX.js";import{_ as ve}from"./DashFormLayout.vue_vue_type_script_setup_true_lang-3V-LyRCQ.js";import{_ as v}from"./Input.vue_vue_type_script_setup_true_lang-B9adgRZV.js";import{S as Ve}from"./Spinner-BZtQf9oC.js";import{u as xe}from"./usePostApi-Crg8MURP.js";import{e as ge}from"./eventBus-CGRXT3Tn.js";import{_ as be}from"./ListClassRoom.vue_vue_type_script_setup_true_lang-crHdkUu0.js";import{_ as ye}from"./ListFonction.vue_vue_type_script_setup_true_lang-B1uv4HzQ.js";import{u as he,a as n,t as Ee}from"./vee-validate-zod-Bra4yLtR.js";import{z as a}from"./external-CYeExkxg.js";import{_ as ke}from"./Textarea.vue_vue_type_script_setup_true_lang-Bg8QXdyw.js";import"./BoxPanelWrapper.vue_vue_type_script_setup_true_lang-CmJ-Iy6y.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./DashLayout.vue_vue_type_script_setup_true_lang-Ch2egXHm.js";import"./RightDashHeader.vue_vue_type_script_setup_true_lang-Bn3G870_.js";import"./FormPageHeader.vue_vue_type_script_setup_true_lang-CAg7Z6LS.js";import"./index-BpkKmY4O.js";import"./SelectGroup.vue_vue_type_script_setup_true_lang-CwIOzTi6.js";import"./useGetApi-EdzHoZm6.js";const Se={key:0,class:"text-xs text-red-500"},Me={key:0,class:"text-xs text-red-500"},we={key:0,class:"text-xs text-red-500"},ze={key:0,class:"text-xs text-red-500"},Ce={key:0,class:"text-xs text-red-500"},Ue={key:0,class:"text-xs text-red-500"},Ie={key:0,class:"text-xs text-red-500"},qe={key:0,class:"text-xs text-red-500"},Ne={key:0,class:"text-xs text-red-500"},$e={key:0,class:"text-xs text-red-500"},je={key:0,class:"text-xs text-red-500"},Ae={key:0,class:"text-xs text-red-500"},Re={key:0,class:"text-xs text-red-500"},He={key:0,class:"text-xs text-red-500"},Oe={class:"flex items-center justify-end gap-2"},Be={key:0,class:"flex items-center gap-2"},Te={key:1},De={class:"flex items-center gap-2"},_l=ne({__name:"NewVisiteClasse",setup(Pe){const j=me(),g=ue(),Z=a.object({school_id:a.number({required_error:"Veuillez sélectionner l'école"}).min(1,"Veuillez sélectionner l'école"),subject:a.string({required_error:"Veuillez saisir le sujet"}).min(2).max(100),classroom_id:a.number({required_error:"Veuillez sélectionner la classe"}).min(1,"Veuillez sélectionner la classe"),personal_id:a.number({required_error:"Veuillez sélectionner le personnel scolaire"}).min(1,"Veuillez sélectionner le personnel scolaire"),cot_doc_prof:a.number({required_error:"Veuillez saisir la cote du document professeur"}).min(0),cot_meth_proc:a.number({required_error:"Veuillez saisir la cote de la méthode/procédure"}).min(0),cot_matiere:a.number({required_error:"Veuillez saisir la cote de la matière"}).min(0),cot_march_lecon:a.number({required_error:"Veuillez saisir la cote de la marche de la leçon"}).min(0),cot_enseignant:a.number({required_error:"Veuillez saisir la cote de l'enseignant"}).min(0),cot_eleve:a.number({required_error:"Veuillez saisir la cote de l'élève"}).min(0),ctrl_doc_eleve:a.number({required_error:"Veuillez saisir le contrôle document de l'élève"}).min(0),visit_hour:a.string({required_error:"Veuillez saisir l'heure de début"}).regex(/^([0-1]\d|2[0-3]):([0-5]\d)$/,"Veuillez saisir une heure valide au format HH:mm"),end_time:a.string({required_error:"Veuillez saisir l'heure de fin"}).regex(/^([0-1]\d|2[0-3]):([0-5]\d)$/,"Veuillez saisir une heure valide au format HH:mm"),summary:a.string({required_error:"Veuillez saisir le Commentaire"}).min(2).max(500),visiteur:a.string().optional(),fonction_id:a.number().optional()}),{handleSubmit:ee,resetForm:le}=he({validationSchema:Ee(Z)}),{value:b,errorMessage:A}=n("subject",void 0,{initialValue:""}),{value:te,errorMessage:Fe}=n("school_id",void 0,{initialValue:0}),{value:y,errorMessage:R}=n("classroom_id",void 0,{initialValue:0}),{value:se,errorMessage:Je}=n("personal_id",void 0,{initialValue:0}),{value:h,errorMessage:H}=n("cot_doc_prof",void 0,{initialValue:0}),{value:E,errorMessage:O}=n("cot_meth_proc",void 0,{initialValue:0}),{value:k,errorMessage:B}=n("cot_matiere",void 0,{initialValue:0}),{value:S,errorMessage:T}=n("cot_march_lecon",void 0,{initialValue:0}),{value:M,errorMessage:D}=n("cot_enseignant",void 0,{initialValue:0}),{value:w,errorMessage:P}=n("cot_eleve",void 0,{initialValue:0}),{value:z,errorMessage:F}=n("ctrl_doc_eleve",void 0,{initialValue:0}),{value:C,errorMessage:J}=n("visit_hour",void 0,{initialValue:""}),{value:U,errorMessage:L}=n("end_time",void 0,{initialValue:""}),{value:I,errorMessage:K}=n("summary",void 0,{initialValue:""}),{value:q,errorMessage:W}=n("visiteur",void 0,{initialValue:""}),{value:N,errorMessage:G}=n("fonction_id",void 0,{initialValue:0}),{loading:re,error:$,response:oe,postData:ae}=xe(),Q=ee(async V=>{if(console.log("=== FORM SUBMISSION ==="),console.log("All fields:",JSON.stringify(V,null,2)),V.visit_hour){const l=new Date,[s,ie]=V.visit_hour.split(":");l.setHours(parseInt(s),parseInt(ie),0,0),V.visit_hour=l.toISOString(),console.log("visit_hour converted to:",V.visit_hour)}if(await ae(de.CREATE_VISITE_CLASSE,V),ge.emit("studentUpdated"),$.value){console.error("=== BACKEND ERROR ==="),console.error("Error details:",JSON.stringify($.value,null,2)),X({message:$.value,type:"error"});return}else oe.value&&(X({message:"Visite de classe créée avec succès",type:"success"}),le(),j.push("/apprenants/operations/visite-classe"))});return pe(()=>{var V,l;(V=g.user)!=null&&V.school_id&&(te.value=Number(g.user.school_id)),(l=g.user)!=null&&l.id&&(se.value=Number(g.user.id))}),(V,l)=>(o(),ce(ve,{title:"Ajouter une visite de classe","link-back":"/apprenants/operations/visite-classe",module:"students","group-route":"/apprenants/operations",breadcrumb:[{label:"Élèves",href:"/apprenants"},{label:"Opérations",href:"/apprenants/operations"},{label:"Visite de Classes",href:"/apprenants/operations/visite-classe"},{label:"Nouvelle Visite",href:"/apprenants/operations/visite-classe/nouvelle"}]},{default:r(()=>[x("form",{class:"w-full flex flex-col space-y-8",onSubmit:l[15]||(l[15]=_e((...s)=>e(Q)&&e(Q)(...s),["prevent"]))},[t(fe,{class:"grid sm:grid-cols-2 lg:grid-cols-3 gap-y-6 gap-x-10",title:"Informations de la visite de classe"},{default:r(()=>[t(p,null,{default:r(()=>[t(be,{modelValue:e(y),"onUpdate:modelValue":l[0]||(l[0]=s=>d(y)?y.value=s:null)},null,8,["modelValue"]),e(R)?(o(),i("span",Se,m(e(R)),1)):u("",!0)]),_:1}),t(p,null,{default:r(()=>[t(e(_),{class:"text-sm"},{default:r(()=>[l[16]||(l[16]=c(" Sujet de la leçon ",-1)),t(f)]),_:1}),t(e(v),{class:"bg-white transition-all h-10 rounded-md",placeholder:"Isaac",modelValue:e(b),"onUpdate:modelValue":l[1]||(l[1]=s=>d(b)?b.value=s:null)},null,8,["modelValue"]),e(A)?(o(),i("span",Me,m(e(A)),1)):u("",!0)]),_:1}),t(p,null,{default:r(()=>[t(e(_),{class:"text-sm"},{default:r(()=>[l[17]||(l[17]=c(" Cote du document professeur ",-1)),t(f)]),_:1}),t(e(v),{type:"number",class:"bg-white transition-all h-10 rounded-md",modelValue:e(h),"onUpdate:modelValue":l[2]||(l[2]=s=>d(h)?h.value=s:null)},null,8,["modelValue"]),e(H)?(o(),i("span",we,m(e(H)),1)):u("",!0)]),_:1}),t(p,null,{default:r(()=>[t(e(_),{class:"text-sm"},{default:r(()=>[l[18]||(l[18]=c(" Cote de la méthode/procédure ",-1)),t(f)]),_:1}),t(e(v),{type:"number",class:"bg-white transition-all h-10 rounded-md",modelValue:e(E),"onUpdate:modelValue":l[3]||(l[3]=s=>d(E)?E.value=s:null)},null,8,["modelValue"]),e(O)?(o(),i("span",ze,m(e(O)),1)):u("",!0)]),_:1}),t(p,null,{default:r(()=>[t(e(_),{class:"text-sm"},{default:r(()=>[l[19]||(l[19]=c(" Cote de la matière ",-1)),t(f)]),_:1}),t(e(v),{type:"number",class:"bg-white transition-all h-10 rounded-md",modelValue:e(k),"onUpdate:modelValue":l[4]||(l[4]=s=>d(k)?k.value=s:null)},null,8,["modelValue"]),e(B)?(o(),i("span",Ce,m(e(B)),1)):u("",!0)]),_:1}),t(p,null,{default:r(()=>[t(e(_),{class:"text-sm"},{default:r(()=>[l[20]||(l[20]=c(" Cote de la marche de la leçon ",-1)),t(f)]),_:1}),t(e(v),{type:"number",class:"bg-white transition-all h-10 rounded-md",modelValue:e(S),"onUpdate:modelValue":l[5]||(l[5]=s=>d(S)?S.value=s:null)},null,8,["modelValue"]),e(T)?(o(),i("span",Ue,m(e(T)),1)):u("",!0)]),_:1}),t(p,null,{default:r(()=>[t(e(_),{class:"text-sm"},{default:r(()=>[l[21]||(l[21]=c(" Cote de l'enseignant ",-1)),t(f)]),_:1}),t(e(v),{type:"number",class:"bg-white transition-all h-10 rounded-md",modelValue:e(M),"onUpdate:modelValue":l[6]||(l[6]=s=>d(M)?M.value=s:null)},null,8,["modelValue"]),e(D)?(o(),i("span",Ie,m(e(D)),1)):u("",!0)]),_:1}),t(p,null,{default:r(()=>[t(e(_),{class:"text-sm"},{default:r(()=>[l[22]||(l[22]=c(" Participation de l'élève ",-1)),t(f)]),_:1}),t(e(v),{type:"number",class:"bg-white transition-all h-10 rounded-md",modelValue:e(w),"onUpdate:modelValue":l[7]||(l[7]=s=>d(w)?w.value=s:null)},null,8,["modelValue"]),e(P)?(o(),i("span",qe,m(e(P)),1)):u("",!0)]),_:1}),t(p,null,{default:r(()=>[t(e(_),{class:"text-sm"},{default:r(()=>[l[23]||(l[23]=c(" Contrôle document de l'élève ",-1)),t(f)]),_:1}),t(e(v),{type:"number",class:"bg-white transition-all h-10 rounded-md",modelValue:e(z),"onUpdate:modelValue":l[8]||(l[8]=s=>d(z)?z.value=s:null)},null,8,["modelValue"]),e(F)?(o(),i("span",Ne,m(e(F)),1)):u("",!0)]),_:1}),t(p,null,{default:r(()=>[t(e(_),{class:"text-sm"},{default:r(()=>[l[24]||(l[24]=c(" Heure de début ",-1)),t(f)]),_:1}),t(e(v),{type:"time",class:"bg-white transition-all h-10 rounded-md",modelValue:e(C),"onUpdate:modelValue":l[9]||(l[9]=s=>d(C)?C.value=s:null)},null,8,["modelValue"]),e(J)?(o(),i("span",$e,m(e(J)),1)):u("",!0)]),_:1}),t(p,null,{default:r(()=>[t(e(_),{class:"text-sm"},{default:r(()=>[l[25]||(l[25]=c(" Heure de fin ",-1)),t(f)]),_:1}),t(e(v),{type:"time",class:"bg-white transition-all h-10 rounded-md",modelValue:e(U),"onUpdate:modelValue":l[10]||(l[10]=s=>d(U)?U.value=s:null)},null,8,["modelValue"]),e(L)?(o(),i("span",je,m(e(L)),1)):u("",!0)]),_:1}),t(p,null,{default:r(()=>[t(e(_),{class:"text-sm"},{default:r(()=>[...l[26]||(l[26]=[c(" Visiteur ",-1)])]),_:1}),t(e(v),{class:"bg-white transition-all h-10 rounded-md",placeholder:"Nom du visiteur",modelValue:e(q),"onUpdate:modelValue":l[11]||(l[11]=s=>d(q)?q.value=s:null)},null,8,["modelValue"]),e(W)?(o(),i("span",Ae,m(e(W)),1)):u("",!0)]),_:1}),t(p,null,{default:r(()=>[t(ye,{modelValue:e(N),"onUpdate:modelValue":l[12]||(l[12]=s=>d(N)?N.value=s:null)},null,8,["modelValue"]),e(G)?(o(),i("span",Re,m(e(G)),1)):u("",!0)]),_:1}),t(p,{class:"sm:col-span-2 lg:col-span-3"},{default:r(()=>[t(e(_),{class:"text-sm"},{default:r(()=>[l[27]||(l[27]=c(" Commentaire ",-1)),t(f)]),_:1}),t(e(ke),{class:"bg-white transition-all h-10 rounded-md",placeholder:"Commentaire",modelValue:e(I),"onUpdate:modelValue":l[13]||(l[13]=s=>d(I)?I.value=s:null)},null,8,["modelValue"]),e(K)?(o(),i("span",He,m(e(K)),1)):u("",!0)]),_:1})]),_:1}),l[31]||(l[31]=x("div",{class:"w-full flex h-px bg-gray-300"},null,-1)),x("div",Oe,[t(e(Y),{variant:"outline",type:"button",onClick:l[14]||(l[14]=s=>e(j).push("/apprenants/operations/visite-classe"))},{default:r(()=>[...l[28]||(l[28]=[x("span",{class:"flex iconify hugeicons--cancel-01 mr-1.5"},null,-1),c(" Annuler ",-1)])]),_:1}),t(e(Y),{type:"submit"},{default:r(()=>[e(re)?(o(),i("span",Te,[x("div",De,[t(Ve),l[30]||(l[30]=x("span",null,"Enregistrement en cours...",-1))])])):(o(),i("span",Be,[...l[29]||(l[29]=[x("span",{class:"iconify hugeicons--floppy-disk mr-1"},null,-1),x("span",null,"Enregistrer",-1)])]))]),_:1})])],32)]),_:1}))}});export{_l as default};
