import{d as R,r as y,A as V,s as v,x as I,i as e,K as Y,w as l,f as s,k as p,b as a,L as q,M as L,N as O,y as m,O as K,g as W,c as u,h as se,z as X,j as te,t as M,P as Z,o,p as B,v as le,a2 as ae,G as F,F as ne,R as ie,S as oe,U as re,V as ue,W as de,X as me,Y as pe,Z as fe}from"./index-CJ_PivE-.js";import{_ as ce}from"./DashLayout.vue_vue_type_script_setup_true_lang-Ch2egXHm.js";import{_ as _e}from"./DashPageHeader.vue_vue_type_script_setup_true_lang-DucYyTAx.js";import{_ as ye}from"./BoxPanelWrapper.vue_vue_type_script_setup_true_lang-CmJ-Iy6y.js";import{u as ve}from"./useGetApi-EdzHoZm6.js";import{u as ge}from"./useDeleteApi-D2AjqV8w.js";import{u as xe}from"./usePutApi-BrTvEW5v.js";import{e as b}from"./eventBus-CGRXT3Tn.js";import{_ as P}from"./Input.vue_vue_type_script_setup_true_lang-B9adgRZV.js";import{_ as D}from"./IconifySpinner.vue_vue_type_script_setup_true_lang-C3Td1B5O.js";import{_ as be}from"./TableRowActions.vue_vue_type_script_setup_true_lang-C8PT7-8D.js";import{_ as $e}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-Bm461x8Q.js";import{o as ke,s as Te,u as we,a as Ee,t as Se}from"./vee-validate-zod-Bra4yLtR.js";import{u as Ae}from"./usePostApi-Crg8MURP.js";import"./RightDashHeader.vue_vue_type_script_setup_true_lang-Bn3G870_.js";import"./index-BpkKmY4O.js";const Ce={class:"grid gap-4 py-4"},he={class:"flex flex-col space-y-1.5"},Ve={key:0,class:"text-red-500 text-xs mt-1"},ze={key:0,class:"flex items-center gap-2"},Ue={key:1,class:"flex items-center gap-2"},je=R({__name:"NewType",setup(H){const g=y(!1),{loading:c,error:$,response:x,postData:z,success:U}=Ae(),k=ke({title:Te({required_error:"Veuillez saisir le titre du type"}).min(2).max(100)}),{handleSubmit:T,resetForm:w}=we({validationSchema:Se(k)}),{value:_,errorMessage:E}=Ee("title"),S=T(async f=>{var r;const n={title:f.title.trim()};if(await z(V.GET_TYPES,n),$.value){v({message:$.value,type:"error"});return}U.value&&(b.emit("typeUpdated"),v({message:((r=x.value)==null?void 0:r.message)||"Type créé avec succès",type:"success"}),w(),g.value=!1)});return(f,n)=>(o(),I(e(Y),{open:g.value,"onUpdate:open":n[2]||(n[2]=r=>g.value=r)},{default:l(()=>[s(e($e),{"as-child":""},{default:l(()=>[s(e(p),{size:"md",class:"rounded-md"},{default:l(()=>[...n[3]||(n[3]=[a("span",{class:"iconify hugeicons--plus-sign"},null,-1),a("span",{class:"hidden sm:flex"},"Ajouter un type",-1)])]),_:1})]),_:1}),s(e(q),{class:"sm:max-w-[400px]"},{default:l(()=>[s(e(L),null,{default:l(()=>[s(e(O),null,{default:l(()=>[...n[4]||(n[4]=[m("Ajouter un type",-1)])]),_:1}),s(e(K),null,{default:l(()=>[...n[5]||(n[5]=[m("Enregistrer un type",-1)])]),_:1})]),_:1}),a("form",{onSubmit:n[1]||(n[1]=W((...r)=>e(S)&&e(S)(...r),["prevent"]))},[a("div",Ce,[a("div",he,[s(e(X),{for:"title",class:"text-sm font-medium"},{default:l(()=>[...n[6]||(n[6]=[m("Titre du type",-1)])]),_:1}),s(e(P),{type:"text",id:"title",name:"title",modelValue:e(_),"onUpdate:modelValue":n[0]||(n[0]=r=>te(_)?_.value=r:null),placeholder:"Entrez le titre du type",class:"w-full h-10 border border-gray-200/40 bg-white transition-all",disabled:e(c)},null,8,["modelValue","disabled"]),e(E)?(o(),u("span",Ve,M(e(E)),1)):se("",!0)])]),s(e(Z),{class:"flex justify-end gap-2 items-center"},{default:l(()=>[s(e(p),{size:"sm",class:"h-9",variant:"outline",type:"button",onClick:e(w),disabled:e(c)},{default:l(()=>[...n[7]||(n[7]=[a("span",{class:"iconify flex hugeicons--cancel-01 mr-1"},null,-1),m(" Annuler ",-1)])]),_:1},8,["onClick","disabled"]),s(e(p),{size:"sm",class:"h-9",type:"submit",disabled:e(c)},{default:l(()=>[e(c)?(o(),u("span",Ue,[s(D,{size:"lg"}),n[9]||(n[9]=a("span",null,"Enregistrement en cours...",-1))])):(o(),u("span",ze,[...n[8]||(n[8]=[a("span",{class:"iconify hugeicons--floppy-disk mr-1"},null,-1),a("span",null,"Enregistrer",-1)])]))]),_:1},8,["disabled"])]),_:1})],32)]),_:1})]),_:1},8,["open"]))}}),Me={class:"pb-6 mx-auto w-full max-w-7xl"},Pe={class:"flex items-center gap-3 justify-between"},De={class:"relative flex-1"},Ge={class:"flex items-center gap-2"},Ne={class:"mt-4 flex-1 min-h-0 overflow-auto bg-white rounded-md border border-gray-100"},Be={key:0,class:"p-4 text-sm text-gray-600"},Fe={key:1,class:"p-4 text-sm text-red-600"},Re={key:0,class:"p-4 text-sm text-gray-600"},Ie={key:1,class:"divide-y"},Ye={class:"flex items-center gap-3"},qe={class:"font-medium"},Le={key:0,class:"flex items-center gap-2"},Oe={key:1},Ke={class:"grid gap-4 py-4"},We={class:"flex flex-col space-y-1.5"},Xe={key:0,class:"flex items-center gap-2"},Ze={key:1,class:"flex items-center gap-2"},fs=R({__name:"Type",setup(H){const g={items:[{label:"Accueil",href:"/",icon:"hugeicons--home-01"},{label:"Administration",href:"/admin"},{label:"Types",isActive:!0}]},c=[{name:"type",text:"Type",href:"/admin/type"}],$=B(()=>"type"),x=y(""),{data:z,loading:U,error:k,fetchData:T}=ve(V.GET_TYPES),{deleteItem:w,deleting:_,errorDelete:E}=ge(),{putData:S,loading:f,error:n}=xe(),r=y(!1),j=y(null),A=y("");function J(d){j.value=d.id,A.value=d.title,r.value=!0}const C=y(null);async function Q(d,t){C.value=d,await w(`${V.GET_TYPES}/${d}`)?(v({message:`Type "${t}" supprimé avec succès`,type:"success"}),b.emit("typeUpdated")):v({message:E.value||"Suppression impossible",type:"error"}),C.value=null}async function ee(){if(!j.value)return;const d={title:A.value.trim()};if(await S(`${V.GET_TYPES}/${j.value}`,d),n.value){v({message:n.value,type:"error"});return}updResponse.value&&(v({message:"Type mis à jour avec succès",type:"success"}),r.value=!1,b.emit("typeUpdated"))}function G(){T()}le(()=>{T(),b.on("typeUpdated",G)}),ae(()=>{b.off("typeUpdated",G)});const N=B(()=>{const d=z.value||[],t=x.value.trim().toLowerCase();return t?d.filter(i=>{var h;return(h=i.title)==null?void 0:h.toLowerCase().includes(t)}):d});return(d,t)=>(o(),I(ce,{breadcrumb:g,"active-route":"/admin/type","module-name":"admin"},{default:l(()=>[a("div",Me,[s(_e,{title:"Administration",tags:c,"active-tag-name":$.value},null,8,["active-tag-name"]),s(ye,null,{default:l(()=>[a("div",Pe,[a("div",De,[s(e(P),{modelValue:x.value,"onUpdate:modelValue":t[0]||(t[0]=i=>x.value=i),placeholder:"Rechercher un type...",class:"w-full max-w-sm ps-10 h-10"},null,8,["modelValue"]),t[4]||(t[4]=a("div",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-foreground-muted/70"},[a("span",{class:"iconify hugeicons--search-01 text-sm"})],-1))]),a("div",Ge,[s(je)])]),a("div",Ne,[e(U)?(o(),u("div",Be,"Chargement...")):e(k)?(o(),u("div",Fe,M(e(k)),1)):(o(),u(F,{key:2},[(N.value||[]).length===0?(o(),u("div",Re,"Aucun type trouvé.")):(o(),u("ul",Ie,[(o(!0),u(F,null,ne(N.value,i=>(o(),u("li",{key:i.id,class:"px-4 py-3 flex items-center justify-between"},[a("div",Ye,[a("span",qe,M(i.title),1)]),s(be,null,{actions:l(()=>[s(e(p),{size:"sm",variant:"outline",class:"h-8",onClick:h=>J(i)},{default:l(()=>[...t[5]||(t[5]=[a("span",{class:"iconify hugeicons--edit-01"},null,-1),a("span",{class:"sr-only"},"Modifier",-1)])]),_:1},8,["onClick"]),s(e(ie),null,{default:l(()=>[s(e(oe),{"as-child":""},{default:l(()=>[s(e(p),{size:"sm",variant:"destructive",class:"h-8"},{default:l(()=>[...t[6]||(t[6]=[a("span",{class:"iconify hugeicons--delete-02"},null,-1),a("span",{class:"sr-only"},"Supprimer",-1)])]),_:1})]),_:1}),s(e(re),null,{default:l(()=>[s(e(ue),null,{default:l(()=>[s(e(de),null,{default:l(()=>[...t[7]||(t[7]=[m("Supprimer ce type ?",-1)])]),_:1}),s(e(me),null,{default:l(()=>[...t[8]||(t[8]=[m(" Cette action est irréversible. Si des données dépendent de ce type, la suppression sera refusée. ",-1)])]),_:1})]),_:1}),s(e(pe),null,{default:l(()=>[s(e(fe),null,{default:l(()=>[...t[9]||(t[9]=[m("Annuler",-1)])]),_:1}),s(e(p),{variant:"destructive",disabled:e(_)&&C.value===i.id,onClick:h=>Q(i.id,i.title)},{default:l(()=>[e(_)&&C.value===i.id?(o(),u("span",Le,[s(D,{size:"sm"}),t[10]||(t[10]=a("span",null,"Suppression...",-1))])):(o(),u("span",Oe,"Confirmer"))]),_:2},1032,["disabled","onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]))),128)),s(e(Y),{open:r.value,"onUpdate:open":t[3]||(t[3]=i=>r.value=i)},{default:l(()=>[s(e(q),{class:"sm:max-w-[420px]"},{default:l(()=>[s(e(L),null,{default:l(()=>[s(e(O),null,{default:l(()=>[...t[11]||(t[11]=[m("Modifier un type",-1)])]),_:1}),s(e(K),null,{default:l(()=>[...t[12]||(t[12]=[m("Mettre à jour le titre du type",-1)])]),_:1})]),_:1}),a("form",{onSubmit:W(ee,["prevent"])},[a("div",Ke,[a("div",We,[s(e(X),{for:"title",class:"text-sm font-medium"},{default:l(()=>[...t[13]||(t[13]=[m("Titre",-1)])]),_:1}),s(e(P),{id:"title",modelValue:A.value,"onUpdate:modelValue":t[1]||(t[1]=i=>A.value=i),class:"h-10",disabled:e(f),required:""},null,8,["modelValue","disabled"])])]),s(e(Z),{class:"flex justify-end gap-2 items-center"},{default:l(()=>[s(e(p),{size:"sm",class:"h-9",variant:"outline",type:"button",disabled:e(f),onClick:t[2]||(t[2]=i=>r.value=!1)},{default:l(()=>[...t[14]||(t[14]=[m(" Annuler ",-1)])]),_:1},8,["disabled"]),s(e(p),{size:"sm",class:"h-9",type:"submit",disabled:e(f)},{default:l(()=>[e(f)?(o(),u("span",Ze,[s(D,{size:"lg"}),t[16]||(t[16]=a("span",null,"Mise à jour...",-1))])):(o(),u("span",Xe,[...t[15]||(t[15]=[a("span",{class:"iconify hugeicons--floppy-disk"},null,-1),a("span",null,"Enregistrer",-1)])]))]),_:1},8,["disabled"])]),_:1})],32)]),_:1})]),_:1},8,["open"])]))],64))])]),_:1})])]),_:1}))}});export{fs as default};
