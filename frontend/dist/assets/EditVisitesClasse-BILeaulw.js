import{d as ce,r as pe,u as ve,a1 as _e,A as le,s as te,a as fe,v as Ve,x as ge,w as r,b as x,f as t,c as u,h as m,i as l,j as c,t as p,z as f,y as _,k as se,g as xe,m as be,o as a}from"./index-CJ_PivE-.js";import{_ as ye}from"./FormSection.vue_vue_type_script_setup_true_lang-C-XSdIg3.js";import{I as v}from"./InputWrapper-tSRHzcjN.js";import{S as g}from"./SpanRequired-COKghTUX.js";import{_ as he}from"./DashFormLayout.vue_vue_type_script_setup_true_lang-3V-LyRCQ.js";import{_ as V}from"./Input.vue_vue_type_script_setup_true_lang-B9adgRZV.js";import{S as Ee}from"./Spinner-BZtQf9oC.js";import{u as Se}from"./usePutApi-BrTvEW5v.js";import{e as Me}from"./eventBus-CGRXT3Tn.js";import{_ as ke}from"./ListClassRoom.vue_vue_type_script_setup_true_lang-crHdkUu0.js";import{_ as we}from"./ListFonction.vue_vue_type_script_setup_true_lang-B1uv4HzQ.js";import{u as Ie,a as n,t as ze}from"./vee-validate-zod-Bra4yLtR.js";import{z as i}from"./external-CYeExkxg.js";import"./BoxPanelWrapper.vue_vue_type_script_setup_true_lang-CmJ-Iy6y.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./DashLayout.vue_vue_type_script_setup_true_lang-Ch2egXHm.js";import"./RightDashHeader.vue_vue_type_script_setup_true_lang-Bn3G870_.js";import"./FormPageHeader.vue_vue_type_script_setup_true_lang-CAg7Z6LS.js";import"./index-BpkKmY4O.js";import"./SelectGroup.vue_vue_type_script_setup_true_lang-CwIOzTi6.js";import"./useGetApi-EdzHoZm6.js";const Ue={key:0,class:"text-xs text-red-500"},qe={key:0,class:"text-xs text-red-500"},Ce={key:0,class:"text-xs text-red-500"},Ne={key:0,class:"text-xs text-red-500"},$e={key:0,class:"text-xs text-red-500"},je={key:0,class:"text-xs text-red-500"},De={key:0,class:"text-xs text-red-500"},Te={key:0,class:"text-xs text-red-500"},He={key:0,class:"text-xs text-red-500"},Ae={key:0,class:"text-xs text-red-500"},Be={key:0,class:"text-xs text-red-500"},Re={key:0,class:"text-xs text-red-500"},Fe={key:0,class:"text-xs text-red-500"},Oe={key:0,class:"text-xs text-red-500"},Pe={class:"flex items-center justify-end gap-2"},Le={key:0,class:"flex items-center gap-2"},Ge={key:1},Je={class:"flex items-center gap-2"},gl=ce({__name:"EditVisitesClasse",setup(We){const o=pe(null),D=fe(),b=ve(),re=i.object({school_id:i.number({required_error:"Veuillez sélectionner l'école"}).min(1,"Veuillez sélectionner l'école"),subject:i.string({required_error:"Veuillez saisir le sujet"}).min(2).max(100),classroom_id:i.number({required_error:"Veuillez sélectionner la classe"}).min(1,"Veuillez sélectionner la classe"),personal_id:i.number({required_error:"Veuillez sélectionner le personnel scolaire"}).min(1,"Veuillez sélectionner le personnel scolaire"),cot_doc_prof:i.number({required_error:"Veuillez saisir la cote du document professeur"}).min(0),cot_meth_proc:i.number({required_error:"Veuillez saisir la cote de la méthode/procédure"}).min(0),cot_matiere:i.number({required_error:"Veuillez saisir la cote de la matière"}).min(0),cot_march_lecon:i.number({required_error:"Veuillez saisir la cote de la marche de la leçon"}).min(0),cot_enseignant:i.number({required_error:"Veuillez saisir la cote de l'enseignant"}).min(0),cot_eleve:i.number({required_error:"Veuillez saisir la cote de l'élève"}).min(0),ctrl_doc_eleve:i.number({required_error:"Veuillez saisir le contrôle document de l'élève"}).min(0),visit_hour:i.string({required_error:"Veuillez saisir l'heure de début"}).regex(/^([0-1]\d|2[0-3]):([0-5]\d)$/,"Veuillez saisir une heure valide au format HH:mm"),end_time:i.string({required_error:"Veuillez saisir l'heure de fin"}).regex(/^([0-1]\d|2[0-3]):([0-5]\d)$/,"Veuillez saisir une heure valide au format HH:mm"),summary:i.string({required_error:"Veuillez saisir le résumé"}).min(2).max(500),visiteur:i.string().optional(),fonction_id:i.number().optional()}),{handleSubmit:oe,resetForm:ae}=Ie({validationSchema:ze(re)}),{value:y,errorMessage:T}=n("subject",void 0,{initialValue:""}),{value:H,errorMessage:Ye}=n("school_id",void 0,{initialValue:0}),{value:h,errorMessage:A}=n("classroom_id",void 0,{initialValue:0}),{value:B,errorMessage:Ke}=n("personal_id",void 0,{initialValue:0}),{value:E,errorMessage:R}=n("cot_doc_prof",void 0,{initialValue:0}),{value:S,errorMessage:F}=n("cot_meth_proc",void 0,{initialValue:0}),{value:M,errorMessage:O}=n("cot_matiere",void 0,{initialValue:0}),{value:k,errorMessage:P}=n("cot_march_lecon",void 0,{initialValue:0}),{value:w,errorMessage:L}=n("cot_enseignant",void 0,{initialValue:0}),{value:I,errorMessage:G}=n("cot_eleve",void 0,{initialValue:0}),{value:z,errorMessage:J}=n("ctrl_doc_eleve",void 0,{initialValue:0}),{value:U,errorMessage:W}=n("visit_hour",void 0,{initialValue:""}),{value:q,errorMessage:Y}=n("end_time",void 0,{initialValue:""}),{value:C,errorMessage:K}=n("summary",void 0,{initialValue:""}),{value:N,errorMessage:Q}=n("visiteur",void 0,{initialValue:""}),{value:$,errorMessage:X}=n("fonction_id",void 0,{initialValue:0}),{loading:ie,error:Z,response:ue,putData:ne}=Se(),{id:j}=_e().params,ee=oe(async d=>{if(console.log("=== EDIT FORM SUBMISSION ==="),console.log("All fields:",JSON.stringify(d,null,2)),d.visit_hour){const e=new Date,[s,me]=d.visit_hour.split(":");e.setHours(parseInt(s),parseInt(me),0,0),d.visit_hour=e.toISOString(),console.log("visit_hour converted to:",d.visit_hour)}if(await ne(le.UPDATE_VISITE_CLASSE.replace(":id",j),d),Me.emit("studentUpdated"),Z.value){te({message:Z.value,type:"error"});return}else ue.value&&(te({message:"Visite de classe mise à jour avec succès",type:"success"}),ae(),D.push("/apprenants/operations/visite-classe"))}),de=async()=>{try{console.log("Fetching visit with ID:",j);const{data:d}=await be.get(le.GET_VISIT_BY_ID.replace(":id",j));if(o.value=d,console.log(o.value),o.value){if(y.value=o.value.subject,H.value=Number(o.value.school_id),h.value=Number(o.value.classroom_id),B.value=Number(o.value.personal_id),E.value=o.value.cot_doc_prof,S.value=o.value.cot_meth_proc,M.value=o.value.cot_matiere,k.value=o.value.cot_march_lecon,w.value=o.value.cot_enseignant,I.value=o.value.cot_eleve,z.value=o.value.ctrl_doc_eleve||0,o.value.visit_hour){const e=new Date(o.value.visit_hour);U.value=`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}`}o.value.end_time&&(q.value=o.value.end_time),C.value=o.value.summary,N.value=o.value.visiteur||"",$.value=o.value.fonction_id?Number(o.value.fonction_id):0}}catch(d){console.error("Erreur lors de la récupération de la visite :",d)}};return Ve(()=>{var d,e;(d=b.user)!=null&&d.school_id&&(H.value=Number(b.user.school_id)),(e=b.user)!=null&&e.id&&(B.value=Number(b.user.id)),j&&de()}),(d,e)=>(a(),ge(he,{title:"Modifier une visite de classe","link-back":"/apprenants/operations/visite-classe","group-route":"/apprenants/operations",module:"students",breadcrumb:[{label:"Élèves",href:"/apprenants"},{label:"Opérations",href:"/apprenants/operations"},{label:"Visite de Classes",href:"/apprenants/operations/visite-classe"},{label:"Modifier Visite",href:"#"}]},{default:r(()=>[x("form",{class:"w-full flex flex-col space-y-8",onSubmit:e[15]||(e[15]=xe((...s)=>l(ee)&&l(ee)(...s),["prevent"]))},[t(ye,{class:"grid sm:grid-cols-2 lg:grid-cols-3 gap-y-6 gap-x-10",title:"Informations de la visite de classe"},{default:r(()=>[t(v,null,{default:r(()=>[t(ke,{modelValue:l(h),"onUpdate:modelValue":e[0]||(e[0]=s=>c(h)?h.value=s:null)},null,8,["modelValue"]),l(A)?(a(),u("span",Ue,p(l(A)),1)):m("",!0)]),_:1}),t(v,null,{default:r(()=>[t(l(f),{class:"text-sm"},{default:r(()=>[e[16]||(e[16]=_(" Sujet ",-1)),t(g)]),_:1}),t(l(V),{class:"bg-white transition-all h-10 rounded-md",placeholder:"Isaac",modelValue:l(y),"onUpdate:modelValue":e[1]||(e[1]=s=>c(y)?y.value=s:null)},null,8,["modelValue"]),l(T)?(a(),u("span",qe,p(l(T)),1)):m("",!0)]),_:1}),t(v,null,{default:r(()=>[t(l(f),{class:"text-sm"},{default:r(()=>[e[17]||(e[17]=_(" Cote du document professeur ",-1)),t(g)]),_:1}),t(l(V),{type:"number",class:"bg-white transition-all h-10 rounded-md",modelValue:l(E),"onUpdate:modelValue":e[2]||(e[2]=s=>c(E)?E.value=s:null)},null,8,["modelValue"]),l(R)?(a(),u("span",Ce,p(l(R)),1)):m("",!0)]),_:1}),t(v,null,{default:r(()=>[t(l(f),{class:"text-sm"},{default:r(()=>[e[18]||(e[18]=_(" Cote de la méthode/procédure ",-1)),t(g)]),_:1}),t(l(V),{type:"number",class:"bg-white transition-all h-10 rounded-md",modelValue:l(S),"onUpdate:modelValue":e[3]||(e[3]=s=>c(S)?S.value=s:null)},null,8,["modelValue"]),l(F)?(a(),u("span",Ne,p(l(F)),1)):m("",!0)]),_:1}),t(v,null,{default:r(()=>[t(l(f),{class:"text-sm"},{default:r(()=>[e[19]||(e[19]=_(" Cote de la matière ",-1)),t(g)]),_:1}),t(l(V),{type:"number",class:"bg-white transition-all h-10 rounded-md",modelValue:l(M),"onUpdate:modelValue":e[4]||(e[4]=s=>c(M)?M.value=s:null)},null,8,["modelValue"]),l(O)?(a(),u("span",$e,p(l(O)),1)):m("",!0)]),_:1}),t(v,null,{default:r(()=>[t(l(f),{class:"text-sm"},{default:r(()=>[e[20]||(e[20]=_(" Cote de la marche de la leçon ",-1)),t(g)]),_:1}),t(l(V),{type:"number",class:"bg-white transition-all h-10 rounded-md",modelValue:l(k),"onUpdate:modelValue":e[5]||(e[5]=s=>c(k)?k.value=s:null)},null,8,["modelValue"]),l(P)?(a(),u("span",je,p(l(P)),1)):m("",!0)]),_:1}),t(v,null,{default:r(()=>[t(l(f),{class:"text-sm"},{default:r(()=>[e[21]||(e[21]=_(" Cote de l'enseignant ",-1)),t(g)]),_:1}),t(l(V),{type:"number",class:"bg-white transition-all h-10 rounded-md",modelValue:l(w),"onUpdate:modelValue":e[6]||(e[6]=s=>c(w)?w.value=s:null)},null,8,["modelValue"]),l(L)?(a(),u("span",De,p(l(L)),1)):m("",!0)]),_:1}),t(v,null,{default:r(()=>[t(l(f),{class:"text-sm"},{default:r(()=>[e[22]||(e[22]=_(" Cote de l'élève ",-1)),t(g)]),_:1}),t(l(V),{type:"number",class:"bg-white transition-all h-10 rounded-md",modelValue:l(I),"onUpdate:modelValue":e[7]||(e[7]=s=>c(I)?I.value=s:null)},null,8,["modelValue"]),l(G)?(a(),u("span",Te,p(l(G)),1)):m("",!0)]),_:1}),t(v,null,{default:r(()=>[t(l(f),{class:"text-sm"},{default:r(()=>[e[23]||(e[23]=_(" Contrôle document de l'élève ",-1)),t(g)]),_:1}),t(l(V),{type:"number",class:"bg-white transition-all h-10 rounded-md",modelValue:l(z),"onUpdate:modelValue":e[8]||(e[8]=s=>c(z)?z.value=s:null)},null,8,["modelValue"]),l(J)?(a(),u("span",He,p(l(J)),1)):m("",!0)]),_:1}),t(v,null,{default:r(()=>[t(l(f),{class:"text-sm"},{default:r(()=>[e[24]||(e[24]=_(" Heure de début ",-1)),t(g)]),_:1}),t(l(V),{type:"time",class:"bg-white transition-all h-10 rounded-md",modelValue:l(U),"onUpdate:modelValue":e[9]||(e[9]=s=>c(U)?U.value=s:null)},null,8,["modelValue"]),l(W)?(a(),u("span",Ae,p(l(W)),1)):m("",!0)]),_:1}),t(v,null,{default:r(()=>[t(l(f),{class:"text-sm"},{default:r(()=>[e[25]||(e[25]=_(" Heure de fin ",-1)),t(g)]),_:1}),t(l(V),{type:"time",class:"bg-white transition-all h-10 rounded-md",modelValue:l(q),"onUpdate:modelValue":e[10]||(e[10]=s=>c(q)?q.value=s:null)},null,8,["modelValue"]),l(Y)?(a(),u("span",Be,p(l(Y)),1)):m("",!0)]),_:1}),t(v,null,{default:r(()=>[t(l(f),{class:"text-sm"},{default:r(()=>[...e[26]||(e[26]=[_(" Visiteur ",-1)])]),_:1}),t(l(V),{class:"bg-white transition-all h-10 rounded-md",placeholder:"Nom du visiteur",modelValue:l(N),"onUpdate:modelValue":e[11]||(e[11]=s=>c(N)?N.value=s:null)},null,8,["modelValue"]),l(Q)?(a(),u("span",Re,p(l(Q)),1)):m("",!0)]),_:1}),t(v,null,{default:r(()=>[t(we,{modelValue:l($),"onUpdate:modelValue":e[12]||(e[12]=s=>c($)?$.value=s:null)},null,8,["modelValue"]),l(X)?(a(),u("span",Fe,p(l(X)),1)):m("",!0)]),_:1}),t(v,{class:"sm:col-span-2 lg:col-span-3"},{default:r(()=>[t(l(f),{class:"text-sm"},{default:r(()=>[e[27]||(e[27]=_(" Résumé ",-1)),t(g)]),_:1}),t(l(V),{class:"bg-white transition-all h-10 rounded-md",placeholder:"Résumé de la visite",modelValue:l(C),"onUpdate:modelValue":e[13]||(e[13]=s=>c(C)?C.value=s:null)},null,8,["modelValue"]),l(K)?(a(),u("span",Oe,p(l(K)),1)):m("",!0)]),_:1})]),_:1}),e[31]||(e[31]=x("div",{class:"w-full flex h-px bg-gray-300"},null,-1)),x("div",Pe,[t(l(se),{variant:"outline",type:"button",onClick:e[14]||(e[14]=s=>l(D).push("/apprenants/operations/visite-classe"))},{default:r(()=>[...e[28]||(e[28]=[x("span",{class:"flex iconify hugeicons--cancel-01 mr-1.5"},null,-1),_(" Annuler ",-1)])]),_:1}),t(l(se),{type:"submit"},{default:r(()=>[l(ie)?(a(),u("span",Ge,[x("div",Je,[t(Ee),e[30]||(e[30]=x("span",null,"Enregistrement en cours...",-1))])])):(a(),u("span",Le,[...e[29]||(e[29]=[x("span",{class:"iconify hugeicons--floppy-disk mr-1"},null,-1),x("span",null,"Enregistrer",-1)])]))]),_:1})])],32)]),_:1}))}});export{gl as default};
