import{d as Q,r as U,A as B,s as g,x as L,i as e,K as W,w as a,f as t,k as C,b as l,L as X,M as Y,N as Z,y as i,O as ee,g as se,z as q,c as _,h as S,a4 as z,t as f,P as te,o as c,p as V,v as ae,G as le,F as oe}from"./index-CJ_PivE-.js";import{_ as j}from"./Input.vue_vue_type_script_setup_true_lang-B9adgRZV.js";import{_ as ne,a as re,b as K,c as E,d as ie,e as N}from"./TableHeader.vue_vue_type_script_setup_true_lang-cS4zBTGx.js";import{_ as G}from"./Checkbox.vue_vue_type_script_setup_true_lang-DTckireD.js";import{_ as ue}from"./BoxPanelWrapper.vue_vue_type_script_setup_true_lang-CmJ-Iy6y.js";import{_ as de}from"./TabPagination.vue_vue_type_script_setup_true_lang-Dsg8W898.js";import{_ as ce}from"./ComptaLayout.vue_vue_type_script_setup_true_lang-Bu3Oqdii.js";import{_ as me}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-Bm461x8Q.js";import{S as R}from"./SpanRequired-COKghTUX.js";import{o as pe,s as F,u as fe,aQ as I,t as ve}from"./vee-validate-zod-Bra4yLtR.js";import{u as ge}from"./usePostApi-Crg8MURP.js";import{e as O}from"./eventBus-CGRXT3Tn.js";import{u as _e}from"./useGetApi-EdzHoZm6.js";import{u as xe}from"./useDeleteApi-D2AjqV8w.js";import"./index-BpkKmY4O.js";import"./RovingFocusGroup-BxePylpC.js";import"./DashPageHeader.vue_vue_type_script_setup_true_lang-DucYyTAx.js";import"./DashLayout.vue_vue_type_script_setup_true_lang-Ch2egXHm.js";import"./RightDashHeader.vue_vue_type_script_setup_true_lang-Bn3G870_.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ye={class:"grid gap-4 py-4"},he={class:"flex flex-col space-y-1.5"},be={key:0,class:"text-sm text-red-500"},we={class:"flex flex-col space-y-1.5"},$e={key:0,class:"text-sm text-red-500"},Ce={class:"flex flex-col space-y-1.5"},ke={key:0,class:"text-sm text-red-500"},Ae={key:0,class:"iconify flex hugeicons--loading-03 mr-1 animate-spin"},Ee={key:1,class:"iconify flex hugeicons--floppy-disk mr-1"},Ne=Q({__name:"NewCompteBanque",setup(J){const k=pe({name:F().min(1,"Le nom du compte est requis").max(255,"Le nom ne doit pas dÃ©passer 255 caractÃ¨res"),code:F().min(1,"Le code est requis").max(100,"Le code ne doit pas dÃ©passer 100 caractÃ¨res"),number:F().min(1,"Le numÃ©ro de compte est requis").max(100,"Le numÃ©ro ne doit pas dÃ©passer 100 caractÃ¨res")}),x=U(!1),{handleSubmit:D,resetForm:b,errors:P}=fe({validationSchema:ve(k)}),{postData:T,response:d,error:w,loading:y}=ge(),r=D(async m=>{try{if(console.log("ðŸ“ DonnÃ©es du formulaire:",m),await T(B.CREATE_BANK_ACCOUNT,m),console.log("ðŸ“¡ RÃ©ponse API complÃ¨te:",JSON.stringify(d.value,null,2)),console.log("âŒ Erreur API:",w.value),w.value){g({message:w.value,type:"error"});return}d.value?(d.value.success===!0||d.value.success===void 0||d.value.data!==void 0)&&d.value.success!==!1?(console.log("âœ… Compte crÃ©Ã© avec succÃ¨s"),g({message:d.value.message||"Compte bancaire crÃ©Ã© avec succÃ¨s",type:"success"}),$(),console.log("ðŸ”„ Ã‰mission de l'Ã©vÃ©nement accountUpdated"),O.emit("accountUpdated")):(console.log("âš ï¸ Ã‰chec de crÃ©ation:",d.value.message),g({message:d.value.message||"Erreur lors de la crÃ©ation du compte",type:"error"})):(console.log("âš ï¸ Aucune rÃ©ponse du serveur"),g({message:"Aucune rÃ©ponse du serveur",type:"error"}))}catch(n){console.error("ðŸ’¥ Erreur lors de la soumission:",n),g({message:"Une erreur inattendue s'est produite",type:"error"})}}),$=()=>{try{b(),x.value=!1}catch(m){console.warn("Erreur lors de la fermeture du dialog:",m),x.value=!1}};return(m,n)=>(c(),L(e(W),{open:x.value,"onUpdate:open":n[1]||(n[1]=p=>x.value=p)},{default:a(()=>[t(e(me),{"as-child":""},{default:a(()=>[t(e(C),{size:"md",class:"rounded-md"},{default:a(()=>[...n[2]||(n[2]=[l("span",{class:"iconify hugeicons--plus-sign"},null,-1),l("span",{class:"hidden sm:flex"}," Ajouter un compte ",-1)])]),_:1})]),_:1}),t(e(X),{class:"sm:max-w-[540px]",onPointerDownOutside:$,onEscapeKeyDown:$},{default:a(()=>[t(e(Y),null,{default:a(()=>[t(e(Z),null,{default:a(()=>[...n[3]||(n[3]=[i("Ajouter un compte bancaire",-1)])]),_:1}),t(e(ee),null,{default:a(()=>[...n[4]||(n[4]=[i(" Enregistrer un nouveau compte bancaire ",-1)])]),_:1})]),_:1}),l("form",{onSubmit:n[0]||(n[0]=se((...p)=>e(r)&&e(r)(...p),["prevent"])),class:"space-y-4"},[l("div",ye,[l("div",he,[t(e(q),{for:"name",class:"text-sm font-medium"},{default:a(()=>[n[5]||(n[5]=i(" Nom de la banque ",-1)),t(R)]),_:1}),t(e(I),{name:"name"},{default:a(({field:p,errorMessage:v})=>[t(e(j),z(p,{id:"name",type:"text",placeholder:"Ex: Compte principal Ecobank",class:"w-full h-10 border border-gray-200/40 bg-white transition-all"}),null,16),v?(c(),_("span",be,f(v),1)):S("",!0)]),_:1})]),l("div",we,[t(e(q),{for:"code",class:"text-sm font-medium"},{default:a(()=>[n[6]||(n[6]=i(" Code ",-1)),t(R)]),_:1}),t(e(I),{name:"code"},{default:a(({field:p,errorMessage:v})=>[t(e(j),z(p,{id:"code",type:"text",placeholder:"Ex: ECO001",class:"w-full h-10 border border-gray-200/40 bg-white transition-all"}),null,16),v?(c(),_("span",$e,f(v),1)):S("",!0)]),_:1})]),l("div",Ce,[t(e(q),{for:"number",class:"text-sm font-medium"},{default:a(()=>[n[7]||(n[7]=i(" NumÃ©ro de compte ",-1)),t(R)]),_:1}),t(e(I),{name:"number"},{default:a(({field:p,errorMessage:v})=>[t(e(j),z(p,{id:"number",type:"text",placeholder:"1234567890",class:"w-full h-10 border border-gray-200/40 bg-white transition-all"}),null,16),v?(c(),_("span",ke,f(v),1)):S("",!0)]),_:1})]),n[8]||(n[8]=l("div",{class:"mt-1 pb-2"},[l("p",{class:"text-sm text-foreground-muted"}," * Tous les champs sont obligatoires ")],-1))]),t(e(te),{class:"flex justify-end gap-2 items-center"},{default:a(()=>[t(e(C),{type:"button",size:"sm",class:"h-9",variant:"outline",onClick:$},{default:a(()=>[...n[9]||(n[9]=[l("span",{class:"iconify flex hugeicons--cancel-01 mr-1"},null,-1),i(" Annuler ",-1)])]),_:1}),t(e(C),{type:"submit",size:"sm",class:"h-9",disabled:e(y)},{default:a(()=>[e(y)?(c(),_("span",Ae)):(c(),_("span",Ee)),i(" "+f(e(y)?"Enregistrement...":"Enregistrer"),1)]),_:1},8,["disabled"])]),_:1})],32)]),_:1})]),_:1},8,["open"]))}}),Ue={class:"flex sm:items-center gap-3 flex-col sm:flex-row sm:justify-between"},Le={class:"relative flex-1"},Se={class:"flex flex-wrap items-center sm:justify-end gap-2.5 flex-1"},De={key:0,class:"mt-4 rounded-md overflow-hidden flex flex-1 bg-white p-8"},Te={key:1,class:"mt-4 rounded-md overflow-hidden flex flex-1 bg-white p-8"},Be={class:"flex flex-col items-center justify-center w-full gap-3"},je={class:"text-sm text-foreground-muted"},Oe={key:2,class:"mt-4 rounded-md overflow-hidden flex flex-1 bg-white p-8"},Pe={class:"flex flex-col items-center justify-center w-full gap-3"},qe={class:"text-sm text-foreground-muted"},ze={key:3,class:"mt-4 rounded-md overflow-hidden flex flex-1 bg-white"},Ve={class:"flex items-center gap-2 w-max"},rs=Q({__name:"ListCompteBanque",setup(J){const{data:k,error:x,loading:D,fetchData:b}=_e(B.GET_BANK_ACCOUNTS),{deleteItem:P,deleting:T}=xe(),d=U(""),w=U(1),y=U(15),r=U([]),$=V(()=>{if(!k.value)return[];if(!d.value)return k.value;const u=d.value.toLowerCase();return k.value.filter(s=>{var o,h,A;return((o=s.name)==null?void 0:o.toLowerCase().includes(u))||((h=s.code)==null?void 0:h.toLowerCase().includes(u))||((A=s.number)==null?void 0:A.toLowerCase().includes(u))})}),m=V(()=>{const u=(w.value-1)*y.value,s=u+y.value;return $.value.slice(u,s)}),n=V(()=>$.value.length),p=async(u,s)=>{if(confirm(`ÃŠtes-vous sÃ»r de vouloir supprimer le compte "${s}" ?`))try{const o=B.DELETE_BANK_ACCOUNT(u);await P(o),g({message:"Compte bancaire supprimÃ© avec succÃ¨s",type:"success"}),await b(),O.emit("accountUpdated")}catch{g({message:"Erreur lors de la suppression du compte",type:"error"})}},v=async()=>{if(r.value.length===0){g({message:"Aucun compte sÃ©lectionnÃ©",type:"warning"});return}const u=r.value.map(s=>{var o,h;return(h=(o=k.value)==null?void 0:o.find(A=>A.id===s))==null?void 0:h.name}).filter(Boolean).join(", ");if(confirm(`ÃŠtes-vous sÃ»r de vouloir supprimer ${r.value.length} compte(s) ?

${u}`))try{for(const s of r.value){const o=B.DELETE_BANK_ACCOUNT(s);await P(o)}g({message:`${r.value.length} compte(s) supprimÃ©(s) avec succÃ¨s`,type:"success"}),r.value=[],await b(),O.emit("accountUpdated")}catch{g({message:"Erreur lors de la suppression des comptes",type:"error"})}},H=()=>{r.value.length===m.value.length?r.value=[]:r.value=m.value.map(u=>u.id)},M=u=>u?new Date(u).toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric"}):"-";return ae(async()=>{await b()}),O.on("accountUpdated",()=>{b()}),(u,s)=>(c(),L(ce,{activeBread:"Comptes banque","active-tag-name":"comptes-banque",group:"saisie"},{default:a(()=>[t(ue,null,{default:a(()=>[l("div",Ue,[l("div",Le,[t(e(j),{modelValue:d.value,"onUpdate:modelValue":s[0]||(s[0]=o=>d.value=o),type:"text",id:"search",name:"search",placeholder:"Rechercher un compte bancaire...",class:"w-full max-w-sm ps-10 border border-gray-200/40 bg-white transition-all h-10 rounded-md"},null,8,["modelValue"]),s[3]||(s[3]=l("div",{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-foreground-muted/70"},[l("span",{class:"flex iconify hugeicons--search-01 text-sm"})],-1))]),l("div",Se,[r.value.length>0?(c(),L(e(C),{key:0,variant:"destructive",size:"md",onClick:v,disabled:e(T)},{default:a(()=>[s[4]||(s[4]=l("span",{class:"iconify hugeicons--delete-02 mr-1"},null,-1)),i(" Supprimer ("+f(r.value.length)+") ",1)]),_:1},8,["disabled"])):S("",!0),t(Ne)])]),e(D)?(c(),_("div",De,[...s[5]||(s[5]=[l("div",{class:"flex flex-col items-center justify-center w-full gap-3"},[l("span",{class:"iconify hugeicons--loading-03 text-4xl animate-spin text-primary"}),l("p",{class:"text-sm text-foreground-muted"},"Chargement des comptes bancaires...")],-1)])])):e(x)?(c(),_("div",Te,[l("div",Be,[s[7]||(s[7]=l("span",{class:"iconify hugeicons--alert-circle text-4xl text-red-500"},null,-1)),l("p",je,f(e(x)),1),t(e(C),{onClick:e(b),variant:"outline",size:"sm"},{default:a(()=>[...s[6]||(s[6]=[l("span",{class:"iconify hugeicons--refresh mr-1"},null,-1),i(" RÃ©essayer ",-1)])]),_:1},8,["onClick"])])])):!m.value||m.value.length===0?(c(),_("div",Oe,[l("div",Pe,[s[8]||(s[8]=l("span",{class:"iconify hugeicons--bank text-4xl text-foreground-muted/50"},null,-1)),l("p",qe,f(d.value?"Aucun compte bancaire trouvÃ© pour cette recherche":"Aucun compte bancaire enregistrÃ©"),1)])])):(c(),_("div",ze,[t(e(ne),{class:"rounded-md bg-white"},{default:a(()=>[t(e(re),null,{default:a(()=>[t(e(K),null,{default:a(()=>[t(e(E),{class:"w-[20px]"},{default:a(()=>[t(e(G),{class:"bg-white scale-70",checked:r.value.length===m.value.length&&m.value.length>0,"onUpdate:checked":H},null,8,["checked"])]),_:1}),t(e(E),null,{default:a(()=>[...s[9]||(s[9]=[i("Code",-1)])]),_:1}),t(e(E),null,{default:a(()=>[...s[10]||(s[10]=[i("NumÃ©ro de compte",-1)])]),_:1}),t(e(E),null,{default:a(()=>[...s[11]||(s[11]=[i("Nom du compte",-1)])]),_:1}),t(e(E),null,{default:a(()=>[...s[12]||(s[12]=[i("Date de crÃ©ation",-1)])]),_:1}),t(e(E),null,{default:a(()=>[...s[13]||(s[13]=[i(" OpÃ©rations ",-1)])]),_:1})]),_:1})]),_:1}),t(e(ie),null,{default:a(()=>[(c(!0),_(le,null,oe(m.value,o=>(c(),L(e(K),{key:o.id},{default:a(()=>[t(e(N),{class:"w-[40px]"},{default:a(()=>[t(e(G),{class:"bg-white scale-70",checked:r.value.includes(o.id),"onUpdate:checked":h=>{h?r.value.push(o.id):r.value=r.value.filter(A=>A!==o.id)}},null,8,["checked","onUpdate:checked"])]),_:2},1024),t(e(N),null,{default:a(()=>[i(f(o.code||"-"),1)]),_:2},1024),t(e(N),null,{default:a(()=>[i(f(o.number||"-"),1)]),_:2},1024),t(e(N),null,{default:a(()=>[i(f(o.name||"-"),1)]),_:2},1024),t(e(N),null,{default:a(()=>[i(f(M(o.created_at)),1)]),_:2},1024),t(e(N),null,{default:a(()=>[l("div",Ve,[t(e(C),{variant:"outline",size:"icon",class:"size-8"},{default:a(()=>[...s[14]||(s[14]=[l("span",{class:"iconify hugeicons--edit-02"},null,-1)])]),_:1}),t(e(C),{variant:"destructive",size:"icon",class:"size-8",onClick:h=>p(o.id,o.name),disabled:e(T)},{default:a(()=>[...s[15]||(s[15]=[l("span",{class:"iconify hugeicons--delete-02"},null,-1)])]),_:1},8,["onClick","disabled"])])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})])),!e(D)&&!e(x)&&m.value.length>0?(c(),L(de,{key:4,modelValue:w.value,"onUpdate:modelValue":s[1]||(s[1]=o=>w.value=o),perPage:y.value,totalItems:n.value,"onUpdate:perPage":s[2]||(s[2]=o=>y.value=o)},null,8,["modelValue","perPage","totalItems"])):S("",!0)]),_:1})]),_:1}))}});export{rs as default};
