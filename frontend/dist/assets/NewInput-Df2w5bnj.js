import{d as ne,A as T,s as h,a as oe,p as $,q as ue,v as ie,x as p,w as l,b as v,f as s,i as t,z as y,y as r,c as d,h as f,a4 as w,t as c,B,C as D,D as I,E as O,J as _,G as S,F as G,k as R,g as re,o}from"./index-CJ_PivE-.js";import{_ as J}from"./Input.vue_vue_type_script_setup_true_lang-B9adgRZV.js";import{_ as de}from"./Textarea.vue_vue_type_script_setup_true_lang-Bg8QXdyw.js";import{_ as me}from"./ComptaLayout.vue_vue_type_script_setup_true_lang-Bu3Oqdii.js";import{_ as ce}from"./FormSection.vue_vue_type_script_setup_true_lang-C-XSdIg3.js";import{I as b}from"./InputWrapper-tSRHzcjN.js";import{S as g}from"./SpanRequired-COKghTUX.js";import{_ as z}from"./SelectGroup.vue_vue_type_script_setup_true_lang-CwIOzTi6.js";import{u as pe}from"./usePostApi-Crg8MURP.js";import{u as M}from"./useGetApi-EdzHoZm6.js";import{o as fe,s as A,a4 as _e,aM as Q,av as W,u as ye,aS as be,aQ as x,t as ge}from"./vee-validate-zod-Bra4yLtR.js";import"./index-BpkKmY4O.js";import"./DashPageHeader.vue_vue_type_script_setup_true_lang-DucYyTAx.js";import"./DashLayout.vue_vue_type_script_setup_true_lang-Ch2egXHm.js";import"./RightDashHeader.vue_vue_type_script_setup_true_lang-Bn3G870_.js";import"./BoxPanelWrapper.vue_vue_type_script_setup_true_lang-CmJ-Iy6y.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const xe={key:0,class:"text-sm text-red-500"},he={key:0,class:"text-sm text-red-500"},ve={key:0,class:"text-sm text-red-500"},Se={key:0,class:"text-sm text-red-500"},Ae={key:0,class:"text-sm text-red-500"},ke={class:"flex items-center justify-end gap-2"},Ce={key:0},Ee={key:1},ze=ne({__name:"NewInput",setup(Te){const H=fe({name:A().min(1,"Le libellé est requis").max(255,"255 caractères maximum"),account_plan_id:Q([A().refine(a=>a!=="","Le compte principal est requis").transform(a=>Number(a)),W()]).refine(a=>Number(a)>0,"Le compte principal est requis"),sub_account_plan_id:Q([A().refine(a=>a!=="","Le sous-compte est requis").transform(a=>Number(a)),W()]).refine(a=>Number(a)>0,"Le sous-compte est requis"),amount:_e.number({invalid_type_error:"Le montant doit être un nombre"}).min(0,"Le montant doit être positif"),justification:A().min(1,"La justification est requise").max(255,"255 caractères maximum")}),{handleSubmit:K,resetForm:N,setFieldValue:X}=ye({validationSchema:ge(H),initialValues:{name:"",account_plan_id:"",sub_account_plan_id:"",amount:void 0,justification:""}}),{response:k,error:C,loading:E,postData:Y}=pe(),P=oe(),L=K(async a=>{try{if(await Y(T.CREATE_INPUTACCOUNT,a),C.value){h({message:typeof C.value=="string"?C.value:"Erreur lors de la création de la sortie.",type:"error"});return}k.value&&k.value.message?(h({message:k.value.message||"Sortie créée avec succès",type:"success"}),N()):(h({message:"Sortie créée avec succès",type:"success"}),N()),P.push("/comptabilite/saisie-operations/recettes")}catch{h({message:"Une erreur inattendue s'est produite.",type:"error"})}}),{data:Z,loading:ee,fetchData:ae}=M(T.GET_COMPTE),{data:te,loading:se,fetchData:le}=M(T.GET_SUB_COMPTE);function V(a){let e=[];return Array.isArray(a)?e=a:a!=null&&a.data&&Array.isArray(a.data)?e=a.data:a!=null&&a.items&&Array.isArray(a.items)?e=a.items:a!=null&&a.accounts&&Array.isArray(a.accounts)?e=a.accounts:a&&typeof a=="object"&&(e=Object.values(a).filter(n=>n&&typeof n=="object"&&(n.id||n.value))),e}const j=$(()=>V(Z.value).map(e=>({id:String(e.id??e.value??""),name:e.name??e.label??e.libelle??e.title??e.account??`Compte #${e.id??e.value}`,code:e.code??e.number??e.code_compte}))),U=$(()=>V(te.value).map(e=>({id:String(e.id??e.value??""),name:e.name??e.label??e.libelle??e.title??e.account??`Sous-compte #${e.id??e.value}`,code:e.code??e.number??e.code_compte,account_plan_id:e.account_plan_id??e.parent_id??e.plan_id??e.compte_id}))),q=be("account_plan_id"),F=$(()=>{const a=q.value;return a?U.value.filter(e=>String(e.account_plan_id??"")===String(a)):U.value});return ue(q,()=>{X("sub_account_plan_id","")}),ie(async()=>{await Promise.all([ae(),le()])}),(a,e)=>(o(),p(me,{activeBread:"Nouvelle Entree","active-tag-name":"saisie-operations",group:"operations","show-header":!1},{default:l(()=>[v("form",{onSubmit:e[1]||(e[1]=re((...n)=>t(L)&&t(L)(...n),["prevent"])),class:"mt-10 space-y-8"},[s(ce,{class:"grid sm:grid-cols-2 lg:grid-cols-3 gap-y-6 gap-x-10",title:"Informations sur la sortie"},{default:l(()=>[s(b,null,{default:l(()=>[s(t(y),{class:"text-sm"},{default:l(()=>[e[2]||(e[2]=r(" Libellé de l'opération ",-1)),s(g)]),_:1}),s(t(x),{name:"name"},{default:l(({field:n,errorMessage:i,meta:m})=>[s(t(J),w(n,{class:"bg-gray-100 transition-all h-10 rounded-md",placeholder:"Ex: Achat de fournitures"}),null,16),m.touched&&i?(o(),d("span",xe,c(i),1)):f("",!0)]),_:1})]),_:1}),s(b,null,{default:l(()=>[s(t(y),{class:"text-sm"},{default:l(()=>[e[3]||(e[3]=r(" Compte principal ",-1)),s(g)]),_:1}),s(t(x),{name:"account_plan_id"},{default:l(({field:n,errorMessage:i,meta:m})=>[s(t(B),{"model-value":n.value,"onUpdate:modelValue":u=>n.onChange(u)},{default:l(()=>[s(t(D),{class:"!h-10 bg-white w-full"},{default:l(()=>[s(t(I),{placeholder:"Sélectionner le compte principal"})]),_:1}),s(t(O),null,{default:l(()=>[s(t(z),null,{default:l(()=>[t(ee)?(o(),p(t(_),{key:0,value:"loading",disabled:""},{default:l(()=>[...e[4]||(e[4]=[r(" Chargement des comptes... ",-1)])]),_:1})):(o(),d(S,{key:1},[j.value.length?f("",!0):(o(),p(t(_),{key:0,value:"empty",disabled:""},{default:l(()=>[...e[5]||(e[5]=[r(" Aucun compte disponible ",-1)])]),_:1})),(o(!0),d(S,null,G(j.value,u=>(o(),p(t(_),{key:u.id,value:u.id},{default:l(()=>[r(c(u.code?u.code+" - ":"")+c(u.name),1)]),_:2},1032,["value"]))),128))],64))]),_:1})]),_:1})]),_:1},8,["model-value","onUpdate:modelValue"]),m.touched&&i?(o(),d("span",he,c(i),1)):f("",!0)]),_:1})]),_:1}),s(b,null,{default:l(()=>[s(t(y),{class:"text-sm"},{default:l(()=>[e[6]||(e[6]=r(" Sous-compte ",-1)),s(g)]),_:1}),s(t(x),{name:"sub_account_plan_id"},{default:l(({field:n,errorMessage:i,meta:m})=>[s(t(B),{"model-value":n.value,"onUpdate:modelValue":u=>n.onChange(u)},{default:l(()=>[s(t(D),{class:"!h-10 bg-white w-full"},{default:l(()=>[s(t(I),{placeholder:"Sélectionner le sous-compte"})]),_:1}),s(t(O),null,{default:l(()=>[s(t(z),null,{default:l(()=>[t(se)?(o(),p(t(_),{key:0,value:"loading",disabled:""},{default:l(()=>[...e[7]||(e[7]=[r(" Chargement des sous-comptes... ",-1)])]),_:1})):(o(),d(S,{key:1},[F.value.length?f("",!0):(o(),p(t(_),{key:0,value:"empty",disabled:""},{default:l(()=>[...e[8]||(e[8]=[r(" Aucun sous-compte disponible ",-1)])]),_:1})),(o(!0),d(S,null,G(F.value,u=>(o(),p(t(_),{key:u.id,value:u.id},{default:l(()=>[r(c(u.code?u.code+" - ":"")+c(u.name),1)]),_:2},1032,["value"]))),128))],64))]),_:1})]),_:1})]),_:1},8,["model-value","onUpdate:modelValue"]),m.touched&&i?(o(),d("span",ve,c(i),1)):f("",!0)]),_:1})]),_:1}),s(b,null,{default:l(()=>[s(t(y),{class:"text-sm"},{default:l(()=>[e[9]||(e[9]=r(" Justification ",-1)),s(g)]),_:1}),s(t(x),{name:"justification"},{default:l(({field:n,errorMessage:i,meta:m})=>[s(t(de),w(n,{class:"bg-gray-100 transition-all rounded-md min-h-[100px]",placeholder:"Ex: FAC001 - Paiement fournisseur"}),null,16),m.touched&&i?(o(),d("span",Se,c(i),1)):f("",!0)]),_:1})]),_:1}),s(b,null,{default:l(()=>[s(t(y),{class:"text-sm"},{default:l(()=>[e[10]||(e[10]=r(" Montant de la sortie ",-1)),s(g)]),_:1}),s(t(x),{name:"amount"},{default:l(({field:n,errorMessage:i,meta:m})=>[s(t(J),w(n,{type:"number",step:"0.01",class:"bg-gray-100 transition-all h-10 rounded-md",placeholder:"Ex: 150000"}),null,16),m.touched&&i?(o(),d("span",Ae,c(i),1)):f("",!0)]),_:1})]),_:1})]),_:1}),v("div",ke,[s(t(R),{variant:"outline",type:"button",disabled:t(E),onClick:e[0]||(e[0]=n=>t(P).push("/comptabilite/saisie-operations/recettes"))},{default:l(()=>[...e[11]||(e[11]=[v("span",{class:"flex iconify hugeicons--cancel-01 mr-1.5"},null,-1),r(" Annuler ",-1)])]),_:1},8,["disabled"]),s(t(R),{type:"submit",disabled:t(E)},{default:l(()=>[e[12]||(e[12]=v("span",{class:"flex iconify hugeicons--add-01 mr-2"},null,-1)),t(E)?(o(),d("span",Ee,"Enregistrement...")):(o(),d("span",Ce,"Enregistrer une entree"))]),_:1},8,["disabled"])])],32)]),_:1}))}});export{ze as default};
