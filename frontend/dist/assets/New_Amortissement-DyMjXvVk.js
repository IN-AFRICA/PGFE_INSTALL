import{d as I,p as R,A as U,s as v,a as O,x as P,w as a,b as f,f as e,i as t,z as u,y as r,c as m,h as p,a4 as x,t as d,B as j,C as z,D as H,E as J,J as L,k as w,g as Q,o as i}from"./index-CJ_PivE-.js";import{_ as y}from"./Input.vue_vue_type_script_setup_true_lang-B9adgRZV.js";import{_ as W}from"./ComptaLayout.vue_vue_type_script_setup_true_lang-Bu3Oqdii.js";import{_ as G}from"./FormSection.vue_vue_type_script_setup_true_lang-C-XSdIg3.js";import{I as c}from"./InputWrapper-tSRHzcjN.js";import{S as b}from"./SpanRequired-COKghTUX.js";import{_ as K}from"./SelectGroup.vue_vue_type_script_setup_true_lang-CwIOzTi6.js";import{u as X}from"./usePostApi-Crg8MURP.js";import{o as Y,s as h,ab as Z,a4 as A,u as M,aQ as _,t as ee}from"./vee-validate-zod-Bra4yLtR.js";import{e as te}from"./eventBus-CGRXT3Tn.js";import{t as se}from"./utils-74-Kdsy2.js";import"./index-BpkKmY4O.js";import"./DashPageHeader.vue_vue_type_script_setup_true_lang-DucYyTAx.js";import"./DashLayout.vue_vue_type_script_setup_true_lang-Ch2egXHm.js";import"./RightDashHeader.vue_vue_type_script_setup_true_lang-Bn3G870_.js";import"./BoxPanelWrapper.vue_vue_type_script_setup_true_lang-CmJ-Iy6y.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ae={key:0,class:"text-sm text-red-500"},oe={key:0,class:"text-sm text-red-500"},le={key:0,class:"text-sm text-red-500"},ne={key:0,class:"text-sm text-red-500"},re={key:0,class:"text-sm text-red-500"},ie={key:0,class:"text-sm text-red-500"},me={key:0,class:"text-sm text-red-500"},ue={key:0,class:"text-sm text-red-500"},de={class:"bg-blue-50 p-3 rounded-md border border-blue-200"},ce={class:"text-lg font-semibold text-blue-700"},pe={class:"flex items-center justify-end gap-2"},_e={key:0},fe={key:1},Fe=I({__name:"New_Amortissement",setup(xe){const V=Y({name:h().min(1,"La désignation est requise").max(255,"255 caractères maximum"),purchase_date:h().min(1,"La date d'acquisition est requise"),amount:A.number({invalid_type_error:"La valeur doit être un nombre"}).min(0,"La valeur doit être positive"),number_years:A.number({invalid_type_error:"La durée doit être un nombre"}).min(1,"La durée doit être d'au moins 1 an"),model:Z(["lineaire","degressif"],{required_error:"La méthode est requise"}),immo_account_id:h().min(1,"Le compte immobilisation est requis").max(50,"50 caractères maximum"),immo_sub_account_id:h().min(1,"Le compte amortissement est requis").max(50,"50 caractères maximum"),code:h().min(1,"Le code est requis").max(50,"50 caractères maximum")}),{handleSubmit:D,resetForm:F,values:S}=M({validationSchema:ee(V),initialValues:{name:"",purchase_date:new Date().toISOString().split("T")[0],amount:0,number_years:3,model:"lineaire",immo_account_id:"",immo_sub_account_id:"",code:"0"}}),{response:q,error:k,loading:E,postData:N}=X(),C=O(),T=R(()=>{const g=S.number_years||1;return S.model==="lineaire"?(100/g).toFixed(2):(100/g*1.75).toFixed(2)}),$=D(async g=>{try{const s={...g,date_acquisition:se(g.purchase_date),taux:parseFloat(T.value)};if(await N(U.CREATE_AMORTISSEMENT,s),k.value){v({message:typeof k.value=="string"?k.value:"Erreur lors de la création de l'amortissement.",type:"error"});return}q.value?(v({message:q.value.message||"Amortissement créé avec succès",type:"success"}),F(),te.emit("amortissementUpdated"),C.push("/comptabilite/saisie-operations/amortissements")):v({message:"Aucune réponse du serveur.",type:"error"})}catch(s){const l=s instanceof Error?s.message:"Une erreur inattendue s'est produite.";console.error("Erreur lors de la création de l'amortissement:",l),v({message:l,type:"error"})}});return(g,s)=>(i(),P(W,{activeBread:"Nouvel Amortissement","active-tag-name":"amortissements",group:"operations","show-header":!1},{default:a(()=>[f("form",{onSubmit:s[1]||(s[1]=Q((...l)=>t($)&&t($)(...l),["prevent"])),class:"mt-10 space-y-8"},[e(G,{class:"grid sm:grid-cols-2 lg:grid-cols-3 gap-y-6 gap-x-10",title:"Nouvel amortissement"},{default:a(()=>[e(c,{class:"lg:col-span-2"},{default:a(()=>[e(t(u),{class:"text-sm"},{default:a(()=>[s[2]||(s[2]=r(" Désignation ",-1)),e(b)]),_:1}),e(t(_),{name:"name"},{default:a(({field:l,errorMessage:o,meta:n})=>[e(t(y),x(l,{type:"text",class:"bg-gray-100 transition-all h-10 rounded-md",placeholder:"Ex: Ordinateur portable HP"}),null,16),n.touched&&o?(i(),m("span",ae,d(o),1)):p("",!0)]),_:1})]),_:1}),e(c,null,{default:a(()=>[e(t(u),{class:"text-sm"},{default:a(()=>[s[3]||(s[3]=r(" Date d'acquisition ",-1)),e(b)]),_:1}),e(t(_),{name:"purchase_date"},{default:a(({field:l,errorMessage:o,meta:n})=>[e(t(y),x(l,{type:"date",class:"bg-gray-100 transition-all h-10 rounded-md"}),null,16),n.touched&&o?(i(),m("span",oe,d(o),1)):p("",!0)]),_:1})]),_:1}),e(c,null,{default:a(()=>[e(t(u),{class:"text-sm"},{default:a(()=>[s[4]||(s[4]=r(" Valeur d'acquisition (FC) ",-1)),e(b)]),_:1}),e(t(_),{name:"amount"},{default:a(({field:l,errorMessage:o,meta:n})=>[e(t(y),x(l,{type:"number",step:"0.01",min:"0",class:"bg-gray-100 transition-all h-10 rounded-md",placeholder:"0.00"}),null,16),n.touched&&o?(i(),m("span",le,d(o),1)):p("",!0)]),_:1})]),_:1}),e(c,null,{default:a(()=>[e(t(u),{class:"text-sm"},{default:a(()=>[s[5]||(s[5]=r(" Durée (années) ",-1)),e(b)]),_:1}),e(t(_),{name:"number_years"},{default:a(({field:l,errorMessage:o,meta:n})=>[e(t(y),x(l,{type:"number",min:"1",class:"bg-gray-100 transition-all h-10 rounded-md",placeholder:"3"}),null,16),n.touched&&o?(i(),m("span",ne,d(o),1)):p("",!0)]),_:1})]),_:1}),e(c,null,{default:a(()=>[e(t(u),{class:"text-sm"},{default:a(()=>[s[6]||(s[6]=r(" Méthode d'amortissement ",-1)),e(b)]),_:1}),e(t(_),{name:"model"},{default:a(({field:l,errorMessage:o,meta:n})=>[e(t(j),{"model-value":l.value,"onUpdate:modelValue":B=>l.onChange(B)},{default:a(()=>[e(t(z),{class:"!h-10 bg-white w-full"},{default:a(()=>[e(t(H),{placeholder:"Sélectionner la méthode"})]),_:1}),e(t(J),null,{default:a(()=>[e(t(K),null,{default:a(()=>[e(t(L),{value:"lineaire"},{default:a(()=>[...s[7]||(s[7]=[r("Linéaire",-1)])]),_:1}),e(t(L),{value:"degressif"},{default:a(()=>[...s[8]||(s[8]=[r("Dégressif",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value","onUpdate:modelValue"]),n.touched&&o?(i(),m("span",re,d(o),1)):p("",!0)]),_:1})]),_:1}),e(c,null,{default:a(()=>[e(t(u),{class:"text-sm"},{default:a(()=>[s[9]||(s[9]=r(" Compte immobilisation ",-1)),e(b)]),_:1}),e(t(_),{name:"immo_account_id"},{default:a(({field:l,errorMessage:o,meta:n})=>[e(t(y),x(l,{type:"text",class:"bg-gray-100 transition-all h-10 rounded-md",placeholder:"Ex: 2410"}),null,16),n.touched&&o?(i(),m("span",ie,d(o),1)):p("",!0)]),_:1})]),_:1}),e(c,null,{default:a(()=>[e(t(u),{class:"text-sm"},{default:a(()=>[s[10]||(s[10]=r(" Compte amortissement ",-1)),e(b)]),_:1}),e(t(_),{name:"immo_sub_account_id"},{default:a(({field:l,errorMessage:o,meta:n})=>[e(t(y),x(l,{type:"text",class:"bg-gray-100 transition-all h-10 rounded-md",placeholder:"Ex: 2841"}),null,16),n.touched&&o?(i(),m("span",me,d(o),1)):p("",!0)]),_:1})]),_:1}),e(c,null,{default:a(()=>[e(t(u),{class:"text-sm"},{default:a(()=>[...s[11]||(s[11]=[r(" Valeur résiduelle (FC) ",-1)])]),_:1}),e(t(_),{name:"code"},{default:a(({field:l,errorMessage:o,meta:n})=>[e(t(y),x(l,{type:"text",step:"0.01",min:"0",class:"bg-gray-100 transition-all h-10 rounded-md",placeholder:"0.00"}),null,16),n.touched&&o?(i(),m("span",ue,d(o),1)):p("",!0)]),_:1})]),_:1}),e(c,{class:"lg:col-span-2"},{default:a(()=>[e(t(u),{class:"text-sm"},{default:a(()=>[...s[12]||(s[12]=[r(" Taux d'amortissement calculé ",-1)])]),_:1}),f("div",de,[f("p",ce,d(T.value)+"%",1),s[13]||(s[13]=f("p",{class:"text-xs text-gray-600 mt-1"}," Calculé automatiquement selon la méthode et la durée ",-1))])]),_:1})]),_:1}),f("div",pe,[e(t(w),{variant:"outline",type:"button",disabled:t(E),onClick:s[0]||(s[0]=l=>t(C).push("/comptabilite/saisie-operations/amortissements"))},{default:a(()=>[...s[14]||(s[14]=[f("span",{class:"flex iconify hugeicons--cancel-01 mr-1.5"},null,-1),r(" Annuler ",-1)])]),_:1},8,["disabled"]),e(t(w),{type:"submit",disabled:t(E)},{default:a(()=>[s[15]||(s[15]=f("span",{class:"flex iconify hugeicons--add-01"},null,-1)),t(E)?(i(),m("span",fe,"Enregistrement...")):(i(),m("span",_e,"Enregistrer l'amortissement"))]),_:1},8,["disabled"])])],32)]),_:1}))}});export{Fe as default};
