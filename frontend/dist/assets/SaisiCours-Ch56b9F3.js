import{d as te,r as N,A as y,p as v,v as re,q as oe,x as L,w as o,f as a,b as i,i as t,k as h,$ as ne,y as n,c as w,h as ue,F as ie,G as de,t as p,a as fe,o as _,g as pe,s as j}from"./index-CJ_PivE-.js";import{_ as U}from"./Input.vue_vue_type_script_setup_true_lang-B9adgRZV.js";import{_ as ce,a as ve,b as C,c as d,d as _e,e as f}from"./TableHeader.vue_vue_type_script_setup_true_lang-cS4zBTGx.js";import{_ as z}from"./Checkbox.vue_vue_type_script_setup_true_lang-DTckireD.js";import{_ as me}from"./LayoutSaisieOperation.vue_vue_type_script_setup_true_lang-bYPLg6Nt.js";import{_ as ge}from"./BoxPanelWrapper.vue_vue_type_script_setup_true_lang-CmJ-Iy6y.js";import{_ as xe}from"./TabPagination.vue_vue_type_script_setup_true_lang-Dsg8W898.js";import{a as be}from"./AlertMessage.vue_vue_type_script_setup_true_lang-DthA28zY.js";import{u as $}from"./useGetApi-EdzHoZm6.js";import{u as ye}from"./useDeleteApi-D2AjqV8w.js";import{e as F}from"./eventBus-CGRXT3Tn.js";import{_ as Se}from"./FilterPopover.vue_vue_type_script_setup_true_lang-D3D_gZSL.js";import{_ as he}from"./FilterBadges.vue_vue_type_script_setup_true_lang-CBuiPNtr.js";import{_ as we}from"./ListAcademicalLevel.vue_vue_type_script_setup_true_lang-DMWuvuYJ.js";import{_ as Ce}from"./ListFiliere.vue_vue_type_script_setup_true_lang-Dgxwljrk.js";import"./index-BpkKmY4O.js";import"./RovingFocusGroup-BxePylpC.js";import"./DashLayoutWithMode.vue_vue_type_script_setup_true_lang-DzpyZ4TL.js";import"./RightDashHeader.vue_vue_type_script_setup_true_lang-Bn3G870_.js";import"./DashPageHeader.vue_vue_type_script_setup_true_lang-DucYyTAx.js";import"./DialogTrigger.vue_vue_type_script_setup_true_lang-Bm461x8Q.js";import"./PopoverTrigger.vue_vue_type_script_setup_true_lang-DzZWQSaq.js";import"./SelectGroup.vue_vue_type_script_setup_true_lang-CwIOzTi6.js";const $e={class:"flex items-center gap-3 justify-between"},Ee={class:"flex flex-1 items-center gap-2"},ke={class:"relative w-full max-w-xs"},Ve={class:"flex flex-col space-y-1.5 flex-1"},Ae={class:"flex flex-col space-y-1.5 flex-1"},Ne={class:"flex flex-wrap items-center gap-2.5"},Le={class:"mt-4 rounded-md overflow-hidden flex flex-1 bg-white"},Ue={class:"group flex items-center justify-between"},Pe={class:"hidden group-hover:flex items-center gap-2 ml-2"},Ie={key:0},Re={key:1},Te={key:2},nl=te({__name:"SaisiCours",setup(je){const m=N(1),g=N(15),P=fe(),{data:E,fetchData:k,loading:M,error:I,meta:V}=$(y.GET_COURSES),{deleteItem:B,errorDelete:R}=ye(),{data:x,fetchData:G}=$(y.GET_ACADEMIC_LEVELS),{data:b,fetchData:O}=$(y.GET_FILLIERES),{data:S,fetchData:D}=$(y.GET_PERSONNELS_ACADEMIQUES),q=v(()=>{var r;return((r=V==null?void 0:V.value)==null?void 0:r.total)??0}),H=v(()=>(Array.isArray(x==null?void 0:x.value)?x.value:[]).reduce((e,l)=>{const s=String((l==null?void 0:l.id)??(l==null?void 0:l.value)??(l==null?void 0:l.academic_level_id)??""),c=String((l==null?void 0:l.name)??(l==null?void 0:l.label)??(l==null?void 0:l.title)??"");return s&&(e[s]=c),e},{}));v(()=>(Array.isArray(S==null?void 0:S.value)?S.value:[]).reduce((e,l)=>{const s=String((l==null?void 0:l.id)??""),c=String((l==null?void 0:l.firstname)??(l==null?void 0:l.first_name)??"").trim(),T=String((l==null?void 0:l.name)??(l==null?void 0:l.last_name)??"").trim(),se=[c,T].filter(Boolean).join(" ").trim();return s&&(e[s]=se||T||c||s),e},{}));const Q=v(()=>(Array.isArray(b==null?void 0:b.value)?b.value:[]).reduce((e,l)=>{const s=String((l==null?void 0:l.id)??(l==null?void 0:l.value)??(l==null?void 0:l.filiere_id)??""),c=String((l==null?void 0:l.name)??(l==null?void 0:l.label)??(l==null?void 0:l.title)??"");return s&&(e[s]=c),e},{})),J=r=>H.value[String(r)]||String(r),K=r=>Q.value[String(r)]||String(r),W=v(()=>!E.value||!Array.isArray(E.value)?[]:E.value.filter(r=>r!=null)),A=v(()=>{let r=W.value;if(u.value.label&&u.value.label.trim()!==""){const e=u.value.label.toLowerCase().trim();r=r.filter(l=>{var s;return(s=l.label)==null?void 0:s.toLowerCase().includes(e)})}return u.value.academic_level_id&&(r=r.filter(e=>String(e.academic_level_id)===String(u.value.academic_level_id))),u.value.filiaire_id&&(r=r.filter(e=>String(e.filiaire_id)===String(u.value.filiaire_id))),u.value.hourly_volume&&(r=r.filter(e=>Number(e.hourly_volume)===u.value.hourly_volume)),r});re(()=>{k({page:m.value,limit:g.value}),G(),O(),D()}),F.on("courseUpdated",()=>{k({page:m.value,limit:g.value})}),oe([m,g],()=>{k({page:m.value,limit:g.value})});const u=N({label:"",academic_level_id:void 0,filiaire_id:void 0,hourly_volume:void 0}),X=v(()=>({academic_level_id:x.value||[],filiaire_id:b.value||[]})),Y={label:r=>`Cours: ${r}`,hourly_volume:r=>`Heures: ${r}h`,academic_level_id:(r,e)=>{const l=e==null?void 0:e.find(s=>String(s.id)===String(r));return`Niveau: ${l?l.name||l.label:r}`},filiaire_id:(r,e)=>{const l=e==null?void 0:e.find(s=>String(s.id)===String(r));return`Section: ${l?l.name||l.label:r}`}},Z=r=>{u.value[r]=r==="label"?"":void 0};function ee(){console.debug("[SaisiCours] goToNewCourse clicked"),P.push("/apprenants/saisie-prealable/cours/nouveau").catch(r=>{console.error("[SaisiCours] navigation error",r)})}const le=r=>{P.push(`/apprenants/saisie-prealable/cours/nouveau?edit=true&id=${r}`)},ae=async r=>{const e=y.DELETE_COURSE.replace(":course",String(r));await B(e),F.emit("courseUpdated"),R.value?j({message:R.value,type:"error"}):j({message:"Cours supprimé avec succès.",type:"success"})};return(r,e)=>{const l=ne("RouterLink");return _(),L(me,{"active-tag-name":"cours",group:"saisie",breadcrumb:[{label:"Élèves",href:"/apprenants"},{label:"Saisie Préalable",href:"/apprenants/saisie-prealable"},{label:"Cours",href:"/apprenants/saisie-prealable/cours"}]},{default:o(()=>[a(ge,null,{default:o(()=>[i("div",$e,[i("div",Ee,[i("div",ke,[a(t(U),{modelValue:u.value.label,"onUpdate:modelValue":e[0]||(e[0]=s=>u.value.label=s),type:"text",id:"search",name:"search",placeholder:"Rechercher un cours...",class:"w-full ps-10 border border-gray-200/40 bg-white transition-all h-10 rounded-md"},null,8,["modelValue"]),e[7]||(e[7]=i("div",{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-foreground-muted/70"},[i("span",{class:"flex iconify hugeicons--search-01 text-sm"})],-1))]),a(Se,null,{default:o(()=>[i("div",Ve,[e[8]||(e[8]=i("label",{for:"filter_label",class:"text-sm font-medium"},"Intitulé du cours",-1)),a(t(U),{id:"filter_label",type:"text",modelValue:u.value.label,"onUpdate:modelValue":e[1]||(e[1]=s=>u.value.label=s),placeholder:"Rechercher par intitulé...",class:"h-10"},null,8,["modelValue"])]),a(we,{"model-value":u.value.academic_level_id?String(u.value.academic_level_id):"",items:t(x)||[],"onUpdate:modelValue":e[2]||(e[2]=s=>u.value.academic_level_id=s?Number(s):void 0)},null,8,["model-value","items"]),a(Ce,{modelValue:u.value.filiaire_id,"onUpdate:modelValue":e[3]||(e[3]=s=>u.value.filiaire_id=s),items:t(b)||[]},null,8,["modelValue","items"]),i("div",Ae,[e[9]||(e[9]=i("label",{for:"hourly_volume",class:"text-sm font-medium"},"Nombre d'heures",-1)),a(t(U),{id:"hourly_volume",type:"number","model-value":u.value.hourly_volume,"onUpdate:modelValue":e[4]||(e[4]=s=>u.value.hourly_volume=s?Number(s):void 0),placeholder:"Ex: 60",class:"h-10",min:"0"},null,8,["model-value"])])]),_:1}),a(he,{filters:u.value,"reference-data":X.value,"custom-labels":Y,onRemoveFilter:Z},null,8,["filters","reference-data"])]),i("div",Ne,[a(t(h),{type:"button",size:"md",class:"rounded-md",onClick:ee},{default:o(()=>[...e[10]||(e[10]=[i("span",{class:"flex iconify hugeicons--plus-sign"},null,-1),i("span",{class:"hidden sm:flex"},"Ajouter",-1)])]),_:1})])]),i("div",Le,[a(l,{to:"/apprenants/saisie-prealable/cours/nouveau",style:{display:"none"}}),a(t(ce),{class:"rounded-md bg-white"},{default:o(()=>[a(t(ve),{class:"bg-primary text-white text-xs uppercase"},{default:o(()=>[a(t(C),null,{default:o(()=>[a(t(d),{rowspan:"2",class:"w-14"},{default:o(()=>[a(t(z),{checked:!0,class:"bg-white scale-70"})]),_:1}),a(t(d),{rowspan:"2"},{default:o(()=>[...e[11]||(e[11]=[n("Code",-1)])]),_:1}),a(t(d),{rowspan:"2"},{default:o(()=>[...e[12]||(e[12]=[n("Intitulé du cours",-1)])]),_:1}),a(t(d),{rowspan:"2"},{default:o(()=>[...e[13]||(e[13]=[n("Niveau",-1)])]),_:1}),a(t(d),{rowspan:"2"},{default:o(()=>[...e[14]||(e[14]=[n("Section",-1)])]),_:1}),a(t(d),{rowspan:"2"},{default:o(()=>[...e[15]||(e[15]=[n("Nombre d'heure",-1)])]),_:1}),a(t(d),{colspan:"6",class:"text-center px-4"},{default:o(()=>[...e[16]||(e[16]=[n("Maximum",-1)])]),_:1}),a(t(d),{rowspan:"2"},{default:o(()=>[...e[17]||(e[17]=[n("Operations",-1)])]),_:1})]),_:1}),a(t(C),{class:"bg-primary border-t-primary text-white text-xs uppercase"},{default:o(()=>[a(t(d),{class:"px-4 py-2 !rounded-none"},{default:o(()=>[...e[18]||(e[18]=[n("P1",-1)])]),_:1}),a(t(d),{class:"px-4 py-2 !rounded-none"},{default:o(()=>[...e[19]||(e[19]=[n("P2",-1)])]),_:1}),a(t(d),{class:"px-4 py-2 !rounded-none"},{default:o(()=>[...e[20]||(e[20]=[n("E1",-1)])]),_:1}),a(t(d),{class:"px-4 py-2 !rounded-none"},{default:o(()=>[...e[21]||(e[21]=[n("P3",-1)])]),_:1}),a(t(d),{class:"px-4 py-2 !rounded-none"},{default:o(()=>[...e[22]||(e[22]=[n("P4",-1)])]),_:1}),a(t(d),{class:"px-4 py-2 !rounded-none"},{default:o(()=>[...e[23]||(e[23]=[n("E2",-1)])]),_:1})]),_:1})]),_:1}),a(t(_e),null,{default:o(()=>[(_(!0),w(de,null,ie(A.value,s=>(_(),L(t(C),{key:s.id},{default:o(()=>[a(t(f),{class:"w-14"},{default:o(()=>[a(t(z),{checked:!1,class:"bg-white scale-70"})]),_:1}),a(t(f),null,{default:o(()=>[n(p(s.code||s.id),1)]),_:2},1024),a(t(f),null,{default:o(()=>[n(p(s.label),1)]),_:2},1024),a(t(f),null,{default:o(()=>[n(p(J(s.academic_level_id)),1)]),_:2},1024),a(t(f),null,{default:o(()=>[n(p(K(s.filiaire_id)),1)]),_:2},1024),a(t(f),null,{default:o(()=>[n(p(s.hourly_volume)+"h",1)]),_:2},1024),a(t(f),{class:"text-center px-4"},{default:o(()=>[n(p(s.max_period_1),1)]),_:2},1024),a(t(f),{class:"text-center px-4"},{default:o(()=>[n(p(s.max_period_2),1)]),_:2},1024),a(t(f),{class:"text-center px-4"},{default:o(()=>[n(p(s.max_exam_1),1)]),_:2},1024),a(t(f),{class:"text-center px-4"},{default:o(()=>[n(p(s.max_period_3),1)]),_:2},1024),a(t(f),{class:"text-center px-4"},{default:o(()=>[n(p(s.max_period_4),1)]),_:2},1024),a(t(f),{class:"text-center px-4"},{default:o(()=>[n(p(s.max_exam_2),1)]),_:2},1024),a(t(f),{class:"px-4"},{default:o(()=>[i("div",Ue,[e[27]||(e[27]=i("div",{class:"flex-1"},null,-1)),e[28]||(e[28]=i("button",{class:"ml-2 group-hover:hidden rounded-full size-8 flex items-center justify-center hover:bg-gray-100 transition"},[i("span",{class:"iconify hugeicons--more-vertical-circle-01"})],-1)),i("div",Pe,[a(t(h),{variant:"ghost",size:"icon",class:"size-8 justify-center text-gray-500 hover:text-blue-600 hover:bg-blue-50",onClick:c=>le(s.id)},{default:o(()=>[...e[24]||(e[24]=[i("span",{class:"iconify hugeicons--edit-02"},null,-1)])]),_:1},8,["onClick"]),a(be,{action:"danger",title:"Supprimer un cours",message:`Vous êtes sur le point de supprimer le cours '${s.label}'. Êtes-vous sûr de continuer?`},{trigger:o(()=>[a(t(h),{variant:"ghost",size:"icon",class:"size-8 justify-center text-gray-500 hover:text-red-600 hover:bg-red-50"},{default:o(()=>[...e[25]||(e[25]=[i("span",{class:"iconify hugeicons--delete-02"},null,-1)])]),_:1})]),"confirm-action-button":o(()=>[a(t(h),{variant:"destructive",size:"sm",class:"h-10 px-4",onClick:pe(c=>ae(s.id),["stop"])},{default:o(()=>[...e[26]||(e[26]=[n(" Oui, Supprimer ",-1)])]),_:1},8,["onClick"])]),_:2},1032,["message"])])])]),_:2},1024)]),_:2},1024))),128)),!A.value||A.value.length===0?(_(),L(t(C),{key:0},{default:o(()=>[a(t(f),{colspan:14,class:"text-center py-8 text-gray-500"},{default:o(()=>[t(M)?(_(),w("div",Ie,"Chargement des cours...")):t(I)?(_(),w("div",Re,"Erreur lors du chargement: "+p(t(I)),1)):(_(),w("div",Te,"Aucun cours trouvé"))]),_:1})]),_:1})):ue("",!0)]),_:1})]),_:1})]),a(xe,{modelValue:m.value,"onUpdate:modelValue":e[5]||(e[5]=s=>m.value=s),perPage:g.value,totalItems:q.value,"onUpdate:perPage":e[6]||(e[6]=s=>g.value=s)},null,8,["modelValue","perPage","totalItems"])]),_:1})]),_:1})}}});export{nl as default};
