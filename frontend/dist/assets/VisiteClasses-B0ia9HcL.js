import{d as W,A as b,v as K,r as X,n as Y,p as w,x as V,w as l,f as t,b as n,c as v,i as s,k as y,z as S,y as o,B as Z,C as ee,D as se,E as te,F as k,G as j,$ as le,t as f,o as c,J as ae,s as z}from"./index-CJ_PivE-.js";import{_ as C}from"./Input.vue_vue_type_script_setup_true_lang-B9adgRZV.js";import{_ as re,a as oe,b as L,c as d,d as ie,e as m}from"./TableHeader.vue_vue_type_script_setup_true_lang-cS4zBTGx.js";import{_ as ne,a as ue,b as de}from"./PopoverTrigger.vue_vue_type_script_setup_true_lang-DzZWQSaq.js";import{_ as fe}from"./SelectGroup.vue_vue_type_script_setup_true_lang-CwIOzTi6.js";import{_ as me}from"./FilterBadges.vue_vue_type_script_setup_true_lang-CBuiPNtr.js";import{_ as pe}from"./ListClassRoom.vue_vue_type_script_setup_true_lang-crHdkUu0.js";import{_ as ce}from"./DateFilter.vue_vue_type_script_setup_true_lang-BLMQrden.js";import{_ as N}from"./Checkbox.vue_vue_type_script_setup_true_lang-DTckireD.js";import{_ as _e}from"./LayoutSaisieOperation.vue_vue_type_script_setup_true_lang-bYPLg6Nt.js";import{_ as ge}from"./BoxPanelWrapper.vue_vue_type_script_setup_true_lang-CmJ-Iy6y.js";import{u as h}from"./useGetApi-EdzHoZm6.js";import{u as ve}from"./useDeleteApi-D2AjqV8w.js";import{a as ye}from"./AlertMessage.vue_vue_type_script_setup_true_lang-DthA28zY.js";import"./index-BpkKmY4O.js";import"./RovingFocusGroup-BxePylpC.js";import"./DashLayoutWithMode.vue_vue_type_script_setup_true_lang-DzpyZ4TL.js";import"./RightDashHeader.vue_vue_type_script_setup_true_lang-Bn3G870_.js";import"./DashPageHeader.vue_vue_type_script_setup_true_lang-DucYyTAx.js";import"./DialogTrigger.vue_vue_type_script_setup_true_lang-Bm461x8Q.js";const xe={class:"flex items-center gap-3 justify-between"},be={class:"flex flex-1 items-center gap-2"},we={class:"relative w-full max-w-xs"},$e={class:"grid gap-4"},Ve={class:"flex flex-col gap-3.5"},Se={class:"space-y-1.5"},Ce={class:"space-y-1.5"},Le={class:"space-y-1.5"},he={class:"flex flex-wrap items-center gap-2.5"},De={key:0,class:"flex justify-center items-center py-10"},Ae={key:1,class:"flex justify-center items-center py-10 text-red-600"},Ee={key:2,class:"mt-4 rounded-md overflow-hidden flex flex-1 bg-white"},Fe={class:"flex items-center gap-2 w-max"},Te={class:"hidden group-hover:flex items-center gap-2"},es=W({__name:"VisiteClasses",setup(ke){const{data:O,loading:D,error:A,fetchData:E}=h(b.GET_VISITE_CLASSES),{data:_,fetchData:R}=h(b.GET_FONCTIONS),{data:$,fetchData:U}=h(b.GET_CLASSROOMS),{deleting:F,errorDelete:g,deleteItem:I}=ve();K(()=>{E(),R(),U()});const x=X(""),i=Y({classroom_id:void 0,date:void 0,professeur:void 0,visiteur:void 0,fonction_id:void 0}),M=w(()=>{const a=$==null?void 0:$.value;return Array.isArray(a)?a:(a==null?void 0:a.data)??[]}),T=w(()=>{const a=_==null?void 0:_.value;return Array.isArray(a)?a:(a==null?void 0:a.data)??[]}),P=w(()=>{let a=O.value||[];if(!Array.isArray(a)&&a.data&&(a=a.data),!Array.isArray(a))return[];if(i.classroom_id&&(a=a.filter(e=>String(e.classroom_id)===String(i.classroom_id))),i.date&&(a=a.filter(e=>e.visit_hour&&e.visit_hour.startsWith(i.date))),i.fonction_id&&(a=a.filter(e=>String(e.fonction_id)===String(i.fonction_id))),i.professeur){const e=i.professeur.toLowerCase();a=a.filter(u=>{var r;return((r=u.personal)==null?void 0:r.name)&&u.personal.name.toLowerCase().includes(e)})}if(i.visiteur){const e=i.visiteur.toLowerCase();a=a.filter(u=>u.visiteur&&u.visiteur.toLowerCase().includes(e))}if(x.value){const e=x.value.toLowerCase();a=a.filter(u=>{var r,p;return u.summary&&u.summary.toLowerCase().includes(e)||((r=u.classroom)==null?void 0:r.name)&&u.classroom.name.toLowerCase().includes(e)||u.visiteur&&u.visiteur.toLowerCase().includes(e)||((p=u.personal)==null?void 0:p.name)&&u.personal.name.toLowerCase().includes(e)})}return a}),B=w(()=>({classroom_id:M.value||[],date:[],fonction_id:T.value||[],professeur:[],visiteur:[]})),G={classroom_id:(a,e)=>{const u=e==null?void 0:e.find(r=>r.id===a);return u?`Classe: ${u.name}`:a},date:a=>`Date: ${a}`,professeur:a=>`Prof: ${a}`,visiteur:a=>`Visiteur: ${a}`,fonction_id:(a,e)=>{const u=e==null?void 0:e.find(r=>String(r.id)===String(a));return u?`Fonction: ${u.title}`:a}},q=a=>{a==="classroom_id"&&(i.classroom_id=void 0),a==="date"&&(i.date=void 0),a==="professeur"&&(i.professeur=void 0),a==="visiteur"&&(i.visiteur=void 0),a==="fonction_id"&&(i.fonction_id=void 0)},H=a=>a?new Date(a).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"}):"-",J=a=>{if(!a||!_.value)return"-";const e=_.value.find(u=>u.id==a);return(e==null?void 0:e.title)||"-"},Q=async a=>{const e=b.DELETE_VISITE_CLASSE.replace(":id",String(a));if(await I(e),E(),g.value){z({message:g.value,type:"error"}),console.error("Erreur lors de la suppression :",g.value);return}else z({message:"Visite de classe supprimée avec succès.",type:"success"}),console.log("Visite de classe supprimée avec succès.")};return(a,e)=>{const u=le("RouterLink");return c(),V(_e,{group:"operations","active-tag-name":"visite-classe",breadcrumb:[{label:"Élèves",href:"/apprenants"},{label:"Opérations",href:"/apprenants/operations"},{label:"Visite de Classes",href:"/apprenants/operations/visite-classe"}]},{default:l(()=>[t(ge,null,{default:l(()=>[n("div",xe,[n("div",be,[n("div",we,[t(s(C),{type:"text",id:"search",name:"search",placeholder:"Rechercher...",modelValue:x.value,"onUpdate:modelValue":e[0]||(e[0]=r=>x.value=r),class:"w-full ps-10 border border-gray-200/40 bg-white transition-all h-10 rounded-md"},null,8,["modelValue"]),e[6]||(e[6]=n("div",{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-foreground-muted/70"},[n("span",{class:"flex iconify hugeicons--search-01 text-sm"})],-1))]),t(s(ne),null,{default:l(()=>[t(s(ue),{"as-child":""},{default:l(()=>[t(s(y),{variant:"ghost",size:"sm",class:"h-10 rounded-md border bg-white"},{default:l(()=>[...e[7]||(e[7]=[n("span",{class:"hidden sm:flex"},"Filtre",-1),n("span",{class:"iconify hugeicons--filter"},null,-1)])]),_:1})]),_:1}),t(s(de),{class:"w-80"},{default:l(()=>[n("div",$e,[e[11]||(e[11]=n("div",{class:"space-y-2"},[n("h4",{class:"font-medium leading-none"},"Filtrage")],-1)),n("div",Ve,[t(pe,{modelValue:i.classroom_id,"onUpdate:modelValue":e[1]||(e[1]=r=>i.classroom_id=r)},null,8,["modelValue"]),t(ce,{modelValue:i.date,"onUpdate:modelValue":e[2]||(e[2]=r=>i.date=r),label:"Date de visite"},null,8,["modelValue"]),n("div",Se,[t(s(S),{class:"text-foreground-muted font-light"},{default:l(()=>[...e[8]||(e[8]=[o("Fonction",-1)])]),_:1}),t(s(Z),{"model-value":i.fonction_id?String(i.fonction_id):"","onUpdate:modelValue":e[3]||(e[3]=r=>i.fonction_id=r?Number(r):void 0)},{default:l(()=>[t(s(ee),{class:"w-full"},{default:l(()=>[t(s(se),{placeholder:"Sélectionner une fonction"})]),_:1}),t(s(te),null,{default:l(()=>[t(s(fe),null,{default:l(()=>[(c(!0),v(j,null,k(T.value,r=>(c(),V(s(ae),{key:r.id,value:String(r.id)},{default:l(()=>[o(f(r.title),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1},8,["model-value"])]),n("div",Ce,[t(s(S),{class:"text-foreground-muted font-light"},{default:l(()=>[...e[9]||(e[9]=[o("Professeur",-1)])]),_:1}),t(s(C),{modelValue:i.professeur,"onUpdate:modelValue":e[4]||(e[4]=r=>i.professeur=r),placeholder:"Nom du professeur...",class:"h-10"},null,8,["modelValue"])]),n("div",Le,[t(s(S),{class:"text-foreground-muted font-light"},{default:l(()=>[...e[10]||(e[10]=[o("Visiteur",-1)])]),_:1}),t(s(C),{modelValue:i.visiteur,"onUpdate:modelValue":e[5]||(e[5]=r=>i.visiteur=r),placeholder:"Nom du visiteur...",class:"h-10"},null,8,["modelValue"])])])])]),_:1})]),_:1}),t(me,{filters:i,"reference-data":B.value,"custom-labels":G,onRemoveFilter:q},null,8,["filters","reference-data"])]),n("div",he,[t(s(y),{size:"md",class:"rounded-md max-sm:flex-1 sm:w-max","as-child":""},{default:l(()=>[t(u,{to:"/apprenants/operations/visite-classe/nouvelle"},{default:l(()=>[...e[12]||(e[12]=[n("span",{class:"flex iconify hugeicons--plus-sign"},null,-1),n("span",{class:"hidden sm:flex"},"Nouvelle visite",-1)])]),_:1})]),_:1})])]),s(D)||s(F)?(c(),v("div",De,[e[13]||(e[13]=n("span",{class:"iconify animate-spin hugeicons--loading-03 text-2xl mr-2"},null,-1)),n("span",null,f(s(D)?"Chargement...":"Suppression en cours..."),1)])):s(A)||s(g)?(c(),v("div",Ae,[e[14]||(e[14]=n("span",{class:"iconify hugeicons--alert-triangle mr-2"},null,-1)),n("span",null,f(s(A)||s(g)),1)])):(c(),v("div",Ee,[t(s(re),{class:"rounded-md bg-white"},{default:l(()=>[t(s(oe),{class:""},{default:l(()=>[t(s(L),{class:"bg-primary"},{default:l(()=>[t(s(d),{rowspan:"2",class:"w-[20px]"},{default:l(()=>[t(s(N),{class:"bg-white scale-70"})]),_:1}),t(s(d),{rowspan:"2"},{default:l(()=>[...e[15]||(e[15]=[o("Date de visite",-1)])]),_:1}),t(s(d),{rowspan:"2"},{default:l(()=>[...e[16]||(e[16]=[o("Visite de classe",-1)])]),_:1}),t(s(d),{class:"text-center",colspan:"4"},{default:l(()=>[...e[17]||(e[17]=[o("Classe visitée",-1)])]),_:1}),t(s(d),{class:"text-center",colspan:"5"},{default:l(()=>[...e[18]||(e[18]=[o("Appréciation détaillée",-1)])]),_:1}),t(s(d),{rowspan:"2"},{default:l(()=>[...e[19]||(e[19]=[o("Professeur",-1)])]),_:1}),t(s(d),{rowspan:"2"},{default:l(()=>[...e[20]||(e[20]=[o("Visiteur",-1)])]),_:1}),t(s(d),{rowspan:"2"},{default:l(()=>[...e[21]||(e[21]=[o("Fonction",-1)])]),_:1}),t(s(d),{rowspan:"2"},{default:l(()=>[...e[22]||(e[22]=[o("Actions",-1)])]),_:1})]),_:1}),t(s(L),{class:"bg-primary border-t-primary text-white text-xs"},{default:l(()=>[t(s(d),{class:"!rounded-tl-none"},{default:l(()=>[...e[23]||(e[23]=[o("Classe",-1)])]),_:1}),t(s(d),null,{default:l(()=>[...e[24]||(e[24]=[o("Sujet",-1)])]),_:1}),t(s(d),null,{default:l(()=>[...e[25]||(e[25]=[o("Heure début",-1)])]),_:1}),t(s(d),null,{default:l(()=>[...e[26]||(e[26]=[o("Heure fin",-1)])]),_:1}),t(s(d),null,{default:l(()=>[...e[27]||(e[27]=[o("Doc prof (20pts)",-1)])]),_:1}),t(s(d),null,{default:l(()=>[...e[28]||(e[28]=[o("Méthode procédé(12pts)",-1)])]),_:1}),t(s(d),null,{default:l(()=>[...e[29]||(e[29]=[o("Matière (12pts)",-1)])]),_:1}),t(s(d),null,{default:l(()=>[...e[30]||(e[30]=[o("Marche leçon (25pts)",-1)])]),_:1}),t(s(d),{class:"!rounded-tr-none"},{default:l(()=>[...e[31]||(e[31]=[o("Contrôle doc élève",-1)])]),_:1})]),_:1})]),_:1}),t(s(ie),null,{default:l(()=>[(c(!0),v(j,null,k(P.value,r=>(c(),V(s(L),{key:r.id,class:"group hover:bg-gray-50"},{default:l(()=>[t(s(m),null,{default:l(()=>[t(s(N))]),_:1}),t(s(m),null,{default:l(()=>[o(f(H(r.visit_hour)),1)]),_:2},1024),t(s(m),null,{default:l(()=>[o(f(r.summary),1)]),_:2},1024),t(s(m),null,{default:l(()=>{var p;return[o(f(((p=r.classroom)==null?void 0:p.name)||"—"),1)]}),_:2},1024),t(s(m),null,{default:l(()=>[o(f(r.subject||"—"),1)]),_:2},1024),t(s(m),null,{default:l(()=>[o(f(r.start_time||"—"),1)]),_:2},1024),t(s(m),null,{default:l(()=>[o(f(r.end_time||"—"),1)]),_:2},1024),t(s(m),null,{default:l(()=>[o(f(r.cot_doc_prof||"—"),1)]),_:2},1024),t(s(m),null,{default:l(()=>[o(f(r.cot_meth_proc||"—"),1)]),_:2},1024),t(s(m),null,{default:l(()=>[o(f(r.cot_matiere||"—"),1)]),_:2},1024),t(s(m),null,{default:l(()=>[o(f(r.cot_march_lecon||"—"),1)]),_:2},1024),t(s(m),null,{default:l(()=>[o(f(r.ctrl_doc_eleve||"—"),1)]),_:2},1024),t(s(m),null,{default:l(()=>{var p;return[o(f(((p=r.personal)==null?void 0:p.name)||"—"),1)]}),_:2},1024),t(s(m),null,{default:l(()=>[o(f(r.visiteur||"—"),1)]),_:2},1024),t(s(m),null,{default:l(()=>[o(f(J(r.fonction_id)),1)]),_:2},1024),t(s(m),null,{default:l(()=>[n("div",Fe,[e[35]||(e[35]=n("button",{class:"flex group-hover:hidden rounded-full size-8 items-center justify-center hover:bg-gray-100 transition","aria-label":"Plus d'actions"},[n("span",{class:"iconify hugeicons--more-vertical-circle-01","aria-hidden":"true"})],-1)),n("div",Te,[t(s(y),{variant:"ghost",size:"icon",class:"size-8 justify-center text-gray-500 hover:text-blue-600 hover:bg-blue-50","aria-label":"Modifier"},{default:l(()=>[t(u,{to:`/apprenants/operations/edit-visite-classe/${r.id}`},{default:l(()=>[...e[32]||(e[32]=[n("span",{class:"iconify hugeicons--edit-02","aria-hidden":"true"},null,-1)])]),_:1},8,["to"])]),_:2},1024),t(ye,{action:"danger",title:"Supprimer une visite de classe",message:" Vous êtes sur le point de supprimer cette visite de classe!! Êtes-vous sûr de continuer???"},{trigger:l(()=>[t(s(y),{variant:"ghost",size:"icon",class:"size-8 justify-center text-gray-500 hover:text-red-600 hover:bg-red-50","aria-label":"Supprimer"},{default:l(()=>[...e[33]||(e[33]=[n("span",{class:"iconify hugeicons--delete-02","aria-hidden":"true"},null,-1)])]),_:1})]),"confirm-action-button":l(()=>[t(s(y),{variant:"destructive",onClick:p=>Q(r.id),size:"sm","aria-label":"Supprimer",class:"h-10 px-4",disabled:s(F)},{default:l(()=>[...e[34]||(e[34]=[o(" Oui, Supprimer ",-1)])]),_:1},8,["onClick","disabled"])]),_:2},1024)])])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]))]),_:1})]),_:1})}}});export{es as default};
