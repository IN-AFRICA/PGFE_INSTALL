import{d as oe,A as $,s as v,a as ue,p as w,q as ie,v as re,x as p,w as l,b as S,f as s,i as t,z as b,y as r,c as d,h as f,a4 as P,t as c,B as D,C as O,D as I,E as G,J as y,G as A,F as R,$ as de,k as J,g as me,o as n}from"./index-CJ_PivE-.js";import{_ as z}from"./Input.vue_vue_type_script_setup_true_lang-B9adgRZV.js";import{_ as ce}from"./ComptaLayout.vue_vue_type_script_setup_true_lang-Bu3Oqdii.js";import{_ as pe}from"./FormSection.vue_vue_type_script_setup_true_lang-C-XSdIg3.js";import{I as g}from"./InputWrapper-tSRHzcjN.js";import{S as x}from"./SpanRequired-COKghTUX.js";import{_ as M}from"./SelectGroup.vue_vue_type_script_setup_true_lang-CwIOzTi6.js";import{u as fe}from"./usePostApi-Crg8MURP.js";import{u as Q}from"./useGetApi-EdzHoZm6.js";import{o as _e,s as k,a4 as ye,aM as W,av as H,u as be,aS as ge,aQ as h,t as xe}from"./vee-validate-zod-Bra4yLtR.js";import"./index-BpkKmY4O.js";import"./DashPageHeader.vue_vue_type_script_setup_true_lang-DucYyTAx.js";import"./DashLayout.vue_vue_type_script_setup_true_lang-Ch2egXHm.js";import"./RightDashHeader.vue_vue_type_script_setup_true_lang-Bn3G870_.js";import"./BoxPanelWrapper.vue_vue_type_script_setup_true_lang-CmJ-Iy6y.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const he={key:0,class:"text-sm text-red-500"},ve={key:0,class:"text-sm text-red-500"},Se={key:0,class:"text-sm text-red-500"},Ae={key:0,class:"text-sm text-red-500"},ke={key:0,class:"text-sm text-red-500"},Ce={class:"flex items-center justify-end gap-2"},Te={key:0},Ee={key:1},ze=oe({__name:"NewOutput",setup($e){const K=_e({name:k().min(1,"Le libellé est requis").max(255,"255 caractères maximum"),account_plan_id:W([k().refine(a=>a!=="","Le compte principal est requis").transform(a=>Number(a)),H()]).refine(a=>Number(a)>0,"Le compte principal est requis"),sub_account_plan_id:W([k().refine(a=>a!=="","Le sous-compte est requis").transform(a=>Number(a)),H()]).refine(a=>Number(a)>0,"Le sous-compte est requis"),amount:ye.number({invalid_type_error:"Le montant doit être un nombre"}).min(0,"Le montant doit être positif"),justification:k().min(1,"La justification est requise").max(255,"255 caractères maximum")}),{handleSubmit:X,resetForm:L,setFieldValue:Y}=be({validationSchema:xe(K),initialValues:{name:"",account_plan_id:"",sub_account_plan_id:"",amount:void 0,justification:""}}),{response:C,error:T,loading:E,postData:Z}=fe(),N=ue(),V=X(async a=>{try{if(await Z($.CREATE_OUTPUTACCOUNT,a),T.value){v({message:typeof T.value=="string"?T.value:"Erreur lors de la création de la sortie.",type:"error"});return}C.value&&C.value.message?(v({message:C.value.message||"Sortie créée avec succès",type:"success"}),L()):(v({message:"Sortie créée avec succès",type:"success"}),L()),N.push("/comptabilite/saisie-operations/recettes")}catch{v({message:"Une erreur inattendue s'est produite.",type:"error"})}}),{data:ee,loading:ae,fetchData:te}=Q($.GET_COMPTE),{data:se,loading:le,fetchData:ne}=Q($.GET_SUB_COMPTE);function U(a){let e=[];return Array.isArray(a)?e=a:a!=null&&a.data&&Array.isArray(a.data)?e=a.data:a!=null&&a.items&&Array.isArray(a.items)?e=a.items:a!=null&&a.accounts&&Array.isArray(a.accounts)?e=a.accounts:a&&typeof a=="object"&&(e=Object.values(a).filter(_=>_&&typeof _=="object"&&(_.id||_.value))),e}const j=w(()=>U(ee.value).map(e=>({id:String(e.id??e.value??""),name:e.name??e.label??e.libelle??e.title??e.account??`Compte #${e.id??e.value}`,code:e.code??e.number??e.code_compte}))),F=w(()=>U(se.value).map(e=>({id:String(e.id??e.value??""),name:e.name??e.label??e.libelle??e.title??e.account??`Sous-compte #${e.id??e.value}`,code:e.code??e.number??e.code_compte,account_plan_id:e.account_plan_id??e.parent_id??e.plan_id??e.compte_id}))),q=ge("account_plan_id"),B=w(()=>{const a=q.value;return a?F.value.filter(e=>String(e.account_plan_id??"")===String(a)):F.value});return ie(q,()=>{Y("sub_account_plan_id","")}),re(async()=>{await Promise.all([te(),ne()])}),(a,e)=>{const _=de("Textarea");return n(),p(ce,{activeBread:"Nouvelle Sortie","active-tag-name":"saisie-operations",group:"operations","show-header":!1},{default:l(()=>[S("form",{onSubmit:e[1]||(e[1]=me((...u)=>t(V)&&t(V)(...u),["prevent"])),class:"mt-10 space-y-8"},[s(pe,{class:"grid sm:grid-cols-2 lg:grid-cols-3 gap-y-6 gap-x-10",title:"Informations sur la sortie"},{default:l(()=>[s(g,null,{default:l(()=>[s(t(b),{class:"text-sm"},{default:l(()=>[e[2]||(e[2]=r(" Libellé de l'opération ",-1)),s(x)]),_:1}),s(t(h),{name:"name"},{default:l(({field:u,errorMessage:i,meta:m})=>[s(t(z),P(u,{class:"bg-gray-100 transition-all h-10 rounded-md",placeholder:"Ex: Achat de fournitures"}),null,16),m.touched&&i?(n(),d("span",he,c(i),1)):f("",!0)]),_:1})]),_:1}),s(g,null,{default:l(()=>[s(t(b),{class:"text-sm"},{default:l(()=>[e[3]||(e[3]=r(" Compte principal ",-1)),s(x)]),_:1}),s(t(h),{name:"account_plan_id"},{default:l(({field:u,errorMessage:i,meta:m})=>[s(t(D),{"model-value":u.value,"onUpdate:modelValue":o=>u.onChange(o)},{default:l(()=>[s(t(O),{class:"!h-10 bg-white w-full"},{default:l(()=>[s(t(I),{placeholder:"Sélectionner le compte principal"})]),_:1}),s(t(G),null,{default:l(()=>[s(t(M),null,{default:l(()=>[t(ae)?(n(),p(t(y),{key:0,value:"loading",disabled:""},{default:l(()=>[...e[4]||(e[4]=[r(" Chargement des comptes... ",-1)])]),_:1})):(n(),d(A,{key:1},[j.value.length?f("",!0):(n(),p(t(y),{key:0,value:"empty",disabled:""},{default:l(()=>[...e[5]||(e[5]=[r(" Aucun compte disponible ",-1)])]),_:1})),(n(!0),d(A,null,R(j.value,o=>(n(),p(t(y),{key:o.id,value:o.id},{default:l(()=>[r(c(o.code?o.code+" - ":"")+c(o.name),1)]),_:2},1032,["value"]))),128))],64))]),_:1})]),_:1})]),_:1},8,["model-value","onUpdate:modelValue"]),m.touched&&i?(n(),d("span",ve,c(i),1)):f("",!0)]),_:1})]),_:1}),s(g,null,{default:l(()=>[s(t(b),{class:"text-sm"},{default:l(()=>[e[6]||(e[6]=r(" Sous-compte ",-1)),s(x)]),_:1}),s(t(h),{name:"sub_account_plan_id"},{default:l(({field:u,errorMessage:i,meta:m})=>[s(t(D),{"model-value":u.value,"onUpdate:modelValue":o=>u.onChange(o)},{default:l(()=>[s(t(O),{class:"!h-10 bg-white w-full"},{default:l(()=>[s(t(I),{placeholder:"Sélectionner le sous-compte"})]),_:1}),s(t(G),null,{default:l(()=>[s(t(M),null,{default:l(()=>[t(le)?(n(),p(t(y),{key:0,value:"loading",disabled:""},{default:l(()=>[...e[7]||(e[7]=[r(" Chargement des sous-comptes... ",-1)])]),_:1})):(n(),d(A,{key:1},[B.value.length?f("",!0):(n(),p(t(y),{key:0,value:"empty",disabled:""},{default:l(()=>[...e[8]||(e[8]=[r(" Aucun sous-compte disponible ",-1)])]),_:1})),(n(!0),d(A,null,R(B.value,o=>(n(),p(t(y),{key:o.id,value:o.id},{default:l(()=>[r(c(o.code?o.code+" - ":"")+c(o.name),1)]),_:2},1032,["value"]))),128))],64))]),_:1})]),_:1})]),_:1},8,["model-value","onUpdate:modelValue"]),m.touched&&i?(n(),d("span",Se,c(i),1)):f("",!0)]),_:1})]),_:1}),s(g,null,{default:l(()=>[s(t(b),{class:"text-sm"},{default:l(()=>[e[9]||(e[9]=r(" Justification ",-1)),s(x)]),_:1}),s(t(h),{name:"justification"},{default:l(({field:u,errorMessage:i,meta:m})=>[s(_,P(u,{class:"bg-gray-100 transition-all rounded-md min-h-[100px]",placeholder:"Ex: FAC001 - Paiement fournisseur"}),null,16),m.touched&&i?(n(),d("span",Ae,c(i),1)):f("",!0)]),_:1})]),_:1}),s(g,null,{default:l(()=>[s(t(b),{class:"text-sm"},{default:l(()=>[e[10]||(e[10]=r(" Montant de la sortie (FC) ",-1)),s(x)]),_:1}),s(t(h),{name:"amount"},{default:l(({field:u,errorMessage:i,meta:m})=>[s(t(z),P(u,{type:"number",step:"0.01",class:"bg-gray-100 transition-all h-10 rounded-md",placeholder:"Ex: 150000"}),null,16),m.touched&&i?(n(),d("span",ke,c(i),1)):f("",!0)]),_:1})]),_:1})]),_:1}),S("div",Ce,[s(t(J),{variant:"outline",type:"button",disabled:t(E),onClick:e[0]||(e[0]=u=>t(N).push("/comptabilite/saisie-operations/recettes"))},{default:l(()=>[...e[11]||(e[11]=[S("span",{class:"flex iconify hugeicons--cancel-01 mr-1.5"},null,-1),r(" Annuler ",-1)])]),_:1},8,["disabled"]),s(t(J),{type:"submit",disabled:t(E)},{default:l(()=>[e[12]||(e[12]=S("span",{class:"flex iconify hugeicons--add-01"},null,-1)),t(E)?(n(),d("span",Ee,"Enregistrement...")):(n(),d("span",Te,"Enregistrer la sortie"))]),_:1},8,["disabled"])])],32)]),_:1})}}});export{ze as default};
