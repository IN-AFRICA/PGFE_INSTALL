import{d as P,r as c,x as E,i as t,K as q,w as s,f as e,k as D,b as u,L as I,M as H,N as K,y as o,g as J,z as N,P as Q,c as L,o as $,s as y,A as F,p as U,v as W,F as X,G as Z,t as p,H as j}from"./index-CJ_PivE-.js";import{_ as M}from"./Input.vue_vue_type_script_setup_true_lang-B9adgRZV.js";import{_ as h,a as ee,b as V,c as i,d as te,e as f}from"./TableHeader.vue_vue_type_script_setup_true_lang-cS4zBTGx.js";import{_ as se}from"./Checkbox.vue_vue_type_script_setup_true_lang-DTckireD.js";import{_ as ae}from"./BoxPanelWrapper.vue_vue_type_script_setup_true_lang-CmJ-Iy6y.js";import{_ as le}from"./TabPagination.vue_vue_type_script_setup_true_lang-Dsg8W898.js";import{_ as re}from"./ComptaLayout.vue_vue_type_script_setup_true_lang-Bu3Oqdii.js";import"./eventBus-CGRXT3Tn.js";import{_ as ne}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-Bm461x8Q.js";import{S as A}from"./SpanRequired-COKghTUX.js";import{u as oe}from"./usePostApi-Crg8MURP.js";import{_ as z}from"./CustomDatePicker.vue_vue_type_script_setup_true_lang-D0Zgowdp.js";import{u as ue}from"./useGetApi-EdzHoZm6.js";import"./index-BpkKmY4O.js";import"./RovingFocusGroup-BxePylpC.js";import"./DashPageHeader.vue_vue_type_script_setup_true_lang-DucYyTAx.js";import"./DashLayout.vue_vue_type_script_setup_true_lang-Ch2egXHm.js";import"./RightDashHeader.vue_vue_type_script_setup_true_lang-Bn3G870_.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./PopoverTrigger.vue_vue_type_script_setup_true_lang-DzZWQSaq.js";const de={class:"flex flex-col space-y-1.5"},ie={class:"flex flex-col space-y-1.5"},fe={class:"flex flex-col space-y-1.5"},me={key:0},pe={key:1},ce=P({__name:"NewBudget",emits:["created"],setup(O,{emit:w}){const _=c(!1),g=c(""),b=c(""),x=c(""),v=c(!1),B=w,{postData:n,response:a,error:r}=oe();function T(m){const l=(m||"").trim();if(!l)return"";const d=l.includes("T")?l.split("T")[0]:l;return/^\d{4}-\d{2}-\d{2}$/.test(d)?d:""}function S(m){const l=m.split("-");return l.length!==3?NaN:Number(l.join(""))}async function G(){var Y;if(!g.value.trim()){y({message:"Le code est requis",type:"error"});return}const m=T(b.value);if(!/^\d{4}-\d{2}-\d{2}$/.test(m)){y({message:"La date de début est invalide (YYYY-MM-DD)",type:"error"});return}const l=T(x.value);if(!/^\d{4}-\d{2}-\d{2}$/.test(l)){y({message:"La date de fin est invalide (YYYY-MM-DD)",type:"error"});return}const d=S(m),C=S(l);if(isNaN(d)||isNaN(C)||C<d){y({message:"La fin doit être supérieure ou égale au début (date)",type:"error"});return}const R={code:g.value.trim(),start_date:m,end_date:l};try{if(v.value=!0,await n(F.CREATE_BUDGET,R),r.value){y({message:String(r.value),type:"error"});return}const k=((Y=a.value)==null?void 0:Y.message)||"Budget créé avec succès";y({message:k,type:"success"}),g.value="",b.value="",x.value="",_.value=!1,B("created")}catch{y({message:"Erreur lors de la création du budget",type:"error"})}finally{v.value=!1}}return(m,l)=>($(),E(t(q),{open:_.value,"onUpdate:open":l[4]||(l[4]=d=>_.value=d)},{default:s(()=>[e(t(ne),{"as-child":""},{default:s(()=>[e(t(D),{size:"md",class:"rounded-md"},{default:s(()=>[...l[5]||(l[5]=[u("span",{class:"iconify hugeicons--plus-sign"},null,-1),u("span",{class:"hidden sm:flex"}," Créer un budget ",-1)])]),_:1})]),_:1}),e(t(I),{class:"sm:max-w-[440px]"},{default:s(()=>[e(t(H),null,{default:s(()=>[e(t(K),null,{default:s(()=>[...l[6]||(l[6]=[o("Ajouter un budget",-1)])]),_:1})]),_:1}),u("form",{class:"grid grid-cols-1 gap-4 py-4",onSubmit:J(G,["prevent"])},[u("div",de,[e(t(N),{for:"budget_code",class:"text-sm font-medium"},{default:s(()=>[l[7]||(l[7]=o(" Code ",-1)),e(A)]),_:1}),e(t(M),{modelValue:g.value,"onUpdate:modelValue":l[0]||(l[0]=d=>g.value=d),type:"text",id:"budget_code",name:"budget_code",placeholder:"Ex: BUD2025",class:"w-full h-10 border border-gray-200/40 bg-white transition-all"},null,8,["modelValue"])]),u("div",ie,[e(t(N),{for:"start_date",class:"text-sm font-medium"},{default:s(()=>[l[8]||(l[8]=o(" Début budgétaire ",-1)),e(A)]),_:1}),e(z,{modelValue:b.value,"onUpdate:modelValue":l[1]||(l[1]=d=>b.value=d),"enable-time":!1},null,8,["modelValue"])]),u("div",fe,[e(t(N),{for:"end_date",class:"text-sm font-medium"},{default:s(()=>[l[9]||(l[9]=o(" Fin du budget ",-1)),e(A)]),_:1}),e(z,{modelValue:x.value,"onUpdate:modelValue":l[2]||(l[2]=d=>x.value=d),"enable-time":!1},null,8,["modelValue"])]),l[12]||(l[12]=u("div",{class:"mt-1 pb-2"},[u("p",{class:"text-sm text-foreground-muted"}," * Les champs marqués sont obligatoires ")],-1)),e(t(Q),{class:"flex justify-end gap-2 items-center"},{default:s(()=>[e(t(D),{size:"sm",class:"h-9",variant:"outline",type:"button",onClick:l[3]||(l[3]=d=>_.value=!1)},{default:s(()=>[...l[10]||(l[10]=[u("span",{class:"iconify flex hugeicons--cancel-01 mr-1"},null,-1),o(" Annuler ",-1)])]),_:1}),e(t(D),{size:"sm",class:"h-9",type:"submit",disabled:v.value},{default:s(()=>[l[11]||(l[11]=u("span",{class:"iconify flex hugeicons--floppy-disk mr-1"},null,-1)),v.value?($(),L("span",pe,"Enregistrement...")):($(),L("span",me,"Enregistrer"))]),_:1},8,["disabled"])]),_:1})],32)]),_:1})]),_:1},8,["open"]))}}),_e={class:"flex sm:items-center gap-3 flex-col sm:flex-row sm:justify-between"},ge={class:"relative flex-1"},xe={class:"flex flex-wrap items-center sm:justify-end gap-2.5 flex-1"},ve={class:"mt-4 rounded-md overflow-hidden flex flex-1 bg-white"},ye={class:"flex items-center gap-2 w-max"},Me=P({__name:"ListBudget",setup(O){const{data:w,fetchData:_}=ue(F.GET_BUDGET),g=U(()=>{const n=w==null?void 0:w.value;return n?Array.isArray(n)?n:Array.isArray(n==null?void 0:n.data)?n.data:Array.isArray(n==null?void 0:n.budgets)?n.budgets:n&&typeof n=="object"?Object.values(n).filter(r=>r&&typeof r=="object"&&"code"in r&&"start_date"in r):[]:[]}),b=U(()=>g.value.map(n=>{const a=(n.start_date||"").slice(0,4),r=(n.end_date||"").slice(0,4);return{id:n.id,code:n.code,periode:a&&r?`${a}-${r}`:`${a||"-"}-${r||"-"}`,recette_budget:0,recette_execution:0,recette_taux:0,depense_budget:0,depense_execution:0,depense_taux:0,statut:""}})),x=c(1),v=c(15),B=c(20);return W(()=>{_()}),(n,a)=>($(),E(re,{activeBread:"Budget","active-tag-name":"budget",group:"saisie"},{default:s(()=>[e(ae,null,{default:s(()=>[u("div",_e,[u("div",ge,[e(t(M),{type:"text",id:"search",name:"search",placeholder:"Rechercher un budget...",class:"w-full max-w-sm ps-10 border border-gray-200/40 bg-white transition-all h-10 rounded-md"}),a[2]||(a[2]=u("div",{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-foreground-muted/70"},[u("span",{class:"flex iconify hugeicons--search-01 text-sm"})],-1))]),u("div",xe,[e(ce,{onCreated:t(_)},null,8,["onCreated"])])]),u("div",ve,[e(t(h),{class:"rounded-md bg-white"},{default:s(()=>[e(t(ee),null,{default:s(()=>[e(t(V),null,{default:s(()=>[e(t(i),{rowspan:"2",class:"w-[20px]"}),e(t(i),{rowspan:"2"},{default:s(()=>[...a[3]||(a[3]=[o("Code",-1)])]),_:1}),e(t(i),{rowspan:"2"},{default:s(()=>[...a[4]||(a[4]=[o("Période du budget",-1)])]),_:1}),e(t(i),{class:"text-center",colspan:"3"},{default:s(()=>[...a[5]||(a[5]=[o("Recette",-1)])]),_:1}),e(t(i),{class:"text-center",colspan:"3"},{default:s(()=>[...a[6]||(a[6]=[o("Dépense",-1)])]),_:1}),e(t(i),{rowspan:"2"},{default:s(()=>[...a[7]||(a[7]=[o("Operations",-1)])]),_:1})]),_:1}),e(t(V),{class:"text-xs"},{default:s(()=>[e(t(i),{class:"!rounded-tl-none text-center"},{default:s(()=>[...a[8]||(a[8]=[o("Budget",-1)])]),_:1}),e(t(i),{class:"text-center"},{default:s(()=>[...a[9]||(a[9]=[o("Execution",-1)])]),_:1}),e(t(i),{class:"text-center"},{default:s(()=>[...a[10]||(a[10]=[o("Taux",-1)])]),_:1}),e(t(i),{class:"text-center"},{default:s(()=>[...a[11]||(a[11]=[o("Budget",-1)])]),_:1}),e(t(i),{class:"text-center"},{default:s(()=>[...a[12]||(a[12]=[o("Execution",-1)])]),_:1}),e(t(i),{class:"!rounded-tr-none text-right"},{default:s(()=>[...a[13]||(a[13]=[o("Taux",-1)])]),_:1})]),_:1})]),_:1}),e(t(te),null,{default:s(()=>[($(!0),L(Z,null,X(b.value,r=>($(),E(t(V),{key:r.id},{default:s(()=>[e(t(f),{class:"w-[40px]"},{default:s(()=>[e(t(se),{class:"bg-white scale-70"})]),_:1}),e(t(f),{class:"font-semibold"},{default:s(()=>[o(p(r.code),1)]),_:2},1024),e(t(f),null,{default:s(()=>[o(p(r.periode),1)]),_:2},1024),e(t(f),{class:"text-center"},{default:s(()=>[o(p(r.recette_budget.toLocaleString())+" FC",1)]),_:2},1024),e(t(f),{class:"text-right"},{default:s(()=>[o(p(r.recette_execution.toLocaleString())+" FC",1)]),_:2},1024),e(t(f),{class:"text-right"},{default:s(()=>[u("span",{class:j([{"text-green-600":r.recette_taux>=100,"text-yellow-600":r.recette_taux>=80&&r.recette_taux<100,"text-red-600":r.recette_taux<80},"font-medium"])},p(r.recette_taux)+"% ",3)]),_:2},1024),e(t(f),{class:"text-right"},{default:s(()=>[o(p(r.depense_budget.toLocaleString())+" FC",1)]),_:2},1024),e(t(f),{class:"text-right"},{default:s(()=>[o(p(r.depense_execution.toLocaleString())+" FC",1)]),_:2},1024),e(t(f),{class:"text-right"},{default:s(()=>[u("span",{class:j([{"text-green-600":r.depense_taux<=100,"text-yellow-600":r.depense_taux>100&&r.depense_taux<=110,"text-red-600":r.depense_taux>110},"font-medium"])},p(r.depense_taux)+"% ",3)]),_:2},1024),e(t(f),null,{default:s(()=>[u("div",ye,[e(t(D),{variant:"outline",size:"icon",class:"size-8"},{default:s(()=>[...a[14]||(a[14]=[u("span",{class:"iconify hugeicons--edit-02"},null,-1)])]),_:1}),e(t(D),{variant:"destructive",size:"icon",class:"size-8"},{default:s(()=>[...a[15]||(a[15]=[u("span",{class:"iconify hugeicons--delete-02"},null,-1)])]),_:1})])]),_:1})]),_:2},1024))),128))]),_:1})]),_:1})]),e(le,{modelValue:x.value,"onUpdate:modelValue":a[0]||(a[0]=r=>x.value=r),perPage:v.value,totalItems:B.value,"onUpdate:perPage":a[1]||(a[1]=r=>v.value=r)},null,8,["modelValue","perPage","totalItems"])]),_:1})]),_:1}))}});export{Me as default};
