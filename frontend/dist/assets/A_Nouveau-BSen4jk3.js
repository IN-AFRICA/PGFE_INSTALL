import{d as se,A as T,s as v,p as E,q as ue,v as ne,x as f,w as l,b as A,f as a,i as t,z as b,y as i,c as d,h as _,B as $,C as w,D as V,E as P,J as p,G as S,F as O,t as c,a4 as G,k as R,g as oe,o as n}from"./index-CJ_PivE-.js";import{_ as J}from"./Input.vue_vue_type_script_setup_true_lang-B9adgRZV.js";import{_ as ie}from"./DashFormLayout.vue_vue_type_script_setup_true_lang-3V-LyRCQ.js";import{_ as re}from"./FormSection.vue_vue_type_script_setup_true_lang-C-XSdIg3.js";import{I as y}from"./InputWrapper-tSRHzcjN.js";import{S as g}from"./SpanRequired-COKghTUX.js";import{_ as L}from"./SelectGroup.vue_vue_type_script_setup_true_lang-CwIOzTi6.js";import{_ as de}from"./CustomDatePicker.vue_vue_type_script_setup_true_lang-D0Zgowdp.js";import{u as me}from"./usePostApi-Crg8MURP.js";import{u as M}from"./useGetApi-EdzHoZm6.js";import{o as ce,s as N,ab as pe,a4 as fe,aM as W,av as z,u as _e,aS as be,aQ as x,t as ye}from"./vee-validate-zod-Bra4yLtR.js";import"./index-BpkKmY4O.js";import"./DashLayout.vue_vue_type_script_setup_true_lang-Ch2egXHm.js";import"./RightDashHeader.vue_vue_type_script_setup_true_lang-Bn3G870_.js";import"./FormPageHeader.vue_vue_type_script_setup_true_lang-CAg7Z6LS.js";import"./BoxPanelWrapper.vue_vue_type_script_setup_true_lang-CmJ-Iy6y.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./PopoverTrigger.vue_vue_type_script_setup_true_lang-DzZWQSaq.js";const ge={key:0,class:"text-sm text-red-500"},xe={key:0,class:"text-sm text-red-500"},ve={key:0,class:"text-sm text-red-500"},Ae={key:0,class:"text-sm text-red-500"},Se={key:0,class:"text-sm text-red-500"},he={class:"flex items-center justify-end gap-2"},ke={key:0},Ce={key:1},Me=se({__name:"A_Nouveau",setup(Te){const Q=ce({account_plan_id:W([N().refine(s=>s!=="","Le compte principal est requis").transform(s=>Number(s)),z()]).refine(s=>Number(s)>0,"Le compte principal est requis"),sub_account_plan_id:W([N().refine(s=>s!=="","Le sous-compte est requis").transform(s=>Number(s)),z()]).refine(s=>Number(s)>0,"Le sous-compte est requis"),amount:fe.number({invalid_type_error:"Le montant doit être un nombre"}).min(0,"Le montant doit être positif"),type:pe(["input","output"],{required_error:"Le type est requis"}),justification:N().min(1,"La justification est requise").max(255,"255 caractères maximum")}),{handleSubmit:Y,resetForm:j,setFieldValue:H}=_e({validationSchema:ye(Q),initialValues:{account_plan_id:"",sub_account_plan_id:"",amount:void 0,type:"",justification:""}}),{response:h,error:k,loading:C,postData:K}=me(),q=Y(async s=>{try{if(await K(T.CREATE_A_NEW_COMPTABILITY,s),k.value){v({message:typeof k.value=="string"?k.value:"Erreur lors de la création de l’écriture.",type:"error"});return}h.value&&h.value.message?(v({message:h.value.message||"Écriture comptable créée avec succès",type:"success"}),j()):(v({message:"Écriture comptable créée avec succès",type:"success"}),j())}catch{v({message:"Une erreur inattendue s’est produite.",type:"error"})}}),{data:X,loading:Z,fetchData:ee}=M(T.GET_COMPTE),{data:ae,loading:te,fetchData:le}=M(T.GET_SUB_COMPTE);function F(s){let e=[];return Array.isArray(s)?e=s:s!=null&&s.data&&Array.isArray(s.data)?e=s.data:s!=null&&s.items&&Array.isArray(s.items)?e=s.items:s!=null&&s.accounts&&Array.isArray(s.accounts)?e=s.accounts:s&&typeof s=="object"&&(e=Object.values(s).filter(u=>u&&typeof u=="object"&&(u.id||u.value))),e}const U=E(()=>F(X.value).map(e=>({id:String(e.id??e.value??""),name:e.name??e.label??e.libelle??e.title??e.account??`Compte #${e.id??e.value}`,code:e.code??e.number??e.code_compte}))),D=E(()=>F(ae.value).map(e=>({id:String(e.id??e.value??""),name:e.name??e.label??e.libelle??e.title??e.account??`Sous-compte #${e.id??e.value}`,code:e.code??e.number??e.code_compte,account_plan_id:e.account_plan_id??e.parent_id??e.plan_id??e.compte_id}))),B=be("account_plan_id"),I=E(()=>{const s=B.value;return s?D.value.filter(e=>String(e.account_plan_id??"")===String(s)):D.value});return ue(B,()=>{H("sub_account_plan_id","")}),ne(async()=>{await Promise.all([ee(),le()])}),(s,e)=>(n(),f(ie,{title:"A-nouveaux","link-back":"/comptabilite/saisie-prealable","group-route":"/comptabilite/saisie-prealable",module:"compta",breadcrumb:[{label:"Comptabilité",href:"/comptabilite"},{label:"Saisie préalable",href:"/comptabilite/saisie-prealable"},{label:"A-nouveaux",href:"/comptabilite/saisie-prealable/a-nouveaux"}]},{default:l(()=>[A("form",{onSubmit:e[0]||(e[0]=oe((...u)=>t(q)&&t(q)(...u),["prevent"])),class:"mt-10 space-y-8"},[a(re,{class:"grid sm:grid-cols-2 lg:grid-cols-3 gap-y-6 gap-x-10",title:"Informations sur l'écriture comptable"},{default:l(()=>[a(y,null,{default:l(()=>[a(t(b),{class:"text-sm"},{default:l(()=>[e[1]||(e[1]=i(" Date de l'écriture ",-1)),a(g)]),_:1}),a(de)]),_:1}),a(y,null,{default:l(()=>[a(t(b),{class:"text-sm"},{default:l(()=>[e[2]||(e[2]=i(" Compte principal ",-1)),a(g)]),_:1}),a(t(x),{name:"account_plan_id"},{default:l(({field:u,errorMessage:r,meta:m})=>[a(t($),{"model-value":u.value,"onUpdate:modelValue":o=>u.onChange(o)},{default:l(()=>[a(t(w),{class:"!h-10 bg-white w-full"},{default:l(()=>[a(t(V),{placeholder:"Sélectionner le compte principal"})]),_:1}),a(t(P),null,{default:l(()=>[a(t(L),null,{default:l(()=>[t(Z)?(n(),f(t(p),{key:0,value:"loading",disabled:""},{default:l(()=>[...e[3]||(e[3]=[i(" Chargement des comptes... ",-1)])]),_:1})):(n(),d(S,{key:1},[U.value.length?_("",!0):(n(),f(t(p),{key:0,value:"empty",disabled:""},{default:l(()=>[...e[4]||(e[4]=[i(" Aucun compte disponible ",-1)])]),_:1})),(n(!0),d(S,null,O(U.value,o=>(n(),f(t(p),{key:o.id,value:o.id},{default:l(()=>[i(c(o.code?o.code+" - ":"")+c(o.name),1)]),_:2},1032,["value"]))),128))],64))]),_:1})]),_:1})]),_:1},8,["model-value","onUpdate:modelValue"]),m.touched&&r?(n(),d("span",ge,c(r),1)):_("",!0)]),_:1})]),_:1}),a(y,null,{default:l(()=>[a(t(b),{class:"text-sm"},{default:l(()=>[e[5]||(e[5]=i(" Sous-compte ",-1)),a(g)]),_:1}),a(t(x),{name:"sub_account_plan_id"},{default:l(({field:u,errorMessage:r,meta:m})=>[a(t($),{"model-value":u.value,"onUpdate:modelValue":o=>u.onChange(o)},{default:l(()=>[a(t(w),{class:"!h-10 bg-white w-full"},{default:l(()=>[a(t(V),{placeholder:"Sélectionner le sous-compte"})]),_:1}),a(t(P),null,{default:l(()=>[a(t(L),null,{default:l(()=>[t(te)?(n(),f(t(p),{key:0,value:"loading",disabled:""},{default:l(()=>[...e[6]||(e[6]=[i(" Chargement des sous-comptes... ",-1)])]),_:1})):(n(),d(S,{key:1},[I.value.length?_("",!0):(n(),f(t(p),{key:0,value:"empty",disabled:""},{default:l(()=>[...e[7]||(e[7]=[i(" Aucun sous-compte disponible ",-1)])]),_:1})),(n(!0),d(S,null,O(I.value,o=>(n(),f(t(p),{key:o.id,value:o.id},{default:l(()=>[i(c(o.code?o.code+" - ":"")+c(o.name),1)]),_:2},1032,["value"]))),128))],64))]),_:1})]),_:1})]),_:1},8,["model-value","onUpdate:modelValue"]),m.touched&&r?(n(),d("span",xe,c(r),1)):_("",!0)]),_:1})]),_:1}),a(y,null,{default:l(()=>[a(t(b),{class:"text-sm"},{default:l(()=>[e[8]||(e[8]=i(" Justification ",-1)),a(g)]),_:1}),a(t(x),{name:"justification"},{default:l(({field:u,errorMessage:r,meta:m})=>[a(t(J),G(u,{class:"bg-gray-100 transition-all h-10 rounded-md",placeholder:"Ex: FAC001 - Paiement fournisseur"}),null,16),m.touched&&r?(n(),d("span",ve,c(r),1)):_("",!0)]),_:1})]),_:1}),a(y,null,{default:l(()=>[a(t(b),{class:"text-sm"},{default:l(()=>[e[9]||(e[9]=i(" Montant (FC) ",-1)),a(g)]),_:1}),a(t(x),{name:"amount"},{default:l(({field:u,errorMessage:r,meta:m})=>[a(t(J),G(u,{type:"number",class:"bg-gray-100 transition-all h-10 rounded-md",placeholder:"Ex: 150000"}),null,16),m.touched&&r?(n(),d("span",Ae,c(r),1)):_("",!0)]),_:1})]),_:1}),a(y,null,{default:l(()=>[a(t(b),{class:"text-sm"},{default:l(()=>[e[10]||(e[10]=i(" Type d'écriture ",-1)),a(g)]),_:1}),a(t(x),{name:"type"},{default:l(({field:u,errorMessage:r,meta:m})=>[a(t($),{"model-value":u.value,"onUpdate:modelValue":o=>u.onChange(o)},{default:l(()=>[a(t(w),{class:"!h-10 bg-white w-full"},{default:l(()=>[a(t(V),{placeholder:"Sélectionner le type (entrée/sortie)"})]),_:1}),a(t(P),null,{default:l(()=>[a(t(L),null,{default:l(()=>[a(t(p),{value:"input"},{default:l(()=>[...e[11]||(e[11]=[i("Entrée (input)",-1)])]),_:1}),a(t(p),{value:"output"},{default:l(()=>[...e[12]||(e[12]=[i("Sortie (output)",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value","onUpdate:modelValue"]),m.touched&&r?(n(),d("span",Se,c(r),1)):_("",!0)]),_:1})]),_:1})]),_:1}),A("div",he,[a(t(R),{variant:"outline",type:"button",disabled:t(C)},{default:l(()=>[...e[13]||(e[13]=[A("span",{class:"flex iconify hugeicons--cancel-01 mr-1.5"},null,-1),i(" Annuler ",-1)])]),_:1},8,["disabled"]),a(t(R),{type:"submit",disabled:t(C)},{default:l(()=>[e[14]||(e[14]=A("span",{class:"flex iconify hugeicons--money-bag-02 mr-1.5"},null,-1)),t(C)?(n(),d("span",Ce,"Enregistrement...")):(n(),d("span",ke,"Enregistrer l'écriture"))]),_:1},8,["disabled"])])],32)]),_:1}))}});export{Me as default};
