import{d as I,p as M,c as $,f as s,z as le,w as t,y as o,i as l,B as te,C as ae,D as ne,E as re,J as k,o as b,A as w,n as ie,q as L,r as oe,x as N,b as i,j as R,k as h,$ as ue,G as de,F as fe,s as S,t as p}from"./index-CJ_PivE-.js";import{_ as me}from"./Input.vue_vue_type_script_setup_true_lang-B9adgRZV.js";import{_ as pe,a as _e,b as U,c as d,d as ce,e as f}from"./TableHeader.vue_vue_type_script_setup_true_lang-cS4zBTGx.js";import{_ as z}from"./Checkbox.vue_vue_type_script_setup_true_lang-DTckireD.js";import{_ as ge}from"./LayoutSaisieOperation.vue_vue_type_script_setup_true_lang-bYPLg6Nt.js";import{_ as ve}from"./BoxPanelWrapper.vue_vue_type_script_setup_true_lang-CmJ-Iy6y.js";import{_ as xe}from"./FilterBadges.vue_vue_type_script_setup_true_lang-CBuiPNtr.js";import{u as F}from"./useGetApi-EdzHoZm6.js";import{u as ye}from"./useSearch-uL6Ct-ER.js";import{u as be}from"./usePagination-BV0f67Jf.js";import{e as j}from"./eventBus-CGRXT3Tn.js";import{u as we}from"./useDeleteApi-D2AjqV8w.js";import{a as he}from"./AlertMessage.vue_vue_type_script_setup_true_lang-DthA28zY.js";import{E as Ve}from"./ExcelManagerWithAPI-DFtMVkSy.js";import{_ as $e}from"./TabPagination.vue_vue_type_script_setup_true_lang-Dsg8W898.js";import{_ as Ee,a as Se,b as Fe}from"./PopoverTrigger.vue_vue_type_script_setup_true_lang-DzZWQSaq.js";import{_ as Te}from"./ListClassRoom.vue_vue_type_script_setup_true_lang-crHdkUu0.js";import{_ as Ce}from"./ListFiliere.vue_vue_type_script_setup_true_lang-Dgxwljrk.js";import{_ as De}from"./SelectGroup.vue_vue_type_script_setup_true_lang-CwIOzTi6.js";import"./index-BpkKmY4O.js";import"./RovingFocusGroup-BxePylpC.js";import"./DashLayoutWithMode.vue_vue_type_script_setup_true_lang-DzpyZ4TL.js";import"./RightDashHeader.vue_vue_type_script_setup_true_lang-Bn3G870_.js";import"./DashPageHeader.vue_vue_type_script_setup_true_lang-DucYyTAx.js";import"./DialogTrigger.vue_vue_type_script_setup_true_lang-Bm461x8Q.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-DN4DQrTt.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Pe={class:"flex flex-col space-y-1.5 flex-1"},ke=I({__name:"ListGender",props:{modelValue:String,useFullLabel:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(C,{emit:V}){const c=C,g=V,T=M(()=>c.useFullLabel&&c.modelValue?c.modelValue==="Masculin"?"M":c.modelValue==="Féminin"?"F":c.modelValue:c.modelValue||"");function E(x){c.useFullLabel?g("update:modelValue",(x==="M"?"Masculin":x==="F"?"Féminin":x)||""):g("update:modelValue",x||"")}return(x,n)=>(b(),$("div",Pe,[s(le,{for:"gender",class:"text-sm font-medium"},{default:t(()=>[...n[0]||(n[0]=[o(" Genre ",-1)])]),_:1}),s(l(te),{id:"gender",name:"gender","model-value":T.value||"","onUpdate:modelValue":E},{default:t(()=>[s(l(ae),{id:"gender",class:"h-10 w-full"},{default:t(()=>[s(l(ne),{placeholder:"Sélectionnez un genre"})]),_:1}),s(l(re),null,{default:t(()=>[s(l(De),null,{default:t(()=>[s(l(k),{value:"M"},{default:t(()=>[...n[1]||(n[1]=[o("Masculin",-1)])]),_:1}),s(l(k),{value:"F"},{default:t(()=>[...n[2]||(n[2]=[o("Féminin",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])]))}}),Le={class:"flex sm:items-center gap-3 flex-col sm:flex-row sm:justify-between"},Ne={class:"flex flex-1 items-center gap-2"},Re={class:"relative w-full max-w-xs"},Ue={class:"grid gap-4"},ze={class:"flex flex-col gap-3.5"},je={class:"flex flex-wrap items-center sm:justify-end gap-2.5 flex-1"},Ie={key:0,class:"flex gap-2 items-center justify-center py-10 bg-white h-full rounded-md text-gray-500"},Me={key:1,class:"mt-4 rounded-md overflow-hidden flex flex-1 bg-white"},Oe={class:"group flex items-center justify-between"},Ge={class:"hidden group-hover:flex items-center gap-2 ml-2"},Ae={key:2,class:"flex flex-col items-center justify-center h-full py-10 bg-white rounded-md text-gray-500"},vs=I({__name:"MainSaisieOperations",setup(C){const{data:V,loading:c,fetchData:g,meta:T}=F(w.GET_STUDENT_REGISTRATIONS),{errorDelete:E,deleteItem:x}=we(),n=ie({classroom_id:void 0,filiaire_id:void 0,gender:void 0}),{data:O,fetchData:G}=F(w.GET_CLASSROOMS),{data:A,fetchData:B}=F(w.GET_FILLIERES),{data:q,fetchData:J}=F(w.GET_COUNTRIES);G(),B(),J();const W=M(()=>({classroom_id:O.value||[],filiaire_id:A.value||[]})),X={classroom_id:(a,e)=>{const m=e==null?void 0:e.find(r=>r.id===a);return m?m.name:a},filiaire_id:(a,e)=>{const m=e==null?void 0:e.find(r=>r.id===a);return m?m.name:a},gender:a=>a},H=a=>{a==="classroom_id"&&(n.classroom_id=void 0),a==="filiaire_id"&&(n.filiaire_id=void 0),a==="gender"&&(n.gender=void 0)},{query:y}=ye(a=>{g({page:_.value,per_page:v.value,...n,...a})},500),{page:_,perPageCount:v,total:D}=be(g,1,15,{pageParam:"page",perPageParam:"per_page"});g({page:_.value,per_page:v.value}),L([()=>n.classroom_id,()=>n.filiaire_id,()=>n.gender],()=>{const a={page:_.value,per_page:v.value,search:y.value};n.classroom_id&&(a.classroom_id=n.classroom_id),n.filiaire_id&&(a.filiaire_id=n.filiaire_id),n.gender&&(a.gender=n.gender),g(a)},{deep:!0}),L(T,a=>{a&&(typeof a.total=="number"&&(D.value=a.total),typeof a.per_page=="number"&&v.value!==a.per_page&&(v.value=a.per_page),typeof a.current_page=="number"&&_.value!==a.current_page&&(_.value=a.current_page))}),j.on("studentUpdated",()=>{g({page:_.value,per_page:v.value,search:y.value,...n})});const K=async a=>{const e=w.DELETE_STUDENT.replace(":student",String(a));if(await x(e),j.emit("studentUpdated"),E.value){S({message:E.value,type:"error"});return}else S({message:"Classe supprimée avec succès.",type:"success"})};function Q(a){_.value=1,v.value=a}function Y(a){if(!a)return"—";const e=(q.value||[]).find(m=>String(m.id)===String(a));return(e==null?void 0:e.name)||"—"}const P=oe({}),Z=()=>{P.value={...n.classroom_id?{classroom_id:n.classroom_id}:{},...n.filiaire_id?{filiaire_id:n.filiaire_id}:{},...n.gender?{gender:n.gender}:{},...y.value?{search:y.value}:{}}},ee=()=>{S({message:"Export réussi ! Le fichier a été téléchargé.",type:"success"})},se=a=>{S({message:a||"Erreur lors de l'export",type:"error"})};return(a,e)=>{const m=ue("RouterLink");return b(),N(ge,{"active-tag-name":"inscriptions",group:"operations",breadcrumb:[{label:"Élèves",href:"/apprenants"},{label:"Opérations",href:"/apprenants/operations"},{label:"Inscriptions",href:"/apprenants/operations"}]},{default:t(()=>[s(ve,null,{default:t(()=>[i("div",Le,[i("div",Ne,[i("div",Re,[s(l(me),{type:"text",modelValue:l(y),"onUpdate:modelValue":e[0]||(e[0]=r=>R(y)?y.value=r:null),id:"search",name:"search",placeholder:"Rechercher un cours...",class:"w-full max-w-sm ps-10 border border-gray-200/40 bg-white transition-all h-10 rounded-md"},null,8,["modelValue"]),e[5]||(e[5]=i("div",{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-foreground-muted/70"},[i("span",{class:"flex iconify hugeicons--search-01 text-sm"})],-1))]),s(l(Ee),null,{default:t(()=>[s(l(Se),{"as-child":""},{default:t(()=>[s(l(h),{variant:"ghost",size:"sm",class:"h-10 rounded-md border bg-white"},{default:t(()=>[...e[6]||(e[6]=[i("span",{class:"hidden sm:flex"}," Filtre",-1),i("span",{class:"iconify hugeicons--filter"},"Filtre",-1)])]),_:1})]),_:1}),s(l(Fe),{class:"w-80"},{default:t(()=>[i("div",Ue,[e[7]||(e[7]=i("div",{class:"space-y-2"},[i("h4",{class:"font-medium leading-none"},"Filtrage")],-1)),i("div",ze,[s(Te,{modelValue:n.classroom_id,"onUpdate:modelValue":e[1]||(e[1]=r=>n.classroom_id=r)},null,8,["modelValue"]),s(Ce,{modelValue:n.filiaire_id,"onUpdate:modelValue":e[2]||(e[2]=r=>n.filiaire_id=r)},null,8,["modelValue"]),s(ke,{modelValue:n.gender,"onUpdate:modelValue":e[3]||(e[3]=r=>n.gender=r),"use-full-label":!0},null,8,["modelValue"])])])]),_:1})]),_:1}),s(xe,{filters:n,"reference-data":W.value,"custom-labels":X,onRemoveFilter:H},null,8,["filters","reference-data"])]),i("div",je,[s(l(h),{size:"md",class:"rounded-md max-sm:flex-1 sm:w-max","as-child":""},{default:t(()=>[s(m,{to:"/apprenants/operations/nouveau-eleve"},{default:t(()=>[...e[8]||(e[8]=[i("span",{class:"flex iconify hugeicons--plus-sign"},null,-1),i("span",{class:"hidden sm:flex"},"Nouveau Eleve",-1)])]),_:1})]),_:1}),s(Ve,{"button-text":"Exporter","show-import":!1,"show-export-excel":!0,"show-template":!1,"export-url":l(w).EXPORT_STUDENT_REGISTRATIONS,"export-filters":P.value,"export-filename":"inscriptions_etudiants",onBeforeExport:Z,onExportSuccess:ee,onExportError:se},null,8,["export-url","export-filters"])])]),l(c)?(b(),$("div",Ie,[...e[9]||(e[9]=[i("span",{class:"iconify animate-spin hugeicons--loading-03 text-2xl"},null,-1),i("span",null,"Chargement des inscriptions...",-1)])])):l(V)&&l(V).length?(b(),$("div",Me,[s(l(pe),{class:"rounded-md bg-white"},{default:t(()=>[s(l(_e),null,{default:t(()=>[s(l(U),null,{default:t(()=>[s(l(d),{class:"w-[20px]"},{default:t(()=>[s(l(z),{class:"bg-white scale-70"})]),_:1}),s(l(d),null,{default:t(()=>[...e[10]||(e[10]=[o("Matricule",-1)])]),_:1}),s(l(d),null,{default:t(()=>[...e[11]||(e[11]=[o("Nom",-1)])]),_:1}),s(l(d),null,{default:t(()=>[...e[12]||(e[12]=[o("Postnom",-1)])]),_:1}),s(l(d),null,{default:t(()=>[...e[13]||(e[13]=[o("Prénom",-1)])]),_:1}),s(l(d),null,{default:t(()=>[...e[14]||(e[14]=[o("Pays",-1)])]),_:1}),s(l(d),null,{default:t(()=>[...e[15]||(e[15]=[o("Sexe",-1)])]),_:1}),s(l(d),null,{default:t(()=>[...e[16]||(e[16]=[o("Classe",-1)])]),_:1}),s(l(d),null,{default:t(()=>[...e[17]||(e[17]=[o("Section",-1)])]),_:1}),s(l(d),null,{default:t(()=>[...e[18]||(e[18]=[o("Date de naissance",-1)])]),_:1}),s(l(d),null,{default:t(()=>[...e[19]||(e[19]=[o("Lieu de naissance",-1)])]),_:1}),s(l(d),null,{default:t(()=>[...e[20]||(e[20]=[o("N° Tél",-1)])]),_:1}),s(l(d),null,{default:t(()=>[...e[21]||(e[21]=[o(" Operations ",-1)])]),_:1})]),_:1})]),_:1}),s(l(ce),null,{default:t(()=>[(b(!0),$(de,null,fe(l(V),r=>(b(),N(l(U),{key:r.id},{default:t(()=>[s(l(f),{class:"w-[40px]"},{default:t(()=>[s(l(z),{class:"bg-white scale-70"})]),_:1}),s(l(f),null,{default:t(()=>[o(p(r.matricule),1)]),_:2},1024),s(l(f),null,{default:t(()=>[o(p(r.student_name),1)]),_:2},1024),s(l(f),null,{default:t(()=>{var u;return[o(p(((u=r.student)==null?void 0:u.lastname)||"—"),1)]}),_:2},1024),s(l(f),null,{default:t(()=>{var u;return[o(p(((u=r.student)==null?void 0:u.firstname)||"—"),1)]}),_:2},1024),s(l(f),null,{default:t(()=>{var u;return[o(p(Y(r.country_id||((u=r.student)==null?void 0:u.country_id))),1)]}),_:2},1024),s(l(f),null,{default:t(()=>[o(p(r.gender),1)]),_:2},1024),s(l(f),null,{default:t(()=>[o(p(r.classroom_name||"Non assigné"),1)]),_:2},1024),s(l(f),null,{default:t(()=>[o(p(r.filiaire_name||"Non assigné"),1)]),_:2},1024),s(l(f),null,{default:t(()=>[o(p(new Date(r.date_of_birth).toLocaleDateString("fr-FR")),1)]),_:2},1024),s(l(f),null,{default:t(()=>{var u;return[o(p(((u=r.student)==null?void 0:u.birth_place)||"—"),1)]}),_:2},1024),s(l(f),null,{default:t(()=>{var u;return[o(p(((u=r.student)==null?void 0:u.phone_number)||"—"),1)]}),_:2},1024),s(l(f),null,{default:t(()=>[i("div",Oe,[e[26]||(e[26]=i("div",{class:"flex-1"},null,-1)),e[27]||(e[27]=i("button",{class:"ml-2 group-hover:hidden rounded-full size-8 flex items-center justify-center hover:bg-gray-100 transition"},[i("span",{class:"iconify hugeicons--more-vertical-circle-01"})],-1)),i("div",Ge,[s(l(h),{variant:"ghost",size:"icon",class:"size-8 justify-center text-gray-500 hover:text-blue-600 hover:bg-blue-50"},{default:t(()=>[s(m,{to:`/apprenants/operations/edition-eleve/${r.id}`},{default:t(()=>[...e[22]||(e[22]=[i("span",{class:"iconify hugeicons--edit-02"},null,-1)])]),_:1},8,["to"])]),_:2},1024),s(l(h),{variant:"ghost",size:"icon",class:"size-8 justify-center text-gray-500 hover:text-blue-600 hover:bg-blue-50"},{default:t(()=>[s(m,{to:`/apprenants/operations/student-infos/${r.student_id}`},{default:t(()=>[...e[23]||(e[23]=[i("span",{class:"iconify hugeicons--eye"},null,-1)])]),_:1},8,["to"])]),_:2},1024),s(he,{action:"danger",title:"Supprimer un étudiant",message:`Vous êtes sur le point de supprimer l'étudiant '${r.name} ${r.firstname}'. Êtes-vous sûr de continuer?`},{trigger:t(()=>[s(l(h),{variant:"ghost",size:"icon",class:"size-8 justify-center text-gray-500 hover:text-red-600 hover:bg-red-50"},{default:t(()=>[...e[24]||(e[24]=[i("span",{class:"iconify hugeicons--delete-02"},null,-1)])]),_:1})]),"confirm-action-button":t(()=>[s(l(h),{variant:"destructive",onClick:u=>K(r.id),size:"sm",class:"h-10 px-4"},{default:t(()=>[...e[25]||(e[25]=[o(" Oui, Supprimer ",-1)])]),_:1},8,["onClick"])]),_:2},1032,["message"])])])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})])):(b(),$("div",Ae,[...e[28]||(e[28]=[i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"size-6"},[i("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M20.25 6.375c0 2.278-3.694 4.125-8.25 4.125S3.75 8.653 3.75 6.375m16.5 0c0-2.278-3.694-4.125-8.25-4.125S3.75 4.097 3.75 6.375m16.5 0v11.25c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125V6.375m16.5 0v3.75m-16.5-3.75v3.75m16.5 0v3.75C20.25 16.153 16.556 18 12 18s-8.25-1.847-8.25-4.125v-3.75m16.5 0c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125"})],-1),i("span",null,"Aucune inscription trouvée pour le moment.",-1)])])),s($e,{modelValue:l(_),"onUpdate:modelValue":e[4]||(e[4]=r=>R(_)?_.value=r:null),perPage:l(v),totalItems:l(D),"onUpdate:perPage":Q},null,8,["modelValue","perPage","totalItems"])]),_:1})]),_:1})}}});export{vs as default};
