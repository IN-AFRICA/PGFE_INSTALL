import{d as qe,A as _,p as m,r as v,q as X,s as c,a1 as Re,v as Me,x as g,w as s,b as u,f as n,i as a,$ as Be,k as T,y as l,h as y,c as x,t as p,F as Y,G as Z,o as i}from"./index-CJ_PivE-.js";import{_ as ee}from"./Input.vue_vue_type_script_setup_true_lang-B9adgRZV.js";import{_ as te,a as ae,b,c as f,d as se,e as d}from"./TableHeader.vue_vue_type_script_setup_true_lang-cS4zBTGx.js";import{_ as ne,a as re,b as le,c as S}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-DN4DQrTt.js";import{_ as ue}from"./BoxPanelWrapper.vue_vue_type_script_setup_true_lang-CmJ-Iy6y.js";import{_ as Ge}from"./ComptaLayout.vue_vue_type_script_setup_true_lang-Bu3Oqdii.js";import{u as D}from"./useGetApi-EdzHoZm6.js";import{u as oe}from"./useDeleteApi-D2AjqV8w.js";import{u as ie}from"./usePutApi-BrTvEW5v.js";import"./eventBus-CGRXT3Tn.js";import{o as ze,s as w,a4 as Qe,aM as ce,av as de,u as pe,t as fe}from"./vee-validate-zod-Bra4yLtR.js";import"./index-BpkKmY4O.js";import"./RovingFocusGroup-BxePylpC.js";import"./DashPageHeader.vue_vue_type_script_setup_true_lang-DucYyTAx.js";import"./DashLayout.vue_vue_type_script_setup_true_lang-Ch2egXHm.js";import"./RightDashHeader.vue_vue_type_script_setup_true_lang-Bn3G870_.js";const He={class:"grid lg:grid-cols-2 gap-7"},Je={class:"flex sm:items-center flex-col sm:flex-row sm:justify-between mb-4"},Ke={class:"flex gap-20"},We={class:"overflow-x-auto"},Xe={key:1,class:"text-center py-8"},Ye={key:2,class:"text-center py-8 text-red-500"},Ze={class:"flex sm:items-center flex-col sm:flex-row sm:justify-between mb-4"},et={class:"flex gap-20"},tt={class:"overflow-x-auto"},at={key:1,class:"text-center py-8"},st={key:2,class:"text-center py-8 text-red-500"},At=qe({__name:"inputAndOuput",setup(nt){const I=Re(),N=ze({name:w().min(1,"Le libellé est requis").max(255,"255 caractères maximum"),account_plan_id:ce([w().refine(e=>e!=="","Le compte principal est requis").transform(e=>Number(e)),de()]).refine(e=>Number(e)>0,"Le compte principal est requis"),sub_account_plan_id:ce([w().refine(e=>e!=="","Le sous-compte est requis").transform(e=>Number(e)),de()]).refine(e=>Number(e)>0,"Le sous-compte est requis"),amount:Qe.number({invalid_type_error:"Le montant doit être un nombre"}).min(0,"Le montant doit être positif"),justification:w().min(1,"La justification est requise").max(255,"255 caractères maximum")}),me=N,{data:_e,error:j,loading:P,fetchData:L}=D(_.GET_INPUTACCOUNT),{putData:ye,error:ge}=ie(),{deleteItem:ve,errorDelete:xe}=oe(),{data:be,error:V,loading:F,fetchData:U}=D(_.GET_OUTPUTACCOUNT),{putData:Ae,error:Ee}=ie(),{deleteItem:Ce,errorDelete:Oe}=oe(),{data:Te,fetchData:Se}=D(_.GET_COMPTE),{data:De,fetchData:we}=D(_.GET_SUB_COMPTE);function q(e){let t=[];return Array.isArray(e)?t=e:e!=null&&e.data&&Array.isArray(e.data)?t=e.data:e!=null&&e.items&&Array.isArray(e.items)?t=e.items:e!=null&&e.accounts&&Array.isArray(e.accounts)?t=e.accounts:e&&typeof e=="object"&&(t=Object.values(e).filter(r=>r&&typeof r=="object"&&(r.id||r.value))),t}const Ie=m(()=>q(Te.value).map(e=>({id:String(e.id??e.value??""),name:e.name??e.label??e.libelle??e.title??`Compte #${e.id??e.value}`,code:e.code??""}))),R=m(()=>q(De.value).map(e=>({id:String(e.id??e.value??""),name:e.name??e.label??e.libelle??e.title??`Sous-compte #${e.id??e.value}`,code:e.code??"",account_plan_id:e.account_plan_id??e.accountPlanId??null}))),A=v(""),E=v(""),M=v(!1),B=v(!1),C=v(null),O=v(null),{handleSubmit:Le,resetForm:Ue,setValues:G,values:h}=pe({validationSchema:fe(N)}),{handleSubmit:he,resetForm:ke,setValues:z,values:k}=pe({validationSchema:fe(me)});m(()=>{const e=h.account_plan_id;return e?R.value.filter(t=>String(t.account_plan_id)===String(e)):[]}),m(()=>{const e=k.account_plan_id;return e?R.value.filter(t=>String(t.account_plan_id)===String(e)):[]}),X(()=>h.account_plan_id,()=>G({...h,sub_account_plan_id:""})),X(()=>k.account_plan_id,()=>z({...k,sub_account_plan_id:""}));const $e=m(()=>{const e=_e.value;let t=[];return Array.isArray(e)?t=e:e!=null&&e.data&&Array.isArray(e.data)?t=e.data:e&&typeof e=="object"&&!Array.isArray(e)&&(t=Object.values(e).filter(r=>r&&typeof r=="object"&&r.id)),t}),Ne=m(()=>{const e=be.value;let t=[];return Array.isArray(e)?t=e:e!=null&&e.data&&Array.isArray(e.data)?t=e.data:e&&typeof e=="object"&&!Array.isArray(e)&&(t=Object.values(e).filter(r=>r&&typeof r=="object"&&r.id)),t}),Q=m(()=>{const e=A.value.toLowerCase();return $e.value.filter(t=>{var r;return t.name.toLowerCase().includes(e)||((r=t.justification)==null?void 0:r.toLowerCase().includes(e))})}),H=m(()=>{const e=E.value.toLowerCase();return Ne.value.filter(t=>{var r;return t.name.toLowerCase().includes(e)||((r=t.justification)==null?void 0:r.toLowerCase().includes(e))})});Le(async e=>{if(C.value)try{if(await ye(_.UPDATE_INPUTACCOUNT(C.value.id),e),ge.value){c({message:"Erreur lors de la modification",type:"error"});return}c({message:"Entrée modifiée avec succès",type:"success"}),M.value=!1,Ue(),C.value=null,await L()}catch{c({message:"Une erreur est survenue",type:"error"})}});const je=e=>{var t,r;C.value=e,G({name:e.name,account_plan_id:((t=e.account_plan_id)==null?void 0:t.toString())||"",sub_account_plan_id:((r=e.sub_account_plan_id)==null?void 0:r.toString())||"",amount:e.amount,justification:e.justification}),M.value=!0},Pe=async e=>{if(confirm("Êtes-vous sûr de vouloir supprimer cette entrée ?"))try{if(await ve(_.DELETE_INPUTACCOUNT(e)),xe.value){c({message:"Erreur lors de la suppression",type:"error"});return}c({message:"Entrée supprimée avec succès",type:"success"}),await L()}catch{c({message:"Une erreur est survenue",type:"error"})}};he(async e=>{if(O.value)try{if(await Ae(_.UPDATE_OUTPUTACCOUNT(O.value.id),e),Ee.value){c({message:"Erreur lors de la modification",type:"error"});return}c({message:"Sortie modifiée avec succès",type:"success"}),B.value=!1,ke(),O.value=null,await U()}catch{c({message:"Une erreur est survenue",type:"error"})}});const Ve=e=>{var t,r;O.value=e,z({name:e.name,account_plan_id:((t=e.account_plan_id)==null?void 0:t.toString())||"",sub_account_plan_id:((r=e.sub_account_plan_id)==null?void 0:r.toString())||"",amount:e.amount,justification:e.justification}),B.value=!0},Fe=async e=>{if(confirm("Êtes-vous sûr de vouloir supprimer cette sortie ?"))try{if(await Ce(_.DELETE_OUTPUTACCOUNT(e)),Oe.value){c({message:"Erreur lors de la suppression",type:"error"});return}c({message:"Sortie supprimée avec succès",type:"success"}),await U()}catch{c({message:"Une erreur est survenue",type:"error"})}},J=e=>e?new Date(e).toLocaleDateString("fr-FR"):"-",K=e=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"CDF"}).format(e),W=e=>{const t=Ie.value.find(r=>String(r.id)===String(e));return t?`${t.code?t.code+" - ":""}${t.name}`:"-"};return m(()=>I.path==="/comptabilite/recettes"||I.path.includes("/comptabilite/nouvelle-entree")||I.path.includes("/comptabilite/nouvelle-sortie")),Me(async()=>{await Promise.all([L(),U(),Se(),we()])}),(e,t)=>{const r=Be("RouterLink");return i(),g(Ge,{activeBread:"Entrées et Sorties","active-tag-name":"recettes",group:"operations"},{default:s(()=>[u("div",He,[n(ue,null,{default:s(()=>[t[13]||(t[13]=u("span",{class:"text-gray-500 my-1.5 text-xl"},"Recettes",-1)),u("div",Je,[u("div",Ke,[n(a(ee),{modelValue:A.value,"onUpdate:modelValue":t[0]||(t[0]=o=>A.value=o),placeholder:"Rechercher...",class:"w-64"},null,8,["modelValue"]),n(r,{to:"/comptabilite/saisie-operations/nouvelle-entree"},{default:s(()=>[n(a(T),{size:"md"},{default:s(()=>[...t[2]||(t[2]=[u("span",{class:"iconify hugeicons--add-01 mr-2"},null,-1),l(" Nouvelle Entrée ",-1)])]),_:1})]),_:1})])]),u("div",We,[!a(P)&&!a(j)?(i(),g(a(te),{key:0},{default:s(()=>[n(a(ae),null,{default:s(()=>[n(a(b),null,{default:s(()=>[n(a(f),null,{default:s(()=>[...t[3]||(t[3]=[l("Libellé",-1)])]),_:1}),n(a(f),null,{default:s(()=>[...t[4]||(t[4]=[l("Compte",-1)])]),_:1}),n(a(f),null,{default:s(()=>[...t[5]||(t[5]=[l("Montant",-1)])]),_:1}),n(a(f),null,{default:s(()=>[...t[6]||(t[6]=[l("Date",-1)])]),_:1}),n(a(f),{class:"text-right"},{default:s(()=>[...t[7]||(t[7]=[l("Actions",-1)])]),_:1})]),_:1})]),_:1}),n(a(se),null,{default:s(()=>[Q.value.length===0?(i(),g(a(b),{key:0},{default:s(()=>[n(a(d),{colspan:"5",class:"text-center text-gray-500"},{default:s(()=>[l(p(A.value?"Aucune entrée trouvée":"Aucune entrée enregistrée"),1)]),_:1})]),_:1})):y("",!0),(i(!0),x(Z,null,Y(Q.value,o=>(i(),g(a(b),{key:o.id},{default:s(()=>[n(a(d),null,{default:s(()=>[l(p(o.name),1)]),_:2},1024),n(a(d),null,{default:s(()=>[l(p(W(o.account_plan_id)),1)]),_:2},1024),n(a(d),null,{default:s(()=>[l(p(K(o.amount)),1)]),_:2},1024),n(a(d),null,{default:s(()=>[l(p(J(o.created_at)),1)]),_:2},1024),n(a(d),{class:"text-right"},{default:s(()=>[n(a(ne),null,{default:s(()=>[n(a(re),{"as-child":""},{default:s(()=>[n(a(T),{variant:"ghost",size:"sm"},{default:s(()=>[...t[8]||(t[8]=[u("span",{class:"iconify hugeicons--more-vertical text-lg"},null,-1)])]),_:1})]),_:1}),n(a(le),{align:"end"},{default:s(()=>[n(a(S),{onClick:$=>je(o)},{default:s(()=>[...t[9]||(t[9]=[u("span",{class:"iconify hugeicons--pencil-edit-01 mr-2"},null,-1),l(" Modifier ",-1)])]),_:1},8,["onClick"]),n(a(S),{onClick:$=>Pe(o.id),class:"text-red-600"},{default:s(()=>[...t[10]||(t[10]=[u("span",{class:"iconify hugeicons--delete-02 mr-2"},null,-1),l(" Supprimer ",-1)])]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})):y("",!0),a(P)?(i(),x("div",Xe,[...t[11]||(t[11]=[u("span",{class:"iconify hugeicons--loading-03 animate-spin text-2xl"},null,-1),u("p",{class:"text-gray-500 mt-2"},"Chargement des entrées...",-1)])])):y("",!0),a(j)?(i(),x("div",Ye,[...t[12]||(t[12]=[u("span",{class:"iconify hugeicons--alert-circle text-2xl"},null,-1),u("p",{class:"mt-2"},"Erreur lors du chargement des entrées",-1)])])):y("",!0)])]),_:1}),n(ue,null,{default:s(()=>[t[25]||(t[25]=u("span",{class:"text-gray-500 my-1.5 text-xl"},"Dépenses",-1)),u("div",Ze,[u("div",et,[n(a(ee),{modelValue:E.value,"onUpdate:modelValue":t[1]||(t[1]=o=>E.value=o),placeholder:"Rechercher...",class:"w-64"},null,8,["modelValue"]),n(r,{to:"/comptabilite/saisie-operations/nouvelle-sortie"},{default:s(()=>[n(a(T),{size:"md"},{default:s(()=>[...t[14]||(t[14]=[u("span",{class:"iconify hugeicons--add-01 mr-2"},null,-1),l(" Nouvelle Sortie ",-1)])]),_:1})]),_:1})])]),u("div",tt,[!a(F)&&!a(V)?(i(),g(a(te),{key:0},{default:s(()=>[n(a(ae),null,{default:s(()=>[n(a(b),null,{default:s(()=>[n(a(f),null,{default:s(()=>[...t[15]||(t[15]=[l("Libellé",-1)])]),_:1}),n(a(f),null,{default:s(()=>[...t[16]||(t[16]=[l("Compte",-1)])]),_:1}),n(a(f),null,{default:s(()=>[...t[17]||(t[17]=[l("Montant",-1)])]),_:1}),n(a(f),null,{default:s(()=>[...t[18]||(t[18]=[l("Date",-1)])]),_:1}),n(a(f),{class:"text-right"},{default:s(()=>[...t[19]||(t[19]=[l("Actions",-1)])]),_:1})]),_:1})]),_:1}),n(a(se),null,{default:s(()=>[H.value.length===0?(i(),g(a(b),{key:0},{default:s(()=>[n(a(d),{colspan:"5",class:"text-center text-gray-500"},{default:s(()=>[l(p(E.value?"Aucune sortie trouvée":"Aucune sortie enregistrée"),1)]),_:1})]),_:1})):y("",!0),(i(!0),x(Z,null,Y(H.value,o=>(i(),g(a(b),{key:o.id},{default:s(()=>[n(a(d),null,{default:s(()=>[l(p(o.name),1)]),_:2},1024),n(a(d),null,{default:s(()=>[l(p(W(o.account_plan_id)),1)]),_:2},1024),n(a(d),null,{default:s(()=>[l(p(K(o.amount)),1)]),_:2},1024),n(a(d),null,{default:s(()=>[l(p(J(o.created_at)),1)]),_:2},1024),n(a(d),{class:"text-right"},{default:s(()=>[n(a(ne),null,{default:s(()=>[n(a(re),{"as-child":""},{default:s(()=>[n(a(T),{variant:"ghost",size:"sm"},{default:s(()=>[...t[20]||(t[20]=[u("span",{class:"iconify hugeicons--more-vertical text-lg"},null,-1)])]),_:1})]),_:1}),n(a(le),{align:"end"},{default:s(()=>[n(a(S),{onClick:$=>Ve(o)},{default:s(()=>[...t[21]||(t[21]=[u("span",{class:"iconify hugeicons--pencil-edit-01 mr-2"},null,-1),l(" Modifier ",-1)])]),_:1},8,["onClick"]),n(a(S),{onClick:$=>Fe(o.id),class:"text-red-600"},{default:s(()=>[...t[22]||(t[22]=[u("span",{class:"iconify hugeicons--delete-02 mr-2"},null,-1),l(" Supprimer ",-1)])]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})):y("",!0),a(F)?(i(),x("div",at,[...t[23]||(t[23]=[u("span",{class:"iconify hugeicons--loading-03 animate-spin text-2xl"},null,-1),u("p",{class:"text-gray-500 mt-2"},"Chargement des sorties...",-1)])])):y("",!0),a(V)?(i(),x("div",st,[...t[24]||(t[24]=[u("span",{class:"iconify hugeicons--alert-circle text-2xl"},null,-1),u("p",{class:"mt-2"},"Erreur lors du chargement des sorties",-1)])])):y("",!0)])]),_:1})])]),_:1})}}});export{At as default};
