import{_ as we}from"./LayoutGestionDisciplinaire.vue_vue_type_script_setup_true_lang-skQCPo4l.js";import{d as Ae,A as p,r as Y,v as Se,n as Ce,p as d,q as $e,x as h,w as o,b as l,f as t,i as a,k as v,$ as Ie,y as r,c as B,h as Ne,F as Ee,G as De,t as f,a as Le,o as _,s as q}from"./index-CJ_PivE-.js";import{a as ke}from"./AlertMessage.vue_vue_type_script_setup_true_lang-DthA28zY.js";import{_ as Ve}from"./Input.vue_vue_type_script_setup_true_lang-B9adgRZV.js";import{a as Te,b as Be,_ as Pe}from"./PopoverTrigger.vue_vue_type_script_setup_true_lang-DzZWQSaq.js";import{_ as Re}from"./FilterBadges.vue_vue_type_script_setup_true_lang-CBuiPNtr.js";import{_ as ze}from"./ListClassRoom.vue_vue_type_script_setup_true_lang-crHdkUu0.js";import{_ as Fe}from"./ListSchoolYear.vue_vue_type_script_setup_true_lang-FGtf-Ajw.js";import{_ as Ge}from"./DateFilter.vue_vue_type_script_setup_true_lang-BLMQrden.js";import{a as Me,b as x,c as m,d as Oe,e as c,_ as je}from"./TableHeader.vue_vue_type_script_setup_true_lang-cS4zBTGx.js";import{_ as H}from"./Checkbox.vue_vue_type_script_setup_true_lang-DTckireD.js";import{u as g}from"./useGetApi-EdzHoZm6.js";import{u as Ue}from"./useDeleteApi-D2AjqV8w.js";import{e as J}from"./eventBus-CGRXT3Tn.js";import"./LayoutSaisieOperation.vue_vue_type_script_setup_true_lang-bYPLg6Nt.js";import"./DashLayoutWithMode.vue_vue_type_script_setup_true_lang-DzpyZ4TL.js";import"./RightDashHeader.vue_vue_type_script_setup_true_lang-Bn3G870_.js";import"./DashPageHeader.vue_vue_type_script_setup_true_lang-DucYyTAx.js";import"./BoxPanelWrapper.vue_vue_type_script_setup_true_lang-CmJ-Iy6y.js";import"./DialogTrigger.vue_vue_type_script_setup_true_lang-Bm461x8Q.js";import"./index-BpkKmY4O.js";import"./SelectGroup.vue_vue_type_script_setup_true_lang-CwIOzTi6.js";import"./RovingFocusGroup-BxePylpC.js";const Ye={class:"flex flex-col md:flex-row gap-3 md:items-center md:justify-between"},qe={class:"flex flex-1 items-center gap-2"},He={class:"relative w-full max-w-xs"},Je={class:"grid gap-4"},Ke={class:"flex flex-col gap-3.5"},Qe={class:"flex flex-wrap items-center gap-2.5"},We={class:"mt-4 rounded-md overflow-hidden flex flex-1 bg-white"},Xe={class:"group flex items-center justify-between"},Ze={class:"hidden group-hover:flex items-center gap-2 ml-2"},es={key:0},ss={key:1},$s=Ae({__name:"CasIndisciplines",setup(as){const K=Le(),{data:y,fetchData:b,loading:Q,error:P}=g(p.GET_INDISCIPLINE_CASES),{deleteItem:W,errorDelete:R}=Ue(),w=Y(1),A=Y(10),{data:S,fetchData:X}=g(p.GET_STUDENTS),{data:C,fetchData:Z}=g(p.GET_CLASSROOMS),{data:$,fetchData:ee}=g(p.GET_FILLIERES),{data:I,fetchData:se}=g(p.GET_SCHOOL_YEARS),{data:N,fetchData:ae}=g(p.GET_DISCIPLINARY_ACTIONS);Se(async()=>{await Promise.all([X(),Z(),ee(),se(),ae(),b({page:w.value,limit:A.value})])});const n=Ce({classroom_id:void 0,school_year_id:void 0,date:void 0}),te=d(()=>({classroom_id:z.value||[],school_year_id:F.value||[],date:[]})),ie={classroom_id:(e,s)=>{const u=s==null?void 0:s.find(i=>i.id===e);return u?u.name:e},school_year_id:(e,s)=>{const u=s==null?void 0:s.find(i=>i.id===e);return u?u.name:e},date:e=>e},oe=e=>{e==="classroom_id"&&(n.classroom_id=void 0),e==="school_year_id"&&(n.school_year_id=void 0),e==="date"&&(n.date=void 0)};$e([()=>n.classroom_id,()=>n.school_year_id,()=>n.date],()=>{const e={page:1,limit:A.value};n.classroom_id&&(e.classroom_id=n.classroom_id),n.school_year_id&&(e.school_year_id=n.school_year_id),n.date&&(e.date=n.date),w.value=1,b(e)}),J.on("indisciplineCaseUpdated",()=>{const e={page:w.value,limit:A.value};n.classroom_id&&(e.classroom_id=n.classroom_id),n.school_year_id&&(e.school_year_id=n.school_year_id),n.date&&(e.date=n.date),b(e)});const le=d(()=>{var s;const e=S==null?void 0:S.value;return Array.isArray(e)?e:((s=e==null?void 0:e.students)==null?void 0:s.data)??(e==null?void 0:e.data)??[]}),ne=d(()=>new Map((le.value??[]).map(e=>[Number(e.id),e]))),z=d(()=>{var s;const e=C==null?void 0:C.value;return Array.isArray(e)?e:((s=e==null?void 0:e.classrooms)==null?void 0:s.data)??(e==null?void 0:e.data)??[]}),re=d(()=>new Map((z.value??[]).map(e=>[Number(e.id),e]))),de=d(()=>{var s;const e=$==null?void 0:$.value;return Array.isArray(e)?e:((s=e==null?void 0:e.filiaires)==null?void 0:s.data)??(e==null?void 0:e.data)??[]}),ce=d(()=>new Map((de.value??[]).map(e=>[Number(e.id),e]))),F=d(()=>{const e=I==null?void 0:I.value;return Array.isArray(e)?e:(e==null?void 0:e.years)??[]}),ue=d(()=>new Map((F.value??[]).map(e=>[Number(e.id),e]))),me=d(()=>{var s;const e=N==null?void 0:N.value;return Array.isArray(e)?e:((s=e==null?void 0:e.actions)==null?void 0:s.data)??(e==null?void 0:e.data)??[]}),fe=d(()=>new Map((me.value??[]).map(e=>[Number(e.id),e]))),pe=d(()=>{var u;const e=y==null?void 0:y.value;return(Array.isArray(e)?e:Array.isArray(e==null?void 0:e.data)?e.data:Array.isArray((u=e==null?void 0:e.data)==null?void 0:u.data)?e.data.data:[]).map(i=>{var G,M,O,j,U;const E=Number(i.id),D=ne.value.get(Number(i.student_id)),L=re.value.get(Number(i.classroom_id)),k=ce.value.get(Number(i.filiere_id)),V=ue.value.get(Number(i.school_year_id)),T=fe.value.get(Number(i.action_id)),ye=((G=i.student)==null?void 0:G.name)||(D?`${D.name??""} ${D.firstname??""}`.trim():String(i.student_id??"")),ve=((M=i.classroom)==null?void 0:M.name)||(L==null?void 0:L.name)||String(i.classroom_id??""),he=((O=i.filiere)==null?void 0:O.name)||(k==null?void 0:k.name)||String(i.filiere_id??""),xe=((j=i.school_year)==null?void 0:j.name)||(V==null?void 0:V.name)||String(i.school_year_id??""),be=((U=i.action)==null?void 0:U.name)||(T==null?void 0:T.name)||String(i.action_id??"");return{id:E,date:i.date,apprenant:ye,fault_count:i.fault_count,actionPunition:be,classe:ve,filiere:he,anneeScolaire:xe}})}),_e=e=>{K.push(`/apprenants/operations/gestion-disciplinaire/cas?edit=true&id=${e}`)},ge=async e=>{const s=p.DELETE_INDISCIPLINE_CASE.replace(":indisciplineCase",String(e));await W(s),R.value?q({message:R.value,type:"error"}):(q({message:"Cas d'indiscipline supprimé avec succès.",type:"success"}),J.emit("indisciplineCaseUpdated"))};return(e,s)=>{const u=Ie("RouterLink");return _(),h(we,{"active-tag-name":"indiscipline",breadcrumb:[{label:"Élèves",href:"/apprenants"},{label:"Opérations",href:"/apprenants/operations"},{label:"Gestion Disciplinaire",href:"/apprenants/operations/gestion-disciplinaire"},{label:"Cas d'Indiscipline",href:"/apprenants/operations/gestion-disciplinaire/cas-indisciplines"}]},{default:o(()=>[l("div",Ye,[l("div",qe,[l("div",He,[t(a(Ve),{type:"text",id:"search",name:"search",placeholder:"Rechercher...",class:"w-full ps-10 border border-gray-200/40 bg-white transition-all h-9 rounded-md"}),s[3]||(s[3]=l("div",{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-foreground-muted/70"},[l("span",{class:"flex iconify hugeicons--search-01 text-sm"})],-1))]),t(a(Pe),null,{default:o(()=>[t(a(Te),{"as-child":""},{default:o(()=>[t(a(v),{variant:"ghost",size:"sm",class:"h-9 rounded-md border bg-white"},{default:o(()=>[...s[4]||(s[4]=[l("span",{class:"hidden sm:flex"},"Filtre",-1),l("span",{class:"iconify hugeicons--filter"},null,-1)])]),_:1})]),_:1}),t(a(Be),{class:"w-80"},{default:o(()=>[l("div",Je,[s[5]||(s[5]=l("div",{class:"space-y-2"},[l("h4",{class:"font-medium leading-none"},"Filtrage")],-1)),l("div",Ke,[t(ze,{modelValue:n.classroom_id,"onUpdate:modelValue":s[0]||(s[0]=i=>n.classroom_id=i)},null,8,["modelValue"]),t(Fe,{modelValue:n.school_year_id,"onUpdate:modelValue":s[1]||(s[1]=i=>n.school_year_id=i)},null,8,["modelValue"]),t(Ge,{modelValue:n.date,"onUpdate:modelValue":s[2]||(s[2]=i=>n.date=i),label:"Date"},null,8,["modelValue"])])])]),_:1})]),_:1}),t(Re,{filters:n,"reference-data":te.value,"custom-labels":ie,onRemoveFilter:oe},null,8,["filters","reference-data"])]),l("div",Qe,[t(a(v),{size:"md",class:"rounded-md","as-child":""},{default:o(()=>[t(u,{to:"/apprenants/operations/gestion-disciplinaire/cas"},{default:o(()=>[...s[6]||(s[6]=[l("span",{class:"flex iconify hugeicons--plus-sign"},null,-1),l("span",{class:"hidden sm:flex"},"Ajouter Cas",-1)])]),_:1})]),_:1})])]),l("div",We,[t(a(je),{class:"rounded-md bg-white"},{default:o(()=>[t(a(Me),null,{default:o(()=>[t(a(x),null,{default:o(()=>[t(a(m),{class:"w-[20px]"},{default:o(()=>[t(a(H),{class:"bg-white scale-70"})]),_:1}),t(a(m),null,{default:o(()=>[...s[7]||(s[7]=[r("Date",-1)])]),_:1}),t(a(m),null,{default:o(()=>[...s[8]||(s[8]=[r("Élève",-1)])]),_:1}),t(a(m),null,{default:o(()=>[...s[9]||(s[9]=[r("Faute commise",-1)])]),_:1}),t(a(m),null,{default:o(()=>[...s[10]||(s[10]=[r("Action/Punition",-1)])]),_:1}),t(a(m),null,{default:o(()=>[...s[11]||(s[11]=[r("Classe",-1)])]),_:1}),t(a(m),null,{default:o(()=>[...s[12]||(s[12]=[r("Section",-1)])]),_:1}),t(a(m),null,{default:o(()=>[...s[13]||(s[13]=[r("Année scolaire",-1)])]),_:1}),t(a(m))]),_:1})]),_:1}),t(a(Oe),null,{default:o(()=>[(_(!0),B(De,null,Ee(pe.value,i=>(_(),h(a(x),{key:i.id},{default:o(()=>[t(a(c),{class:"w-[40px]"},{default:o(()=>[t(a(H),{class:"bg-white scale-70"})]),_:1}),t(a(c),null,{default:o(()=>[r(f(i.date),1)]),_:2},1024),t(a(c),null,{default:o(()=>[r(f(i.apprenant),1)]),_:2},1024),t(a(c),null,{default:o(()=>[r(f(i.fault_count),1)]),_:2},1024),t(a(c),null,{default:o(()=>[r(f(i.actionPunition),1)]),_:2},1024),t(a(c),null,{default:o(()=>[r(f(i.classe),1)]),_:2},1024),t(a(c),null,{default:o(()=>[r(f(i.filiere),1)]),_:2},1024),t(a(c),null,{default:o(()=>[r(f(i.anneeScolaire),1)]),_:2},1024),t(a(c),null,{default:o(()=>[l("div",Xe,[s[17]||(s[17]=l("div",{class:"flex-1"},null,-1)),s[18]||(s[18]=l("button",{class:"ml-2 group-hover:hidden rounded-full size-8 flex items-center justify-center hover:bg-gray-100 transition"},[l("span",{class:"iconify hugeicons--more-vertical-circle-01"})],-1)),l("div",Ze,[t(a(v),{variant:"ghost",size:"icon",class:"size-8 justify-center text-gray-500 hover:text-blue-600 hover:bg-blue-50",onClick:E=>_e(i.id)},{default:o(()=>[...s[14]||(s[14]=[l("span",{class:"iconify hugeicons--edit-02"},null,-1)])]),_:1},8,["onClick"]),t(ke,{action:"danger",title:"Supprimer un cas d'indiscipline",message:`Vous êtes sur le point de supprimer le cas d'indiscipline de '${i.apprenant}'. Êtes-vous sûr de continuer?`},{trigger:o(()=>[t(a(v),{variant:"ghost",size:"icon",class:"size-8 justify-center text-gray-500 hover:text-red-600 hover:bg-red-50"},{default:o(()=>[...s[15]||(s[15]=[l("span",{class:"iconify hugeicons--delete-02"},null,-1)])]),_:1})]),"confirm-action-button":o(()=>[t(a(v),{variant:"destructive",onClick:E=>ge(i.id),size:"sm",class:"h-10 px-4"},{default:o(()=>[...s[16]||(s[16]=[r(" Oui, Supprimer ",-1)])]),_:1},8,["onClick"])]),_:2},1032,["message"])])])]),_:2},1024)]),_:2},1024))),128)),a(Q)?(_(),h(a(x),{key:0},{default:o(()=>[t(a(c),{colspan:9,class:"text-center py-10"},{default:o(()=>[...s[19]||(s[19]=[l("div",{class:"flex flex-col items-center justify-center text-gray-500"},[l("svg",{class:"animate-spin h-6 w-6 text-gray-400 mb-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[l("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),l("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8z"})]),l("span",null,"Chargement des cas d'indiscipline...")],-1)])]),_:1})]),_:1})):!a(y)||a(y).length===0?(_(),h(a(x),{key:1},{default:o(()=>[t(a(c),{colspan:9,class:"text-center py-8 text-gray-500"},{default:o(()=>[a(P)?(_(),B("div",es,"Erreur: "+f(a(P)),1)):(_(),B("div",ss,"Aucun cas d'indiscipline trouvé"))]),_:1})]),_:1})):Ne("",!0)]),_:1})]),_:1})])]),_:1})}}});export{$s as default};
