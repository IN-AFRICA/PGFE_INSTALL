var ne=Object.defineProperty;var de=(i,o,u)=>o in i?ne(i,o,{enumerable:!0,configurable:!0,writable:!0,value:u}):i[o]=u;var le=(i,o,u)=>de(i,typeof o!="symbol"?o+"":o,u);import{m as ce,r as M,n as ue,p as m,q as se,v as _e,d as fe,x as $,w as d,f as t,b as r,c as y,h as R,i as e,t as C,k as V,y as g,z as j,B as P,C as U,D as H,E as q,F as J,G as K,H as oe,I as me,A as Q,o as f,J as W}from"./index-CJ_PivE-.js";import{_ as X}from"./CardDashStat.vue_vue_type_script_setup_true_lang-B8zO29KP.js";import{_ as ve}from"./DashLayoutWithMode.vue_vue_type_script_setup_true_lang-DzpyZ4TL.js";import{_ as he}from"./BarChart.vue_vue_type_script_setup_true_lang-D20XYPzz.js";import{_ as pe,a as ye,b as ge}from"./PopoverTrigger.vue_vue_type_script_setup_true_lang-DzZWQSaq.js";import{_ as Z}from"./SelectGroup.vue_vue_type_script_setup_true_lang-CwIOzTi6.js";import{_ as be}from"./FilterBadges.vue_vue_type_script_setup_true_lang-CBuiPNtr.js";import{u as ee}from"./useGetApi-EdzHoZm6.js";import"./RightDashHeader.vue_vue_type_script_setup_true_lang-Bn3G870_.js";import"./index-BpkKmY4O.js";import"./Card.vue_vue_type_script_setup_true_lang-D6d8RJcP.js";class ie{static async getStats(o){const u={};return o!=null&&o.school_year_id&&(u.school_year_id=o.school_year_id),o!=null&&o.classroom_id&&(u.classroom_id=o.classroom_id),o!=null&&o.filiaire_id&&(u.filiaire_id=o.filiaire_id,u.filiere_id=o.filiaire_id),(await ce.get(this.ENDPOINT,{params:u})).data}}le(ie,"ENDPOINT","/dashboard");function xe(){const i=M(null),o=M(!1),u=M(null),_=ue({school_year_id:void 0,classroom_id:void 0,filiaire_id:void 0}),F=m(()=>i.value?i.value.total:0),T=m(()=>i.value?i.value.girls:0),A=m(()=>i.value?i.value.boys:0),D=m(()=>{var c;return((c=i.value)==null?void 0:c.filtered)||{gender:"",count:"0"}}),a=m(()=>{var c;return((c=i.value)==null?void 0:c.school_year_name)||""}),z=m(()=>{var c;return((c=i.value)==null?void 0:c.school_year_total)||0}),N=m(()=>{var c,v;return(c=i.value)!=null&&c.by_school_year?(Object.values((v=i.value)==null?void 0:v.by_school_year).reduce((S,w)=>S+parseInt(w),0),Object.entries(i.value.by_school_year).map(([S,w])=>{var E;const k=parseInt(w),h=((E=i.value)==null?void 0:E.total)||0,O=h>0?Math.round(i.value.boys/h*100):0,Y=h>0?Math.round(i.value.girls/h*100):0,G=Math.round(k*i.value.girls/h)||0,L=Math.round(k*i.value.boys/h)||0;return{name:S,total:k,garcon:O,fille:Y,garconA:L,filleA:G}})):[]}),b=m(()=>i.value?{year:i.value.school_year_name,total:i.value.school_year_total,girls:i.value.girls,boys:i.value.boys}:null),x=async()=>{o.value=!0,u.value=null;try{const c={};_.school_year_id&&(c.school_year_id=_.school_year_id),_.classroom_id&&(c.classroom_id=_.classroom_id),_.filiaire_id&&(c.filiaire_id=_.filiaire_id);const v=await ie.getStats(c);v.success?i.value=v.data:u.value=v.message||"Erreur lors de la récupération des données"}catch(c){u.value=c.message||"Erreur de connexion",console.error("Erreur dashboard:",c)}finally{o.value=!1}},B=()=>x(),I=()=>{_.school_year_id=void 0,_.classroom_id=void 0,_.filiaire_id=void 0};return se(()=>[_.school_year_id,_.classroom_id,_.filiaire_id],()=>{x()}),_e(()=>{x()}),{data:i,loading:o,error:u,filters:_,totalStudents:F,totalGirls:T,totalBoys:A,filteredData:D,currentSchoolYear:a,schoolYearTotal:z,chartData:N,currentYearData:b,fetchDashboardData:x,refresh:B,clearFilters:I}}const Se={class:"flex flex-col-reverse md:justify-between md:flex-row pt-6 md:pt-12"},we={class:"flex flex-col max-w-2xl"},Ae={key:0,class:"text-sm text-primary mt-1"},ke={key:0,class:"pt-4"},$e={class:"bg-red-50 border border-red-200 rounded-md p-4 flex items-center justify-between"},Ce={class:"flex items-center"},De={class:"text-red-700"},Ee={class:"pt-7 md:pt-12 pb-20 mx-auto w-full max-w-7xl"},Fe={class:"flex flex-wrap items-center gap-3 mb-6"},Te={class:"grid gap-4"},ze={class:"flex flex-col gap-3.5"},Ne={class:"flex flex-col space-y-1.5"},Be={class:"flex flex-col space-y-1.5"},Ie={class:"flex flex-col space-y-1.5"},Oe={class:"grid sm:grid-cols-2 lg:grid-cols-3 gap-6"},Ye={class:"mt-10"},Ge={key:0,class:"bg-white rounded-lg p-8 text-center"},Le={key:1},Me={key:2,class:"bg-white rounded-lg p-8 text-center"},Ze=fe({__name:"HomeModule1",setup(i){const{loading:o,error:u,totalStudents:_,totalGirls:F,totalBoys:T,chartData:A,currentSchoolYear:D,filters:a,refresh:z,clearFilters:N}=xe(),{data:b,fetchData:x}=ee(Q.GET_CLASSROOMS),{data:B,fetchData:I}=ee(Q.GET_FILLIERES),{data:c,fetchData:v}=ee(Q.GET_SCHOOL_YEARS);x(),I(),v();const S=m(()=>{const s=c.value;return Array.isArray(s)?s:(s==null?void 0:s.years)??(s==null?void 0:s.data)??[]}),w=m(()=>{const s=B.value;return Array.isArray(s)?s:(s==null?void 0:s.data)??[]}),k=m(()=>{const s=b.value,l=Array.isArray(s)?s:(s==null?void 0:s.data)??[];return a.filiaire_id?l.filter(n=>{const p=n.filiere_id||n.filiaire_id;return String(p)===String(a.filiaire_id)}):l});se(()=>a.school_year_id,()=>{a.filiaire_id=void 0,a.classroom_id=void 0}),se(()=>a.filiaire_id,()=>{a.classroom_id=void 0});const h=m(()=>({school_year_id:S.value||[],classroom_id:b.value||[],filiaire_id:w.value||[]})),O={school_year_id:(s,l)=>{const n=l==null?void 0:l.find(p=>p.id===s);return n?n.name:s},classroom_id:(s,l)=>{var ae;const n=Array.isArray(b.value)?b.value:((ae=b.value)==null?void 0:ae.data)??[],p=n==null?void 0:n.find(re=>re.id===s);return p?p.name:s},filiaire_id:(s,l)=>{const n=l==null?void 0:l.find(p=>p.id===s);return n?n.name:s}},Y=s=>{s==="school_year_id"&&(a.school_year_id=void 0,a.filiaire_id=void 0,a.classroom_id=void 0),s==="filiaire_id"&&(a.filiaire_id=void 0,a.classroom_id=void 0),s==="classroom_id"&&(a.classroom_id=void 0)},G=m(()=>a.school_year_id||a.classroom_id||a.filiaire_id),L=s=>{a.school_year_id=s?Number(s):void 0},E=s=>{a.filiaire_id=s?Number(s):void 0},te=s=>{a.classroom_id=s?Number(s):void 0};return(s,l)=>(f(),$(ve,{"non-formel-link":"/apprenants","show-switcher":!1,"active-route":"/apprenants","module-name":"students"},{default:d(()=>[t(me,null,{default:d(()=>[r("div",Se,[r("div",we,[l[0]||(l[0]=r("h1",{class:"font-semibold text-xl text-foreground-title"},"Dashboard",-1)),l[1]||(l[1]=r("p",{class:"text-foreground-muted mt-0.5"}," Bonjour, Bienvenu à nouveau sur votre plateforme. ",-1)),e(D)?(f(),y("p",Ae," Année scolaire actuelle: "+C(e(D)),1)):R("",!0)])]),e(u)?(f(),y("div",ke,[r("div",$e,[r("div",Ce,[l[2]||(l[2]=r("span",{class:"iconify hugeicons--alert-circle text-red-500 mr-2"},null,-1)),r("span",De,C(e(u)),1)]),t(e(V),{onClick:e(z),class:"text-red-600 hover:text-red-800 underline"},{default:d(()=>[...l[3]||(l[3]=[g(" Réessayer ",-1)])]),_:1},8,["onClick"])])])):R("",!0),r("div",Ee,[r("div",Fe,[t(e(pe),null,{default:d(()=>[t(e(ye),{"as-child":""},{default:d(()=>[t(e(V),{variant:"ghost",size:"sm",class:"h-10 rounded-md border bg-white"},{default:d(()=>[...l[4]||(l[4]=[r("span",{class:"hidden sm:flex"},"Filtres",-1),r("span",{class:"iconify hugeicons--filter"},null,-1)])]),_:1})]),_:1}),t(e(ge),{class:"w-80"},{default:d(()=>[r("div",Te,[l[9]||(l[9]=r("div",{class:"space-y-2"},[r("h4",{class:"font-medium leading-none"},"Filtrer les données"),r("p",{class:"text-sm text-muted-foreground"}," Sélectionnez les critères pour filtrer le dashboard ")],-1)),r("div",ze,[r("div",Ne,[t(e(j),{class:"text-sm font-medium"},{default:d(()=>[...l[5]||(l[5]=[g("Année scolaire",-1)])]),_:1}),t(e(P),{"model-value":e(a).school_year_id?String(e(a).school_year_id):"","onUpdate:modelValue":L},{default:d(()=>[t(e(U),{class:"h-10 w-full"},{default:d(()=>[t(e(H),{placeholder:"Sélectionnez une année"})]),_:1}),t(e(q),null,{default:d(()=>[t(e(Z),null,{default:d(()=>[(f(!0),y(K,null,J(S.value,n=>(f(),$(e(W),{key:n.id,value:String(n.id)},{default:d(()=>[g(C(n.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1},8,["model-value"])]),r("div",Be,[t(e(j),{class:oe(["text-sm font-medium",{"text-gray-400":!e(a).school_year_id}])},{default:d(()=>[...l[6]||(l[6]=[g("Section",-1)])]),_:1},8,["class"]),t(e(P),{"model-value":e(a).filiaire_id?String(e(a).filiaire_id):"","onUpdate:modelValue":E,disabled:!e(a).school_year_id},{default:d(()=>[t(e(U),{class:"h-10 w-full",disabled:!e(a).school_year_id},{default:d(()=>[t(e(H),{placeholder:e(a).school_year_id?"Sélectionnez une section":"Sélectionnez d'abord une année"},null,8,["placeholder"])]),_:1},8,["disabled"]),t(e(q),null,{default:d(()=>[t(e(Z),null,{default:d(()=>[(f(!0),y(K,null,J(w.value,n=>(f(),$(e(W),{key:n.id,value:String(n.id)},{default:d(()=>[g(C(n.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1},8,["model-value","disabled"])]),r("div",Ie,[t(e(j),{class:oe(["text-sm font-medium",{"text-gray-400":!e(a).filiaire_id}])},{default:d(()=>[...l[7]||(l[7]=[g("Classe",-1)])]),_:1},8,["class"]),t(e(P),{"model-value":e(a).classroom_id?String(e(a).classroom_id):"","onUpdate:modelValue":te,disabled:!e(a).filiaire_id},{default:d(()=>[t(e(U),{class:"h-10 w-full",disabled:!e(a).filiaire_id},{default:d(()=>[t(e(H),{placeholder:e(a).filiaire_id?"Sélectionnez une classe":"Sélectionnez d'abord une section"},null,8,["placeholder"])]),_:1},8,["disabled"]),t(e(q),null,{default:d(()=>[t(e(Z),null,{default:d(()=>[(f(!0),y(K,null,J(k.value,n=>(f(),$(e(W),{key:n.id,value:String(n.id)},{default:d(()=>[g(C(n.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1},8,["model-value","disabled"])])]),G.value?(f(),$(e(V),{key:0,variant:"outline",size:"sm",onClick:e(N),class:"w-full"},{default:d(()=>[...l[8]||(l[8]=[r("span",{class:"iconify hugeicons--delete-02 mr-2"},null,-1),g(" Réinitialiser les filtres ",-1)])]),_:1},8,["onClick"])):R("",!0)])]),_:1})]),_:1}),t(be,{filters:e(a),"reference-data":h.value,"custom-labels":O,onRemoveFilter:Y},null,8,["filters","reference-data"])]),r("div",Oe,[t(X,{icon:"hugeicons--user",value:e(o)?0:e(_),title:"Total",description:"Total des apprenants",color:"#008080",loading:e(o)},null,8,["value","loading"]),t(X,{icon:"hugeicons--user",value:e(o)?0:e(T),title:"Garçons",description:"Total des garçons",color:"#008080",loading:e(o)},null,8,["value","loading"]),t(X,{icon:"hugeicons--user",value:e(o)?0:e(F),title:"Filles",description:"Total des filles",color:"#008080",loading:e(o)},null,8,["value","loading"])]),r("div",Ye,[e(o)?(f(),y("div",Ge,[...l[10]||(l[10]=[r("div",{class:"animate-pulse"},[r("div",{class:"h-64 bg-gray-200 rounded"})],-1),r("p",{class:"text-gray-500 mt-4"},"Chargement des données...",-1)])])):e(A)&&e(A).length>0?(f(),y("div",Le,[t(e(he),{data:e(A),index:"name",categories:["garcon","fille"],"rounded-corners":30,"y-formatter":n=>`${n} %`,class:"bg-white rounded-lg p-3 text-center items-center capitalize"},null,8,["data","y-formatter"])])):(f(),y("div",Me,[...l[11]||(l[11]=[r("div",{class:"text-gray-500"},[r("span",{class:"iconify hugeicons--chart-bar text-4xl mb-4 block"}),r("p",null,"Aucune donnée disponible pour le graphique")],-1)])]))])])]),_:1})]),_:1}))}});export{Ze as default};
