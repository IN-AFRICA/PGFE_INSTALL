import{d as Y,r as N,A as L,s as R,q as se,x as y,i as s,K as le,w as i,f as t,k as w,b as o,L as ae,M as te,N as O,y as c,O as ie,g as Z,c as u,h as j,z as K,j as H,t as A,P as oe,o as r,n as ne,p as x,F as re,G as de}from"./index-CJ_PivE-.js";import{_ as I}from"./Input.vue_vue_type_script_setup_true_lang-B9adgRZV.js";import{_ as ue,a as ce,b as G,c as T,d as me,e as F}from"./TableHeader.vue_vue_type_script_setup_true_lang-cS4zBTGx.js";import{_ as J}from"./Checkbox.vue_vue_type_script_setup_true_lang-DTckireD.js";import{_ as fe}from"./LayoutSaisieOperation.vue_vue_type_script_setup_true_lang-bYPLg6Nt.js";import{_ as pe}from"./BoxPanelWrapper.vue_vue_type_script_setup_true_lang-CmJ-Iy6y.js";import{_ as _e,a as ve}from"./AlertMessage.vue_vue_type_script_setup_true_lang-DthA28zY.js";import{_ as ge}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-Bm461x8Q.js";import{a as Q,o as be,s as W,u as xe,t as ye}from"./vee-validate-zod-Bra4yLtR.js";import{_ as he}from"./IconifySpinner.vue_vue_type_script_setup_true_lang-C3Td1B5O.js";import{e as E}from"./eventBus-CGRXT3Tn.js";import{u as $e}from"./usePostApi-Crg8MURP.js";import{u as we}from"./usePutApi-BrTvEW5v.js";import{_ as Ee}from"./TabPagination.vue_vue_type_script_setup_true_lang-Dsg8W898.js";import{u as X}from"./useGetApi-EdzHoZm6.js";import{u as Se}from"./useDeleteApi-D2AjqV8w.js";import{_ as ke}from"./FilterPopover.vue_vue_type_script_setup_true_lang-D3D_gZSL.js";import{_ as Ve}from"./FilterBadges.vue_vue_type_script_setup_true_lang-CBuiPNtr.js";import{_ as Ce}from"./ListAcademicalLevel.vue_vue_type_script_setup_true_lang-DMWuvuYJ.js";import"./index-BpkKmY4O.js";import"./RovingFocusGroup-BxePylpC.js";import"./DashLayoutWithMode.vue_vue_type_script_setup_true_lang-DzpyZ4TL.js";import"./RightDashHeader.vue_vue_type_script_setup_true_lang-Bn3G870_.js";import"./DashPageHeader.vue_vue_type_script_setup_true_lang-DucYyTAx.js";import"./PopoverTrigger.vue_vue_type_script_setup_true_lang-DzZWQSaq.js";import"./SelectGroup.vue_vue_type_script_setup_true_lang-CwIOzTi6.js";const Fe={class:"grid gap-4 py-4"},Ne={class:"flex flex-col space-y-1.5"},Le={key:0,class:"text-red-500 text-xs mt-1"},Ae={class:"flex flex-col space-y-1.5"},Ie={key:0,class:"text-red-500 text-xs mt-1"},Pe={key:0,class:"flex items-center gap-2"},Ue={key:0},ze={key:1},Te={key:1,class:"flex items-center gap-2"},Re={key:0},je={key:1},De=Y({__name:"NewFilliere",setup(ee){const{loading:m,response:_,postData:p,success:D}=$e(),{loading:v,response:P,putData:U,success:M}=we(),f=N(!1),g=N(!1),n=N(null);E.on("editFilliere",l=>{console.log("[NewFilliere] Edit event received:",l),g.value=!0,n.value=l,h.value=l.name||"",$.value=l.code?String(l.code):"",f.value=!0});const S=be({name:W({required_error:"Veuillez saisir le nom de la fillière"}).min(2).max(100),code:W({required_error:"Le code est requis"}).min(1,"Le code est requis").max(50)}),{handleSubmit:q,resetForm:k}=xe({validationSchema:ye(S)}),{value:h,errorMessage:z}=Q("name"),{value:$,errorMessage:V}=Q("code"),b=q(async l=>{var e,a;console.log("[NewFilliere] onSubmit called with values:",l);try{if(g.value&&n.value){console.log("[NewFilliere] Editing mode - calling putData");const d=L.UPDATE_FILLIERE.replace(":filiaire",String(n.value.id));await U(d,l),M.value&&(console.log("[NewFilliere] Put success - showing toast and closing modal"),R({message:((e=P.value)==null?void 0:e.message)||"Section modifiée avec succès",type:"success"}),k(),C(),f.value=!1,E.emit("filiereUpdated"))}else console.log("[NewFilliere] Creation mode - calling postData"),await p(L.CREATE_FILLIERE,l),D.value&&(console.log("[NewFilliere] Post success - showing toast and closing modal"),R({message:((a=_.value)==null?void 0:a.message)||"Section ajoutée avec succès",type:"success"}),k(),f.value=!1,E.emit("filiereUpdated"))}catch(d){console.error("[NewFilliere] Error in onSubmit:",d)}}),C=()=>{g.value=!1,n.value=null},B=()=>{k(),C(),f.value=!1};return se(f,l=>{l||C()}),(l,e)=>(r(),y(s(le),{open:f.value,"onUpdate:open":e[3]||(e[3]=a=>f.value=a)},{default:i(()=>[t(s(ge),{"as-child":""},{default:i(()=>[t(s(w),{size:"md",class:"rounded-md"},{default:i(()=>[...e[4]||(e[4]=[o("span",{class:"iconify hugeicons--plus-sign"},null,-1),o("span",{class:"hidden sm:flex"}," Nouvelle section ",-1)])]),_:1})]),_:1}),t(s(ae),{class:"sm:max-w-[400px]"},{default:i(()=>[t(s(te),null,{default:i(()=>[g.value?(r(),y(s(O),{key:1},{default:i(()=>[...e[6]||(e[6]=[c("Édition de la section",-1)])]),_:1})):(r(),y(s(O),{key:0},{default:i(()=>[...e[5]||(e[5]=[c("Nouvelle section",-1)])]),_:1})),t(s(ie),null,{default:i(()=>[...e[7]||(e[7]=[c(" Enregistrer une nouvelle section ",-1)])]),_:1})]),_:1}),o("form",{onSubmit:e[2]||(e[2]=Z((...a)=>s(b)&&s(b)(...a),["prevent"]))},[o("div",Fe,[o("div",Ne,[t(s(K),{for:"name",class:"text-sm font-medium"},{default:i(()=>[...e[8]||(e[8]=[c(" Nom de la section ",-1)])]),_:1}),t(s(I),{type:"text",id:"name",name:"name",modelValue:s(h),"onUpdate:modelValue":e[0]||(e[0]=a=>H(h)?h.value=a:null),placeholder:"Entrez le nom de la section",class:"w-full h-10 border border-gray-200/40 bg-white transition-all",disabled:s(m)||s(v)},null,8,["modelValue","disabled"]),s(z)?(r(),u("span",Le,A(s(z)),1)):j("",!0)]),o("div",Ae,[t(s(K),{for:"code",class:"text-sm font-medium"},{default:i(()=>[...e[9]||(e[9]=[c(" Code ",-1)])]),_:1}),t(s(I),{type:"text",id:"code",name:"code",modelValue:s($),"onUpdate:modelValue":e[1]||(e[1]=a=>H($)?$.value=a:null),placeholder:"Entrez le code de la section",class:"w-full h-10 border border-gray-200/40 bg-white transition-all",disabled:s(m)||s(v)},null,8,["modelValue","disabled"]),s(V)?(r(),u("span",Ie,A(s(V)),1)):j("",!0)])]),t(s(oe),{class:"flex justify-end gap-2 items-center"},{default:i(()=>[t(s(_e),{"as-child":""},{default:i(()=>[t(s(w),{size:"sm",class:"h-9",variant:"outline",type:"button",onClick:B,disabled:s(m)||s(v)},{default:i(()=>[...e[10]||(e[10]=[o("span",{class:"iconify flex hugeicons--cancel-01 mr-1"},null,-1),c(" Annuler ",-1)])]),_:1},8,["disabled"])]),_:1}),t(s(w),{size:"sm",class:"h-9",type:"submit",disabled:s(m)||s(v)},{default:i(()=>[!s(m)&&!s(v)?(r(),u("span",Pe,[e[11]||(e[11]=o("span",{class:"iconify hugeicons--floppy-disk mr-1"},null,-1)),g.value?(r(),u("span",ze,"Modifier")):(r(),u("span",Ue,"Enregistrer"))])):(r(),u("span",Te,[t(he,{size:"lg"}),g.value?(r(),u("span",je,"Modification en cours...")):(r(),u("span",Re,"Enregistrement en cours..."))]))]),_:1},8,["disabled"])]),_:1})],32)]),_:1})]),_:1},8,["open"]))}}),Me={class:"flex items-center gap-3 justify-between"},qe={class:"flex flex-1 items-center gap-2"},Be={class:"relative w-full max-w-xs"},Ge={class:"flex flex-col gap-3.5"},Oe={class:"flex flex-col space-y-1.5 flex-1"},Ke={class:"flex flex-col space-y-1.5 flex-1"},He={class:"flex flex-wrap items-center gap-2.5"},Je={class:"mt-4 rounded-md overflow-hidden flex flex-1 bg-white"},Qe={class:"group flex items-center justify-between"},We={class:"hidden group-hover:flex items-center gap-2 ml-2"},Xe={key:0},Ye={key:1},Ze={key:2},ks=Y({__name:"MainSaisiPrealable",setup(ee){const m=N(1),_=N(15),{data:p,loading:D,error:v,fetchData:P}=X(L.GET_FILLIERES),{errorDelete:U,deleteItem:M}=Se(),{data:f,fetchData:g}=X(L.GET_ACADEMIC_LEVELS);P({page:m.value,limit:_.value}),g();const n=ne({label:"",academic_level_id:void 0,code:""}),S=x(()=>{const l=f==null?void 0:f.value;return Array.isArray(l)?l:(l==null?void 0:l.data)??[]});x(()=>S.value.reduce((l,e)=>{const a=String((e==null?void 0:e.id)??""),d=String((e==null?void 0:e.name)??(e==null?void 0:e.label)??"");return a&&(l[a]=d),l},{}));const q=x(()=>({academic_level_id:S.value||[]})),k={label:l=>`Section: ${l}`,code:l=>`Code: ${l}`,academic_level_id:(l,e)=>{const a=e==null?void 0:e.find(d=>String(d.id)===String(l));return`Niveau: ${a?a.name||a.label:l}`}},h=l=>{l==="label"&&(n.label=""),l==="code"&&(n.code=""),l==="academic_level_id"&&(n.academic_level_id=void 0)};E.on("filiereUpdated",()=>{P({page:m.value,limit:_.value})});const z=l=>{const e=p.value.find(a=>a.id===l);e&&E.emit("editFilliere",e)},$=async l=>{const e=L.DELETE_FILLIERE.replace(":filiaire",String(l));await M(e),E.emit("filiereUpdated"),U.value?R({message:U.value,type:"error"}):R({message:"Section supprimée avec succès.",type:"success"})},V=x(()=>{var l;return p.value?Array.isArray(p.value)?p.value:(l=p.value)!=null&&l.data&&Array.isArray(p.value.data)?p.value.data:[]:[]}),b=x(()=>{let l=[...V.value];if(n.label&&n.label.trim()!==""){const e=n.label.toLowerCase().trim();l=l.filter(a=>{var d;return(d=a.name)==null?void 0:d.toLowerCase().includes(e)})}if(n.code&&n.code.trim()!==""){const e=n.code.toLowerCase().trim();l=l.filter(a=>{var d;return(d=a.code)==null?void 0:d.toLowerCase().includes(e)})}return n.academic_level_id&&(l=l.filter(e=>String(e.academic_level_id)===String(n.academic_level_id))),l.sort((e,a)=>Number(a.id)-Number(e.id)),l}),C=x(()=>{const l=(m.value-1)*_.value,e=l+_.value;return b.value.slice(l,e)}),B=x(()=>b.value.length);return(l,e)=>(r(),y(fe,{"active-tag-name":"sections",group:"saisie",breadcrumb:[{label:"Élèves",href:"/apprenants"},{label:"Saisie Préalable",href:"/apprenants/saisie-prealable"},{label:"Sections",href:"/apprenants/saisie-prealable"}]},{default:i(()=>[t(pe,null,{default:i(()=>[o("div",Me,[o("div",qe,[o("div",Be,[t(s(I),{modelValue:n.label,"onUpdate:modelValue":e[0]||(e[0]=a=>n.label=a),type:"text",id:"search",name:"search",placeholder:"Rechercher une section...",class:"w-full ps-10 border border-gray-200/40 bg-white transition-all h-10 rounded-md"},null,8,["modelValue"]),e[6]||(e[6]=o("div",{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-foreground-muted/70"},[o("span",{class:"flex iconify hugeicons--search-01 text-sm"})],-1))]),t(ke,null,{default:i(()=>[o("div",Ge,[o("div",Oe,[e[7]||(e[7]=o("label",{for:"filter_label",class:"text-sm font-medium"},"Nom de la section",-1)),t(s(I),{id:"filter_label",type:"text",modelValue:n.label,"onUpdate:modelValue":e[1]||(e[1]=a=>n.label=a),placeholder:"Rechercher par nom...",class:"h-10"},null,8,["modelValue"])]),t(Ce,{"model-value":n.academic_level_id?String(n.academic_level_id):"",items:S.value,"onUpdate:modelValue":e[2]||(e[2]=a=>n.academic_level_id=a?Number(a):void 0)},null,8,["model-value","items"]),o("div",Ke,[e[8]||(e[8]=o("label",{for:"filter_code",class:"text-sm font-medium"},"Code",-1)),t(s(I),{id:"filter_code",type:"text",modelValue:n.code,"onUpdate:modelValue":e[3]||(e[3]=a=>n.code=a),placeholder:"Rechercher par code...",class:"h-10"},null,8,["modelValue"])])])]),_:1}),t(Ve,{filters:n,"reference-data":q.value,"custom-labels":k,onRemoveFilter:h},null,8,["filters","reference-data"])]),o("div",He,[t(De)])]),o("div",Je,[t(s(ue),{class:"rounded-md bg-white"},{default:i(()=>[t(s(ce),{class:"bg-primary text-white text-xs uppercase"},{default:i(()=>[t(s(G),null,{default:i(()=>[t(s(T),{class:"w-14"},{default:i(()=>[t(s(J),{checked:!1,class:"bg-white scale-70"})]),_:1}),t(s(T),null,{default:i(()=>[...e[9]||(e[9]=[c("Nom de la section",-1)])]),_:1}),t(s(T),null,{default:i(()=>[...e[10]||(e[10]=[c("Code",-1)])]),_:1}),t(s(T),null,{default:i(()=>[...e[11]||(e[11]=[c("Operations",-1)])]),_:1})]),_:1})]),_:1}),t(s(me),null,{default:i(()=>[(r(!0),u(de,null,re(C.value,a=>(r(),y(s(G),{key:a.id},{default:i(()=>[t(s(F),{class:"w-14"},{default:i(()=>[t(s(J),{checked:!1,class:"bg-white scale-70"})]),_:1}),t(s(F),null,{default:i(()=>[c(A(a.name),1)]),_:2},1024),t(s(F),null,{default:i(()=>[c(A(a.code||"—"),1)]),_:2},1024),t(s(F),{class:"px-4"},{default:i(()=>[o("div",Qe,[e[15]||(e[15]=o("div",{class:"flex-1"},null,-1)),e[16]||(e[16]=o("button",{class:"ml-2 group-hover:hidden rounded-full size-8 flex items-center justify-center hover:bg-gray-100 transition"},[o("span",{class:"iconify hugeicons--more-vertical-circle-01"})],-1)),o("div",We,[t(s(w),{variant:"ghost",size:"icon",class:"size-8 justify-center text-gray-500 hover:text-blue-600 hover:bg-blue-50",onClick:d=>z(a.id)},{default:i(()=>[...e[12]||(e[12]=[o("span",{class:"iconify hugeicons--edit-02"},null,-1)])]),_:1},8,["onClick"]),t(ve,{action:"danger",title:"Supprimer une section",message:`Vous êtes sur le point de supprimer la section '${a.name}'. Êtes-vous sûr de continuer?`},{trigger:i(()=>[t(s(w),{variant:"ghost",size:"icon",class:"size-8 justify-center text-gray-500 hover:text-red-600 hover:bg-red-50"},{default:i(()=>[...e[13]||(e[13]=[o("span",{class:"iconify hugeicons--delete-02"},null,-1)])]),_:1})]),"confirm-action-button":i(()=>[t(s(w),{variant:"destructive",size:"sm",class:"h-10 px-4",onClick:Z(d=>$(a.id),["stop"])},{default:i(()=>[...e[14]||(e[14]=[c(" Oui, Supprimer ",-1)])]),_:1},8,["onClick"])]),_:2},1032,["message"])])])]),_:2},1024)]),_:2},1024))),128)),!b.value||b.value.length===0?(r(),y(s(G),{key:0},{default:i(()=>[t(s(F),{colspan:4,class:"text-center py-8 text-gray-500"},{default:i(()=>[s(D)?(r(),u("div",Xe,"Chargement des sections...")):s(v)?(r(),u("div",Ye,"Erreur lors du chargement: "+A(s(v)),1)):(r(),u("div",Ze,"Aucune section trouvée"))]),_:1})]),_:1})):j("",!0)]),_:1})]),_:1})]),V.value.length?(r(),y(Ee,{key:0,modelValue:m.value,"onUpdate:modelValue":e[4]||(e[4]=a=>m.value=a),perPage:_.value,totalItems:B.value,"onUpdate:perPage":e[5]||(e[5]=a=>_.value=a)},null,8,["modelValue","perPage","totalItems"])):j("",!0)]),_:1})]),_:1}))}});export{ks as default};
