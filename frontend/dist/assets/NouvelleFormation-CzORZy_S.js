import{d as te,u as le,n as oe,q as re,A as y,p as v,v as se,x as S,w as r,b as p,f as t,i as o,z as i,y as n,B as U,C as k,D as C,E as I,c as h,F as P,G as R,k as M,t as D,g as ne,a as ie,o as m,J as j,s as _}from"./index-CJ_PivE-.js";import{_ as G}from"./FormSection.vue_vue_type_script_setup_true_lang-C-XSdIg3.js";import{I as d}from"./InputWrapper-tSRHzcjN.js";import{S as w}from"./SpanRequired-COKghTUX.js";import{_ as de}from"./DashFormLayout.vue_vue_type_script_setup_true_lang-3V-LyRCQ.js";import{_ as f}from"./Input.vue_vue_type_script_setup_true_lang-B9adgRZV.js";import{_ as Y}from"./SelectGroup.vue_vue_type_script_setup_true_lang-CwIOzTi6.js";import{_ as ue}from"./Textarea.vue_vue_type_script_setup_true_lang-Bg8QXdyw.js";import{u as me}from"./usePostApi-Crg8MURP.js";import{u as A}from"./useGetApi-EdzHoZm6.js";import"./BoxPanelWrapper.vue_vue_type_script_setup_true_lang-CmJ-Iy6y.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./DashLayout.vue_vue_type_script_setup_true_lang-Ch2egXHm.js";import"./RightDashHeader.vue_vue_type_script_setup_true_lang-Bn3G870_.js";import"./FormPageHeader.vue_vue_type_script_setup_true_lang-CAg7Z6LS.js";import"./index-BpkKmY4O.js";const fe={class:"flex items-center justify-end gap-2"},ce={key:0,class:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white mr-1.5"},pe={key:1,class:"flex iconify hugeicons--graduation-cap mr-1.5"},Oe=te({__name:"NouvelleFormation",setup(_e){const N=ie(),z=le(),l=oe({academic_personal_id:void 0,title:"",start_date:new Date().toISOString().split("T")[0],end_date:void 0,location:"",school_year_id:void 0,description:"",duration_days:void 0});re([()=>l.start_date,()=>l.end_date],([s,a])=>{if(s&&a){const e=new Date(s),c=new Date(a).getTime()-e.getTime(),O=Math.ceil(c/(1e3*60*60*24));O>=0?l.duration_days=O+1:l.duration_days=void 0}});const{data:x,fetchData:B,loading:L}=A(y.GET_PERSONALS),{data:g,fetchData:q}=A(y.GET_FONCTIONS),{data:H,fetchData:J,loading:W}=A(y.GET_SCHOOL_YEARS),K=s=>{var u;if(!s||!g.value)return"N/A";const e=(Array.isArray(g.value)?g.value:((u=g.value)==null?void 0:u.data)||[]).find(c=>c.id==s);return(e==null?void 0:e.name)||(e==null?void 0:e.title)||(e==null?void 0:e.libelle)||"N/A"},$=v(()=>{var a;return(Array.isArray(x.value)?x.value:((a=x.value)==null?void 0:a.data)||[]).map(e=>({id:e.id,name:`${e.name||e.nom||""} ${e.postnom||""} ${e.firstname||e.prenom||""}`.trim(),matricule:e.matricule,fonction:K(e.fonction_id)}))}),Q=v(()=>{const s=H.value;return(Array.isArray(s)?s:(s==null?void 0:s.years)??(s==null?void 0:s.data)??[]).map(e=>({id:e.id,label:e.name||e.year||e.libelle||`${e.start_year}-${e.end_year}`||"N/A"}))}),E=v(()=>l.academic_personal_id?$.value.find(s=>s.id===l.academic_personal_id):null),{loading:b,error:V,postData:X}=me(),F=v(()=>l.academic_personal_id!==void 0&&l.title.trim()!==""&&l.start_date!==""&&l.school_year_id!==void 0),T=s=>{if(!s)return null;const a=new Date(s),e=String(a.getDate()).padStart(2,"0"),u=String(a.getMonth()+1).padStart(2,"0"),c=a.getFullYear();return`${e}-${u}-${c}`};async function Z(){var e;if(!F.value){_({message:"Veuillez remplir tous les champs obligatoires correctement.",type:"error"});return}const s=(e=z.user)==null?void 0:e.id;if(!s){_({message:"Impossible d'identifier l'utilisateur connecté.",type:"error"});return}const a={academic_personal_id:Number(l.academic_personal_id),title:l.title.trim(),start_date:T(l.start_date),end_date:l.end_date?T(l.end_date):null,location:l.location.trim()||null,school_year_id:Number(l.school_year_id),description:l.description.trim()||null,duration_days:l.duration_days?Number(l.duration_days):null,author_id:Number(s)};try{if(await X(y.CREATE_FORMATION_CONTINUE,a),V.value){console.error("❌ Erreur API:",V.value),_({message:V.value,type:"error"});return}_({message:"Formation enregistrée avec succès !",type:"success"}),ee(),setTimeout(()=>{N.push("/rh/saisie/formation-continue")},1e3)}catch(u){console.error("Erreur lors de la soumission:",u),_({message:"Une erreur inattendue s'est produite.",type:"error"})}}function ee(){l.academic_personal_id=void 0,l.title="",l.start_date=new Date().toISOString().split("T")[0],l.end_date=void 0,l.location="",l.school_year_id=void 0,l.description="",l.duration_days=void 0}function ae(){N.push("/rh/saisie/formation-continue")}return se(async()=>{await Promise.all([B(),q(),J()])}),(s,a)=>(m(),S(de,{title:"Nouvelle Formation Continue","link-back":"/rh/saisie/formation-continue","group-route":"/rh/saisie/personnel",module:"rh",breadcrumb:[{label:"GRH",href:"/rh"},{label:"Formation",href:"/rh/saisie/formation-continue"},{label:"Nouvelle Formation",isActive:!0}]},{default:r(()=>[p("form",{onSubmit:ne(Z,["prevent"]),class:"w-full flex flex-col space-y-8"},[t(G,{class:"grid sm:grid-cols-2 lg:grid-cols-3 gap-y-6 gap-x-10",title:"Informations générales"},{default:r(()=>[t(d,null,{default:r(()=>[t(o(i),{class:"text-sm font-medium"},{default:r(()=>[a[8]||(a[8]=n(" Personnel ",-1)),t(w)]),_:1}),t(o(U),{modelValue:l.academic_personal_id,"onUpdate:modelValue":a[0]||(a[0]=e=>l.academic_personal_id=e),disabled:o(L)},{default:r(()=>[t(o(k),{class:"!h-10 bg-white w-full"},{default:r(()=>[t(o(C),{placeholder:"Sélectionnez le personnel"})]),_:1}),t(o(I),null,{default:r(()=>[t(o(Y),null,{default:r(()=>[(m(!0),h(R,null,P($.value,e=>(m(),S(o(j),{key:e.id,value:e.id},{default:r(()=>[n(D(e.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1}),t(d,null,{default:r(()=>{var e;return[t(o(i),{class:"text-sm font-medium"},{default:r(()=>[...a[9]||(a[9]=[n("Matricule",-1)])]),_:1}),t(o(f),{value:((e=E.value)==null?void 0:e.matricule)||"",class:"bg-gray-100 transition-all h-10 rounded-md",readonly:"",placeholder:"Sélectionner d'abord un personnel"},null,8,["value"])]}),_:1}),t(d,null,{default:r(()=>{var e;return[t(o(i),{class:"text-sm font-medium"},{default:r(()=>[...a[10]||(a[10]=[n("Fonction",-1)])]),_:1}),t(o(f),{value:((e=E.value)==null?void 0:e.fonction)||"",class:"bg-gray-100 transition-all h-10 rounded-md",readonly:"",placeholder:"Sélectionner d'abord un personnel"},null,8,["value"])]}),_:1}),t(d,null,{default:r(()=>[t(o(i),{class:"text-sm font-medium"},{default:r(()=>[a[11]||(a[11]=n(" Année scolaire ",-1)),t(w)]),_:1}),t(o(U),{modelValue:l.school_year_id,"onUpdate:modelValue":a[1]||(a[1]=e=>l.school_year_id=e),disabled:o(W)},{default:r(()=>[t(o(k),{class:"!h-10 bg-white w-full"},{default:r(()=>[t(o(C),{placeholder:"Sélectionner l'année scolaire"})]),_:1}),t(o(I),null,{default:r(()=>[t(o(Y),null,{default:r(()=>[(m(!0),h(R,null,P(Q.value,e=>(m(),S(o(j),{key:e.id,value:e.id},{default:r(()=>[n(D(e.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),a[19]||(a[19]=p("div",{class:"w-full flex h-px bg-gray-300"},null,-1)),t(G,{class:"grid sm:grid-cols-2 lg:grid-cols-3 gap-y-6 gap-x-10",title:"Détails de la formation"},{default:r(()=>[t(d,{class:"sm:col-span-2 lg:col-span-3"},{default:r(()=>[t(o(i),{class:"text-sm font-medium"},{default:r(()=>[a[12]||(a[12]=n(" Titre de la formation ",-1)),t(w)]),_:1}),t(o(f),{modelValue:l.title,"onUpdate:modelValue":a[2]||(a[2]=e=>l.title=e),placeholder:"Ex: Formation en pédagogie active",class:"w-full h-10 border border-gray-200/40 bg-white transition-all rounded-md"},null,8,["modelValue"])]),_:1}),t(d,null,{default:r(()=>[t(o(i),{class:"text-sm font-medium"},{default:r(()=>[a[13]||(a[13]=n(" Date de début ",-1)),t(w)]),_:1}),t(o(f),{type:"date",modelValue:l.start_date,"onUpdate:modelValue":a[3]||(a[3]=e=>l.start_date=e),class:"w-full h-10 border border-gray-200/40 bg-white transition-all rounded-md"},null,8,["modelValue"])]),_:1}),t(d,null,{default:r(()=>[t(o(i),{class:"text-sm font-medium"},{default:r(()=>[...a[14]||(a[14]=[n(" Date de fin ",-1)])]),_:1}),t(o(f),{type:"date",modelValue:l.end_date,"onUpdate:modelValue":a[4]||(a[4]=e=>l.end_date=e),class:"w-full h-10 border border-gray-200/40 bg-white transition-all rounded-md"},null,8,["modelValue"])]),_:1}),t(d,null,{default:r(()=>[t(o(i),{class:"text-sm font-medium"},{default:r(()=>[...a[15]||(a[15]=[n(" Durée (jours) ",-1)])]),_:1}),t(o(f),{type:"number",modelValue:l.duration_days,"onUpdate:modelValue":a[5]||(a[5]=e=>l.duration_days=e),modelModifiers:{number:!0},min:"1",placeholder:"Nombre de jours",class:"w-full h-10 border border-gray-200/40 bg-white transition-all rounded-md"},null,8,["modelValue"])]),_:1}),t(d,{class:"sm:col-span-2 lg:col-span-3"},{default:r(()=>[t(o(i),{class:"text-sm font-medium"},{default:r(()=>[...a[16]||(a[16]=[n(" Lieu / Endroit ",-1)])]),_:1}),t(o(f),{modelValue:l.location,"onUpdate:modelValue":a[6]||(a[6]=e=>l.location=e),placeholder:"Ex: Salle polyvalente, En ligne...",class:"w-full h-10 border border-gray-200/40 bg-white transition-all rounded-md"},null,8,["modelValue"])]),_:1}),t(d,{class:"sm:col-span-2 lg:col-span-3"},{default:r(()=>[t(o(i),{class:"text-sm font-medium"},{default:r(()=>[...a[17]||(a[17]=[n(" Description / Objectifs ",-1)])]),_:1}),t(o(ue),{modelValue:l.description,"onUpdate:modelValue":a[7]||(a[7]=e=>l.description=e),placeholder:"Décrivez les objectifs et le contenu de la formation...",class:"w-full min-h-[100px] border border-gray-200/40 bg-white transition-all resize-none rounded-md"},null,8,["modelValue"])]),_:1})]),_:1}),a[20]||(a[20]=p("div",{class:"w-full flex h-px bg-gray-300"},null,-1)),p("div",fe,[t(o(M),{type:"button",variant:"outline",onClick:ae,disabled:o(b)},{default:r(()=>[...a[18]||(a[18]=[p("span",{class:"flex iconify hugeicons--cancel-01 mr-1.5"},null,-1),n(" Annuler ",-1)])]),_:1},8,["disabled"]),t(o(M),{type:"submit",disabled:!F.value||o(b)},{default:r(()=>[o(b)?(m(),h("span",ce)):(m(),h("span",pe)),n(" "+D(o(b)?"Enregistrement...":"Enregistrer la formation"),1)]),_:1},8,["disabled"])])],32)]),_:1}))}});export{Oe as default};
