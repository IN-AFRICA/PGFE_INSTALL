import{d as $,A as q,s as i,a as B,x as I,w as o,b as p,f as t,i as s,z as x,y as m,c as g,h as y,t as c,k as w,g as L,o as f}from"./index-CJ_PivE-.js";import{_ as N}from"./DashFormLayout.vue_vue_type_script_setup_true_lang-3V-LyRCQ.js";import{_ as F}from"./FormSection.vue_vue_type_script_setup_true_lang-C-XSdIg3.js";import{I as v}from"./InputWrapper-tSRHzcjN.js";import{S as V}from"./SpanRequired-COKghTUX.js";import{_ as C}from"./CustomDatePicker.vue_vue_type_script_setup_true_lang-D0Zgowdp.js";import{u as O}from"./usePostApi-Crg8MURP.js";import{t as U}from"./utils-74-Kdsy2.js";import{o as j,s as S,u as P,aQ as h,t as z}from"./vee-validate-zod-Bra4yLtR.js";import{e as Q}from"./eventBus-CGRXT3Tn.js";import"./DashLayout.vue_vue_type_script_setup_true_lang-Ch2egXHm.js";import"./RightDashHeader.vue_vue_type_script_setup_true_lang-Bn3G870_.js";import"./Input.vue_vue_type_script_setup_true_lang-B9adgRZV.js";import"./index-BpkKmY4O.js";import"./FormPageHeader.vue_vue_type_script_setup_true_lang-CAg7Z6LS.js";import"./BoxPanelWrapper.vue_vue_type_script_setup_true_lang-CmJ-Iy6y.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./PopoverTrigger.vue_vue_type_script_setup_true_lang-DzZWQSaq.js";const W={key:0,class:"text-sm text-red-500"},X={key:0,class:"text-sm text-red-500"},G={key:0,class:"text-sm text-red-500"},H={class:"flex items-center justify-end gap-2"},fe=$({__name:"new_exercice_cloture",setup(J){const D=j({date:S().min(1,"La date de clôture est requise"),start_date:S().min(1,"La date de début est requise"),end_date:S().min(1,"La date de fin est requise")}).refine(l=>{const e=new Date(l.start_date),a=new Date(l.end_date);return e<=a},{message:"La date de début doit être antérieure ou égale à la date de fin",path:["end_date"]}),{handleSubmit:T,resetForm:R}=P({validationSchema:z(D),initialValues:{date:new Date().toISOString().split("T")[0],start_date:"",end_date:""}}),{response:d,error:_,loading:b,postData:A}=O(),k=B(),E=T(async l=>{try{const e={date:U(l.date),start_date:U(l.start_date),end_date:U(l.end_date)};if(await A(q.CREATE_CLOTURE_EXERCICE,e),_.value){i({message:typeof _.value=="string"?_.value:"Erreur lors de la création de la clôture d'exercice.",type:"error"});return}d.value?d.value.user_id?(i({message:d.value.message||"Clôture d'exercice créée avec succès",type:"success"}),R(),Q.emit("clotureExerciceUpdated"),k.push("/comptabilite/saisie-operations")):d.value.message?i({message:d.value.message,type:"error"}):i({message:"Réponse inattendue du serveur.",type:"error"}):i({message:"Aucune réponse du serveur.",type:"error"})}catch(e){console.error("Erreur lors de la soumission:",e),i({message:"Une erreur inattendue s'est produite.",type:"error"})}});return(l,e)=>(f(),I(N,{title:"Clôture d'exercice","link-back":"/comptabilite/saisie-operations","group-route":"/comptabilite/saisie-operations",module:"compta",breadcrumb:[{label:"Comptabilité",href:"/comptabilite"},{label:"saisie opérations",href:"/comptabilite/saisie-operations"},{label:"Clôture d'exercice",href:"/comptabilite/saisie-operations/cloture-exercice"}]},{default:o(()=>[p("form",{onSubmit:e[1]||(e[1]=L((...a)=>s(E)&&s(E)(...a),["prevent"])),class:"mt-10 space-y-8"},[t(F,{class:"grid sm:grid-cols-2 lg:grid-cols-3 gap-y-6 gap-x-10",title:"Clôture d'exercice comptable"},{default:o(()=>[t(v,null,{default:o(()=>[t(s(x),{class:"text-sm"},{default:o(()=>[e[2]||(e[2]=m(" Date de clôture ",-1)),t(V)]),_:1}),t(s(h),{name:"date"},{default:o(({field:a,errorMessage:r,meta:u})=>[t(C,{modelValue:a.value,"onUpdate:modelValue":[n=>a.value=n,a["onUpdate:modelValue"]]},null,8,["modelValue","onUpdate:modelValue"]),u.touched&&r?(f(),g("span",W,c(r),1)):y("",!0)]),_:1})]),_:1}),t(v,null,{default:o(()=>[t(s(x),{class:"text-sm"},{default:o(()=>[e[3]||(e[3]=m(" Date de début de l'exercice ",-1)),t(V)]),_:1}),t(s(h),{name:"start_date"},{default:o(({field:a,errorMessage:r,meta:u})=>[t(C,{modelValue:a.value,"onUpdate:modelValue":[n=>a.value=n,a["onUpdate:modelValue"]]},null,8,["modelValue","onUpdate:modelValue"]),u.touched&&r?(f(),g("span",X,c(r),1)):y("",!0)]),_:1})]),_:1}),t(v,null,{default:o(()=>[t(s(x),{class:"text-sm"},{default:o(()=>[e[4]||(e[4]=m(" Date de fin de l'exercice ",-1)),t(V)]),_:1}),t(s(h),{name:"end_date"},{default:o(({field:a,errorMessage:r,meta:u})=>[t(C,{modelValue:a.value,"onUpdate:modelValue":[n=>a.value=n,a["onUpdate:modelValue"]]},null,8,["modelValue","onUpdate:modelValue"]),u.touched&&r?(f(),g("span",G,c(r),1)):y("",!0)]),_:1})]),_:1})]),_:1}),p("div",H,[t(s(w),{variant:"outline",type:"button",disabled:s(b),onClick:e[0]||(e[0]=a=>s(k).push("/comptabilite/saisie-operations"))},{default:o(()=>[...e[5]||(e[5]=[p("span",{class:"flex iconify hugeicons--cancel-01 mr-1.5"},null,-1),m(" Annuler ",-1)])]),_:1},8,["disabled"]),t(s(w),{type:"submit",disabled:s(b)},{default:o(()=>[e[6]||(e[6]=p("span",{class:"flex iconify hugeicons--tick-02 mr-1.5"},null,-1)),m(" "+c(s(b)?"Clôture en cours...":"Clôturer l'exercice"),1)]),_:1},8,["disabled"])])],32)]),_:1}))}});export{fe as default};
