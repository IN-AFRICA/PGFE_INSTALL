import{d as de,u as ue,n as ne,A as c,p,v as me,x as h,w as o,b as f,f as l,i as s,z as d,y as i,B as S,C as q,D as A,E as w,c as v,F as E,G as N,t as b,k as I,g as _e,a as ce,o as n,J as $,s as C}from"./index-CJ_PivE-.js";import{_}from"./Input.vue_vue_type_script_setup_true_lang-B9adgRZV.js";import{_ as D}from"./SelectGroup.vue_vue_type_script_setup_true_lang-CwIOzTi6.js";import{_ as pe}from"./DashFormLayout.vue_vue_type_script_setup_true_lang-3V-LyRCQ.js";import{_ as B}from"./FormSection.vue_vue_type_script_setup_true_lang-C-XSdIg3.js";import{_ as fe}from"./Textarea.vue_vue_type_script_setup_true_lang-Bg8QXdyw.js";import{S as m}from"./SpanRequired-COKghTUX.js";import{I as u}from"./InputWrapper-tSRHzcjN.js";import{u as ve}from"./usePostApi-Crg8MURP.js";import{u as y}from"./useGetApi-EdzHoZm6.js";import"./index-BpkKmY4O.js";import"./DashLayout.vue_vue_type_script_setup_true_lang-Ch2egXHm.js";import"./RightDashHeader.vue_vue_type_script_setup_true_lang-Bn3G870_.js";import"./FormPageHeader.vue_vue_type_script_setup_true_lang-CAg7Z6LS.js";import"./BoxPanelWrapper.vue_vue_type_script_setup_true_lang-CmJ-Iy6y.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const be={class:"text-xs text-gray-500 mt-1"},ge={class:"flex items-center justify-end gap-2"},he={key:0,class:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white mr-1.5"},ye={key:1,class:"flex iconify hugeicons--money-bag-02 mr-1.5"},Re=de({__name:"NewEvaluation",setup(xe){const P=ce(),L=ue(),a=ne({personnel_id:void 0,critiques:"",c1_quantite_travail:void 0,c2_theorie_pratique:void 0,c3_determ_ress_perso:void 0,c4_ponctualite:void 0,c5_dr_att_posit_collab:void 0,school_year_id:void 0,semester_id:void 0,school_id:void 0}),{data:k,fetchData:Y,loading:H}=y(c.GET_PERSONALS),{data:z,fetchData:Q,loading:j}=y(c.GET_SCHOOL_YEARS),{data:T,fetchData:J,loading:W}=y(c.GET_SEMESTERS),{data:M,fetchData:K,loading:X}=y(c.GET_SCHOOLS),{data:x,fetchData:Z}=y(c.GET_FONCTIONS),ee=r=>{var g;if(!r||!x.value)return"N/A";const e=(Array.isArray(x.value)?x.value:((g=x.value)==null?void 0:g.data)||[]).find(U=>U.id==r);return(e==null?void 0:e.name)||(e==null?void 0:e.title)||(e==null?void 0:e.libelle)||"N/A"},R=p(()=>{var t;return(Array.isArray(k.value)?k.value:((t=k.value)==null?void 0:t.data)||[]).map(e=>({id:e.id,name:`${e.name||e.nom||""} ${e.postnom||""} ${e.firstname||e.prenom||""}`.trim(),matricule:e.matricule,fonction:ee(e.fonction_id)}))}),le=p(()=>{const r=z.value;return(Array.isArray(r)?r:(r==null?void 0:r.years)??(r==null?void 0:r.data)??[]).map(e=>({id:e.id,label:e.name||e.year||e.libelle||`${e.start_year}-${e.end_year}`||"N/A"}))}),te=p(()=>{var t;return(Array.isArray(T.value)?T.value:((t=T.value)==null?void 0:t.data)||[]).map(e=>({id:e.id,label:e.name||e.libelle||e.title||`Semestre ${e.id}`}))}),ae=p(()=>{var t;return(Array.isArray(M.value)?M.value:((t=M.value)==null?void 0:t.data)||[]).map(e=>({id:e.id,label:e.name||e.libelle||e.title||e.denomination||`École ${e.id}`}))}),F=p(()=>a.personnel_id?R.value.find(r=>r.id===a.personnel_id):null),{loading:V,error:O,postData:se}=ve(),G=p(()=>a.personnel_id!==void 0&&a.critiques.trim()!==""&&a.critiques.length<=255&&a.c1_quantite_travail!==void 0&&a.c1_quantite_travail>=0&&a.c2_theorie_pratique!==void 0&&a.c2_theorie_pratique>=0&&a.c3_determ_ress_perso!==void 0&&a.c3_determ_ress_perso>=0&&a.c4_ponctualite!==void 0&&a.c4_ponctualite>=0&&a.c5_dr_att_posit_collab!==void 0&&a.c5_dr_att_posit_collab>=0&&a.school_year_id!==void 0&&a.semester_id!==void 0&&a.school_id!==void 0);async function oe(){var g;if(!G.value){C({message:"Veuillez remplir tous les champs obligatoires correctement.",type:"error"});return}const r=L.user,t=(r==null?void 0:r.id)||((g=r==null?void 0:r.user)==null?void 0:g.id)||1,e={critiques:a.critiques.trim(),c1_quantite_travail:Number(a.c1_quantite_travail),c2_theorie_pratique:Number(a.c2_theorie_pratique),c3_determ_ress_perso:Number(a.c3_determ_ress_perso),c4_ponctualite:Number(a.c4_ponctualite),c5_dr_att_posit_collab:Number(a.c5_dr_att_posit_collab),school_year_id:Number(a.school_year_id),semester_id:Number(a.semester_id),school_id:Number(a.school_id),author_id:Number(t)};try{if(await se(c.CREATE_EVALUATION,e),O.value){console.error("❌ Erreur API:",O.value),C({message:O.value,type:"error"});return}C({message:"Évaluation créée avec succès !",type:"success"}),re(),setTimeout(()=>{P.push("/rh/saisie/evaluation")},1e3)}catch(U){console.error("Erreur lors de la soumission:",U),C({message:"Une erreur inattendue s'est produite.",type:"error"})}}function re(){a.personnel_id=void 0,a.critiques="",a.c1_quantite_travail=void 0,a.c2_theorie_pratique=void 0,a.c3_determ_ress_perso=void 0,a.c4_ponctualite=void 0,a.c5_dr_att_posit_collab=void 0,a.school_year_id=void 0,a.semester_id=void 0,a.school_id=void 0}function ie(){P.push("/rh/saisie/evaluation")}return me(async()=>{await Promise.all([Y(),Q(),J(),K(),Z()])}),(r,t)=>(n(),h(pe,{title:"Nouvelle évaluation","link-back":"/rh/saisie/evaluation","group-route":"/rh/saisie/personnel",module:"rh",breadcrumb:[{label:"GRH",href:"/rh"},{label:"Evaluation",href:"/rh/saisie/evaluation"},{label:"Nouvelle évaluation",isActive:!0}]},{default:o(()=>[f("form",{onSubmit:_e(oe,["prevent"]),class:"w-full flex flex-col space-y-8"},[l(B,{class:"grid sm:grid-cols-2 lg:grid-cols-3 gap-y-6 gap-x-10",title:"Informations sur l'employé"},{default:o(()=>[l(u,null,{default:o(()=>[l(s(d),{class:"text-sm"},{default:o(()=>[t[10]||(t[10]=i(" Nom du personnel ",-1)),l(m)]),_:1}),l(s(S),{modelValue:a.personnel_id,"onUpdate:modelValue":t[0]||(t[0]=e=>a.personnel_id=e),disabled:s(H)},{default:o(()=>[l(s(q),{class:"!h-10 bg-white w-full"},{default:o(()=>[l(s(A),{placeholder:"Sélectionner un employé"})]),_:1}),l(s(w),null,{default:o(()=>[l(s(D),null,{default:o(()=>[(n(!0),v(N,null,E(R.value,e=>(n(),h(s($),{key:e.id,value:e.id},{default:o(()=>[i(b(e.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1}),l(u,null,{default:o(()=>{var e;return[l(s(d),{class:"text-sm"},{default:o(()=>[...t[11]||(t[11]=[i("Matricule",-1)])]),_:1}),l(s(_),{value:((e=F.value)==null?void 0:e.matricule)||"",class:"bg-gray-100 transition-all h-10 rounded-md",readonly:"",placeholder:"Sélectionner d'abord un personnel"},null,8,["value"])]}),_:1}),l(u,null,{default:o(()=>{var e;return[l(s(d),{class:"text-sm"},{default:o(()=>[...t[12]||(t[12]=[i("Fonction",-1)])]),_:1}),l(s(_),{value:((e=F.value)==null?void 0:e.fonction)||"",class:"bg-gray-100 transition-all h-10 rounded-md",readonly:"",placeholder:"Sélectionner d'abord un personnel"},null,8,["value"])]}),_:1}),l(u,null,{default:o(()=>[l(s(d),{class:"text-sm"},{default:o(()=>[t[13]||(t[13]=i(" Année scolaire ",-1)),l(m)]),_:1}),l(s(S),{modelValue:a.school_year_id,"onUpdate:modelValue":t[1]||(t[1]=e=>a.school_year_id=e),disabled:s(j)},{default:o(()=>[l(s(q),{class:"!h-10 bg-white w-full"},{default:o(()=>[l(s(A),{placeholder:"Sélectionner l'année scolaire"})]),_:1}),l(s(w),null,{default:o(()=>[l(s(D),null,{default:o(()=>[(n(!0),v(N,null,E(le.value,e=>(n(),h(s($),{key:e.id,value:e.id},{default:o(()=>[i(b(e.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1}),l(u,null,{default:o(()=>[l(s(d),{class:"text-sm"},{default:o(()=>[t[14]||(t[14]=i(" Semestre ",-1)),l(m)]),_:1}),l(s(S),{modelValue:a.semester_id,"onUpdate:modelValue":t[2]||(t[2]=e=>a.semester_id=e),disabled:s(W)},{default:o(()=>[l(s(q),{class:"!h-10 bg-white w-full"},{default:o(()=>[l(s(A),{placeholder:"Sélectionner le semestre"})]),_:1}),l(s(w),null,{default:o(()=>[l(s(D),null,{default:o(()=>[(n(!0),v(N,null,E(te.value,e=>(n(),h(s($),{key:e.id,value:e.id},{default:o(()=>[i(b(e.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1}),l(u,null,{default:o(()=>[l(s(d),{class:"text-sm"},{default:o(()=>[t[15]||(t[15]=i(" École ",-1)),l(m)]),_:1}),l(s(S),{modelValue:a.school_id,"onUpdate:modelValue":t[3]||(t[3]=e=>a.school_id=e),disabled:s(X)},{default:o(()=>[l(s(q),{class:"!h-10 bg-white w-full"},{default:o(()=>[l(s(A),{placeholder:"Sélectionner l'école"})]),_:1}),l(s(w),null,{default:o(()=>[l(s(D),null,{default:o(()=>[(n(!0),v(N,null,E(ae.value,e=>(n(),h(s($),{key:e.id,value:e.id},{default:o(()=>[i(b(e.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1}),l(u,{class:"lg:col-span-3"},{default:o(()=>[l(s(d),{class:"text-sm"},{default:o(()=>[t[16]||(t[16]=i(" Critiques / Observations ",-1)),l(m)]),_:1}),l(s(fe),{modelValue:a.critiques,"onUpdate:modelValue":t[4]||(t[4]=e=>a.critiques=e),class:"bg-white transition-all rounded-md min-h-[100px]",placeholder:"Remarques ou notes particulières sur cette évaluation...",maxlength:"255"},null,8,["modelValue"]),f("p",be,b(a.critiques.length)+"/255 caractères",1)]),_:1})]),_:1}),t[23]||(t[23]=f("div",{class:"w-full flex h-px bg-gray-300"},null,-1)),l(B,{class:"grid sm:grid-cols-2 lg:grid-cols-3 gap-y-6 gap-x-10",title:"Evaluation"},{default:o(()=>[l(u,null,{default:o(()=>[l(s(d),{class:"text-sm"},{default:o(()=>[t[17]||(t[17]=i(" C1 Quantité & Qualité de travail [/20] ",-1)),l(m)]),_:1}),l(s(_),{modelValue:a.c1_quantite_travail,"onUpdate:modelValue":t[5]||(t[5]=e=>a.c1_quantite_travail=e),modelModifiers:{number:!0},type:"number",class:"bg-white transition-all h-10 rounded-md",placeholder:"0",min:"0",max:"20",step:"0.5"},null,8,["modelValue"])]),_:1}),l(u,null,{default:o(()=>[l(s(d),{class:"text-sm"},{default:o(()=>[t[18]||(t[18]=i(" C2 Maitrise des connaissances théoriques et pratiques [/20] ",-1)),l(m)]),_:1}),l(s(_),{modelValue:a.c2_theorie_pratique,"onUpdate:modelValue":t[6]||(t[6]=e=>a.c2_theorie_pratique=e),modelModifiers:{number:!0},type:"number",class:"bg-white transition-all h-10 rounded-md",placeholder:"0",min:"0",max:"20",step:"0.5"},null,8,["modelValue"])]),_:1}),l(u,null,{default:o(()=>[l(s(d),{class:"text-sm"},{default:o(()=>[t[19]||(t[19]=i(" C3 Détermination d'utiliser des ressources personnelles [/20] ",-1)),l(m)]),_:1}),l(s(_),{modelValue:a.c3_determ_ress_perso,"onUpdate:modelValue":t[7]||(t[7]=e=>a.c3_determ_ress_perso=e),modelModifiers:{number:!0},type:"number",class:"bg-white transition-all h-10 rounded-md",placeholder:"0",min:"0",max:"20",step:"0.5"},null,8,["modelValue"])]),_:1}),l(u,null,{default:o(()=>[l(s(d),{class:"text-sm"},{default:o(()=>[t[20]||(t[20]=i(" C4 Ponctualité [/20] ",-1)),l(m)]),_:1}),l(s(_),{modelValue:a.c4_ponctualite,"onUpdate:modelValue":t[8]||(t[8]=e=>a.c4_ponctualite=e),modelModifiers:{number:!0},type:"number",class:"bg-white transition-all h-10 rounded-md",placeholder:"0",min:"0",max:"20",step:"0.5"},null,8,["modelValue"])]),_:1}),l(u,null,{default:o(()=>[l(s(d),{class:"text-sm"},{default:o(()=>[t[21]||(t[21]=i(" C5 Droiture, attitude positive, collaborations [/20] ",-1)),l(m)]),_:1}),l(s(_),{modelValue:a.c5_dr_att_posit_collab,"onUpdate:modelValue":t[9]||(t[9]=e=>a.c5_dr_att_posit_collab=e),modelModifiers:{number:!0},class:"bg-white transition-all h-10 rounded-md",placeholder:"0",type:"number",min:"0",max:"20",step:"0.5"},null,8,["modelValue"])]),_:1})]),_:1}),t[24]||(t[24]=f("div",{class:"w-full flex h-px bg-gray-300"},null,-1)),f("div",ge,[l(s(I),{type:"button",variant:"outline",onClick:ie,disabled:s(V)},{default:o(()=>[...t[22]||(t[22]=[f("span",{class:"flex iconify hugeicons--cancel-01 mr-1.5"},null,-1),i(" Annuler ",-1)])]),_:1},8,["disabled"]),l(s(I),{type:"submit",disabled:!G.value||s(V)},{default:o(()=>[s(V)?(n(),v("span",he)):(n(),v("span",ye)),i(" "+b(s(V)?"Enregistrement...":"Enregistrer"),1)]),_:1},8,["disabled"])])],32)]),_:1}))}});export{Re as default};
