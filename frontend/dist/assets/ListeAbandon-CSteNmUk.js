import{_ as P}from"./LayoutGestionDisciplinaire.vue_vue_type_script_setup_true_lang-skQCPo4l.js";import{d as T,r as m,v as H,s as $,n as I,p as J,q as K,x as C,w as t,b as r,f as s,j as Q,i as o,k as p,ab as z,y as d,c as D,F as W,G as j,o as v,h as X,t as _}from"./index-CJ_PivE-.js";import{_ as Z}from"./Input.vue_vue_type_script_setup_true_lang-B9adgRZV.js";import{a as R}from"./abandonCasesService-B1DRDXT3.js";import{S as ee,F as ae}from"./FiliaireService-CYGYY8j2.js";import{C as le}from"./ClassroomService--2HkcG_r.js";import{S as se,a as ie}from"./SemestreService-BP5X1NpV.js";import{a as te,b as oe,_ as ne}from"./PopoverTrigger.vue_vue_type_script_setup_true_lang-DzZWQSaq.js";import{_ as re}from"./FilterBadges.vue_vue_type_script_setup_true_lang-CBuiPNtr.js";import{_ as de}from"./ListClassRoom.vue_vue_type_script_setup_true_lang-crHdkUu0.js";import{_ as ue}from"./ListFiliere.vue_vue_type_script_setup_true_lang-Dgxwljrk.js";import{_ as fe}from"./ListSchoolYear.vue_vue_type_script_setup_true_lang-FGtf-Ajw.js";import{_ as me}from"./DateFilter.vue_vue_type_script_setup_true_lang-BLMQrden.js";import{a as ce,b as V,c,d as _e,e as f,_ as pe}from"./TableHeader.vue_vue_type_script_setup_true_lang-cS4zBTGx.js";import{a as ve}from"./AlertMessage.vue_vue_type_script_setup_true_lang-DthA28zY.js";import{u as ge}from"./useSearch-uL6Ct-ER.js";import"./LayoutSaisieOperation.vue_vue_type_script_setup_true_lang-bYPLg6Nt.js";import"./DashLayoutWithMode.vue_vue_type_script_setup_true_lang-DzpyZ4TL.js";import"./RightDashHeader.vue_vue_type_script_setup_true_lang-Bn3G870_.js";import"./DashPageHeader.vue_vue_type_script_setup_true_lang-DucYyTAx.js";import"./BoxPanelWrapper.vue_vue_type_script_setup_true_lang-CmJ-Iy6y.js";import"./index-BpkKmY4O.js";import"./SelectGroup.vue_vue_type_script_setup_true_lang-CwIOzTi6.js";import"./useGetApi-EdzHoZm6.js";import"./DialogTrigger.vue_vue_type_script_setup_true_lang-Bm461x8Q.js";const be={class:"flex flex-col md:flex-row gap-3 md:items-center md:justify-between"},ye={class:"flex flex-1 items-center gap-2"},he={class:"relative max-w-xs w-full"},xe={class:"grid gap-4"},we={class:"flex flex-col gap-3.5"},Ae={class:"flex flex-wrap items-center gap-2.5"},Se={class:"mt-4 rounded-md overflow-hidden flex flex-1 bg-white"},$e={class:"flex items-center gap-2 w-max"},Ce={class:"hidden group-hover:flex items-center gap-2"},Ze=T({__name:"ListeAbandon",setup(Ve){const y=m([{id:1,label:"--------"}]),h=m([{id:1,name:"-----------"}]),x=m([{id:1,name:"----------------------"}]),F=m([{id:1,label:"----------"}]),w=m([{id:1,full_name:"-------------"}]),k=m([]),A=m(!1),g=m(!1);H(()=>{B(),L(),U(),M(),E(),b()});const B=async()=>{var e;const a=await ee.getAllSchoolYear();a&&(y.value=(e=a==null?void 0:a.data)==null?void 0:e.years.map(l=>({id:l.id,label:l.name})))},L=async()=>{const a=await le.getAllClassroom();if(a&&a.data){const e=Array.isArray(a.data)?a.data:Array.isArray(a.data.data)?a.data.data:[];h.value=e.map(l=>({id:l.id,name:l.name}))}},U=async()=>{var e;const a=await ae.getAllFiliaire();a&&(x.value=(e=a==null?void 0:a.data)==null?void 0:e.data.map(l=>({id:l.id,name:l.name})))},E=async()=>{var e;const a=await se.getAllSemestre();a&&(F.value=(e=a==null?void 0:a.data)==null?void 0:e.data.map(l=>({id:l.id,label:l.name})))},M=async()=>{var e,l;const a=await ie.getAllStudents();a&&(w.value=(l=(e=a==null?void 0:a.data)==null?void 0:e.students)==null?void 0:l.data.map(i=>({id:i==null?void 0:i.id,full_name:`${(i==null?void 0:i.name)??""} ${(i==null?void 0:i.firstname)??""} ${(i==null?void 0:i.lastname)??""}`})))},b=async(a={})=>{var e;A.value=!0;try{const l=await R.getAllAbandonCases(a);l!=null&&l.data&&(k.value=(e=l==null?void 0:l.data)==null?void 0:e.data)}catch{$({message:"Erreur lors du chargement des abandons",type:"error"})}finally{A.value=!1}},{query:S}=ge(a=>{b({...a,...n})},500),n=I({classroom_id:void 0,filiere_id:void 0,school_year_id:void 0,date:void 0}),N=J(()=>({classroom_id:h.value||[],filiere_id:x.value||[],school_year_id:y.value||[],date:[]})),Y={classroom_id:(a,e)=>{const l=e==null?void 0:e.find(i=>i.id===a);return l?l.name:a},filiere_id:(a,e)=>{const l=e==null?void 0:e.find(i=>i.id===a);return l?l.name:a},school_year_id:(a,e)=>{const l=e==null?void 0:e.find(i=>i.id===a);return l?l.label:a},date:a=>a},q=a=>{a==="classroom_id"&&(n.classroom_id=void 0),a==="filiere_id"&&(n.filiere_id=void 0),a==="school_year_id"&&(n.school_year_id=void 0),a==="date"&&(n.date=void 0)};K([()=>n.classroom_id,()=>n.filiere_id,()=>n.school_year_id,()=>n.date],()=>{const a={};n.classroom_id&&(a.classroom_id=n.classroom_id),n.filiere_id&&(a.filiere_id=n.filiere_id),n.school_year_id&&(a.school_year_id=n.school_year_id),n.date&&(a.date=n.date),b(a)});const G=async a=>{g.value=!0;try{await R.deleteAbandonCase(a),$({message:"Abandon supprimé avec succès",type:"success"}),await b(n)}catch{$({message:"Erreur lors de la suppression",type:"error"})}finally{g.value=!1}};function O(a){return new Date(a).toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}return(a,e)=>(v(),C(P,{"active-tag-name":"abandons",breadcrumb:[{label:"Élèves",href:"/apprenants"},{label:"Opérations",href:"/apprenants/operations"},{label:"Gestion Disciplinaire",href:"/apprenants/operations/gestion-disciplinaire"},{label:"Abandons",href:"/apprenants/operations/gestion-disciplinaire/abandons"}]},{default:t(()=>[r("div",be,[r("div",ye,[r("div",he,[s(o(Z),{modelValue:o(S),"onUpdate:modelValue":e[0]||(e[0]=l=>Q(S)?S.value=l:null),type:"text",id:"search",name:"search",placeholder:"Rechercher...",class:"w-full ps-10 border border-gray-200/40 bg-white transition-all h-9 rounded-md"},null,8,["modelValue"]),e[5]||(e[5]=r("div",{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-foreground-muted/70"},[r("span",{class:"flex iconify hugeicons--search-01 text-sm"})],-1))]),s(o(ne),null,{default:t(()=>[s(o(te),{"as-child":""},{default:t(()=>[s(o(p),{variant:"ghost",size:"sm",class:"h-9 rounded-md border bg-white"},{default:t(()=>[...e[6]||(e[6]=[r("span",{class:"hidden sm:flex"},"Filtre",-1),r("span",{class:"iconify hugeicons--filter"},null,-1)])]),_:1})]),_:1}),s(o(oe),{class:"w-80"},{default:t(()=>[r("div",xe,[e[7]||(e[7]=r("div",{class:"space-y-2"},[r("h4",{class:"font-medium leading-none"},"Filtrage")],-1)),r("div",we,[s(de,{modelValue:n.classroom_id,"onUpdate:modelValue":e[1]||(e[1]=l=>n.classroom_id=l)},null,8,["modelValue"]),s(ue,{modelValue:n.filiere_id,"onUpdate:modelValue":e[2]||(e[2]=l=>n.filiere_id=l)},null,8,["modelValue"]),s(fe,{modelValue:n.school_year_id,"onUpdate:modelValue":e[3]||(e[3]=l=>n.school_year_id=l)},null,8,["modelValue"]),s(me,{modelValue:n.date,"onUpdate:modelValue":e[4]||(e[4]=l=>n.date=l),label:"Date"},null,8,["modelValue"])])])]),_:1})]),_:1}),s(re,{filters:n,"reference-data":N.value,"custom-labels":Y,onRemoveFilter:q},null,8,["filters","reference-data"])]),r("div",Ae,[s(o(p),{size:"md",class:"rounded-md","as-child":""},{default:t(()=>[s(o(z),{to:"/apprenants/operations/gestion-disciplinaire/abandon"},{default:t(()=>[...e[8]||(e[8]=[r("span",{class:"flex iconify hugeicons--plus-sign"},null,-1),r("span",{class:"hidden sm:flex"},"Ajouter Abandon",-1)])]),_:1})]),_:1})])]),r("div",Se,[s(o(pe),{class:"rounded-md bg-white"},{default:t(()=>[s(o(ce),null,{default:t(()=>[s(o(V),null,{default:t(()=>[s(o(c),null,{default:t(()=>[...e[9]||(e[9]=[d("Date",-1)])]),_:1}),s(o(c),null,{default:t(()=>[...e[10]||(e[10]=[d("Année scolaire",-1)])]),_:1}),s(o(c),null,{default:t(()=>[...e[11]||(e[11]=[d("Classe",-1)])]),_:1}),s(o(c),null,{default:t(()=>[...e[12]||(e[12]=[d("Élève",-1)])]),_:1}),s(o(c),null,{default:t(()=>[...e[13]||(e[13]=[d("Section",-1)])]),_:1}),s(o(c),null,{default:t(()=>[...e[14]||(e[14]=[d("Semestre",-1)])]),_:1}),s(o(c),null,{default:t(()=>[...e[15]||(e[15]=[d("Commentaire",-1)])]),_:1}),s(o(c),null,{default:t(()=>[...e[16]||(e[16]=[d("Actions",-1)])]),_:1})]),_:1})]),_:1}),s(o(_e),null,{default:t(()=>[A.value?(v(),C(o(V),{key:0},{default:t(()=>[s(o(f),{colspan:8,class:"text-center py-10"},{default:t(()=>[...e[17]||(e[17]=[r("div",{class:"flex flex-col items-center justify-center text-gray-500"},[r("svg",{class:"animate-spin h-6 w-6 text-gray-400 mb-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[r("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),r("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8z"})]),r("span",null,"Chargement des abandons...")],-1)])]),_:1})]),_:1})):(v(!0),D(j,{key:1},W(k.value,l=>(v(),C(o(V),{key:(l==null?void 0:l.id)||Math.random(),class:"group hover:bg-gray-50"},{default:t(()=>[l?(v(),D(j,{key:0},[s(o(f),null,{default:t(()=>[d(_(l.created_at?O(l.created_at):"-"),1)]),_:2},1024),s(o(f),null,{default:t(()=>{var i;return[d(_(((i=y.value.find(u=>u.id==l.school_year_id))==null?void 0:i.label)||"-"),1)]}),_:2},1024),s(o(f),null,{default:t(()=>{var i;return[d(_(((i=h.value.find(u=>u.id==l.classroom_id))==null?void 0:i.name)||"-"),1)]}),_:2},1024),s(o(f),null,{default:t(()=>{var i;return[d(_(((i=w.value.find(u=>u.id==l.student_id))==null?void 0:i.full_name)||"-"),1)]}),_:2},1024),s(o(f),null,{default:t(()=>{var i;return[d(_(((i=x.value.find(u=>u.id==l.filiere_id))==null?void 0:i.name)||"-"),1)]}),_:2},1024),s(o(f),null,{default:t(()=>{var i;return[d(_(((i=F.value.find(u=>u.id==l.semester_id))==null?void 0:i.label)||"-"),1)]}),_:2},1024),s(o(f),null,{default:t(()=>[d(_(l.comment||"-"),1)]),_:2},1024),s(o(f),null,{default:t(()=>{var i;return[r("div",$e,[e[21]||(e[21]=r("button",{class:"flex group-hover:hidden rounded-full size-8 items-center justify-center hover:bg-gray-100 transition","aria-label":"Plus d'actions"},[r("span",{class:"iconify hugeicons--more-vertical-circle-01","aria-hidden":"true"})],-1)),r("div",Ce,[s(o(z),{to:`/apprenants/operations/gestion-disciplinaire/abandon/${l.id}`},{default:t(()=>[s(o(p),{variant:"ghost",size:"icon",class:"size-8 justify-center text-gray-500 hover:text-blue-600 hover:bg-blue-50","aria-label":"Modifier"},{default:t(()=>[...e[18]||(e[18]=[r("span",{class:"iconify hugeicons--edit-02","aria-hidden":"true"},null,-1)])]),_:1})]),_:1},8,["to"]),s(ve,{action:"danger",title:"Supprimer un abandon",message:`Vous etes sur le point de supprimer l'abandon de '${((i=w.value.find(u=>u.id==l.student_id))==null?void 0:i.full_name)||"cet élève"}'. Etes-vous sur de continuer?`},{trigger:t(()=>[s(o(p),{variant:"ghost",size:"icon",class:"size-8 justify-center text-gray-500 hover:text-red-600 hover:bg-red-50","aria-label":"Supprimer",disabled:g.value},{default:t(()=>[...e[19]||(e[19]=[r("span",{class:"iconify hugeicons--delete-02","aria-hidden":"true"},null,-1)])]),_:1},8,["disabled"])]),"confirm-action-button":t(()=>[s(o(p),{variant:"destructive",onClick:u=>G(l.id),size:"sm",class:"h-10 px-4",disabled:g.value},{default:t(()=>[...e[20]||(e[20]=[d(" Oui, Supprimer ",-1)])]),_:1},8,["onClick","disabled"])]),_:2},1032,["message"])])])]}),_:2},1024)],64)):X("",!0)]),_:2},1024))),128))]),_:1})]),_:1})])]),_:1}))}});export{Ze as default};
